<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rshawshank.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="纵浪大化中，不喜亦不惧">
<meta property="og:type" content="website">
<meta property="og:title" content="rhb_blog">
<meta property="og:url" content="http://rshawshank.github.io/page/9/index.html">
<meta property="og:site_name" content="rhb_blog">
<meta property="og:description" content="纵浪大化中，不喜亦不惧">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="rhb">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rshawshank.github.io/page/9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>rhb_blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">rhb_blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">rao的博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">56</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">24</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">127</span></a>

  </li>
        <li class="menu-item menu-item-photos">

    <a href="/photos/" rel="section"><i class="fa fa-camera fa-fw"></i>相册</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-download fa-fw"></i>资源</a>

  </li>
        <li class="menu-item menu-item-readnote">

    <a href="/readnote" rel="section"><i class="fa fa-book fa-fw"></i>阅读笔记</a>

  </li>
        <li class="menu-item menu-item-somethink">

    <a href="/somethink/" rel="section"><i class="fa fa-sticky-note fa-fw"></i>随笔闲谈</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/RShawshank" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/03/23/%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/23/%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%A6%82%E8%BF%B0/" class="post-title-link" itemprop="url">数据库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-22 19:57:09" itemprop="dateCreated datePublished" datetime="2020-03-22T19:57:09Z">2020-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-01 08:28:18" itemprop="dateModified" datetime="2020-06-01T08:28:18Z">2020-06-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="绪论"><a href="#绪论" class="headerlink" title="绪论"></a>绪论</h1><h2 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h2><p>数据模型是数据库系统的核心和基础。它是现实世界的模拟。</p>
<p>三要素：数据结构、数据操作、数据约束</p>
<h3 id="概念模型"><a href="#概念模型" class="headerlink" title="概念模型"></a>概念模型</h3><p>信息模型，按用户的观点来对数据和信息建模。</p>
<ul>
<li>实体：客观存在并可相互区别的事物</li>
<li>属性：实体所具有的某一特性</li>
<li>码：<strong>唯一</strong>标识实体的属性集</li>
<li>实体型：</li>
</ul>
<h3 id="逻辑模型和物理模型"><a href="#逻辑模型和物理模型" class="headerlink" title="逻辑模型和物理模型"></a>逻辑模型和物理模型</h3><ul>
<li>逻辑模型主要包括网状模型、层次模型、关系模型、面向对象模型···</li>
<li>物理模型是对数据最底层的抽象，描述数据在系统内部的表示方式和存取方法，在磁盘或者是磁带上的存储方式和存取方法。</li>
</ul>
<h3 id="客观对象的抽象过程–两步抽象"><a href="#客观对象的抽象过程–两步抽象" class="headerlink" title="客观对象的抽象过程–两步抽象"></a>客观对象的抽象过程–两步抽象</h3><p>1、客观对象抽象为概念模型</p>
<p>2、把概念模型转换为某一DBMS支持的数据模型</p>
<img src="/images/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20200323175234167.png" style="zoom:67%;" />

<h2 id="常用的数据模型"><a href="#常用的数据模型" class="headerlink" title="常用的数据模型"></a>常用的数据模型</h2><ul>
<li><strong>非关系模型</strong><ul>
<li>层次模型</li>
<li>网状模型</li>
</ul>
</li>
<li><strong>关系模型</strong><ul>
<li>面向对象模型</li>
<li>对象关系模型</li>
</ul>
</li>
</ul>
<h3 id="层次模型"><a href="#层次模型" class="headerlink" title="层次模型"></a>层次模型</h3><p>使用<strong>树状结构</strong>来表示各类实体以及实体间的联系。</p>
<p>要求：</p>
<ol>
<li>有且只有一个结点没有双亲结点，这个结点称为根节点</li>
<li><strong>根以外的其他结点有且只有一个双亲结点</strong></li>
</ol>
<p>根据上述的要求，可以确认层次模型其实是<strong>父与子之间一对多的联系</strong>。每个结点表示的是记录类型，记录类型之间的联系用结点之间的连线表示。</p>
<h4 id="层次模型的特点"><a href="#层次模型的特点" class="headerlink" title="层次模型的特点"></a>层次模型的特点</h4><ul>
<li>结点的双亲是唯一的</li>
<li>只能直接处理<strong>一对多</strong>的实体联系<br>【如果一个结点有多个双亲结点的话，只能通过引入冗余数据或者创建非自然的数据结构来解决】</li>
<li>每个记录类型可以定义一个排序字段（码字段）<br>【方便查找，并且查找效率高】</li>
<li>任何记录值只有按其路径查看时，才能显出它的全部意义<br>【可以直观的知道其一脉相承的父子关系，结构严密】</li>
<li>没有一个子女记录值能够脱离双亲记录值而独立存在<br>【例如：插入操作时，要先找到其父结点值；删除操作时，其子结点会一并被删除】</li>
<li>查询子女结点必须通过双亲结点</li>
</ul>
<h4 id="多对多联系在层次模型中的表示"><a href="#多对多联系在层次模型中的表示" class="headerlink" title="多对多联系在层次模型中的表示"></a>多对多联系在层次模型中的表示</h4><p>基本思路是：将多对多联系分解成一对多联系</p>
<p><strong>冗余结点法</strong>：就是将存在多对多联系的结点拆分成一对多联系的模式。会产生多个根节点，同时该多个根结点也表示子结点。</p>
<p><strong>虚拟结点法</strong>：就是将存在多对多联系的结点拆分，产生多个根结点。每个根节点连接一个虚拟结点【该虚拟结点就是上述拆开的子节点】</p>
<h4 id="增删查改与完整性约束"><a href="#增删查改与完整性约束" class="headerlink" title="增删查改与完整性约束"></a>增删查改与完整性约束</h4><ul>
<li>无相应的双亲结点值就不能插入子女结点值</li>
<li>如果删除双亲结点值，则相应的子女结点值也会被删除</li>
<li><strong>更新操作时，应更新所有相应记录，以保证数据的一致性</strong></li>
</ul>
<h4 id="层次数据模型的存储结构"><a href="#层次数据模型的存储结构" class="headerlink" title="层次数据模型的存储结构"></a>层次数据模型的存储结构</h4><p><strong>邻接法</strong></p>
<p>按照层次树前序遍历将所有的记录值一次邻接存储，通过<strong>物理空间的位置相邻</strong>来实现层次顺序</p>
<p><strong>链接法</strong></p>
<p>用指针来反映数据之间的层次联系</p>
<img src="/images/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20200324103822351.png" style="zoom:67%;" />

<img src="/images/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20200324103845301.png" style="zoom:67%;" />



<h3 id="网状模型"><a href="#网状模型" class="headerlink" title="网状模型"></a>网状模型</h3><p>要求：</p>
<ol>
<li>允许一个以上的结点无双亲结点</li>
<li>一个结点可以有多个双亲结点</li>
</ol>
<p>层次模型可以看成是网状模型的一个特例</p>
<h3 id="关系模型"><a href="#关系模型" class="headerlink" title="关系模型"></a>关系模型</h3><p><strong>用二维表来表示实体及其联系：行、列</strong></p>
<blockquote>
<p>用表格表示实体集，用列表示属性，表结构表示实体的型</p>
<p>用表间的特定的冗余信息表示实体间的联系（主键和外键）</p>
<p>行、列是无序的</p>
<p>列不可再分</p>
<p>没有重复行</p>
</blockquote>
<p><strong>关系规范化要求：</strong>关系的每一个分量必须是一个不可分的数据项 <strong>不允许表中还有表</strong></p>
<img src="/images/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20200324104653997.png" style="zoom:50%;" />

<h4 id="关系模型的存储结构"><a href="#关系模型的存储结构" class="headerlink" title="关系模型的存储结构"></a>关系模型的存储结构</h4><p>实体及实体间的联系都用表来表示</p>
<p>表以文件形式存储</p>
<h2 id="数据库系统结构"><a href="#数据库系统结构" class="headerlink" title="数据库系统结构"></a>数据库系统结构</h2><p>在数据模型中有“型”和“值”的概念。<strong>型是指对某一类数据的结构和属性的说明。值是型的一个具体赋值</strong></p>
<p>数据库系统内部的体系结构：采取三级模式结构</p>
<p>数据库系统外部的体系结构：</p>
<ul>
<li>单用户结构</li>
<li>主从式结构</li>
<li>分布式结构</li>
<li>客户|服务器</li>
<li>浏览器|应用服务器|数据库服务器多层结构</li>
</ul>
<h3 id="数据库系统的三级模式结构"><a href="#数据库系统的三级模式结构" class="headerlink" title="数据库系统的三级模式结构"></a>数据库系统的三级模式结构</h3><p><img src="/images/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20200324120106956.png"></p>
<h4 id="模式（逻辑模式）"><a href="#模式（逻辑模式）" class="headerlink" title="模式（逻辑模式）"></a>模式（逻辑模式）</h4><p>对数据库中的全部数据的逻辑结构和特征的描述，它仅仅涉及到的是型的描述，不涉及到具体的值。</p>
<p><strong>模式的定义：</strong></p>
<ul>
<li>数据的逻辑结构（包括了数据项的名字、类型、取值范围···）</li>
<li>数据之间的联系</li>
<li>数据有关的安全性、完整性要求</li>
</ul>
<blockquote>
<p><strong>模式（schema）</strong>：反映的是数据的结构及其联系</p>
<p><strong>实例（instance）</strong>：模式的一个具体值，实例会随着数据库中的数据的更新而变动</p>
<p><strong>模式是相对稳定的，而实例是相对变动的</strong></p>
</blockquote>
<p><strong>一个数据库只有一个模式，可以将模式视为是数据库数据在逻辑级上的视图。</strong></p>
<p>&#x3D;&#x3D;<strong>模式是数据库系统模式结构的中间层</strong>&#x3D;&#x3D;</p>
<ul>
<li>与数据的物理存储细节和硬件环境无关</li>
<li>与具体的应用程序、开发工具及高级程序设计语言无关</li>
</ul>
<h4 id="外模式（子模式、用户模式）"><a href="#外模式（子模式、用户模式）" class="headerlink" title="外模式（子模式、用户模式）"></a>外模式（子模式、用户模式）</h4><p><strong>数据库用户的数据视图，是用户使用的局部数据的逻辑结构和特征的描述</strong></p>
<p>&#x3D;&#x3D;<strong>外模式介于模式和应用之间</strong>&#x3D;&#x3D;</p>
<ul>
<li>模式与外模式的关系：一对多<ul>
<li>外模式通常是模式的子集</li>
<li>一个数据库可以拥有多个外模式。</li>
<li>对模式中同一数据，在外模式中的结构、类型、长度、保密级别都不同（这倒是让我想起了在同一个项目下使用不同数据库存储不同的数据）</li>
</ul>
</li>
<li>外模式与应用的关系：一对多<ul>
<li>同一外模式可以为某个用户的多个应用系统所使用</li>
<li>但是一个应用程序只能使用一个外模式</li>
</ul>
</li>
</ul>
<p>外模式的用途</p>
<ul>
<li>保证数据库安全性</li>
<li>每个用户只能看见和访问所对应的外模式中的数据</li>
</ul>
<h3 id="内模式（存储模式）"><a href="#内模式（存储模式）" class="headerlink" title="内模式（存储模式）"></a>内模式（存储模式）</h3><p>是数据物理结构和存储方式的描述（不同数据库的内部实现方式）</p>
<p>是数据在数据库内部的表示方式</p>
<ul>
<li>记录的存储方式（顺序存储、按照B树结构存储、按照hash方式存储）</li>
<li>索引的组织方式</li>
<li>数据是否压缩存储</li>
<li>数据是否加密</li>
<li>数据存储记录结构的规定</li>
</ul>
<p><strong>一个数据库只有一个内模式</strong></p>
<h3 id="数据库的二级映像功能与数据独立性"><a href="#数据库的二级映像功能与数据独立性" class="headerlink" title="数据库的二级映像功能与数据独立性"></a>数据库的二级映像功能与数据独立性</h3><p>二级映像在DBMS内部实现这三个抽象层次的联系和转换</p>
<ul>
<li>外模式|模式映像</li>
<li>模式|内模式映像</li>
</ul>
<h4 id="外模式-模式映象"><a href="#外模式-模式映象" class="headerlink" title="外模式|模式映象"></a>外模式|模式映象</h4><p>定义外模式与模式之间的对应关系。映象定义通常包含在各自外模式的描述中。</p>
<blockquote>
<p>模式描述的是数据的全局逻辑结构；外模式描述的是数据的局部逻辑结构。</p>
<p>同一个模式下可以有任意多个外模式。</p>
</blockquote>
<p><strong>保证数据的逻辑独立性</strong>：应用程序是依据数据的外模式编写的，从而应用程序不必修改，保证了数据与程序的逻辑独立性。</p>
<h4 id="模式-内模式映象"><a href="#模式-内模式映象" class="headerlink" title="模式|内模式映象"></a>模式|内模式映象</h4><p>定义了数据全局逻辑结构与存储结构之间的对应关系。通常包含在模式描述中。</p>
<p><strong>数据库中模式|内模式映象是唯一的。</strong></p>
<p><strong>保证了数据的物理独立性：</strong>当数据库的存储结构改变了，只要修改模式|内模式映象使得模式保持不变，应用程序就不会受到影响。</p>
<h4 id="数据库模式"><a href="#数据库模式" class="headerlink" title="数据库模式"></a>数据库模式</h4><ul>
<li>全局逻辑结构</li>
<li>设计数据库模式结构时应该首先确定数据库的逻辑模式</li>
</ul>
<h4 id="数据库的内模式"><a href="#数据库的内模式" class="headerlink" title="数据库的内模式"></a>数据库的内模式</h4><ul>
<li>依赖其全局逻辑结构</li>
<li>独立于数据库的用户视图（外模式）</li>
<li>独立于具体的存储设备</li>
<li>将全局逻辑结构中所定义的数据结构及其联系按照一定的物理存储策略进行组织，提高空间使用率。</li>
</ul>
<h4 id="数据库的外模式"><a href="#数据库的外模式" class="headerlink" title="数据库的外模式"></a>数据库的外模式</h4><ul>
<li>面向的是具体的应用程序</li>
<li>定义在逻辑模式之上</li>
<li>独立于存储模式和存储设备</li>
<li>当应用需求发生较大的变化时，相对应外模式不能满足其视图要求时，该外模式就得做出相应改动。</li>
<li>设计外模式时应充分考虑到应用的扩展性</li>
</ul>
<h4 id="特定的应用程序"><a href="#特定的应用程序" class="headerlink" title="特定的应用程序"></a>特定的应用程序</h4><ul>
<li>是在外模式描述的数据结构上编制的</li>
<li>依赖于特定的外模式</li>
<li>与数据库的模式和存储结构独立</li>
<li>不同的应用程序有时可以共用一个外模式</li>
</ul>
<h2 id="数据库系统的组成"><a href="#数据库系统的组成" class="headerlink" title="数据库系统的组成"></a>数据库系统的组成</h2><img src="/images/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20200324155703346.png" style="zoom:67%;" />

<h3 id="硬件平台及数据库"><a href="#硬件平台及数据库" class="headerlink" title="硬件平台及数据库"></a>硬件平台及数据库</h3><ol>
<li><p>足够大的内存</p>
<blockquote>
<p>存放操作系统、数据库管理系统的核心模块、数据缓冲区和应用程序</p>
</blockquote>
</li>
<li><p>足够大的外存</p>
<blockquote>
<p>可以用作数据的备份</p>
</blockquote>
</li>
<li><p>较高的通道能力，提高数据传送率</p>
</li>
</ol>
<h3 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h3><ol>
<li><p>DBMS</p>
<blockquote>
<p>数据库管理系统是为数据库的建立、使用和维护配置的系统软件</p>
</blockquote>
</li>
<li><p>支持DBMS运行的操作系统</p>
</li>
<li><p>与数据库接口的高级语言和配套的编译系统</p>
</li>
<li><p>以DBMS为核心的应用开发工具</p>
</li>
<li><p>为特定应用环境开发的数据库应用系统</p>
</li>
</ol>
<h3 id="人员"><a href="#人员" class="headerlink" title="人员"></a>人员</h3><ol>
<li><p>数据库管理人员DBA</p>
<blockquote>
</blockquote>
</li>
<li><p>系统分析员和数据库设计人员</p>
</li>
<li><p>应用程序员</p>
</li>
<li><p>用户</p>
</li>
</ol>
<img src="/images/%E6%95%B0%E6%8D%AE%E5%BA%93/image-20200324160326154.png" style="zoom:67%;" />

<h2 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h2><p>文件系统和数据库系统都能管理数据，也都支持通过应用程序访问数据，两种方式在数据独立性上有何不同？</p>
<p>数据管理文件系统阶段和数据库系统阶段“数据独立性”有何不同？</p>
<blockquote>
<p> 在数据管理技术的发展过程中，经历了人工管理阶段、文件系统阶段和数据库系统阶段，其中数据独立性最高的阶段是数据库系统。数据库阶段用数据模型表示复杂的数据，有较高的数据独立性。数据库系统为用户提供了方便的用户接口，用户可使用查询语言或终端命令操作数据库，也可以用程序方式操作数据库。数据库管理系统提供了数据控制功能。</p>
<p> 文件系统和数据库系统之间的区别：</p>
<p> （1） 文件系统用文件将数据长期保存在外存上，数据库系统用数据库统一存储数据；</p>
<p> （2） 文件系统中的程序和数据有一定的联系，数据库系统中的程序和数据分离；</p>
<p> （3） 文件系统用操作系统中的存取方法对数据进行管理，数据库系统用DBMS统一管理和控制数据；</p>
<p> （4） 文件系统实现以文件为单位的数据共享，数据库系统实现以记录和字段为单位的数据共享。</p>
<p> 文件系统和数据库系统之间的联系：</p>
<p> （1） 均为数据组织的管理技术；</p>
<p> （2） 均由数据管理软件管理数据，程序与数据之间用存取方法进行转换；</p>
<p> （3） 数据库系统是在文件系统的基础上发展而来的。</p>
<p> 文件系统是操作系统用于明确存储设备（常见的是磁盘，也有基于NAND Flash的固态硬盘）或分区上的文件的方法和数据结构；即在存储设备上组织文件的方法。操作系统中负责管理和存储文件信息的软件机构称为文件管理系统，简称文件系统。</p>
<p> 文件系统由三部分组成：文件系统的接口，对对象操纵和管理的软件集合，对象及属性。从系统角度来看，文件系统是对文件存储设备的空间进行组织和分配，负责文件存储并对存入的文件进行保护和检索的系统。具体地说，它负责为用户建立文件，存入、读出、修改、转储文件，控制文件的存取，当用户不再使用时撤销文件等。</p>
</blockquote>
<p>数据库系统在管理数据时采用的分层管理的思想，也就是三级模式两级映像的架构，这么做起到了什么作用？</p>
<blockquote>
<p>采用三级模式和二级映像的原因：</p>
<p>1）保证了数据的独立性。将模式与内模式、模式与外模式分开保证了数据的物理独立性和逻辑独立性</p>
<p>2）简化了用户接口，按照外模式编写应用程序或敲入命令，不需了解内部结构</p>
<p>3）有利于数据共享，不同应用可共用一个外模式，减少了数据冗余</p>
<p>4）有利于数据的安全保密，在外模式限定下进行操作，不能对限定数据操作，保证了其他数据的安全</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/03/23/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-ML%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/23/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-ML%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">函数式编程-ML编程基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-22 19:56:50" itemprop="dateCreated datePublished" datetime="2020-03-22T19:56:50Z">2020-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-29 06:13:26" itemprop="dateModified" datetime="2020-04-29T06:13:26Z">2020-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">函数式编程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ML概览"><a href="#ML概览" class="headerlink" title="ML概览"></a>ML概览</h1><ul>
<li>ML强调的是表达式估计</li>
<li>ML更倾向于代数</li>
<li>ML表达式特征：类型可有可无、值可有可无、效果可有可无</li>
<li>类型检查十分严格</li>
</ul>
<h2 id="ML标准类型"><a href="#ML标准类型" class="headerlink" title="ML标准类型"></a>ML标准类型</h2><ul>
<li>基础类型(basic types) unit, int, real, bool, string</li>
<li>表(lists)  int list, (int -&gt; int) list</li>
<li>元组(tuples)  int * int, int * int * real</li>
<li>函数(functions) int -&gt; int, real -&gt; int * int</li>
</ul>
<p>所有对象都要有类型，不一定显式说明，但必须能静态推导(在编译时该类型能被编译器根据上下文推算出来)。例如：int y&#x3D;x+3就默认了x和y均是int型，因为会强制类型转换。</p>
<ul>
<li>单元(unit) 只包含一个元素，用空的括号表示，类似于C语言中的void类型。 ( ) : unit</li>
<li>整型(int) 负号用“~”表示。</li>
<li>浮点型(real)</li>
<li>布尔型(bool) true, false</li>
<li>字符串型(string) 双引号间的字符序列</li>
</ul>
<h3 id="表"><a href="#表" class="headerlink" title="表"></a>表</h3><ul>
<li>包含<strong>相同类型的元素</strong>序列</li>
<li>表中元素用“,”分隔，整个表用[ ]括起来</li>
<li>空表：[ ]或nil</li>
<li>表的类型表达式取决于表的元素类型，写作：<br>  &lt;元素类型&gt; list</li>
</ul>
<p> 如： int list, (int -&gt; int) list</p>
<ul>
<li>表可以嵌套</li>
</ul>
<p> 如: [1,2,3] : int list  [“张三”, “李四”]: string list</p>
<ul>
<li><p>相同类型元素的有限序列</p>
</li>
<li><p>元素可以重复出现，其顺序是有意义的</p>
</li>
<li><p>表中元素可以为任意类型，但需具有相同类型</p>
</li>
<li><p>表为多态类型</p>
</li>
<li><p>表的基本函数：</p>
<p>  :: (追加元素), @ (连接表), null (空表测试), hd(返回表头元素), tl(返回非空表的表尾), length(返回表长)</p>
<blockquote>
<p>• [1, 3, 2, 1, 21+21] : int list</p>
<p>• [true, false, true] : bool list</p>
<p>• [[1],[2, 3]] : (int list) list</p>
<p>• [ ] : int list, [ ] : bool list, ……</p>
<p>• 1::[2, 3] &#x3D; [1, 2, 3]</p>
<p>• [1, 2]@[3, 4] &#x3D; [1, 2, 3, 4]</p>
<p>• nil &#x3D; [ ]</p>
</blockquote>
</li>
</ul>
<h3 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h3><ul>
<li><strong>包含任意类型数据元素的定长序列</strong></li>
<li>类型表达式：每个元素的类型用*间隔并排列在一起。如： int * int, int * int * real</li>
<li>圆括号中用逗号分隔的数据元素，允许嵌套。如: (“张三”, “男”, 19, 1.75)</li>
</ul>
<p>​    [((“赵”,”子昂”)，21, 1.81), ((“张”, “文艺”), 20, 1.69)]对应的是((string * string)* int * real)list</p>
<h3 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h3><ul>
<li>类似C中的结构类型，可以包含不同类型的元素</li>
<li>每个元素有个名字</li>
<li>记录的值和类型的写法都用{ }括起来。如： {First_name&#x3D;“赵”, Last_name&#x3D;“子昂”}</li>
</ul>
<h3 id="元组、表和记录的异同点"><a href="#元组、表和记录的异同点" class="headerlink" title="元组、表和记录的异同点"></a>元组、表和记录的异同点</h3><ul>
<li>符号：（）  、   [ ]    、{  }</li>
<li>元素类型：可以不同    、    必须相同      、可以不同</li>
<li>长度：定长    、    变长       、变长</li>
</ul>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul>
<li>以一定的规则将定义域上的值映射到值域上去</li>
<li>类型由它的定义域类型和值域类型共同描述</li>
<li>-&gt;表示定义域到值域的映射</li>
</ul>
<p> fn: &lt;定义域类型&gt; -&gt; &lt;值域类型&gt;。如: fun add(x, y) &#x3D; x + y;</p>
<h4 id="ML标准函数"><a href="#ML标准函数" class="headerlink" title="ML标准函数"></a>ML标准函数</h4><ul>
<li><p>标准布尔函数：not, andalso, orelse。如：not true;    true andalso false;   true orelse false;</p>
</li>
<li><p>标准算数运算函数：~, +, -, *, div, &#x2F;。如：6 * 7;   3.0 * 2.0;</p>
<ul>
<li>运算符重载(operator ): 把同一运算符作用在不同类型上。</li>
<li>重载运算符的两边必须为同一类型。</li>
<li>整数到实数的转换：real</li>
<li>实数到整数的转换：floor(下取整), ceil(上取整), round(四舍五入)，trunc(忽略小数)</li>
</ul>
</li>
<li><p>标准字符串函数：</p>
<ul>
<li>把两个字符串合并成一个：^</li>
<li>返回字符串的长度：size</li>
</ul>
</li>
</ul>
<h3 id="值"><a href="#值" class="headerlink" title="值"></a>值</h3><ul>
<li><p>每个类型都有一个值的集合<br>  For each type t there is a set of <em>values</em></p>
</li>
<li><p>一个类型的表达式求值结果为该类型的一个值(或出错)<br>  An expression of type t <em>evaluates to a value of type</em> t (or fails to terminate)</p>
</li>
</ul>
<h4 id="函数求值"><a href="#函数求值" class="headerlink" title="函数求值"></a>函数求值</h4><p>函数：以一定的规则将定义域上的值映射到值域上</p>
<p>原型： fn:&lt;定义域类型&gt; -&gt; &lt;值域类型&gt;</p>
<h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><p><strong>赋予某个对象一个名字，包括值、类型、签名、结构和函子</strong></p>
<ul>
<li>函数的声明： fun &lt;函数名&gt; (&lt;形式参数&gt;) : &lt;结果类型&gt; &#x3D; &lt;函数体&gt;</li>
</ul>
<p> 例：fun divmod(x:int, y:int) : int*int &#x3D; (x div y, x mod y)</p>
<ul>
<li><p>值的声明：val pi &#x3D; 3.1415；val (q:int, r:int) &#x3D; divmod(42, 5)；</p>
<p>采用静态绑定方式——重新声明不会损坏系统、库或程序</p>
</li>
<li><p>类型绑定：type float &#x3D; real</p>
<p>type count &#x3D; int and average &#x3D; real</p>
</li>
<li><p>值绑定：val m : int &#x3D; 3+2</p>
<p>val pi : real &#x3D; 3.14 and e : real &#x3D; 2.17</p>
</li>
<li><p>组合声明：val m : int &#x3D; 3+2</p>
<p>val n : int &#x3D; m*m</p>
</li>
</ul>
<h4 id="声明的使用"><a href="#声明的使用" class="headerlink" title="声明的使用"></a>声明的使用</h4><p>声明函数：<br>  check : int * int -&gt; bool</p>
<p>局部声明：</p>
<p>  let D in E end</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fun</span> check(x<span class="operator">:</span><span class="type">int</span>, y<span class="operator">:</span><span class="type">int</span>)<span class="operator">:</span><span class="type">bool</span> <span class="operator">=</span></span><br><span class="line"><span class="keyword">let</span></span><br><span class="line">	<span class="keyword">val</span> (q<span class="operator">:</span><span class="type">int</span>, r<span class="operator">:</span><span class="type">int</span>)<span class="operator">=</span> divmod(x, y)</span><br><span class="line"><span class="keyword">in</span></span><br><span class="line">	(x <span class="operator">=</span> q<span class="operator">*</span>y <span class="operator">+</span> r)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>全局声明</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> pi : real = <span class="number">3.14</span>;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">square</span><span class="params">(r:<span class="type">real</span>)</span></span> : real = r * r;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">area</span><span class="params">(r:<span class="type">real</span>)</span></span> : real = pi * square(r);</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> pi : real = <span class="number">3.14159</span>;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">area</span><span class="params">(r:<span class="type">real</span>)</span></span> : real = pi * square(r);</span><br></pre></td></tr></table></figure>



<h3 id="声明、类型和值"><a href="#声明、类型和值" class="headerlink" title="声明、类型和值"></a>声明、类型和值</h3><ul>
<li>任意一个类型的表达式都可以进行求值操作</li>
<li>任意一个类型表达式求值的结果为该类型的一个值</li>
<li>ML提供重新声明功能 </li>
<li>声明将产生名字(变量)和值的绑定(结合)</li>
<li>绑定具有静态作用域</li>
</ul>
<h3 id="ML-x3D"><a href="#ML-x3D" class="headerlink" title="ML &#x3D;"></a>ML &#x3D;</h3><ul>
<li>“&#x3D;”用于类型的等式判断，称为等式类型(“<em>equality types</em>”)</li>
<li>等式类型包括整数、布尔值结合元组、表等构造子生成的类型</li>
</ul>
<h3 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h3><ul>
<li><p>只包含变量、构造子(数值、字符、元组、表等)和通配符的表达式</p>
<ul>
<li>模式中不是构造子的名字，是变量</li>
<li>模式中的变量必须彼此不同</li>
<li>构造子必须和变量区分开来</li>
</ul>
</li>
<li><p>通配符:  _</p>
</li>
<li><p>变量  : x   &#x2F;&#x2F;同一模式中，一个变量不能出现两次</p>
</li>
<li><p>常数  : 42, true, ~3   &#x2F;&#x2F; 实数和函数没有常数模式</p>
</li>
<li><p>元组  : (p1, …, pk)   &#x2F;&#x2F;p1, …, pk均为模式</p>
</li>
<li><p>表    : nil, p1::p2, [p1, …, pk]</p>
</li>
</ul>
<h3 id="规则说明"><a href="#规则说明" class="headerlink" title="规则说明"></a>规则说明</h3><ul>
<li>部分操作的内建规则：<ul>
<li>结合性强于 -&gt;</li>
<li>无结合规则</li>
<li>-&gt; 为右结合</li>
</ul>
</li>
</ul>
<h3 id="替代"><a href="#替代" class="headerlink" title="替代"></a>替代</h3><ul>
<li><p>给定集合绑定值【 x1:v1,…,xk:vk 】</p>
</li>
<li><p>及表达式e，计为[ x1:v1, …, xk:vk ] e</p>
</li>
<li><p>表达式替换为</p>
</li>
<li><p>v1 for x1,…,vk for xk </p>
</li>
<li><p>如</p>
<p>[ x:2 ] (x + x) is (2 + 2)；[ x:2 ] (fn y &#x3D;&gt; x + y) is (fn y &#x3D;&gt; 2 + y) </p>
<p>[ x:2 ] (if x&gt;0 then 1 else f(x-1))  is (if 2&gt;0 then 1 else f(2-1))</p>
</li>
</ul>
<h3 id="代码说明"><a href="#代码说明" class="headerlink" title="代码说明"></a>代码说明</h3><ul>
<li>函数定义前，用注释信息描述函数功能，形如(* comments*) ：<ul>
<li>函数名字和类型 (类型定义)</li>
<li>REQUIRES：参数说明 (明确参数范围)</li>
<li>ENSURES：函数在有效参数范围内的执行结果 (函数功能)</li>
</ul>
</li>
</ul>
<blockquote>
<p>范例1：函数eval的说明</p>
<p><strong>fun</strong> eval ([ ]:int list) : int &#x3D; 0<br> | eval (d::L) &#x3D; d + 10 * (eval L);</p>
<p>(* eval : int list -&gt; int  <em>)<br> ( * REQUIRES:  <em>)<br> (  * every integer in L is a decimal digit    * ) (</em> ENSURES:  * )<br> (</em>   eval(L) evaluates to a non-negative integer *)</p>
</blockquote>
<h3 id="程序正确性证明"><a href="#程序正确性证明" class="headerlink" title="程序正确性证明"></a>程序正确性证明</h3><ul>
<li>基于等式或者推导的方式进行数学证明</li>
<li>程序结构作为指导</li>
</ul>
<blockquote>
<p>为什么要进行程序正确性证明？</p>
<p>传统程序编写地是否正确性依靠分支测试，根据条件分支输入不同的数据检验是否正确？延伸出来很多自动化测试工具，黑盒测试、白盒测试和覆盖度测试。</p>
<p>函数式编程程序正确性证明是代码完成后用严格的数学推导证明对所有可能输入都产生正确结果。</p>
</blockquote>
<h2 id="归纳法"><a href="#归纳法" class="headerlink" title="归纳法"></a>归纳法</h2><h3 id="简单归纳法"><a href="#简单归纳法" class="headerlink" title="简单归纳法"></a>简单归纳法</h3><ul>
<li><strong>适用于涉及自然数的递归函数</strong><ul>
<li>参数为非负整数</li>
<li>f(x)的递归调用形如f(y),且size(y)&#x3D;size(x)-1</li>
</ul>
</li>
</ul>
<h3 id="完全归纳法"><a href="#完全归纳法" class="headerlink" title="完全归纳法"></a>完全归纳法</h3><p>证明对所有非负整数n，P(n)都成立</p>
<p>将P(k)简化为k个子问题： P(0), P(1), … , P(k-1)，且它们均成立时，可以利用{P(0), P(1), … , P(k-1)}推导出P(k)也成立</p>
<blockquote>
<p>如：P(0)成立</p>
<p>​    P(1)可由P(0)推导出来</p>
<p>​    P(2)可由P(0)， P(1)推导出来</p>
<p>​     P(3)可由P(0)， P(1)， P(2)推导出来</p>
<p>​    ……  </p>
<p>​    P(k)可由P(0), P(1), … , P(k-1)推导出来</p>
</blockquote>
<ul>
<li><strong>适用于涉及自然数的递归函数</strong><ul>
<li>参数为非负整数</li>
<li>f(x)的递归调用形如f(y),且size(y)&lt;size(x)</li>
</ul>
</li>
</ul>
<h3 id="结构归纳法"><a href="#结构归纳法" class="headerlink" title="结构归纳法"></a>结构归纳法</h3><p>基本情形： P([ ])</p>
<p>归纳步骤：对具有类型t的所有元素y和t list类型的数ys，都有P(ys)成立时， P(y::ys)成立</p>
<p>  ∀ i &lt; k, P(i)成立的条件下有P(k)</p>
<ul>
<li><strong>适用于涉及表和树的递归函数</strong></li>
</ul>
<h3 id="良基归纳法"><a href="#良基归纳法" class="headerlink" title="良基归纳法"></a>良基归纳法</h3><p>关系≺是良基的：</p>
<p>  不存在无穷降序链：…≺Xn≺…≺X2≺X1,</p>
<p>  <strong>对所有y’≺y</strong>，有P(y)，则P(y’)成立</p>
<ul>
<li><strong>可以处理广泛的可终止计算问题</strong></li>
</ul>
<h2 id="近似运行时间（近似时间复杂度）"><a href="#近似运行时间（近似时间复杂度）" class="headerlink" title="近似运行时间（近似时间复杂度）"></a>近似运行时间（近似时间复杂度）</h2><ul>
<li><p>反映基于大批量数据的程序运行性能</p>
<ul>
<li><p>假设基本操作为常量执行时间(Assume basic ops take <em>constant</em> time)</p>
</li>
<li><p>用Ο记号表示算法的时间性能(Give big-O classification)</p>
</li>
</ul>
</li>
<li><p>求解步骤：</p>
<ul>
<li>1.找出算法中的<strong>基本语句</strong>：算法中执行次数最多的那条语句就是基本语句，通常是最内层循环的循环体</li>
<li>2.<strong>计算基本语句的执行次数的数量级</strong>：忽略所有低次幂和最高次幂的系数，保证基本语句执行次数的函数中的最高次幂正确</li>
<li>3.用Ο记号表示算法的时间性能：将基本语句执行次数的数量级放入Ο记号中。</li>
</ul>
</li>
</ul>
<h2 id="递归分析"><a href="#递归分析" class="headerlink" title="递归分析"></a>递归分析</h2><p>递归函数的定义给出了程序的递推关系，执行情况用<em>work</em>表示</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/03/23/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/23/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-%E6%A6%82%E8%BF%B0/" class="post-title-link" itemprop="url">函数式编程概述</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-22 19:56:50" itemprop="dateCreated datePublished" datetime="2020-03-22T19:56:50Z">2020-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-23 07:28:56" itemprop="dateModified" datetime="2020-03-23T07:28:56Z">2020-03-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">函数式编程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="functional-programming"><a href="#functional-programming" class="headerlink" title="functional programming"></a>functional programming</h1><h2 id="函数式语言的特点"><a href="#函数式语言的特点" class="headerlink" title="函数式语言的特点"></a>函数式语言的特点</h2><ul>
<li><p><strong>不依赖于冯·诺伊曼体系结构的计算机</strong></p>
</li>
<li><p><strong>函数是”第一等公民”</strong></p>
<blockquote>
<p>所谓<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/First-class_function">“第一等公民”</a>（first class），指的是<strong>函数与其他数据类型一样，处于平等地位，可以赋值给其他变量，也可以作为参数，传入另一个函数，或者作为别的函数的返回值。</strong></p>
</blockquote>
</li>
<li><p><strong>只用”表达式”，不用”语句”</strong></p>
<blockquote>
<p>“表达式”（expression）是一个单纯的运算过程，总是有返回值；”语句”（statement）是执行某种操作，没有返回值。函数式编程要求，只使用表达式，不使用语句。也就是说，<strong>每一步都是单纯的运算，而且都有返回值。</strong></p>
<p>原因是函数式编程的开发动机，一开始就是为了处理运算（computation），不考虑系统的读写（I&#x2F;O）。”语句”属于对系统的读写操作，所以就被排斥在外。</p>
<p>当然，实际应用中，不做I&#x2F;O是不可能的。因此，编程过程中，函数式编程只要求把I&#x2F;O限制到最小，不要有不必要的读写行为，保持计算过程的单纯性。</p>
</blockquote>
</li>
<li><p><strong>没有”副作用”</strong></p>
<blockquote>
<p>所谓<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Side_effect_(computer_science)">“副作用”</a>（side effect），指的是函数内部与外部互动（最典型的情况，就是修改全局变量的值），产生运算以外的其他结果。</p>
<p>函数式编程强调没有”副作用”，意味着<strong>函数要保持独立，所有功能就是返回一个新的值，没有其他行为，尤其是不得修改外部变量的值。</strong></p>
</blockquote>
</li>
<li><p><strong>不修改状态</strong></p>
<blockquote>
<p>上一点已经提到，函数式编程只是返回新的值，不修改系统变量。因此，不修改变量，也是它的一个重要特点。</p>
<p>在其他类型的语言中，变量往往用来保存”状态”（state）。不修改变量，意味着状态不能保存在变量中。<strong>函数式编程使用参数保存状态，最好的例子就是递归</strong>。</p>
<p>由于使用了递归，函数式语言的运行速度比较慢。</p>
<p>【递归的速度慢，一般都是将递归写成尾递归，然后编译器进行优化，将尾递归转化成迭代】</p>
</blockquote>
</li>
<li><p><strong>引用透明（referential transparency）</strong></p>
<blockquote>
<p>引用透明（Referential transparency），指的是<strong>函数的运行不依赖于外部变量或”状态”，只依赖于输入的参数，任何时候只要参数相同，引用函数所得到的返回值总是相同的。</strong></p>
<p>有了前面的第三点和第四点，这点是很显然的。其他类型的语言，函数的返回值往往与系统状态有关，不同的状态之下，返回值是不一样的。这就叫”引用不透明”，很不利于观察和理解程序的行为。</p>
</blockquote>
</li>
<li><p><strong>确定性（determinism）</strong></p>
<blockquote>
<p>所谓确定性的意思就是像数学那样 f(x) &#x3D; y ，这个函数无论在什么场景下，都会得到同样的结果，这个我们称之为函数的确定性。而不是像程序中的很多函数那样，同一个参数，却会在不同的场景下计算出不同的结果。所谓不同的场景的意思就是我们的函数会根据一些运行中的状态信息的不同而发生变化。</p>
</blockquote>
</li>
<li><p><strong>惰性求值（延迟计算）与并行</strong></p>
<blockquote>
<p>惰性求值：</p>
<p>这个需要编译器的支持。<strong>表达式不在它被绑定到变量之后就立即求值，而是在该值被取用的时候求值。</strong>也就是说，当调用函数时，不是盲目的计算所有实参的值后再进入函数体，而是先进入函数体，只有当需要实参值时才计算所需的实参值（<strong>按需调用</strong>）</p>
</blockquote>
</li>
<li><p><strong>递归调用及其优化</strong></p>
<blockquote>
<p>就是使用尾递归进行优化</p>
</blockquote>
</li>
</ul>
<h2 id="函数式语言的优点"><a href="#函数式语言的优点" class="headerlink" title="函数式语言的优点"></a>函数式语言的优点</h2><ol>
<li><p>代码简洁，开发快速</p>
<p>其实这条是比较好理解的，函数式的编程使用了大量的函数，减少了代码的重复。</p>
</li>
<li><p>易于理解</p>
</li>
<li><p>方便代码管理</p>
<p>函数式编程不依赖、也不会改变外界的状态，只要给定输入参数，返回的结果必定相同。因此，每一个函数都可以被看做独立单元，很有利于进行单元测试（unit testing）和除错（debugging），以及模块化组合。</p>
</li>
<li><p><strong>易于“并发编程”</strong></p>
<p><strong>函数式编程不需要考虑”死锁”（deadlock），因为它不修改变量，所以根本不存在”锁”线程的问题。</strong>不必担心一个线程的数据，被另一个线程修改，所以可以很放心地把工作分摊到多个线程，部署”并发编程”（concurrency）。</p>
</li>
<li><p><strong>可以进行代码的热升级</strong></p>
<p><strong>函数式编程没有副作用，只要保证接口不变，内部实现是外部无关的。所以，可以在运行状态下直接升级代码，不需要重启，也不需要停机。</strong></p>
</li>
</ol>
<h2 id="函数式编程的几个技术"><a href="#函数式编程的几个技术" class="headerlink" title="函数式编程的几个技术"></a>函数式编程的几个技术</h2><ol>
<li><p><strong>map&amp;reduce</strong></p>
</li>
<li><p><strong>pipeline</strong></p>
</li>
<li><p><strong>recursing递归</strong></p>
</li>
<li><p><strong>currying</strong></p>
</li>
<li><p><strong>higher-order function高阶函数</strong></p>
<blockquote>
<p>所谓高阶函数就是函数当参数，把传入的函数做一个封装，然后返回这个封装函数。现象上就是函数传进传出，就像面向对象对象满天飞一样。</p>
</blockquote>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.byvoid.com/zhs/blog/why-functional-programming">参考文章</a></p>
<p><a target="_blank" rel="noopener" href="https://coolshell.cn/articles/10822.html">参考文章</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/03/22/Algorithm-%E5%8F%8C%E6%8C%87%E9%92%88%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/22/Algorithm-%E5%8F%8C%E6%8C%87%E9%92%88%E6%B3%95/" class="post-title-link" itemprop="url">Algorithm_双指针法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-21 23:41:10" itemprop="dateCreated datePublished" datetime="2020-03-21T23:41:10Z">2020-03-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-22 07:33:12" itemprop="dateModified" datetime="2020-03-22T07:33:12Z">2020-03-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="双指针法"><a href="#双指针法" class="headerlink" title="双指针法"></a>双指针法</h1><p>双指针法可以分成两个部分：<strong>快慢指针，左右指针</strong>。前者解决主要解决链表中的问题，比如典型的判定链表中是否包含环；后者主要解决数组（或者字符串）中的问题，比如二分查找。</p>
<p> (注：这里的指针，并非专指c中指针的概念，而是指索引，游标或指针，可迭代对象等)</p>
<h2 id="快慢指针常见算法"><a href="#快慢指针常见算法" class="headerlink" title="快慢指针常见算法"></a>快慢指针常见算法</h2><h2 id="左右指针常见算法"><a href="#左右指针常见算法" class="headerlink" title="左右指针常见算法"></a>左右指针常见算法</h2><p>左右指针在数组中实际是指两个索引值，一般初始化为 left &#x3D; 0, right &#x3D; nums.length - 1 。</p>
<p>一般我们会对数组进行排序，然后在进行比较时，通过移动指针来找到解。</p>
<h3 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h3><p>两个指针的算法都是很基础的，也是很简单的，通常只要取一头一尾进行移动比较即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left &lt;= right) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (right + left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[mid] == target)</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &lt; target)</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &gt; target)</span><br><span class="line">            right = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="两数之和"><a href="#两数之和" class="headerlink" title="两数之和"></a>两数之和</h3><p><a target="_blank" rel="noopener" href="https://leetcode.com/problems/two-sum-ii-input-array-is-sorted/description/">Leetcode：167——两数之和II-输入有序数组</a></p>
<p>题目描述：在有序数组中找出两个数，使它们的和为 target。</p>
<p>在进行数组元素相加后比较之类的问题，都可以采取双指针方式进行求解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] numbers, <span class="type">int</span> target) &#123;</span><br><span class="line">        <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> left=numbers.length-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> []output = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">while</span>(right&lt;left)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(numbers[right]+numbers[left]==target)&#123;</span><br><span class="line">                output[<span class="number">0</span>]=right+<span class="number">1</span>;</span><br><span class="line">                output[<span class="number">1</span>]=left+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(numbers[right]+numbers[left]&lt;target)</span><br><span class="line">            &#123;</span><br><span class="line">                right++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">            &#123;</span><br><span class="line">                left--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="两数平方和"><a href="#两数平方和" class="headerlink" title="两数平方和"></a>两数平方和</h3><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sum-of-square-numbers/description/?utm_source=LCUS&utm_medium=ip_redirect_q_uns&utm_campaign=transfer2china">Leetcode：633——平方数之和</a></p>
<p>题目描述：给定一个非负整数 c ，你要判断是否存在两个整数 a 和 b，使得 a^2^ + b^2^ &#x3D; c。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">judgeSquareSum</span><span class="params">(<span class="type">int</span> c)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>,left =(<span class="type">int</span>)Math.sqrt(c);</span><br><span class="line">        <span class="keyword">while</span>(right&lt;=left)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Math.pow(right,<span class="number">2</span>)+Math.pow(left,<span class="number">2</span>)==c)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(Math.pow(right,<span class="number">2</span>)+Math.pow(left,<span class="number">2</span>)&lt;c)</span><br><span class="line">            &#123;</span><br><span class="line">                right++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                left--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/4sum/submissions/">Leetcode：18</a></p>
<p>左右指针：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">fourSum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(nums==<span class="literal">null</span>||nums.length&lt;<span class="number">4</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="type">int</span> length=nums.length;</span><br><span class="line">        <span class="comment">//一个指向最小的值，一个指向最大的值</span></span><br><span class="line">        <span class="type">int</span> head,tail;</span><br><span class="line">        <span class="type">int</span> left,right;</span><br><span class="line">        <span class="keyword">for</span>(head=<span class="number">0</span>;head&lt;length-<span class="number">3</span>;head++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//在有相同的数的前提下，移动到最右边的数</span></span><br><span class="line">            <span class="keyword">if</span>(head&gt;<span class="number">0</span>&amp;&amp;nums[head]==nums[head-<span class="number">1</span>])</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">                <span class="comment">//如果当前可以取得的最小值比目标值大的话，直接退出。</span></span><br><span class="line">            <span class="type">int</span> min=nums[head]+nums[head+<span class="number">1</span>]+nums[head+<span class="number">2</span>]+nums[head+<span class="number">3</span>];</span><br><span class="line">            <span class="keyword">if</span>(min&gt;target)<span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">//如果当前取得的最大值比目标值小的话，将head往后移动</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> nums[head]+nums[length-<span class="number">1</span>]+nums[length-<span class="number">2</span>]+nums[length-<span class="number">3</span>];</span><br><span class="line">            <span class="keyword">if</span>(max&lt;target)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(left=head+<span class="number">1</span>;left&lt;length-<span class="number">2</span>;left++)</span><br><span class="line">            &#123;</span><br><span class="line">                tail = length-<span class="number">1</span>;</span><br><span class="line">                right = left+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(left&gt;head+<span class="number">1</span>&amp;&amp;nums[left-<span class="number">1</span>]==nums[left])<span class="keyword">continue</span>;</span><br><span class="line">                min = nums[head]+nums[left]+nums[left+<span class="number">1</span>]+nums[left+<span class="number">2</span>];</span><br><span class="line">                <span class="keyword">if</span>(min&gt;target)<span class="keyword">continue</span>;</span><br><span class="line">                max = nums[head]+nums[left]+nums[tail-<span class="number">1</span>]+nums[tail];</span><br><span class="line">                <span class="keyword">if</span>(max&lt;target)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span>(right&lt;tail)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">all</span> <span class="operator">=</span> nums[head]+nums[left]+nums[right]+nums[tail];</span><br><span class="line">                    <span class="keyword">if</span>(all==target)</span><br><span class="line">                    &#123;</span><br><span class="line">                        result.add(Arrays.asList(nums[head],nums[left],nums[right],nums[tail]));</span><br><span class="line">                        right++;</span><br><span class="line">                    <span class="keyword">while</span>(right&gt;left&amp;&amp;right&lt;tail&amp;&amp;nums[right-<span class="number">1</span>]==nums[right])</span><br><span class="line">                    &#123;</span><br><span class="line">                        right++;</span><br><span class="line">                    &#125;</span><br><span class="line">                    tail--;</span><br><span class="line">                    <span class="keyword">while</span>(tail&gt;left&amp;&amp;nums[tail]==nums[tail+<span class="number">1</span>])</span><br><span class="line">                    &#123;</span><br><span class="line">                        tail--;</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(all&gt;target)</span><br><span class="line">                    &#123;</span><br><span class="line">                        tail--;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(all&lt;target)</span><br><span class="line">                    &#123;</span><br><span class="line">                        right++;</span><br><span class="line">                    &#125;</span><br><span class="line">                 </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/03/12/Java-%20%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/12/Java-%20%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">java_反射机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-11 19:59:22" itemprop="dateCreated datePublished" datetime="2020-03-11T19:59:22Z">2020-03-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-15 05:38:24" itemprop="dateModified" datetime="2021-12-15T05:38:24Z">2021-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java-反射机制"><a href="#Java-反射机制" class="headerlink" title="Java- 反射机制"></a>Java- 反射机制</h1><p><img src="https://i.loli.net/2021/11/30/kJ7XHxwc8gBQlYW.jpg"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_38259539/article/details/71799078">参考文章：重要</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000010162647?utm_source=tuicool&utm_medium=referral">参考文章</a></p>
<h2 id="什么是反射机制"><a href="#什么是反射机制" class="headerlink" title="什么是反射机制"></a>什么是反射机制</h2><p>简单来说，<strong>反射可以帮助我们在动态运行的时候，对于任意一个类，可以获得其所有的方法（包括 public protected private 默认状态的），所有的变量 （包括 public protected private 默认状态的）。</strong>程序中一般的对象的类型都是在编译期就确定下来的，而 Java 反射机制可以动态地创建对象并调用其属性，这样的对象的类型在编译期是未知的。所以我们可以通过反射机制直接创建对象，即使这个对象的类型在编译期是未知的。</p>
<p>反射的核心是 JVM 在运行时才动态加载类或调用方法&#x2F;访问属性，它不需要事先（写代码的时候或编译期）知道运行对象是谁。</p>
<p>Java 反射主要提供以下功能：</p>
<ul>
<li>在运行时判断任意一个对象所属的类；</li>
<li>在运行时构造任意一个类的对象；</li>
<li>在运行时判断任意一个类所具有的成员变量和方法（通过反射甚至可以调用private方法）；</li>
<li>在运行时调用任意一个对象的方法</li>
</ul>
<p>重点：<strong>是运行时而不是编译时</strong></p>
<h2 id="反射的主要用途"><a href="#反射的主要用途" class="headerlink" title="反射的主要用途"></a>反射的主要用途</h2><p>很多人都认为反射在实际的 Java 开发应用中并不广泛，其实不然。当我们在使用 IDE(如 Eclipse，IDEA)时，当我们输入一个对象或类并想调用它的属性或方法时，一按点号，编译器就会自动列出它的属性或方法，这里就会用到反射。</p>
<p><strong>反射最重要的用途就是开发各种通用框架。</strong>很多框架（比如 Spring）都是配置化的（比如通过 XML 文件配置 Bean），为了<strong>保证框架的通用性，它们可能需要根据配置文件加载不同的对象或类，调用不同的方法，这个时候就必须用到反射，运行时动态加载需要加载的对象。</strong></p>
<ul>
<li>静态编译：在编译时确定类型，绑定对象</li>
<li>动态编译：运行时确定类型，绑定对象</li>
</ul>
<p>  两者的区别在于，动态编译可以最大程度地支持多态，而多态最大的意义在于降低类的耦合性，因此反射的优点就很明显了：解耦以及提高代码的灵活性。</p>
<p>  因此，反射的优势和劣势分别在于：</p>
<ul>
<li>优势<ul>
<li>运行期类型的判断，动态类加载：提高代码灵活度</li>
</ul>
</li>
<li>劣势<ul>
<li>性能瓶颈：反射相当于一系列解释操作，通知 JVM 要做的事情，性能比直接的java代码要慢很多</li>
</ul>
</li>
</ul>
<h2 id="反射的基本运用"><a href="#反射的基本运用" class="headerlink" title="反射的基本运用"></a>反射的基本运用</h2><h3 id="1、获得class对象"><a href="#1、获得class对象" class="headerlink" title="1、获得class对象"></a>1、获得class对象</h3><h4 id="Class对象"><a href="#Class对象" class="headerlink" title="Class对象"></a>Class对象</h4><p>在Java中有两种对象：Class对象和实例对象，<strong>实例对象是类的实例，通常是通过 <code>new</code>关键字构建的。<em>Class对象是JVM生成用来保存对象的类的信息的</em>。</strong>Java程序执行之前需要经过编译、加载、链接和初始化这几个阶段，<strong>编译阶段会将源码文件编译为 <code>.class</code>字节码文件，编译器同时会在 <code>.class</code>文件中生成Class对象</strong>，加载阶段通过JVM内部的类加载机制，将Class对象加载到内存中。在创建对象实例之前，JVM会先检查Class对象是否在内存中存在，如果不存在，则加载Class对象，然后再创建对象实例，如果存在，则直接根据Class对象创建对象实例。JVM中只有一个Class对象，但可以根据Class对象生成多个对象实例。</p>
<h4 id="Class对象的获得"><a href="#Class对象的获得" class="headerlink" title="Class对象的获得"></a>Class对象的获得</h4><h5 id="1、类名-class"><a href="#1、类名-class" class="headerlink" title="1、类名.class"></a>1、类名.class</h5><p>当执行 <code>类名.class</code>时，JVM会先检查Class对象是否装入内存，如果没有装入内存，则将Class对象装入内存，然后返回Class对象，如果装入内存，则直接返回Class对象。在加载Class对象后，不会对Class对象进行初始化。</p>
<ul>
<li>Example</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run static initialization block.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run nonstatic initialization block.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassTest</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">t</span> <span class="operator">=</span> Test.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Result</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 空</span></span><br></pre></td></tr></table></figure>

<h5 id="2、-Class-forName"><a href="#2、-Class-forName" class="headerlink" title="2、 Class.forName()"></a>2、 Class.forName()</h5><p>当执行 <code>Class.forName()</code>时，JVM也会先检查Class对象是否装入内存，如果没有装入内存，则将Class对象装入内存，然后返回Class对象，如果装入内存，则直接返回Class对象。在加载Class对象后，会对类进行初始化，即执行类的静态代码块。<code>forName()</code>方法中的参数是类名字符串，类名字符串 &#x3D; 包名 + 类名。<code>Class.forName()</code>的一个很常见的用法是在加载数据库驱动的时候。</p>
<ul>
<li>Example</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tyan.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run static initialization block.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run nonstatic initialization block.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.tyan.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassTest</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">t</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.tyan.test.Test&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Result</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Run <span class="keyword">static</span> initialization block</span><br></pre></td></tr></table></figure>

<h5 id="3、getClass"><a href="#3、getClass" class="headerlink" title="3、getClass()"></a>3、getClass()</h5><p><code>getClass()</code>方法的方法是在通过的类的实例调用的，即已经创建了类的实例。</p>
<ul>
<li>Example</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run static initialization block.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Run nonstatic initialization block.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassTest</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Test</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">test</span> <span class="operator">=</span> t.getClass();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Result</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Run <span class="keyword">static</span> initialization block.</span><br><span class="line">Run nonstatic initialization block.</span><br></pre></td></tr></table></figure>

<h4 id="Class类的常用方法"><a href="#Class类的常用方法" class="headerlink" title="Class类的常用方法"></a>Class类的常用方法</h4><ul>
<li>getName()</li>
</ul>
<p>一个Class对象描述了一个特定类的属性，Class类中最常用的方法getName以String的形式返回此Class对象所表示的实体（类、接口、数组类、基本类型或void名称。</p>
<ul>
<li>newInstance()</li>
</ul>
<p>Class还有一个有用的方法可以为类创建一个实例，这个方法叫做newInstance()。例如：<code>x.getClass.newInstance()</code>，创建了一个同 <code>x</code>一样类型的新实例。<code>newInstance()</code>方法调用默认构造器（无参数构造器）初始化新建对象。</p>
<ul>
<li>getClassLoader()</li>
</ul>
<p>返回该类的类加载器。</p>
<ul>
<li>getComponentType()</li>
</ul>
<p>返回表示数组组件类型的Class。</p>
<ul>
<li>getSuperclass()</li>
</ul>
<p>返回表示此 Class 所表示的实体（类、接口、基本类型或 void）的超类的Class。</p>
<ul>
<li>isArray()</li>
</ul>
<p>判定此 Class 对象是否表示一个数组类。</p>
<h3 id="2、判断是否为某个类的实例"><a href="#2、判断是否为某个类的实例" class="headerlink" title="2、判断是否为某个类的实例"></a>2、判断是否为某个类的实例</h3><p>一般地，我们用 <code>instanceof</code> 关键字来判断是否为某个类的实例。同时我们也可以借助反射中 Class 对象的 <code>isInstance()</code> 方法来判断是否为某个类的实例，它是一个 native 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">isInstance</span><span class="params">(Object obj)</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3、创建实例"><a href="#3、创建实例" class="headerlink" title="3、创建实例"></a>3、创建实例</h3><p>通过反射来生成对象主要有两种方式。</p>
<ul>
<li>使用Class对象的newInstance()方法来创建Class对象对应类的实例。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; c = String.class;<span class="type">Object</span> <span class="variable">str</span> <span class="operator">=</span> c.newInstance();</span><br></pre></td></tr></table></figure>

<ul>
<li>先通过Class对象获取指定的Constructor对象，再调用Constructor对象的newInstance()方法来创建实例。这种方法可以用指定的构造器构造类的实例。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取String所对应的Class对象</span></span><br><span class="line">Class&lt;?&gt; c = String.class;</span><br><span class="line"><span class="comment">//获取String类带一个String参数的构造器</span></span><br><span class="line"><span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> c.getConstructor(String.class);</span><br><span class="line"><span class="comment">//根据构造器创建实例</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;23333&quot;</span>);</span><br><span class="line">System.out.println(obj);</span><br></pre></td></tr></table></figure>

<h3 id="4、获取方法"><a href="#4、获取方法" class="headerlink" title="4、获取方法"></a>4、获取方法</h3><p>获取某个Class对象的方法集合，主要有以下几个方法：</p>
<ul>
<li><code>getDeclaredMethods</code> 方法返回类或接口声明的所有方法，包括公共、保护、默认（包）访问和私有方法，但不包括继承的方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Method[] getDeclaredMethods() <span class="keyword">throws</span> SecurityException</span><br></pre></td></tr></table></figure>

<ul>
<li><code>getMethods</code> 方法返回某个类的所有公用（public）方法，包括其继承类的公用方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Method[] getMethods() <span class="keyword">throws</span> SecurityException</span><br></pre></td></tr></table></figure>

<ul>
<li><code>getMethod</code> 方法返回一个特定的方法，其中第一个参数为方法名称，后面的参数为方法的参数对应Class的对象。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Method <span class="title function_">getMethod</span><span class="params">(String name, Class&lt;?&gt;... parameterTypes)</span></span><br></pre></td></tr></table></figure>

<p>只是这样描述的话可能难以理解，我们用例子来理解这三个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.ScZyhSoft.common;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> IllegalAccessException,InstantiationException, NoSuchMethodException, InvocationTargetException </span><br><span class="line">    &#123;	   </span><br><span class="line">        Class&lt;?&gt; c = methodClass.class;	    </span><br><span class="line">                                                                                    <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> c.newInstance();	    </span><br><span class="line">                                                                                    Method[] methods = c.getMethods();	     </span><br><span class="line">        Method[] declaredMethods = c.getDeclaredMethods();	   </span><br><span class="line">        <span class="comment">//获取methodClass类的add方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;add&quot;</span>, <span class="type">int</span>.class, <span class="type">int</span>.class);	        <span class="comment">//getMethods()方法获取的所有方法	 </span></span><br><span class="line">        System.out.println(<span class="string">&quot;getMethods获取的方法：&quot;</span>);	  </span><br><span class="line">        <span class="keyword">for</span>(Method m:methods)	    </span><br><span class="line">            System.out.println(m);	  </span><br><span class="line">        <span class="comment">//getDeclaredMethods()方法获取的所有方法	 </span></span><br><span class="line">        System.out.println(<span class="string">&quot;getDeclaredMethods获取的方法：&quot;</span>);	   </span><br><span class="line">        <span class="keyword">for</span>(Method m:declaredMethods)	     </span><br><span class="line">            System.out.println(m);	  </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">methodClass</span> </span><br><span class="line">&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">fuck</span> <span class="operator">=</span> <span class="number">3</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">return</span> a+b;   </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span><br><span class="line">    &#123;      </span><br><span class="line">        <span class="keyword">return</span> a+b;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序运行的结果如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">getMethods获取的方法：</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> org.ScZyhSoft.common.methodClass.add(<span class="type">int</span>,<span class="type">int</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> org.ScZyhSoft.common.methodClass.sub(<span class="type">int</span>,<span class="type">int</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> java.lang.Object.wait() <span class="keyword">throws</span> java.lang.InterruptedException</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> java.lang.Object.wait(<span class="type">long</span>,<span class="type">int</span>) <span class="keyword">throws</span> java.lang.InterruptedException</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> java.lang.Object.wait(<span class="type">long</span>) <span class="keyword">throws</span> java.lang.InterruptedException</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> java.lang.Object.equals(java.lang.Object)</span><br><span class="line">    <span class="keyword">public</span> java.lang.String java.lang.Object.toString()</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> java.lang.Object.hashCode()</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> java.lang.Class java.lang.Object.getClass()</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> java.lang.Object.notify()</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> java.lang.Object.notifyAll()</span><br><span class="line">    getDeclaredMethods获取的方法：</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> org.ScZyhSoft.common.methodClass.add(<span class="type">int</span>,<span class="type">int</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> org.ScZyhSoft.common.methodClass.sub(<span class="type">int</span>,<span class="type">int</span>)</span><br></pre></td></tr></table></figure>

<p>可以看到，通过 <code>getMethods()</code> 获取的方法可以获取到父类的方法,比如 java.lang.Object 下定义的各个方法。</p>
<h3 id="5、获取构造器信息"><a href="#5、获取构造器信息" class="headerlink" title="5、获取构造器信息"></a>5、获取构造器信息</h3><p>获取类构造器的用法与上述获取方法的用法类似。主要是通过Class类的getConstructor方法得到Constructor类的一个实例，而Constructor类有一个newInstance方法可以创建一个对象实例:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">newInstance</span><span class="params">(Object ... initargs)</span></span><br></pre></td></tr></table></figure>

<p>此方法可以根据传入的参数来调用对应的Constructor创建对象实例。</p>
<h3 id="6、获取类的成员变量（字段）信息"><a href="#6、获取类的成员变量（字段）信息" class="headerlink" title="6、获取类的成员变量（字段）信息"></a>6、获取类的成员变量（字段）信息</h3><p>主要是这几个方法，在此不再赘述：</p>
<ul>
<li><code>getFiled</code>：访问公有的成员变量</li>
<li><code>getDeclaredField</code>：所有已声明的成员变量，但不能得到其父类的成员变量</li>
</ul>
<p><code>getFileds</code> 和 <code>getDeclaredFields</code> 方法用法同上（参照 Method）。</p>
<h3 id="7、调用方法"><a href="#7、调用方法" class="headerlink" title="7、调用方法"></a>7、调用方法</h3><p>当我们从类中获取了一个方法后，我们就可以用 <code>invoke()</code> 方法来调用这个方法。<code>invoke</code> 方法的原型为:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object obj, Object... args)</span> </span><br><span class="line">    <span class="keyword">throws</span> IllegalAccessException, IllegalArgumentException,           InvocationTargetException</span><br></pre></td></tr></table></figure>

<p>下面是一个实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test1</span> &#123;   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException</span><br><span class="line">    &#123;        Class&lt;?&gt; klass = methodClass.class;   </span><br><span class="line">     <span class="comment">//创建methodClass的实例</span></span><br><span class="line">     <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> klass.newInstance();   </span><br><span class="line">     <span class="comment">//获取methodClass类的add方法    </span></span><br><span class="line">     <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> klass.getMethod(<span class="string">&quot;add&quot;</span>,<span class="type">int</span>.class,<span class="type">int</span>.class);    </span><br><span class="line">     <span class="comment">//调用method对应的方法 =&gt; add(1,4) </span></span><br><span class="line">     <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(obj,<span class="number">1</span>,<span class="number">4</span>);  </span><br><span class="line">     System.out.println(result);   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">methodClass</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">fuck</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="keyword">return</span> a+b; </span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> &#123;     </span><br><span class="line">        <span class="keyword">return</span> a+b;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8、利用反射创建数组"><a href="#8、利用反射创建数组" class="headerlink" title="8、利用反射创建数组"></a>8、利用反射创建数组</h3><p>数组在Java里是比较特殊的一种类型，它可以赋值给一个Object Reference。下面我们看一看利用反射创建数组的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testArray</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException &#123;  </span><br><span class="line">Class&lt;?&gt; cls = Class.forName(<span class="string">&quot;java.lang.String&quot;</span>);      </span><br><span class="line"><span class="type">Object</span> <span class="variable">array</span> <span class="operator">=</span> Array.newInstance(cls,<span class="number">25</span>);    </span><br><span class="line"><span class="comment">//往数组里添加内容 </span></span><br><span class="line">Array.set(array,<span class="number">0</span>,<span class="string">&quot;hello&quot;</span>);  </span><br><span class="line">Array.set(array,<span class="number">1</span>,<span class="string">&quot;Java&quot;</span>);  </span><br><span class="line">Array.set(array,<span class="number">2</span>,<span class="string">&quot;fuck&quot;</span>);  </span><br><span class="line">Array.set(array,<span class="number">3</span>,<span class="string">&quot;Scala&quot;</span>);   </span><br><span class="line">Array.set(array,<span class="number">4</span>,<span class="string">&quot;Clojure&quot;</span>);   </span><br><span class="line"><span class="comment">//获取某一项的内容    </span></span><br><span class="line">System.out.println(Array.get(array,<span class="number">3</span>)); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中的Array类为java.lang.reflect.Array类。我们通过Array.newInstance()创建数组对象，它的原型是:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">newInstance</span><span class="params">(Class&lt;?&gt; componentType, <span class="type">int</span> length)</span>        <span class="keyword">throws</span> NegativeArraySizeException</span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">return</span> newArray(componentType, length);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而 <code>newArray</code> 方法是一个 native 方法，它在 HotSpot JVM 里的具体实现我们后边再研究，这里先把源码贴出来：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> Object <span class="title function_">newArray</span><span class="params">(Class&lt;?&gt; componentType, <span class="type">int</span> length)</span>        <span class="keyword">throws</span> NegativeArraySizeException;</span><br></pre></td></tr></table></figure>

<p>源码目录：<code>openjdk\hotspot\src\share\vm\runtime\reflection.cpp</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">arrayOop Reflection::reflect_new_array(oop element_mirror, jint length, TRAPS)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (element_mirror == NULL)</span><br><span class="line">    &#123;   </span><br><span class="line">        THROW_0(vmSymbols::java_lang_NullPointerException()); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (length &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;  </span><br><span class="line">        THROW_0(vmSymbols::java_lang_NegativeArraySizeException()); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (java_lang_Class::is_primitive(element_mirror))</span><br><span class="line">    &#123;</span><br><span class="line">        Klass* tak = basic_type_mirror_to_arrayklass(element_mirror, CHECK_NULL);    <span class="keyword">return</span> TypeArrayKlass::cast(tak)-&gt;allocate(length, THREAD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Klass* k = java_lang_Class::as_Klass(element_mirror);   </span><br><span class="line">        <span class="keyword">if</span> (k-&gt;oop_is_array() &amp;&amp; ArrayKlass::cast(k)-&gt;dimension() &gt;= MAX_DIM)</span><br><span class="line">        &#123;  </span><br><span class="line">            THROW_0(vmSymbols::java_lang_IllegalArgumentException()); </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> oopFactory::new_objArray(k, length, THREAD); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外，Array 类的 <code>set</code> 和 <code>get</code> 方法都为 native 方法，在 HotSpot JVM 里分别对应 <code>Reflection::array_set</code> 和 <code>Reflection::array_get</code> 方法，这里就不详细解析了。</p>
<h2 id="反射的应用场景"><a href="#反射的应用场景" class="headerlink" title="反射的应用场景"></a>反射的应用场景</h2><h3 id="JDBC-的数据库的连接"><a href="#JDBC-的数据库的连接" class="headerlink" title="JDBC 的数据库的连接"></a>JDBC 的数据库的连接</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConnectionJDBC</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="comment">//驱动程序就是之前在classpath中配置的JDBC的驱动程序的JAR 包中  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DBDRIVER</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;  </span><br><span class="line">    <span class="comment">//连接地址是由各个数据库生产商单独提供的，所以需要单独记住  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DBURL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;  </span><br><span class="line">    <span class="comment">//连接数据库的用户名  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DBUSER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;  </span><br><span class="line">    <span class="comment">//连接数据库的密码  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DBPASS</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;  </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Connection</span> <span class="variable">con</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">//表示数据库的连接对象  </span></span><br><span class="line">        Class.forName(DBDRIVER); <span class="comment">//1、使用CLASS 类加载驱动程序 ,反射机制的体现 </span></span><br><span class="line">        con = DriverManager.getConnection(DBURL,DBUSER,DBPASS); <span class="comment">//2、连接数据库  </span></span><br><span class="line">        System.out.println(con);  </span><br><span class="line">        con.close(); <span class="comment">// 3、关闭数据库  </span></span><br><span class="line">    &#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="spring框架的使用"><a href="#spring框架的使用" class="headerlink" title="spring框架的使用"></a>spring框架的使用</h3><p>Spring 通过 XML 配置模式装载 Bean 的过程：</p>
<ol>
<li>将程序内所有 XML 或 Properties 配置文件加载入内存中</li>
<li>Java类里面解析xml或properties里面的内容，得到对应实体类的字节码字符串以及相关的属性信息</li>
<li>使用反射机制，根据这个字符串获得某个类的Class实例</li>
<li>动态配置实例的属性</li>
</ol>
<p>Spring这样做的好处是：</p>
<ul>
<li>不用每一次都要在代码里面去new或者做其他的事情</li>
<li>以后要改的话直接改配置文件，代码维护起来就很方便了</li>
<li>有时为了适应某些需求，Java类里面不一定能直接调用另外的方法，可以通过反射机制来实现</li>
</ul>
<p>模拟 Spring 加载 XML 配置文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanFactory</span> &#123;</span><br><span class="line">       <span class="keyword">private</span> Map&lt;String, Object&gt; beanMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * bean工厂的初始化.</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> xml xml配置文件</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(String xml)</span> &#123;</span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                     <span class="comment">//读取指定的配置文件</span></span><br><span class="line">                     <span class="type">SAXReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line">                     <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader();</span><br><span class="line">                     <span class="comment">//从class目录下获取指定的xml文件</span></span><br><span class="line">                     <span class="type">InputStream</span> <span class="variable">ins</span> <span class="operator">=</span> classLoader.getResourceAsStream(xml);</span><br><span class="line">                     <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> reader.read(ins);</span><br><span class="line">                     <span class="type">Element</span> <span class="variable">root</span> <span class="operator">=</span> doc.getRootElement();  </span><br><span class="line">                     Element foo;</span><br><span class="line">                    </span><br><span class="line">                     <span class="comment">//遍历bean</span></span><br><span class="line">                     <span class="keyword">for</span> (<span class="type">Iterator</span> <span class="variable">i</span> <span class="operator">=</span> root.elementIterator(<span class="string">&quot;bean&quot;</span>); i.hasNext();) &#123;  </span><br><span class="line">                            foo = (Element) i.next();</span><br><span class="line">                            <span class="comment">//获取bean的属性id和class</span></span><br><span class="line">                            <span class="type">Attribute</span> <span class="variable">id</span> <span class="operator">=</span> foo.attribute(<span class="string">&quot;id&quot;</span>);  </span><br><span class="line">                            <span class="type">Attribute</span> <span class="variable">cls</span> <span class="operator">=</span> foo.attribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">                           </span><br><span class="line">                            <span class="comment">//利用Java反射机制，通过class的名称获取Class对象</span></span><br><span class="line">                            <span class="type">Class</span> <span class="variable">bean</span> <span class="operator">=</span> Class.forName(cls.getText());</span><br><span class="line">                           </span><br><span class="line">                            <span class="comment">//获取对应class的信息</span></span><br><span class="line">                            java.beans.<span class="type">BeanInfo</span> <span class="variable">info</span> <span class="operator">=</span> java.beans.Introspecto</span><br></pre></td></tr></table></figure>

<h2 id="反射的一些注意事项"><a href="#反射的一些注意事项" class="headerlink" title="反射的一些注意事项"></a>反射的一些注意事项</h2><p>由于反射会额外消耗一定的系统资源，因此如果不需要动态地创建一个对象，那么就不需要用反射。</p>
<p>另外，反射调用方法时可以忽略权限检查，因此可能会破坏封装性而导致安全问题。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/03/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84-%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84-%E6%A6%82%E8%BF%B0/" class="post-title-link" itemprop="url">计算机系统结构—概述</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-09 19:12:12" itemprop="dateCreated datePublished" datetime="2020-03-09T19:12:12Z">2020-03-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-18 14:34:48" itemprop="dateModified" datetime="2020-07-18T14:34:48Z">2020-07-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">计算机系统结构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><h2 id="图灵机"><a href="#图灵机" class="headerlink" title="图灵机"></a>图灵机</h2><p>计算机的<strong>理论基础</strong>是——图灵机。</p>
<p>图灵机在理论上证明了：只要对数据进行处理、存储、传输三种简单的操作就能解决一切可计算的数学问题。</p>
<ul>
<li>处理：按照有限规则对0，1的集合进行序列变换</li>
</ul>
<p>图灵机的模型就是决定了计算机追求的就是一个字：快。（在规定的时间内完成对规律的表达）</p>
<h2 id="冯诺依曼结构"><a href="#冯诺依曼结构" class="headerlink" title="冯诺依曼结构"></a>冯诺依曼结构</h2><p><strong>结构基础</strong></p>
<p>输出设备、输入设备、存储器、控制器、运算器</p>
<p><strong>以运算器为中心。</strong></p>
<p>在存储器中，指令和数据同样重要。</p>
<h2 id="摩尔定律"><a href="#摩尔定律" class="headerlink" title="摩尔定律"></a>摩尔定律</h2><p><strong>物质基础</strong></p>
<h2 id="加快经常性事件"><a href="#加快经常性事件" class="headerlink" title="加快经常性事件"></a>加快经常性事件</h2><p>在计算机系统结构中加快的一个方式就是加快经常性事件。</p>
<p>要点：</p>
<ul>
<li>辨认经常性事件</li>
<li>找出加快方法</li>
</ul>
<h3 id="CISC（复杂指令系统）"><a href="#CISC（复杂指令系统）" class="headerlink" title="CISC（复杂指令系统）"></a>CISC（复杂指令系统）</h3><p>用硬件替代软件，用指令代替子程序。</p>
<p>但是容易使得硬件很冗余。</p>
<h3 id="RISC（精简指令集）"><a href="#RISC（精简指令集）" class="headerlink" title="RISC（精简指令集）"></a>RISC（精简指令集）</h3><p>找到频繁使用的代码。精简指令系统（不经常使用的就放弃掉），将多余的资源实现加快。可以把硬件部分增加寄存器的数量、做成多级的流水线等。</p>
<h3 id="高速缓存Cache"><a href="#高速缓存Cache" class="headerlink" title="高速缓存Cache"></a>高速缓存Cache</h3><p>利用局部性原理，将局部代码放在cache中，使得访存的速度与处理器的速度匹配。</p>
<h2 id="Amdahl定律"><a href="#Amdahl定律" class="headerlink" title="Amdahl定律"></a>Amdahl定律</h2><p><strong>计算机系统结构的总原则</strong><br>$$<br>加速比：S_n&#x3D;\frac{新速度}{旧速度}&#x3D;\frac{老时间}{新时间}&#x3D;\frac{T_o}{T_n}\<br>S_n:系统加速比\<br>T_o:原执行时间\<br>T_n:新执行时间\<br>$$</p>
<p>$$<br>基本的Amdal定律：S_n&#x3D;\frac{1}{(1-F_e)+\frac{F_e}{S_e}}\<br>S_e:被改进部分的部件加速比\<br>F_e:被改进部分原执行时间占原来总时间的百分比<br>$$</p>
<img src="/images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/image-20200413194617300.png" style="zoom:67%;" />

<p>为使系统能获得较高加速比，可改进部分必须占有较大的比例。</p>
<p>当对一个系统中的某个部件进行改进后，所能获得的整个系统性能的提高，受限于该部件的执行时间占总执行时间的百分比。</p>
<h2 id="CPU性能公式"><a href="#CPU性能公式" class="headerlink" title="CPU性能公式"></a>CPU性能公式</h2><p>在设计CPU的时候，部件加速比往往是不能得到的。</p>
<p>一个程序在CPU上运行的时间不包括I&#x2F;O时间。</p>
<p><strong>CPU时间&#x3D;执行程序所需的时钟周期x时钟周期时间。</strong></p>
<ul>
<li><p>时钟周期时间：系统的时钟周期时间越短，相应的CPU性能越好（纯粹依赖硬件实现）</p>
</li>
<li><p>时钟周期数：固有属性</p>
<ul>
<li>指令周期数CPI：平均每条指令耗费的时钟周期数<br>$$<br>CPI&#x3D;\frac{执行程序所需的时钟周期数}{IC}\<br>IC：所执行的指令条数<br>$$</li>
</ul>
</li>
</ul>
<h3 id="处理器性能优化的策略"><a href="#处理器性能优化的策略" class="headerlink" title="处理器性能优化的策略"></a>处理器性能优化的策略</h3><p>$CPU时间&#x3D;IC\times CPI\times 时钟周期时间$</p>
<ul>
<li>减少指令条数</li>
<li>降低CPI</li>
<li>减少时钟周期时间</li>
</ul>
<h2 id="局部性原理"><a href="#局部性原理" class="headerlink" title="局部性原理"></a>局部性原理</h2><ul>
<li>时间局部性：如果一个信息正在被访问，那么它很有可能即将被访问</li>
<li>空间局部性：程序即将用到的信息很有可能与目前正在使用的信息在空间上相邻或者临近。</li>
</ul>
<p><strong>局部性原理最能在存储部分中体现出来。</strong>例如：经常性事件放置在cache中。</p>
<h2 id="提高并行性的技术"><a href="#提高并行性的技术" class="headerlink" title="提高并行性的技术"></a>提高并行性的技术</h2><p>并行性：同时性+并发性</p>
<ul>
<li>同时性：两个及以上事件在同一时刻发生</li>
<li>并发性：两个及以上事件在同一时间间隔内发生</li>
</ul>
<p>从处理数据的角度，并行性等级：</p>
<ul>
<li>字串位串：每次只对一个字的一位进行处理</li>
<li>字串位并：同时对一个字的全部位进行处理，不同字之间是串行的</li>
<li>字并位串：同时对许多字的同一位进行处理</li>
<li>全并行：同时对许多字的全部位或部分位进行处理</li>
</ul>
<p>从执行程序的角度，并行性等级：</p>
<ul>
<li>指令内部并行：单条指令中各微操作之间的并行</li>
<li>指令级并行：并行执行多条指令</li>
<li>线程级并行：并行执行多个线程</li>
<li>任务级或过程级并行：并行执行多个过程、任务（程序段）</li>
<li>作业、程序级并行：并行执行多个作业、程序</li>
</ul>
<p>提高并行性的方法：</p>
<ol>
<li><strong>时间重叠：让多个处理过程轮流重叠的使用用一套硬件设备的各个部分，加快硬件周转</strong></li>
<li><strong>资源重复：重复设置硬件资源，大幅度地提高计算机系统的性能</strong></li>
<li><strong>资源共享：软件方法，使得多个任务按一定时间顺序轮流使同一套设备</strong></li>
</ol>
<h3 id="单机系统下的并行性的发展"><a href="#单机系统下的并行性的发展" class="headerlink" title="单机系统下的并行性的发展"></a>单机系统下的并行性的发展</h3><h4 id="时间重叠"><a href="#时间重叠" class="headerlink" title="时间重叠"></a>时间重叠</h4><p>在高性能单处理机过程中，起主导作用的是时间重叠原理。</p>
<p><strong>实现时间重叠的基础：部件功能专用化。</strong></p>
<p>把一件工作按功能分割为多个部分，每个部分指定给专门的部件完成。</p>
<h4 id="资源重复"><a href="#资源重复" class="headerlink" title="资源重复"></a>资源重复</h4><p>主要运用在多体储存器、多操作部件和阵列处理机。</p>
<h4 id="资源共享"><a href="#资源共享" class="headerlink" title="资源共享"></a>资源共享</h4><p>本质是用单处理机模拟多处理机的功能，以形成虚拟机的功能。</p>
<h2 id="计算机系统评价"><a href="#计算机系统评价" class="headerlink" title="计算机系统评价"></a>计算机系统评价</h2><ul>
<li><p>性能<br>评价指标：响应时间（完成一个任务的全部时间）、吞吐率（单位时间完成的任务数）<br>$$<br>MIPS &#x3D; \frac{指令条数}{执行时间X10^6}&#x3D;\frac{f}{CPIX10^6}\<br>程序执行时间T_c &#x3D; \frac{指令条数}{MIPSX10^6}\<br>MFLOPS &#x3D; \frac{程序中的浮点操作数}{执行时间X10^6}<br>$$</p>
</li>
<li><p>成本<br>售价构成</p>
</li>
<li><p>能耗</p>
</li>
<li><p>可靠性</p>
</li>
</ul>
<h2 id="冯诺依曼结构的发展改进"><a href="#冯诺依曼结构的发展改进" class="headerlink" title="冯诺依曼结构的发展改进"></a>冯诺依曼结构的发展改进</h2><h3 id="输入输出方式的改进"><a href="#输入输出方式的改进" class="headerlink" title="输入输出方式的改进"></a>输入输出方式的改进</h3><p>1、<strong>程序等待</strong>：CPU需要轮询I&#x2F;O设备，造成CPU时间浪费；<br>      程序中断：CPU与I&#x2F;O设备可并行工作</p>
<p>2、<strong>DMA直接存储器访问：</strong>减少CPU对I&#x2F;O的干预</p>
<p>3、<strong>专用的I&#x2F;O处理机：</strong></p>
<p>4、<strong>采用并行性技术：</strong></p>
<p>5、<strong>存储器组织结构的发展：</strong>相联存储器、通用寄存器组、高速缓冲存储器Cache</p>
<h1 id="问答"><a href="#问答" class="headerlink" title="问答"></a>问答</h1><p>1、衡量计算机系统设计是否优化的最通用的标准包括性能和价格。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/02/07/java-%E5%B9%B6%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/07/java-%E5%B9%B6%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">java 并发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-07 11:37:01" itemprop="dateCreated datePublished" datetime="2020-02-07T11:37:01Z">2020-02-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-30 01:50:08" itemprop="dateModified" datetime="2021-11-30T01:50:08Z">2021-11-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>东西比较多，做个笔记。方便日后查阅学习。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/02/07/java-%E5%B9%B6%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/02/07/java-%E5%B9%B6%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/07/java-%E5%B9%B6%E5%8F%91/" class="post-title-link" itemprop="url">java 并发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-07 11:37:01" itemprop="dateCreated datePublished" datetime="2020-02-07T11:37:01Z">2020-02-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-30 00:37:08" itemprop="dateModified" datetime="2021-11-30T00:37:08Z">2021-11-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>东西比较多，做个笔记。方便日后查阅学习。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/02/07/java-%E5%B9%B6%E5%8F%91/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/02/07/java-%E9%94%81%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/07/java-%E9%94%81%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">java 锁机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-07 11:36:50" itemprop="dateCreated datePublished" datetime="2020-02-07T11:36:50Z">2020-02-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-08 05:20:52" itemprop="dateModified" datetime="2020-02-08T05:20:52Z">2020-02-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java中常用的锁机制"><a href="#Java中常用的锁机制" class="headerlink" title="Java中常用的锁机制"></a>Java中常用的锁机制</h1><h2 id="java多线程—锁机制"><a href="#java多线程—锁机制" class="headerlink" title="java多线程—锁机制"></a>java多线程—锁机制</h2><p>在开发Java多线程应用程序中，各个线程之间由于要共享资源，必须用到锁机制。Java提供了多种多线程锁机制的实现方式，常见的有synchronized、ReentrantLock、Semaphore、AtomicInteger等。每种机制都有优缺点与各自的适用场景，必须熟练掌握他们的特点才能在Java多线程应用开发时得心应手。</p>
<p>线程同步有关的类图关系可用以下的图总结：</p>
<img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/1042141-20180119085622974-1501528059.jpg" style="zoom:150%;" />



<h3 id="锁的介绍"><a href="#锁的介绍" class="headerlink" title="锁的介绍"></a>锁的介绍</h3><h4 id="什么是锁"><a href="#什么是锁" class="headerlink" title="什么是锁"></a>什么是锁</h4><p>在计算机科学中，锁(lock)或互斥(mutex)是一种同步机制，用于在有许多执行线程的环境中强制对资源的访问限制。锁旨在强制实施互斥排他、并发控制策略。</p>
<p>  锁通常需要硬件支持才能有效实施。这种支持通常采取一个或多个原子指令的形式，如”test-and-set”, “fetch-and-add” or “compare-and-swap””。这些指令允许单个进程测试锁是否空闲，如果空闲，则通过单个原子操作获取锁。</p>
<p>通俗的理解是，锁是为了解决多个线程公用一种临界资源而产生冲突的。跟上厕所一样，假如有<a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=ABC&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao">ABC</a>三个人都来上厕所而厕所只有一个一次只能进一人，A先来了，那么在A出来之前，这个厕所就处在了“锁”定状态，B和C憋死也要在外面等着，直到A出门（原因很多，如睡着了，方便完了，忘带厕纸了跑出来找人要….）“锁”定解除B和C才能进入，当然牛逼的进（A和B有一腿只让B进或者优先级高或者…），其他的在外面继续等。</p>
<h4 id="锁的属性—粒度"><a href="#锁的属性—粒度" class="headerlink" title="锁的属性—粒度"></a>锁的属性—粒度</h4><p>在引入锁粒度之前，需要了解关于锁的三个概念：</p>
<p>1、锁开销 lock overhead 锁占用内存空间、 cpu初始化和销毁锁、获取和释放锁的时间。程序使用的锁越多，相应的锁开销越大</p>
<p>2、锁竞争 lock contention 一个进程或线程试图获取另一个进程或线程持有的锁，就会发生锁竞争。锁粒度越小，发生锁竞争的可能性就越小</p>
<p>3、死锁 deadlock 至少两个任务中的每一个都等待另一个任务持有的锁的情况锁粒度是衡量锁保护的数据量大小，通常选择粗粒度的锁(锁的数量少，每个锁保护大量的数据)，在当单进程访问受保护的数据时锁开销小，但是当多个进程同时访问时性能很差。因为增大了锁的竞争。相反，使用细粒度的锁(锁数量多，每个锁保护少量的数据)增加了锁的开销但是减少了锁竞争。例如数据库中，锁的粒度有表锁、页锁、行锁、字段锁、字段的一部分锁</p>
<p>相关术语  Critical Section(临界区)、 Mutex&#x2F;mutual exclusion(互斥体)、 Semaphore&#x2F;binary semaphore(信号量)</p>
<p>注：</p>
<p>锁的粒度通常就是锁的级别。详细见：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_25408423/article/details/84340432">https://blog.csdn.net/qq_25408423/article/details/84340432</a></p>
<h3 id="Java锁的种类"><a href="#Java锁的种类" class="headerlink" title="Java锁的种类"></a>Java锁的种类</h3><ul>
<li><p>公平锁&#x2F;非公平锁</p>
</li>
<li><p>可重入锁</p>
</li>
<li><p>独享锁&#x2F;共享锁</p>
</li>
<li><p>互斥锁&#x2F;读写锁</p>
</li>
<li><p>乐观锁&#x2F;悲观锁</p>
</li>
<li><p>分段锁</p>
</li>
<li><p>偏向锁&#x2F;轻量级锁&#x2F;重量级锁</p>
</li>
<li><p>自旋锁</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20190616200439354_-1581078576151.png"></p>
</li>
</ul>
<p>上面是很多锁的名词，这些分类并不是全是指锁的状态，有的指锁的特性，有的指锁的设计，下面总结的内容是对每个锁的名词进行一定的解释。</p>
<h4 id="1-公平锁-x2F-非公平锁"><a href="#1-公平锁-x2F-非公平锁" class="headerlink" title="1.公平锁&#x2F;非公平锁"></a>1.公平锁&#x2F;非公平锁</h4><p>公平锁是指多个线程按照申请锁的顺序来获取锁，线程直接进入队列中排队，队列中的第一个线程才能获得锁。公平锁的优点是等待锁的线程不会饿死。缺点是整体吞吐效率相对非公平锁要低，等待队列中除第一个线程以外的所有线程都会阻塞，CPU唤醒阻塞线程的开销比非公平锁大。</p>
<p>非公平锁是多个线程加锁时直接尝试获取锁，获取不到才会到等待队列的队尾等待。但如果此时锁刚好可用，那么这个线程可以无需阻塞直接获取到锁，所以非公平锁有可能出现后申请锁的线程先获取锁的场景。非公平锁的优点是可以减少唤起线程的开销，整体的吞吐效率高，因为线程有几率不阻塞直接获得锁，CPU不必唤醒所有线程。缺点是处于等待队列中的线程可能会饿死，或者等很久才会获得锁。对于Java ReentrantLock而言，通过构造函数指定该锁是否是公平锁，默认是非公平锁。</p>
<p>非公平锁的优点在于吞吐量比公平锁大。 </p>
<p>例子：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104146557.png"></p>
<p>如上图所示，假设有一口水井，有管理员看守，管理员有一把锁，只有拿到锁的人才能够打水，打完水要把锁还给管理员。每个过来打水的人都要管理员的允许并拿到锁之后才能去打水，如果前面有人正在打水，那么这个想要打水的人就必须排队。管理员会查看下一个要去打水的人是不是队伍里排最前面的人，如果是的话，才会给你锁让你去打水；如果你不是排第一的人，就必须去队尾排队，这就是公平锁。</p>
<p>但是对于非公平锁，管理员对打水的人没有要求。即使等待队伍里有排队等待的人，但如果在上一个人刚打完水把锁还给管理员而且管理员还没有允许等待队伍里下一个人去打水时，刚好来了一个插队的人，这个插队的人是可以直接从管理员那里拿到锁去打水，不需要排队，原本排队等待的人只能继续等待。如下图所示：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/2018112210420869.png"></p>
<p>对于synchronized而言，也是一种非公平锁。由于其并不像ReentrantLock是通过AQS的来实现线程调度，所以并没有任何办法使其变成公平锁。</p>
<p>接下来我们通过ReentrantLock的源码来讲解公平锁和非公平锁。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104221314.png" alt="img"></p>
<p>根据代码可知，ReentrantLock里面有一个内部类Sync，Sync继承AQS（AbstractQueuedSynchronizer），添加锁和释放锁的大部分操作实际上都是在Sync中实现的。它有公平锁FairSync和非公平锁NonfairSync两个子类。ReentrantLock默认使用非公平锁，也可以通过构造器来显示的指定使用公平锁。</p>
<p>下面我们来看一下公平锁与非公平锁的加锁方法的源码:</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104235664.png" alt="img"></p>
<p> 通过上图中的源代码对比，我们可以明显的看出公平锁与非公平锁的lock()方法唯一的区别就在于公平锁在获取同步状态时多了一个限制条件：hasQueuedPredecessors()。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104316520.png" alt="img"></p>
<p>再进入hasQueuedPredecessors()，可以看到该方法主要做一件事情：主要是判断当前线程是否位于同步队列中的第一个。如果是则返回true，否则返回false。</p>
<p>综上，<strong>公平锁就是通过同步队列来实现多个线程按照申请锁的顺序来获取锁，从而实现公平的特性。非公平锁加锁时不考虑排队等待问题，直接尝试获取锁，所以存在后申请却先获得锁的情况。</strong></p>
<h4 id="2-独享锁-x2F-共享锁"><a href="#2-独享锁-x2F-共享锁" class="headerlink" title="2.独享锁&#x2F;共享锁"></a>2.独享锁&#x2F;共享锁</h4><p>独享锁和共享锁同样是一种概念。我们先介绍一下具体的概念，然后通过ReentrantLock和ReentrantReadWriteLock的源码来介绍独享锁和共享锁。</p>
<p>独享锁也叫排他锁，是<strong>指该锁一次只能被一个线程所持有</strong>。如果线程T对数据A加上排它锁后，则其他线程不能再对A加任何类型的锁。获得排它锁的线程即能读数据又能修改数据。JDK中的synchronized和JUC中Lock的实现类就是互斥锁。</p>
<p><strong>共享锁是指该锁可被多个线程所持有。如果线程T对数据A加上共享锁后，则其他线程只能对A再加共享锁，不能加排它锁。获得共享锁的线程只能读数据，不能修改数据。</strong></p>
<p>独享锁与共享锁也是通过AQS来实现的，通过实现不同的方法，来实现独享或者共享。</p>
<p>下图为ReentrantReadWriteLock的部分源码：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104424361.png" alt="img"></p>
<p>我们看到ReentrantReadWriteLock有两把锁：ReadLock和WriteLock，由词知意，一个读锁一个写锁，合称“读写锁”。再进一步观察可以发现ReadLock和WriteLock是靠内部类Sync实现的锁。Sync是AQS的一个子类，这种结构在CountDownLatch、ReentrantLock、Semaphore里面也都存在。</p>
<p>在ReentrantReadWriteLock里面，读锁和写锁的锁主体都是Sync，但读锁和写锁的加锁方式不一样。读锁是共享锁，写锁是独享锁。读锁的共享锁可保证并发读非常高效，而读写、写读、写写的过程互斥，因为读锁和写锁是分离的。所以ReentrantReadWriteLock的并发性相比一般的互斥锁有了很大提升。</p>
<p>那读锁和写锁的具体加锁方式有什么区别呢？在了解源码之前我们需要回顾一下其他知识。</p>
<p>在最开始提及AQS的时候我们也提到了state字段（int类型，32位），该字段用来描述有多少线程获持有锁。</p>
<p>在独享锁中这个值通常是0或者1（如果是重入锁的话state值就是重入的次数），在共享锁中state就是持有锁的数量。但是在ReentrantReadWriteLock中有读、写两把锁，所以需要在一个整型变量state上分别描述读锁和写锁的数量（或者也可以叫状态）。于是将state变量“按位切割”切分成了两个部分，高16位表示读锁状态（读锁个数），低16位表示写锁状态（写锁个数）。如下图所示：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104440388.png" alt="img"></p>
<p>了解了概念之后我们再来看代码，先看写锁的加锁源码：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104448924.png" alt="img"></p>
<ul>
<li>这段代码首先取到当前锁的个数c，然后再通过c来获取写锁的个数w。因为写锁是低16位，所以取低16位的最大值与当前的c做与运算（ int w &#x3D; exclusiveCount(c); ），高16位和0与运算后是0，剩下的就是低位运算的值，同时也是持有写锁的线程数目。</li>
<li>在取到写锁线程的数目后，首先判断是否已经有线程持有了锁。如果已经有线程持有了锁（c!&#x3D;0），则查看当前写锁线程的数目，如果写线程数为0（即此时存在读锁）或者持有锁的线程不是当前线程就返回失败（涉及到公平锁和非公平锁的实现）。</li>
<li>如果写入锁的数量大于最大数（65535，2的16次方-1）就抛出一个Error。</li>
<li>如果当且写线程数为0（那么读线程也应该为0，因为上面已经处理c!&#x3D;0的情况），并且当前线程需要阻塞那么就返回失败；如果通过CAS增加写线程数失败也返回失败。</li>
<li>如果c&#x3D;0，w&#x3D;0或者c&gt;0，w&gt;0（重入），则设置当前线程或锁的拥有者，返回成功！</li>
</ul>
<p>tryAcquire()除了重入条件（当前线程为获取了写锁的线程）之外，增加了一个读锁是否存在的判断。如果存在读锁，则写锁不能被获取，原因在于：必须确保写锁的操作对读锁可见，如果允许读锁在已被获取的情况下对写锁的获取，那么正在运行的其他读线程就无法感知到当前写线程的操作。</p>
<p>因此，只有等待其他读线程都释放了读锁，写锁才能被当前线程获取，而写锁一旦被获取，则其他读写线程的后续访问均被阻塞。写锁的释放与ReentrantLock的释放过程基本类似，每次释放均减少写状态，当写状态为0时表示写锁已被释放，然后等待的读写线程才能够继续访问读写锁，同时前次写线程的修改对后续的读写线程可见。</p>
<p>接着是读锁的代码：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104555799.png" alt="img"></p>
<p>可以看到在tryAcquireShared(int unused)方法中，如果其他线程已经获取了写锁，则当前线程获取读锁失败，进入等待状态。如果当前线程获取了写锁或者写锁未被获取，则当前线程（线程安全，依靠CAS保证）增加读状态，成功获取读锁。读锁的每次释放（线程安全的，可能有多个读线程同时释放读锁）均减少读状态，减少的值是“1&lt;&lt;16”。所以读写锁才能实现读读的过程共享，而读写、写读、写写的过程互斥。</p>
<p>此时，我们再回头看一下互斥锁ReentrantLock中公平锁和非公平锁的加锁源码：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104555509.png" alt="img"></p>
<p>我们发现在ReentrantLock虽然有公平锁和非公平锁两种，但是它们添加的都是独享锁。根据源码所示，当某一个线程调用lock方法获取锁时，如果同步资源没有被其他线程锁住，那么当前线程在使用CAS更新state成功后就会成功抢占该资源。而如果公共资源被占用且不是被当前线程占用，那么就会加锁失败。所以可以确定ReentrantLock无论读操作还是写操作，添加的锁都是都是独享锁。</p>
<p>对于Java ReentrantLock而言，其是独享锁。<strong>但是对于Lock的另一个实现类ReadWriteLock，其读锁是共享锁，其写锁是独享锁</strong>。读锁的共享锁可保证并发读是非常高效的，读写、写读 、写写的过程是互斥的。独享锁与共享锁也是通过AQS来实现的，通过实现不同的方法，来实现独享或者共享。对于synchronized而言，当然是独享锁。</p>
<h4 id="3-互斥锁-x2F-读写锁"><a href="#3-互斥锁-x2F-读写锁" class="headerlink" title="3.互斥锁&#x2F;读写锁"></a>3.互斥锁&#x2F;读写锁</h4><p>上面说到的独享锁&#x2F;共享锁就是一种广义的说法，互斥锁&#x2F;读写锁就是具体的实现。互斥锁在Java中的具体实现就是ReentrantLock（可重入锁）；读写锁在Java中的具体实现就是ReadWriteLock。独享锁与共享锁也是通过AQS来实现的。</p>
<p>在多线程的环境下，对同一份数据进行读写，会涉及到线程安全的问题。比如在一个线程读取数据的时候，另外一个线程在写数据，而导致前后数据的不一致性；一个线程在写数据的时候，另一个线程也在写，同样也会导致线程前后看到的数据的不一致性。   这时候可以在读写方法中加入互斥锁，任何时候只能允许一个线程的一个读或写操作，而不允许其他线程的读或写操作，这样是可以解决这样以上的问题，但是效率却大打折扣了。因为在真实的业务场景中，一份数据，读取数据的操作次数通常高于写入数据的操作，而线程与线程间的读读操作是不涉及到线程安全的问题，没有必要加入互斥锁，只要在读-写，写-写期间上锁就行了。对于这种情况，读写锁则最好的解决方案！</p>
<p>读写锁的机制： </p>
<ol>
<li><p>“读-读”不互斥 </p>
</li>
<li><p>“读-写”互斥 </p>
</li>
<li><p>“写-写”互斥</p>
</li>
</ol>
<p>即在任何时候必须保证： </p>
<ol>
<li>只有一个线程在写入； </li>
<li>线程正在读取的时候，写入操作等待； </li>
<li>线程正在写入的时候，其他线程的写入操作和读取操作都要等待；</li>
</ol>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachedData</span> &#123;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 缓存都应该是单例的，在这里用单例模式设计：  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">CachedData</span> <span class="variable">cachedData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CachedData</span>();  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReadWriteLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();<span class="comment">//读写锁  </span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; cache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();<span class="comment">//缓存  </span></span><br><span class="line">      </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">CachedData</span><span class="params">()</span>&#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CachedData <span class="title function_">getInstance</span><span class="params">()</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> cachedData;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 读取缓存：  </span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">read</span><span class="params">(String key)</span> &#123;  </span><br><span class="line">        lock.readLock().lock();  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            obj = cache.get(key);  </span><br><span class="line">            <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;  </span><br><span class="line">                lock.readLock().unlock();  </span><br><span class="line">                <span class="comment">// 在这里的时候，其他的线程有可能获取到锁  </span></span><br><span class="line">                lock.writeLock().lock();  </span><br><span class="line">                <span class="keyword">try</span> &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;  </span><br><span class="line">                        obj = <span class="string">&quot;查找数据库&quot;</span>; <span class="comment">// 实际动作是查找数据库  </span></span><br><span class="line">                        <span class="comment">// 把数据更新到缓存中：  </span></span><br><span class="line">                        cache.put(key, obj);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">                    <span class="comment">// 当前线程在获取到写锁的过程中，可以获取到读锁，这叫锁的重入，然后导致了写锁的降级，称为降级锁。  </span></span><br><span class="line">                    <span class="comment">// 利用重入可以将写锁降级，但只能在当前线程保持的所有写入锁都已经释放后，才允许重入 reader使用  </span></span><br><span class="line">                    <span class="comment">// 它们。所以在重入的过程中，其他的线程不会有获取到锁的机会（这样做的好处）。试想，先释放写锁，在  </span></span><br><span class="line">                    <span class="comment">// 上读锁，这样做有什么弊端？--如果这样做，那么在释放写锁后，在得到读锁前，有可能被其他线程打断。  </span></span><br><span class="line">                    <span class="comment">// 重入————&gt;降级锁的步骤：先获取写入锁，然后获取读取锁，最后释放写入锁（重点）  </span></span><br><span class="line">                    lock.readLock().lock();   </span><br><span class="line">                    lock.writeLock().unlock();  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            lock.readLock().unlock();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>



<h4 id="4-乐观锁-x2F-悲观锁"><a href="#4-乐观锁-x2F-悲观锁" class="headerlink" title="4.乐观锁&#x2F;悲观锁"></a>4.乐观锁&#x2F;悲观锁</h4><p>乐观锁与悲观锁不是指具体的什么类型的锁，而是指看待并发同步的角度。</p>
<p><strong>悲观锁：总是假设最坏的情况，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会阻塞直到它拿到锁</strong>。比如Java里面的同步原语synchronized关键字的实现就是悲观锁。</p>
<p>乐观锁：顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量，在Java中java.util.concurrent.atomic包下面的原子变量类就是使用了乐观锁的一种实现方式CAS(Compare and Swap 比较并交换)实现的。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122101819836.png" alt="img"></p>
<p>根据从上面的概念描述我们可以发现：</p>
<ul>
<li><p>悲观锁适合写操作多的场景，先加锁可以保证写操作时数据正确。</p>
</li>
<li><p>乐观锁适合读操作多的场景，不加锁的特点能够使其读操作的性能大幅提升。</p>
<p>乐观锁和悲观锁的调用方式示例：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122101946394.png" alt="img"></p>
</li>
</ul>
<p>通过调用方式示例，我们可以发现<strong>悲观锁基本都是在显式的锁定之后再操作同步资源，而乐观锁则直接去操作同步资源。</strong>那么，为何乐观锁能够做到不锁定同步资源也可以正确的实现线程同步呢？我们通过介绍乐观锁的主要实现方式 “CAS” 的技术原理来为大家解惑。</p>
<h5 id="乐观锁的一种实现：CAS"><a href="#乐观锁的一种实现：CAS" class="headerlink" title="乐观锁的一种实现：CAS"></a>乐观锁的一种实现：CAS</h5><p>CAS全称 Compare And Swap（比较与交换），是一种无锁算法。在不使用锁（没有线程被阻塞）的情况下实现多线程之间的变量同步。java.util.concurrent包中的原子类就是通过CAS来实现了乐观锁。</p>
<p>CAS算法涉及到三个操作数：</p>
<ul>
<li>需要读写的内存值 V。</li>
<li>进行比较的值 A。</li>
<li>要写入的新值 B。</li>
</ul>
<p>当且仅当 V 的值等于 A 时，CAS通过原子方式用新值B来更新V的值（“比较+更新”整体是一个原子操作），否则不会执行任何操作。一般情况下，“更新”是一个不断重试的操作。</p>
<p>注：</p>
<p>【原子性：即一个操作或者多个操作 要么全部执行并且执行的过程不会被任何因素打断，要么就都不执行。</p>
<ol>
<li><p>“原子操作(atomic operation)是不需要synchronized”，所谓原子操作是指不会被线程调度机制打断的操作；这种操作一旦开始，就一直运行到结束，中间不会有任何 context switch；</p>
</li>
<li><p>java中一般事务管理里面用到原子操作。</p>
</li>
<li><ol>
<li><p>原子操作可以是一个步骤，也可以是多个操作步骤，但是其顺序不可以被打乱，也不可以被切割而只执行其中的一部分，将整个操作视作一个整体是原子性的核心特征；</p>
</li>
<li><p>使用原子操作的好处：</p>
<p>⑴. 性能角度：它执行多次的所消耗的时间远远小于由于线程所挂起到恢复所消耗的时间，因此无锁的CAS操作在性能上要比同步锁高很多；</p>
<p>⑵. 业务需求：业务本身的需求上，无锁机制本身就可以满足我们绝大多数的需求，并且在性能上也可以大大的进行提升。】</p>
</li>
</ol>
</li>
</ol>
<p>之前提到java.util.concurrent包中的原子类，就是通过CAS来实现了乐观锁，那么我们进入原子类AtomicInteger的源码，看一下AtomicInteger的定义：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122102030461.png" alt="img"></p>
<p>根据定义我们可以看出各属性的作用：</p>
<ul>
<li>unsafe： 获取并操作内存的数据。</li>
<li>valueOffset： 存储value在AtomicInteger中的偏移量。</li>
<li>value： 存储AtomicInteger的int值，该属性需要借助volatile关键字保证其在线程间是可见的。</li>
</ul>
<p>接下来，我们查看AtomicInteger的自增函数incrementAndGet()的源码时，发现自增函数底层调用的是unsafe.getAndAddInt()。但是由于JDK本身只有Unsafe.class，只通过class文件中的参数名，并不能很好的了解方法的作用，所以我们通过OpenJDK 8 来查看Unsafe的源码：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122102047431.png" alt="img"></p>
<p>根据OpenJDK 8的源码我们可以看出，getAndAddInt()循环获取给定对象o中的偏移量处的值v，然后判断内存值是否等于v。如果相等则将内存值设置为 v + delta，否则返回false，继续循环进行重试，直到设置成功才能退出循环，并且将旧值返回。整个“比较+更新”操作封装在compareAndSwapInt()中，在JNI里是借助于一个CPU指令完成的，属于原子操作，可以保证多个线程都能够看到同一个变量的修改值。</p>
<p>后续JDK通过CPU的cmpxchg指令，去比较寄存器中的 A 和 内存中的值 V。如果相等，就把要写入的新值 B 存入内存中。如果不相等，就将内存值 V 赋值给寄存器中的值 A。然后通过Java代码中的while循环再次调用cmpxchg指令进行重试，直到设置成功为止。</p>
<p>CAS虽然很高效，但是它也存在三大问题，这里也简单说一下：</p>
<p>\1. <strong>ABA问题</strong>。CAS需要在操作值的时候检查内存值是否发生变化，没有发生变化才会更新内存值。但是如果内存值原来是A，后来变成了B，然后又变成了A，那么CAS进行检查时会发现值没有发生变化，但是实际上是有变化的。ABA问题的解决思路就是在变量前面添加版本号，每次变量更新的时候都把版本号加一，这样变化过程就从“A－B－A”变成了“1A－2B－3A”。</p>
<p>JDK从1.5开始提供了AtomicStampedReference类来解决ABA问题，具体操作封装在compareAndSet()中。compareAndSet()首先检查当前引用和当前标志与预期引用和预期标志是否相等，如果都相等，则以原子方式将引用值和标志的值设置为给定的更新值。</p>
<p>\2. <strong>循环时间长开销大</strong>。CAS操作如果长时间不成功，会导致其一直自旋，给CPU带来非常大的开销。</p>
<p>\3. <strong>只能保证一个共享变量的原子操作</strong>。对一个共享变量执行操作时，CAS能够保证原子操作，但是对多个共享变量操作时，CAS是无法保证操作的原子性的。</p>
<p>Java从1.5开始JDK提供了AtomicReference类来保证引用对象之间的原子性，可以把多个变量放在一个对象里来进行CAS操作。</p>
<h4 id="5-分段锁"><a href="#5-分段锁" class="headerlink" title="5.分段锁"></a>5.分段锁</h4><p>分段锁其实是一种锁的设计，并不是具体的一种锁，对于ConcurrentHashMap而言，其并发的实现就是通过分段锁的形式来实现高效的并发操作，ConcurrentHashMap中的分段锁称为Segment，它即类似于HashMap（JDK7与JDK8中HashMap的实现）的结构，即内部拥有一个Entry数组，数组中的每个元素又是一个链表；同时又是一个ReentrantLock（Segment继承了ReentrantLock)。当需要put元素的时候，并不是对整个HashMap进行加锁，而是先通过hashcode来知道他要放在那一个分段中，然后对这个分段进行加锁，所以当多线程put的时候，只要不是放在一个分段中，就实现了真正的并行的插入。但是，在统计size的时候，可就是获取HashMap全局信息的时候，就需要获取所有的分段锁才能统计。</p>
<p>分段锁的设计目的是细化锁的粒度，当操作不需要更新整个数组的时候，就仅仅针对数组中的一项进行加锁操作。</p>
<h4 id="6-无锁-x2F-偏向锁-x2F-轻量级锁-x2F-重量级锁（待看）"><a href="#6-无锁-x2F-偏向锁-x2F-轻量级锁-x2F-重量级锁（待看）" class="headerlink" title="6.无锁&#x2F;偏向锁&#x2F;轻量级锁&#x2F;重量级锁（待看）"></a>6.无锁&#x2F;偏向锁&#x2F;轻量级锁&#x2F;重量级锁（待看）</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010648018/article/details/79750608">参考文章</a></p>
<p>这四种锁是指锁的状态，并且是针对synchronized。在Java 5通过引入锁升级的机制来实现高效synchronized。这三种锁（偏向锁&#x2F;轻量级锁&#x2F;重量级锁）的状态是通过对象监视器在对象头中的字段来表明的。</p>
<h5 id="Synchronized用法"><a href="#Synchronized用法" class="headerlink" title="Synchronized用法"></a>Synchronized用法</h5><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/blueSkyline/p/8598099.html">原文链接</a></p>
<p>synchronized是实现线程同步的基本手段，然而底层实现还是通过锁机制来保证，对于被synchronized修饰的区域每次只有一个线程可以访问，从而满足线程安全的目的。</p>
<p>synchronized通过锁机制的实现，满足了原子性，可见性和有序性，是并发编程正确执行的有效保障，而volatile只保证了可见性和有序性（禁止指令重排）。</p>
<p>synchronized可以修饰范围的包括：方法级别，代码块级别；而实际加锁的目标包括：对象锁（普通变量，静态变量），类锁。</p>
<p>下面是synchronized的几种常用方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynMethod</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">staticLockObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对象锁,代码级别,同一对象争用该锁,this为SynMethod实例,synchronized的锁绑定在this对象上</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; synchronized loop &quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对象锁，方法级别,同一对象争用该锁,普通（非静态）方法,synchronized的锁绑定在调用该方法的对象上,与上一个写法含义一致</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; synchronized loop &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对象锁，代码级别,同一类争用该锁,绑定在staticLockObj上,不同SynMethod实例,拥有同一个staticLockObj对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (staticLockObj) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; synchronized loop &quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 类锁,代码级别，同一类争用该锁</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (SynMethod.class) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; synchronized loop &quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 类锁,方法级别，同一类争用该锁,synchronized的锁绑定在SynMethod.class上</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">staticMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; synchronized loop &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试情况1</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method1();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method1();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程运行了同一个对象t1的同一个public方法method1。</p>
<p><strong>测试情况2</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method1();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method2();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程运行同一个对象t1的不同的方法method1和method2方法，但是这两个方法是使用同一个对象t1上进行同步的，所以实现同步的效果，侧面印证了这两种写法的一致性。</p>
<p><strong>测试情况3：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method3();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t2.method3();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程运行了不同的类对象t1和t2的同一个方法method3，这个方法是在一个静态对象上同步，这个<strong>静态变量</strong>是在这个类的所有实例上共享的，所以也是达到了同步的效果</p>
<p><strong>测试情况4：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method2();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method3();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程运行了同一个对象t1的method2和method3方法，这个方法分别在t1对象和SynMethod类的静态对象上同步，所以达到同步效果。因为method3方法是针对同一类的，</p>
<p><strong>测试情况5：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method4();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t2.method4();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程运行了不同对象t1和t2的同一个方法method4，该方法是在SynMethod类上同步，实现了同步效果</p>
<p><strong>测试情况6：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method4();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                SynMethod.staticMethod();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程分别运行了对象t1的method4和静态方法staticMethod，这个两个方法都在SynMethod类上同步，实现了同步的效果。</p>
<p><strong>测试情况7：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method4();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t2.method3();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>这次两个线程运行了两个对象的method3和method4发放，这个两个方法分别在SynMethod类和SynMethod类的静态对象上同步，所以没有达到同步效果</p>
<p><strong>测试情况8：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method4();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t2.method2();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>这次两个线程运行了两个对象的method4和method2方法，这两个方法分别在SynMethod类和对象t2上同步，所以没有达到同步效果。</p>
<p>　　<strong>使用总结：虽然上面说的情况比较多，但是从同步对象的角度，同步的场景只用三个，一个是SynMethod实例（可以多个），SynMethod的静态对象（共享）和SynMethod类（一个），只要是在同一个对象上同步，这个对象可以是实例对象，可以是静态对象，可以是类对象，那么就可以实现同步效果，否则无法达到同步，这也与synchronized设计的初衷一致。</strong></p>
<h5 id="为什么Synchronized能实现线程同步？"><a href="#为什么Synchronized能实现线程同步？" class="headerlink" title="为什么Synchronized能实现线程同步？"></a>为什么Synchronized能实现线程同步？</h5><p>在回答这个问题之前我们需要了解两个重要的概念：“Java对象头”、“Monitor”。</p>
<p>1、Java对象头</p>
<p>synchronized是悲观锁，在操作同步资源之前需要给同步资源先加锁，<strong>这把锁就是存在Java对象头里的</strong>，而Java对象头又是什么呢？</p>
<p>我们以Hotspot虚拟机为例，Hotspot的对象头主要包括两部分数据：Mark Word（标记字段）、Klass Pointer（类型指针）。</p>
<p><strong>Mark Word</strong>：默认存储对象的HashCode，分代年龄和锁标志位信息。这些信息都是与对象自身定义无关的数据，所以Mark Word被设计成一个非固定的数据结构以便在极小的空间内存存储尽量多的数据。它会根据对象的状态复用自己的存储空间，也就是说在运行期间Mark Word里存储的数据会随着锁标志位的变化而变化。</p>
<p><strong>Klass Point</strong>：对象指向它的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例。</p>
<p>运行时JVM内存布局</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/2018032923230698"></p>
<p>Mark Word在不同锁状态下的标志位存储</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20180329232421333"></p>
<p>2、Monitor</p>
<p>Monitor可以理解为一个同步工具或一种同步机制，通常被描述为一个对象。每一个Java对象就有一把看不见的锁，称为内部锁或者Monitor锁。</p>
<p>Monitor是线程私有的数据结构，每一个线程都有一个可用monitor record列表，同时还有一个全局的可用列表。每一个被锁住的对象都会和一个monitor关联，同时monitor中有一个Owner字段存放拥有该锁的线程的唯一标识，表示该锁被这个线程占用。</p>
<p>现在话题回到synchronized，synchronized通过Monitor来实现线程同步，Monitor是依赖于底层的操作系统的Mutex Lock（互斥锁）来实现的线程同步。</p>
<p>如同我们在自旋锁中提到的“阻塞或唤醒一个Java线程需要操作系统切换CPU状态来完成，这种状态转换需要耗费处理器时间。如果同步代码块中的内容过于简单，状态转换消耗的时间有可能比用户代码执行的时间还要长”。这种方式就是synchronized最初实现同步的方式，这就是JDK 6之前synchronized效率低的原因。这种依赖于操作系统Mutex Lock所实现的锁我们称之为“重量级锁”，JDK 6中为了减少获得锁和释放锁带来的性能消耗，引入了“偏向锁”和“轻量级锁”。</p>
<p>所以目前锁一共有4种状态，级别从低到高依次是：无锁、偏向锁、轻量级锁和重量级锁。锁状态只能升级不能降级。</p>
<p>通过上面的介绍，我们对synchronized的加锁机制以及相关知识有了一个了解，那么下面我们给出四种锁状态对应的的Mark Word内容，然后再分别讲解四种锁状态的思路以及特点：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/2018112210411172.png" alt="img"></p>
<p><strong>无锁</strong></p>
<p>无锁没有对资源进行锁定，所有的线程都能访问并修改同一个资源，但同时只有一个线程能修改成功。</p>
<p>无锁的特点就是修改操作在循环内进行，线程会不断的尝试修改共享资源。如果没有冲突就修改成功并退出，否则就会继续循环尝试。如果有多个线程修改同一个值，必定会有一个线程能修改成功，而其他修改失败的线程会不断重试直到修改成功。上面我们介绍的CAS原理及应用即是无锁的实现。无锁无法全面代替有锁，但无锁在某些场合下的性能是非常高的。</p>
<p><strong>偏向锁</strong></p>
<p><strong>偏向锁是指一段同步代码一直被一个线程所访问，那么该线程会自动获取锁，降低获取锁的代价。</strong></p>
<p>在大多数情况下，锁总是由同一线程多次获得，不存在多线程竞争，所以出现了偏向锁。其目标就是在只有一个线程执行同步代码块时能够提高性能。</p>
<p>当一个线程访问同步代码块并获取锁时，会在Mark Word里存储锁偏向的线程ID。在线程进入和退出同步块时不再通过CAS操作来加锁和解锁，而是检测Mark Word里是否存储着指向当前线程的偏向锁。引入偏向锁是为了在无多线程竞争的情况下尽量减少不必要的轻量级锁执行路径，因为轻量级锁的获取及释放依赖多次CAS原子指令，而偏向锁只需要在置换ThreadID的时候依赖一次CAS原子指令即可。</p>
<p>偏向锁只有遇到其他线程尝试竞争偏向锁时，持有偏向锁的线程才会释放锁，线程不会主动释放偏向锁。偏向锁的撤销，需要等待全局安全点（在这个时间点上没有字节码正在执行），它会首先暂停拥有偏向锁的线程，判断锁对象是否处于被锁定状态。撤销偏向锁后恢复到无锁（标志位为“01”）或轻量级锁（标志位为“00”）的状态。</p>
<p>偏向锁在JDK 6及以后的JVM里是默认启用的。可以通过JVM参数关闭偏向锁：-XX:-UseBiasedLocking&#x3D;false，关闭之后程序默认会进入轻量级锁状态。</p>
<p><strong>轻量级锁</strong></p>
<p>是指当锁是偏向锁的时候，被另外的线程所访问，偏向锁就会升级为轻量级锁，其他线程会通过自旋的形式尝试获取锁，不会阻塞，从而提高性能。</p>
<p>在代码进入同步块的时候，如果同步对象锁状态为无锁状态（锁标志位为“01”状态，是否为偏向锁为“0”），虚拟机首先将在当前线程的栈帧中建立一个名为锁记录（Lock Record）的空间，用于存储锁对象目前的Mark Word的拷贝，然后拷贝对象头中的Mark Word复制到锁记录中。</p>
<p>拷贝成功后，虚拟机将使用CAS操作尝试将对象的Mark Word更新为指向Lock Record的指针，并将Lock Record里的owner指针指向对象的Mark Word。</p>
<p>如果这个更新动作成功了，那么这个线程就拥有了该对象的锁，并且对象Mark Word的锁标志位设置为“00”，表示此对象处于轻量级锁定状态。</p>
<p>如果轻量级锁的更新操作失败了，虚拟机首先会检查对象的Mark Word是否指向当前线程的栈帧，如果是就说明当前线程已经拥有了这个对象的锁，那就可以直接进入同步块继续执行，否则说明多个线程竞争锁。</p>
<p>若当前只有一个等待线程，则该线程通过自旋进行等待。但是当自旋超过一定的次数，或者一个线程在持有锁，一个在自旋，又有第三个来访时，轻量级锁升级为重量级锁。</p>
<p><strong>重量级锁</strong></p>
<p>升级为重量级锁时，锁标志的状态值变为“10”，此时Mark Word中存储的是指向重量级锁的指针，此时等待锁的线程都会进入阻塞状态。</p>
<p>整体的锁状态升级流程如下：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104130517.png" alt="img"></p>
<p>综上，偏向锁通过对比Mark Word解决加锁问题，避免执行CAS操作。而轻量级锁是通过用CAS操作和自旋来解决加锁问题，避免线程阻塞和唤醒而影响性能。重量级锁是将除了拥有锁的线程以外的线程都阻塞。</p>
<p>重量级锁是指当锁为轻量级锁的时候，另一个线程虽然是自旋，但自旋不会一直持续下去，当自旋一定次数的时候，还没有获取到锁，就会进入阻塞，该锁膨胀为重量级锁。重量级锁会让其他申请的线程进入阻塞，性能降低。<strong>随着竞争情况锁状态逐渐升级、锁可以升级但不能降级。</strong></p>
<p>偏向锁的获取和撤销：</p>
<p>HotSpot作者经过研究发现，大多数情况下，锁不仅不存在多线程竞争，而且总是由同一线程多次获得，为了让线程获得锁的代价更低而引入偏向锁。</p>
<p>线程1检查对象头中的Mark Word中是否存储了线程1，如果没有则CAS操作将Mark Word中的线程ID替换为线程1。此时，锁偏向线程1，后面该线程进入同步块时不需要进行CAS操作，只需要简单的测试一下Mark Word中是否存储指向当前线程的偏向锁，如果成功表明该线程已经获得锁。如果失败，则再需要测试一下Mark Word中偏向锁标识是否设置为1(是否是偏向锁)，如果没有设置，则使用CAS竞争锁，如果设置了，则尝试使用CAS将偏向锁指向当前线程</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20180329232604894"></p>
<p>偏向锁的竞争结果:</p>
<p>根据持有偏向锁的线程是否存活</p>
<p>1.如果不活动，偏向锁撤销到无锁状态，再偏向到其他线程<br>2.如果线程仍然活着，则升级到轻量级锁</p>
<p>偏向锁在Java6和Java7中默认是开启的，但是在应用程序启动几秒后才激活，如果有必要可以关闭延迟：<br>-XX:BiasedLockingStartupDelay&#x3D;0</p>
<p>如果确定应用程序中所有的锁通常情况下处于竞争状态，可以通过JVM参数关闭偏向锁：<br>-XX:-UseBiasedLocking&#x3D;false，那么程序默认会进入轻量级锁。</p>
<p>-XX:BiasedLockingStartupDelay&#x3D;0 -XX:+TraceBiasedLocking</p>
<p>轻量级锁膨胀：</p>
<p>1.线程在执行同步块之前，JVM会在当前栈桢中创建用于存储锁记录的空间(Lock record)，并将对象头中的Mark Word复制到锁记录中(Displaced Mark Word)。<br>2.然后线程尝试使用CAS将对象头中的Mark Word替换为指向锁记录的指针<br>3.如果成功，当前线程获得锁，如果失败，表示其他线程竞争锁，当前线程尝试使用自旋来获取锁</p>
<p><strong>偏向锁、轻量级锁、重量级锁的优缺点</strong></p>
<p>1.偏向锁是为了避免某个线程反复获得&#x2F;释放同一把锁时的性能消耗，如果仍然是同个线程去获得这个锁，尝试偏向锁时会直接进入同步块，不需要再次获得锁。</p>
<p>2.而轻量级锁和自旋锁都是为了避免直接调用操作系统层面的互斥操作，因为挂起线程是一个很耗资源的操作。</p>
<p>为了尽量避免使用重量级锁（操作系统层面的互斥），首先会尝试轻量级锁，轻量级锁会尝试使用CAS操作来获得锁，如果轻量级锁获得失败，说明存在竞争。但是也许很快就能获得锁，就会尝试自旋锁，将线程做几个空循环，每次循环时都不断尝试获得锁。如果自旋锁也失败，那么只能升级成重量级锁。</p>
<p>3.可见偏向锁，轻量级锁，自旋锁都是乐观锁。</p>
<p>逃逸分析：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20180329233254519"></p>
<p>逃逸分析：通俗一点讲，当一个对象的指针被多个方法或线程引用时，我们称这个指针发生了逃逸，必须在JIT里完成</p>
<p>锁粗化：</p>
<p>如果虚拟机探测到有这样一串零碎的操作都对同一个对象加锁，将会把加锁同步的范围扩展到整个操作序列的外部，这样就只需要加锁一次就够了</p>
<p>锁消除：</p>
<p>如果你定义的类的方法上有同步锁，但在运行时，却只有一个线程在访问，此时逃逸分析后的机器码，会去掉同步锁运行。</p>
<p>栈上分配：</p>
<p>分析找到未逃逸的变量，将变量类的实例化内存直接在栈里分配(无需进入堆)，分配完成后，继续在调用栈内执行，最后线程结束，栈空间被回收，局部变量对象也被回收。</p>
<p>从jdk1.6开始默认开启：<br>开启：  -XX:+DoEscapeAnalysis</p>
<p>关闭：  -XX:-DoEscapeAnalysis</p>
<h4 id="7-自旋锁"><a href="#7-自旋锁" class="headerlink" title="7.自旋锁"></a>7.自旋锁</h4><p>在Java中，自旋锁是指尝试获取锁的线程不会立即阻塞，而是采用循环的方式去尝试获取锁，这样的好处是减少线程上下文切换的消耗，缺点是循环会消耗CPU。</p>
<p>在介绍自旋锁前，我们需要介绍一些前提知识来帮助大家明白自旋锁的概念。</p>
<p>阻塞或唤醒一个Java线程需要操作系统切换CPU状态来完成，这种状态转换需要耗费处理器时间。如果同步代码块中的内容过于简单，状态转换消耗的时间有可能比用户代码执行的时间还要长。</p>
<p>在许多场景中，同步资源的锁定时间很短，为了这一小段时间去切换线程，线程挂起和恢复现场的花费可能会让系统得不偿失。如果物理机器有多个处理器，能够让两个或以上的线程同时并行执行，我们就可以让后面那个请求锁的线程不放弃CPU的执行时间，看看持有锁的线程是否很快就会释放锁。</p>
<p>而为了让当前线程“稍等一下”，我们需让当前线程进行自旋，如果在自旋完成后前面锁定同步资源的线程已经释放了锁，那么当前线程就可以不必阻塞而是直接获取同步资源，从而避免切换线程的开销。这就是自旋锁。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/2018112210212894.png" alt="img"></p>
<p>自旋锁本身是有缺点的，它不能代替阻塞。自旋等待虽然避免了线程切换的开销，但它要占用处理器时间。如果锁被占用的时间很短，自旋等待的效果就会非常好。反之，如果锁被占用的时间很长，那么自旋的线程只会白浪费处理器资源。所以，自旋等待的时间必须要有一定的限度，如果自旋超过了限定次数（默认是10次，可以使用-XX:PreBlockSpin来更改）没有成功获得锁，就应当挂起线程。</p>
<p>自旋锁的实现原理同样也是CAS，AtomicInteger中调用unsafe进行自增操作的源码中的do-while循环就是一个自旋操作，如果修改数值失败则通过循环来执行自旋，直至修改成功。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104052869.png" alt="img"></p>
<p>自旋锁在JDK1.4.2中引入，使用-XX:+UseSpinning来开启。JDK 6中变为默认开启，并且引入了自适应的自旋锁（适应性自旋锁）。</p>
<p>自适应意味着自旋的时间（次数）不再固定，而是由前一次在同一个锁上的自旋时间及锁的拥有者的状态来决定。如果在同一个锁对象上，自旋等待刚刚成功获得过锁，并且持有锁的线程正在运行中，那么虚拟机就会认为这次自旋也是很有可能再次成功，进而它将允许自旋等待持续相对更长的时间。如果对于某个锁，自旋很少成功获得过，那在以后尝试获取这个锁时将可能省略掉自旋过程，直接阻塞线程，避免浪费处理器资源。</p>
<p>在自旋锁中 另有三种常见的锁形式:TicketLock、CLHlock和MCSlock。</p>
<h4 id="8-可重入锁-x2F-非可重入锁"><a href="#8-可重入锁-x2F-非可重入锁" class="headerlink" title="8.可重入锁&#x2F;非可重入锁"></a>8.可重入锁&#x2F;非可重入锁</h4><p>可重入锁又名递归锁，是指在同一个线程在外层方法获取锁的时候，再进入该线程的内层方法会自动获取锁（前提锁对象得是同一个对象或者class），不会因为之前已经获取过还没释放而阻塞。Java中ReentrantLock和synchronized都是可重入锁，可重入锁的一个优点是可一定程度避免死锁。下面用示例代码来进行分析：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104329631.png" alt="img"></p>
<p>在上面的代码中，类中的两个方法都是被内置锁synchronized修饰的，doSomething()方法中调用doOthers()方法。因为内置锁是可重入的，所以同一个线程在调用doOthers()时可以直接获得当前对象的锁，进入doOthers()进行操作。</p>
<p>如果是一个不可重入锁，那么当前线程在调用doOthers()之前需要将执行doSomething()时获取当前对象的锁释放掉，实际上该对象锁已被当前线程所持有，且无法释放。所以此时会出现死锁。</p>
<p>而为什么可重入锁就可以在嵌套调用时可以自动获得锁呢？我们通过图示和源码来分别解析一下。</p>
<p>还是打水的例子，有多个人在排队打水，此时管理员允许锁和同一个人的多个水桶绑定。这个人用多个水桶打水时，第一个水桶和锁绑定并打完水之后，第二个水桶也可以直接和锁绑定并开始打水，所有的水桶都打完水之后打水人才会将锁还给管理员。这个人的所有打水流程都能够成功执行，后续等待的人也能够打到水。这就是可重入锁。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/2018112210434386.png" alt="img"></p>
<p>但如果是非可重入锁的话，此时管理员只允许锁和同一个人的一个水桶绑定。第一个水桶和锁绑定打完水之后并不会释放锁，导致第二个水桶不能和锁绑定也无法打水。当前线程出现死锁，整个等待队列中的所有线程都无法被唤醒。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104355888.png" alt="img"></p>
<p>之前我们说过ReentrantLock和synchronized都是重入锁，那么我们通过重入锁ReentrantLock以及非可重入锁NonReentrantLock的源码来对比分析一下为什么非可重入锁在重复调用同步资源时会出现死锁。</p>
<p>首先ReentrantLock和NonReentrantLock都继承父类AQS，其父类AQS中维护了一个同步状态status来计数重入次数，status初始值为0。</p>
<p>当线程尝试获取锁时，可重入锁先尝试获取并更新status值，如果status &#x3D;&#x3D; 0表示没有其他线程在执行同步代码，则把status置为1，当前线程开始执行。如果status !&#x3D; 0，则判断当前线程是否是获取到这个锁的线程，如果是的话执行status+1，且当前线程可以再次获取锁。而非可重入锁是直接去获取并尝试更新当前status的值，如果status !&#x3D; 0的话会导致其获取锁失败，当前线程阻塞。</p>
<p>释放锁时，可重入锁同样先获取当前status的值，在当前线程是持有锁的线程的前提下。如果status-1 &#x3D;&#x3D; 0，则表示当前线程所有重复获取锁的操作都已经执行完毕，然后该线程才会真正释放锁。而非可重入锁则是在确定当前线程是持有锁的线程之后，直接将status置为0，将锁释放。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104410235.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">setA</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    setB();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">setB</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码就是一个可重入锁的一个特点，如果不是可重入锁的话，setB可能不会被当前线程执行，可能造成死锁。</p>
<p>需要注意的是，可重入锁加锁和解锁的次数要相等。</p>
<p><img src="/../../../../notes_learn/java/Java%25E4%25B8%25AD%25E5%25B8%25B8%25E7%2594%25A8%25E7%259A%2584%25E9%2594%2581%25E6%259C%25BA%25E5%2588%25B6.assets/20180329230449266" alt="img"></p>
<p>C&#x3D;&#x3D;0表明未获得锁，Else表示已经获得锁，这时对state加1，相应的，每次释放锁都会对state减1</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/01/19/android_drawable/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/19/android_drawable/" class="post-title-link" itemprop="url">drawable</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-19 08:41:20" itemprop="dateCreated datePublished" datetime="2020-01-19T08:41:20Z">2020-01-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-22 02:17:10" itemprop="dateModified" datetime="2020-01-22T02:17:10Z">2020-01-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="drawable"><a href="#drawable" class="headerlink" title="drawable"></a>drawable</h1><p><strong>drawable常用作View的背景</strong>（还可以作为ImageView中的图像来显示）。是通过xml来定义的。</p>
<p>Drawable是个抽象类，是所有Dreawble对象的基类，每个具体的Drawable是它的子类。这就反映了Drawable是可以通过代码来创建的。</p>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><h3 id="1-BitmapDrawable"><a href="#1-BitmapDrawable" class="headerlink" title="1.BitmapDrawable"></a>1.BitmapDrawable</h3><p> 表示一张图片，可以直接接引原始的图片，或者通过XML的方式描述。</p>
<h3 id="2-ShapeDrawble"><a href="#2-ShapeDrawble" class="headerlink" title="2.ShapeDrawble"></a>2.ShapeDrawble</h3><p>通过颜色构造的图形</p>
<h3 id="3-LayerDrawable"><a href="#3-LayerDrawable" class="headerlink" title="3.LayerDrawable"></a>3.LayerDrawable</h3><p>将不同的Drawable放置在不同的层上面达到一种叠加效果。XML标签是<layer-list>，一个layer-list包含很多个item，一个item表示一个Drawable。item中的属性可以移动对应的Drawable。item中的andorid：drawable属性可以引用一个Drawable（故该drawable是已经存在的。）或者自己在item中定义一个。</p>
<h3 id="4-StateListDrawable"><a href="#4-StateListDrawable" class="headerlink" title="4.StateListDrawable"></a>4.StateListDrawable</h3><p>对应着<selector>标签，表示的是drawable的集合，每个drawable对应view的一种状态，<strong>系统会根据view的状态来选择drawable</strong></p>
<p>它包含许多个item（表示一个具体的Drawable）里面包含了view的状态。故系统自上而下根据view的状态选择item。（找到一个就返回，没找到就选择默认的item）默认的item是不附带状态的。</p>
<h3 id="5-LevelListDrawable"><a href="#5-LevelListDrawable" class="headerlink" title="5.LevelListDrawable"></a>5.LevelListDrawable</h3><p>对应<level-list>标签，表示的是drawable集合，但是集合中的drawable是有等级的。根据不同的等级切换到不同的drawable。等级在item。view是通过设置等级来选择对应的drawable作为其背景的。（设置等级是通过Drawable类的setLevel方法来设置的）。</p>
<p>感觉上可以自由选择自己想要的背景。</p>
<h3 id="6-TransitionDrawable"><a href="#6-TransitionDrawable" class="headerlink" title="6.TransitionDrawable"></a>6.TransitionDrawable</h3><p>对应<transition>标签。实现<strong>两个</strong>drawable之间的淡入淡出。</p>
<p>在其中确定自己的item（即item对应的drawable之前淡入淡出）</p>
<p>可以直接在view中设置为其背景</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ImageView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/imgView&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">android:src=<span class="string">&quot;@drawable/transition&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>或者在代码中控制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">ImageView</span> <span class="variable">image</span> <span class="operator">=</span> (ImageView) findViewById(R.id.mIv);</span><br><span class="line"><span class="comment">//得到一个Drawable，属于 TransitionDrawable 类型的</span></span><br><span class="line">        <span class="type">TransitionDrawable</span> <span class="variable">transition</span> <span class="operator">=</span> (TransitionDrawable)getResources().</span><br><span class="line">                getDrawable(R.drawable.transition_simple);</span><br><span class="line"></span><br><span class="line">        image.setImageDrawable(transition);</span><br><span class="line">        transition.startTransition(<span class="number">2000</span>); <span class="comment">// 设定渐变的变化时长</span></span><br></pre></td></tr></table></figure>

<p>问题：如何实现多个drawable的淡入淡出？</p>
<p>开启一个线程（死循环）每隔一段时间发送消息到UI主线程中替换主线程中的transitionDrawable对象中的图片就可以了，需要用到handler。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/z_zt_t/article/details/52761432">https://blog.csdn.net/z_zt_t/article/details/52761432</a></p>
<h3 id="7-InsetDrawable"><a href="#7-InsetDrawable" class="headerlink" title="7.InsetDrawable"></a>7.InsetDrawable</h3><p>对应<inset>标签。可以将其他的drawable内嵌到自己的当中。故view可以让背景比自己的实际区域小。</p>
<p>很像drawable的padding属性，区别在于 padding表示drawable的内容与drawable本身的边距，insetDrawable表示两个drawable和容器之间的边距。</p>
<h3 id="8-ScaleDrawable"><a href="#8-ScaleDrawable" class="headerlink" title="8.ScaleDrawable"></a>8.ScaleDrawable</h3><p>对应与<scale>标签。根据自己的等级将其指定的drawable进行放缩。等级越小，放缩越好。等级为0，则不可见。</p>
<h3 id="9-ClipDrawable"><a href="#9-ClipDrawable" class="headerlink" title="9.ClipDrawable"></a>9.ClipDrawable</h3><p>对应与<clip>标签。根据自己的等级设置一个Drawable的当前显示比例来裁剪出另一张Drawable。（该drawable是其引用的drawable的一部分）</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/briblue/article/details/53528837">https://blog.csdn.net/briblue/article/details/53528837</a></p>
<h3 id="10-自定义Drawable"><a href="#10-自定义Drawable" class="headerlink" title="10.自定义Drawable"></a>10.自定义Drawable</h3><p>核心是draw方法（？）。系统调用draw方法来绘制view的背景。由此可得，可以通过重写drawable的draw方法来自定义drawable。</p>
<h3 id="11-VectorDrawable"><a href="#11-VectorDrawable" class="headerlink" title="11.VectorDrawable"></a>11.VectorDrawable</h3><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0972a0d290e9">Android矢量图I–VectorDrawable基础</a></p>
<p>Android API 21（5.0）引入了一个Drawable的子类<code>VectorDrawable</code>目的就是用来渲染矢量图，<code>AnimatedVectorDrawable</code>用来播放矢量动画。</p>
<p><strong>准备</strong></p>
<p>使用矢量图要根据<code>minSdkVersion</code>来分3中不同的情况：</p>
<ol>
<li><code>minSdkVersion&gt;=21</code>：用xml文件或者代码定义VectorDrawable，和普通的Drawable用法一样，不再需要额外任何东西；如何编写矢量图，下文有介绍；</li>
<li><code>minSdkVersion&lt;21</code>：如果想要渲染矢量图的话必须在app模块的build.gralde文件里添加一行代码：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">    vectorDrawables.useSupportLibrary = true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	3. <code>minSdkVersion&lt;21以及更多</code>：上面的第二种情况是使用兼容包，但是兼容包仅支持<code>AppCompatImageView</code>和<code>AppCompatImageButton</code>及其子类矢量图，而且矢量图的引用必须放在<code>app:srcCompat</code>属性中才会被识别并生效，代码必须这样写才行：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.AppCompatImageView</span></span></span><br><span class="line"><span class="tag">      <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:layout_width</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:layout_height</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">app:srcCompat</span>=<span class="string">&quot;@drawable/ic_oval&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ic_oval.xml是我们使用xml编写的矢量图，如果想要TextView的drawableTop或者其他额外方式使用矢量图渲染，那么必须在Activity中加入代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    AppCompatDelegate.setCompatVectorFromResourcesEnabled(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时这个Activity必须继承AppCompatActivity这个compat兼容包属性才会生效。</p>
<p><code>minSdkVersion&lt;21</code>情况下在非app:srcCompat属性的地方使用矢量图时，需要将矢量图用drawable容器(如StateListDrawable, InsetDrawable, LayerDrawable, LevelListDrawable, 和RotateDrawable)包裹起来使用。否则会在低版本的情况下报错<code>org.xmlpull.v1.XmlPullParserException: Binary XML file line #0: invalid drawable tag vector</code>。minSdkVersion&gt;&#x3D;21则没有任何限制。</p>
<p><strong>矢量图使用</strong></p>
<p>准备工作做好之后，我们就需要自己动手编辑矢量图了。VectorDrawable类在xml中对应的是标签是<code>vector</code>。我目前所知道的是只有xml文件才能决定矢量图的样子(也就是编辑pathData、fillColor等属性)，貌似无法使用代码来决定矢量图的绘制逻辑，而只能使用代码加载编辑好的xml文件，这个xml文件有两种方法来创建：</p>
<ol>
<li>右击drawable–&gt;Drawable resource file–&gt;设置<code>root element</code>为<code>vector</code>，这样的矢量图绘制逻辑完全掌握在开发者手里；</li>
<li>右击drawable–&gt;Vector Asset，选择SVG或者PSD文件直接生成根标签为vector的xml文件，可以百度或者Google怎样把png转换成SVG。</li>
</ol>
<p>写了这么多字，一直在瞎扯淡而没谈重点，下面我们看下根标签为vector的xml文件的真面目，代码：</p>
<p><img src="/images/drawable/1323444-54b94ead11c967ba.webp" alt="img"></p>
<p>上图中标签vector使用了四个属性：<code>android:width=&quot;24dp&quot;</code>、<code>android:height=&quot;24dp&quot;</code>、<code>android:viewportHeight=&quot;300.0&quot;</code>、<code>android:viewportWidth=&quot;300.0&quot;</code>。</p>
<ol>
<li>width和height：当使用这个矢量图的View的宽高是wrap_content 的时候这两个属性才生效；</li>
<li>viewportWidth和viewportHeight：决定画布的宽高，是定义的一个虚拟空间，方便编辑pathData属性，如果pathData中的点超出了这个虚拟空间，超出的部分将不会展现给用户；虚拟空间的原点仍然还是在左上角(R点就是原点)。</li>
</ol>
<p>path标签是vector标签的子标签，它使用了以下属性：</p>
<ol>
<li><code>android:name</code>：类似View的id属性，方便path被引用，如上图的edge是虚拟空间四个边界的path，oval是一个椭圆的path；</li>
<li><code>android:fillColor</code>：填充path的颜色，如果没有定义则不填充path</li>
<li><code>android:strokeColor</code>：path边框颜色，如果没有定义则不显示边框</li>
<li><code>android:strokeWidth</code>：path边框的粗细尺寸</li>
<li><code>android:pathData</code>：path指令，决定path的移动和绘制逻辑，这个是最主要的属性，下面详细讨论。</li>
</ol>
<p>更多path属性请参考<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://developer.android.com/reference/android/graphics/drawable/VectorDrawable.html">链接</a>。</p>
<p>pathData的指令和Path类的API方法基本差不多，比如M指令对应moveTo方法，m指令对应rMoveTo方法，下面是一些基本的指令：</p>
<ul>
<li><ol>
<li>Mx,y：移动到点(x,y)</li>
</ol>
</li>
<li><ol>
<li>Lx,y：直线连到点x,y，简化命令H(x)水平连接和V(y)垂直连接；</li>
</ol>
</li>
<li><ol>
<li>Qx1,y1 x2,y2：二阶贝塞尔曲线，控制点（x1,y1），终点x2,y2；</li>
</ol>
</li>
<li><ol>
<li>Cx1,y1 x2,y2 x3,y3：三阶贝塞尔曲线，控制点（x1,y1）（ x2,y2），终点x3,y3；</li>
</ol>
</li>
<li><ol>
<li>Tx y：平滑的二阶贝塞尔曲线，参数只有一个点(x,y)，这个点是结束点，控制点是前一个二阶贝塞尔曲线的控制点相对于前一个贝塞尔曲线的结束点的镜像点。</li>
</ol>
</li>
<li><ol>
<li>Sx2,y2 x,y：平滑的三阶贝塞尔曲线，参数为(x2,y2 x,y) ，x2,y2 为第二个控制点，x,y为绘制终点，那么第一个控制点则是前一个三阶曲线的第二个控制点相对于前一个三阶曲线终点的镜像点。</li>
</ol>
</li>
<li><ol>
<li>Arx,ry x-axis-rotation large-arc-flag,sweep-flag x,y：ellipse arc圆弧曲线</li>
</ol>
</li>
<li><ol>
<li>z：close闭合<br>……</li>
</ol>
</li>
</ul>
<p>每个指令都有大小写形式，大写表示后面的参数是绝对坐标，小写表示相对于上一个点的相对坐标位置，参数可以用逗号或者空格分离。<br>只要掌握上面5个基本指令就能编辑pathData并且绘制一些酷炫的SVG。更详细全面的path指令请参阅<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://www.w3.org/TR/SVG/paths.html%23PathDataEllipticalArcCommands">链接</a>。</p>
<p>估计你已经发现了，圆弧曲线指令A竟然那么多参数，这直接吓跑了很多的程序员，其实也并不难，且慢慢道来。</p>
<p>先根据图1里的代码来分析pathData指令。如图一所示，edge这个path使用了四个相对指令，首先指令h300 0相对向右水平移动300到点S，然后指令v0 300相对向下垂直移动300到T，再次指令h-300 0相对向左水平移动300到U，最后指令v0 -300相对向上垂直移动300到起点R，这样就根据属性strokeColor和strokeWidth绘制了四条直线，最后一个指令可以使用z代替。这很简单吧？！</p>
<p>再来看oval这个path。它使用了三条指令。第一条指令移动到点M处，第二条指令<code>a75,75 0 1,1 150,0</code>绘制M-N-O的弧线，第三条指令<code>a75,75 0 1,1 -150,0</code>绘制O-P-M的弧线。a指令共有7个参数：rx和ry表示椭圆的两个半径，x-axis-rotation表示x轴的旋转角度，x和y表示绘制椭圆弧线的终点，这5个参数很简单很好理解，large-arc-flag和sweep-flag这两个参数有点唬人。<br>解释large-arc-flag和sweep-flag这两个参数之前先考虑下这个题目：已知椭圆的半径rx和ry，请绘制若干条从起始点A到终点B的椭圆弧线。题目中是若干条，那到底几条啊？一般情况下会有四条椭圆弧线(特殊情况是rx&#x3D;线段AB的一半或者ry&#x3D;线段AB的一半，这时候的椭圆弧线只有两条)，而large-arc-flag和sweep-flag这两个参数就从这四个椭圆弧线中选取了最终的一条进行绘制。large-arc-flag决定是大弧线还是小弧线，1大0小，sweep-flag决定是顺时针弧线还是逆时针弧线，1顺0逆。</p>
<p><img src="/images/drawable/1323444-c37681ec1a63726a.webp" alt="img"></p>
<p>图2</p>
<p>看图2希望你能明白这两个参数的意义。</p>
<p>有人可能会问，图1的oval path是个圆，竟然使用了两个a指令，使用一个a指令就能绘制圆的，只要终点回到起始点就能绘制圆的path了，刚开始我也是这样认为的，比如下面的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">vector</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:width</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:height</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportHeight</span>=<span class="string">&quot;300.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportWidth</span>=<span class="string">&quot;300.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;circle&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/holo_green_light&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        M150,150</span></span></span><br><span class="line"><span class="string"><span class="tag">        a75,75 0 1,1 0,0&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;#00000000&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>  上面的代码的path从起始点又回到了起始点，不会绘制任何东西，终点x y需要和起始点错开几个像素比如<code>android:pathData=&quot;M150,150 a75,75 0 1,1 0,1&quot;</code>就大约是一个圆path，为什么说是大约一个圆？因为起始点和终点不在一起，这只是一个圆的大弧线部分。推荐使用两条a指令绘制圆path，因为一条a指令绘制的不是真正的圆path。</p>
<p><strong>group标签</strong></p>
<p>path没有<strong>scale</strong>、<strong>rotate</strong>和<strong>translate</strong>这三种属性，因此也不能执行这三种属性动画，要达到这样的目的需要借助group这个标签。group标签也是vector的一个子标签，它可以作为path或者其他group的父标签使用，将path和group组合成一个组来附加一些变换操作，这些变换操作包括<strong>scale</strong>、<strong>rotate</strong>和<strong>translate</strong>共三种。这张图3是来自<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://developer.android.com/guide/topics/graphics/vector-drawable-resources.html">android官网</a>的vector标签树型图：</p>
<p><img src="/images/drawable/1323444-f01c851c19b3679d.webp" alt="img"></p>
<p>图3</p>
<p>。<group>定义变换的细节，<clip-path>定义裁剪区域。根据这三个变换操作，group标签有以下属性：</p>
<ul>
<li>android:name：group的名字；</li>
<li>android:rotation：group的旋转角度，默认0。</li>
<li>android:pivotX：scale和rotation变换中心点的X坐标，默认0；</li>
<li>android:pivotY：scale和rotation变换中心点的Y坐标，默认0；</li>
<li>android:scaleX：X轴方向的缩放，默认1；</li>
<li>android:scaleY：Y轴方向的缩放，默认1；</li>
<li>android:translateX：X轴方向的移动距离，默认0；</li>
<li>android:translateY：Y轴方向的移动距离，默认0。</li>
</ul>
<p>这是group的全部属性了，属性都很简单，不需要解释。</p>
<p><strong>clip-path标签</strong></p>
<p><clip-path>定义当前绘制的剪切路径，就是图像的一部分剪切下来。注意，clip-path只对当前的vector和group以及当前vector和group的孩子有效。这个标签仅有两个属性：</p>
<ul>
<li>android:name：clip-path的名字；</li>
<li>android:pathData：clip-path的路径。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">vector</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:width</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:height</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportHeight</span>=<span class="string">&quot;300.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportWidth</span>=<span class="string">&quot;300.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clip-path</span> <span class="attr">android:name</span>=<span class="string">&quot;clip_one&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">    M0 20a20 20 0 0 1 20 -20</span></span></span><br><span class="line"><span class="string"><span class="tag">    l260 0a20 20 0 0 1 20 20</span></span></span><br><span class="line"><span class="string"><span class="tag">    l0 260a20 20 0 0 1 -20 20</span></span></span><br><span class="line"><span class="string"><span class="tag">    l-260 0a20 20 0 0 1 -20 -20</span></span></span><br><span class="line"><span class="string"><span class="tag">    l0 -260&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;edge&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;h300v300h-300v-300</span></span></span><br><span class="line"><span class="string"><span class="tag">        M150 0 v300</span></span></span><br><span class="line"><span class="string"><span class="tag">        M0 150 h300&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/holo_green_light&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;@android:color/holo_red_dark&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeWidth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">clip-path</span> <span class="attr">android:name</span>=<span class="string">&quot;clip_two&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;M0 150h300v150h-300v-150&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;oval&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeLineCap</span>=<span class="string">&quot;round&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeLineJoin</span>=<span class="string">&quot;round&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:pathData</span>=<span class="string">&quot;M20 20 l260,260M280 20 l-260,260h100&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeColor</span>=<span class="string">&quot;#000000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeWidth</span>=<span class="string">&quot;15&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面代码定义了两个clip-path，其效果如图4所示。</p>
<p><img src="/images/drawable/1323444-1337064674f55b83.webp" alt="img"></p>
<p>图4.gif</p>
<p><strong>build.gradle中vectorDrawables.useSupportLibrary属性</strong></p>
<p>build.gradle中的vectorDrawables.useSupportLibrary默认是false，不设置为true的话会有什么问题吗？讨论这个问题也需要根据minSdkVersion具体分析：</p>
<ol>
<li><code>minSdkVersion&gt;=21</code>：这么高的API根本就不需要兼容包，仍然可以渲染矢量图；</li>
<li><code>minSdkVersion&lt;21</code>：不再使用矢量图兼容包，不能渲染矢量图，但是有趣的是vector标签仍然可以使用，低版本的API完全把VectorDrawable当作Drawable使用了，VectorDrawable的特性完全失效。原理是vector xml文件会生成对应的png文件，使用png方式渲染图片，和矢量图没有任何关系。值得注意的是生成的png图片size很小而且会忽略vector标签的android:tint属性(貌似只忽略这个属性，我试过vector标签的android:alpha属性在生成的png图片中仍然有效，生成的png文件目录是app&#x2F;build&#x2F;generated&#x2F;res&#x2F;pngs&#x2F;debug，minSdkVersion&gt;&#x3D;21或者vectorDrawables.useSupportLibrary&#x3D;true的话不会生成这些png图片)。而且path标签的color相关的属性不能引用colors.xml的值，<code>android:strokeColor=&quot;@android:color/holo_red_dark&quot;</code>这样写的话会编译失败，提示错误：<code>Can&#39;t process attribute android:strokeColor=&quot;@android:color/holo_red_dark&quot;: references to other resources are not supported by build-time PNG generation</code>，而只能写原生的16进制color值比如<code>android:strokeColor=&quot;#234aac&quot;</code>。</li>
</ol>
<p>想看具体信息请查看这篇<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://blog.stylingandroid.com/vectordrawable-png/">文章</a>。</p>
<p><strong>SVG实战</strong></p>
<p>我做的项目中一张扑克png资源大小2k左右，我试着用矢量图画这些扑克牌。代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">vector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:width</span>=<span class="string">&quot;400dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:height</span>=<span class="string">&quot;550dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportHeight</span>=<span class="string">&quot;550&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportWidth</span>=<span class="string">&quot;400.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">android:name</span>=<span class="string">&quot;poker_diamond_a&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;border&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeWidth</span>=<span class="string">&quot;7&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeColor</span>=<span class="string">&quot;#96999c&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/white&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:pathData</span>=<span class="string">&quot;M5 25a20 20 0 0 1 20 -20</span></span></span><br><span class="line"><span class="string"><span class="tag">            h350a20 20 0 0 1 20 20v500a20 20 0 0 1 -20 20h-350a20 20 0 0 1 -20 -20v-500&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeWidth</span>=<span class="string">&quot;8&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeColor</span>=<span class="string">&quot;#cc0000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeLineJoin</span>=<span class="string">&quot;bevel&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:pathData</span>=<span class="string">&quot;M40 120</span></span></span><br><span class="line"><span class="string"><span class="tag">            l40 -90</span></span></span><br><span class="line"><span class="string"><span class="tag">            l40 90</span></span></span><br><span class="line"><span class="string"><span class="tag">            l-16-35</span></span></span><br><span class="line"><span class="string"><span class="tag">            h-48&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;small_diamond&quot;</span> <span class="attr">android:fillColor</span>=<span class="string">&quot;#cc0000&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;M80 130l41 41l-41 41l-41 -41z&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;big_diamond&quot;</span> <span class="attr">android:fillColor</span>=<span class="string">&quot;#cc0000&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;M260 310l100 100l-100 100l-100 -100z&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="/images/drawable/1323444-2f3dc23aa919c927.webp" alt="img"></p>
<p>图5</p>
<p>代码很简单，只有4条path。border路径顺序是1-2-3-4-5-6-7-8-1， a的路径是a-b-c-d-e，small_diamond的路径是e-f-g-h，big_diamond的路径是i-j-k-l。这个xml文件只有1k。</p>
<p><strong>vector属性</strong></p>
<ol>
<li><code>android:alpha</code>：矢量图的透明度，范围0-1，默认1；</li>
<li><code>android:tint</code>：矢量图的颜色，这个颜色值会覆盖所有与color相关的属性比如path的fillColor和strokeColor等；这个属性会被API setColorFilter(ColorFilter)覆盖。</li>
<li><code>android:tintMode</code>：色彩混合模式，可选值有很多，下面详细讨论，默认src_in。</li>
<li><code>android:autoMirrored</code>：当布局方向变成right-to-left的时候，矢量图是否自动镜像，默认false，这个属性在API&gt;&#x3D;19才生效。</li>
</ol>
<p>关于tintMode，先看下PorterDuff这类的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PorterDuff</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PorterDuff</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Stub!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">Mode</span> &#123;</span><br><span class="line">        CLEAR, <span class="comment">/** [Sa, Sc] */</span></span><br><span class="line"></span><br><span class="line">        DST, <span class="comment">/** [Da, Dc] */</span></span><br><span class="line">        DST_ATOP, <span class="comment">/** [Sa, Sa * Dc + Sc * (1 - Da)] */</span></span><br><span class="line">        DST_IN, <span class="comment">/** [Sa * Da, Sa * Dc] */</span></span><br><span class="line">        DST_OUT, <span class="comment">/** [Da * (1 - Sa), Dc * (1 - Sa)] */</span></span><br><span class="line">        DST_OVER, <span class="comment">/** [Sa + (1 - Sa)*Da, Rc = Dc + (1 - Da)*Sc] */</span></span><br><span class="line"></span><br><span class="line">        SRC, <span class="comment">/** [Sa, Sc] */</span></span><br><span class="line">        SRC_ATOP, <span class="comment">/** [Da, Sc * Da + (1 - Sa) * Dc] */</span></span><br><span class="line">        SRC_IN, <span class="comment">/** [Sa * Da, Sc * Da] */</span></span><br><span class="line">        SRC_OUT, <span class="comment">/** [Sa * (1 - Da), Sc * (1 - Da)] */</span></span><br><span class="line">        SRC_OVER, <span class="comment">/** [Sa + (1 - Sa)*Da, Rc = Sc + (1 - Sa)*Dc] */</span></span><br><span class="line"></span><br><span class="line">        DARKEN, <span class="comment">/** [Sa + Da - Sa*Da, Sc*(1 - Da) + Dc*(1 - Sa) + min(Sc, Dc)] */</span></span><br><span class="line">        XOR, <span class="comment">/** [Sa + Da - 2 * Sa * Da, Sc * (1 - Da) + (1 - Sa) * Dc] */</span></span><br><span class="line">        LIGHTEN, <span class="comment">/** [Sa + Da - Sa*Da, Sc*(1 - Da) + Dc*(1 - Sa) + max(Sc, Dc)] */</span></span><br><span class="line">        MULTIPLY, <span class="comment">/** [Sa * Da, Sc * Dc] */</span></span><br><span class="line">        SCREEN, <span class="comment">/** [Sa + Da - Sa * Da, Sc + Dc - Sc * Dc] */</span></span><br><span class="line">        <span class="comment">/** Saturate(S + D) */</span></span><br><span class="line">        ADD,</span><br><span class="line">        OVERLAY;</span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">Mode</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先类名PorterDuff是什么意思呢？PorterDuff是两个人名的组合: Thomas Porter和Tom Duff，他们1984年在ACM SIGGRAPH计算机图形学发表论文《Compositing digital images》，最早提出图形混合概念，极大地推动了图形图像学的发展，有兴趣的同学可以自行查阅资料。</p>
<p><img src="/images/drawable/1323444-b5395a586d961d45.webp" alt="img"></p>
<p>图1</p>
<p>PorterDuff共有18个模式可选，但是<code>android:tintMode</code>可选值只有六个：MULTIPLY、SCREEN、ADD、SRC_ATOP、SRC_IN、SRC_OVER，(xml文件只提供这6个的原因我不知道，请大神留言告知)。当然想使用其余12个tintMode模式也是可以的，需要用代码调用API Drawable.setTintMode(PorterDuff.Mode)即可，可以达到相应tintMode的效果。</p>
<p>tint属性是Android 5.0引入的，Android 6.0又引入了drawableTint的属性。<br>Button和TextView等一些组件会多出下面6个属性：</p>
<p><img src="/images/drawable/1323444-3c875323de7fee46.webp" alt="img"></p>
<p>图2</p>
<p>ImageView会多出下面6个属性：</p>
<p><img src="/images/drawable/1323444-f33ae9d93bc59295.webp" alt="img"></p>
<p>图3</p>
<p><img src="/images/drawable/1323444-1a0a013e976eef37.webp" alt="img"></p>
<p>图4</p>
<p>我们对矢量图进行调色，先看效果如图4所示，图4中红色文字表示xml允许使用的6个tintMode。下面贴出代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line">// poker_a.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">vector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:width</span>=<span class="string">&quot;400dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:height</span>=<span class="string">&quot;550dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:tint</span>=<span class="string">&quot;@android:color/holo_purple&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportHeight</span>=<span class="string">&quot;550&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportWidth</span>=<span class="string">&quot;400.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">android:name</span>=<span class="string">&quot;poker_diamond_a&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;border&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeWidth</span>=<span class="string">&quot;7&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeColor</span>=<span class="string">&quot;#96999c&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/white&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:pathData</span>=<span class="string">&quot;M5 25a20 20 0 0 1 20 -20</span></span></span><br><span class="line"><span class="string"><span class="tag">            h350a20 20 0 0 1 20 20v500a20 20 0 0 1 -20 20h-350a20 20 0 0 1 -20 -20v-500&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeWidth</span>=<span class="string">&quot;8&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeColor</span>=<span class="string">&quot;@android:color/holo_red_dark&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeLineJoin</span>=<span class="string">&quot;bevel&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:pathData</span>=<span class="string">&quot;M40 120</span></span></span><br><span class="line"><span class="string"><span class="tag">            l40 -90</span></span></span><br><span class="line"><span class="string"><span class="tag">            l40 90</span></span></span><br><span class="line"><span class="string"><span class="tag">            l-16-35</span></span></span><br><span class="line"><span class="string"><span class="tag">            h-48&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;small_diamond&quot;</span> <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/holo_blue_dark&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;M80 130l41 41l-41 41l-41 -41z&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;big_diamond&quot;</span> <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/holo_green_dark&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;M260 310l100 100l-100 100l-100 -100z&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">&quot;width&quot;</span>&gt;</span>64dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">&quot;height&quot;</span>&gt;</span>88dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">// activity_main.xml</span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">&quot;5dp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:tint</span>=<span class="string">&quot;@android:color/transparent&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;@android:color/holo_purple&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/CLEAR&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;10dp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;5dp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DST&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DST_ATOP&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DST_IN&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DST_OUT&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DST_OVER&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;5dp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SRC&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SRC_ATOP&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SRC_IN&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SRC_OUT&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SRC_OVER&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;5dp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DARKEN&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/XOR&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/LIGHTEN&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/MULTIPLY&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SCREEN&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;5dp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/ADD&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/OVERLAY&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MainActivity.java代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MainActivity.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        AppCompatDelegate.setCompatVectorFromResourcesEnabled(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        ((ImageView) findViewById(R.id.CLEAR)).getDrawable().mutate().setTintMode(PorterDuff.Mode.CLEAR);</span><br><span class="line"></span><br><span class="line">        ((ImageView) findViewById(R.id.DST)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DST);</span><br><span class="line">        ((ImageView) findViewById(R.id.DST_ATOP)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DST_ATOP);</span><br><span class="line">        ((ImageView) findViewById(R.id.DST_IN)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DST_IN);</span><br><span class="line">        ((ImageView) findViewById(R.id.DST_OUT)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DST_OUT);</span><br><span class="line">        ((ImageView) findViewById(R.id.DST_OVER)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DST_OVER);</span><br><span class="line"></span><br><span class="line">        ((ImageView) findViewById(R.id.SRC)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SRC);</span><br><span class="line">        ((ImageView) findViewById(R.id.SRC_ATOP)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SRC_ATOP);</span><br><span class="line">        ((ImageView) findViewById(R.id.SRC_IN)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SRC_IN);</span><br><span class="line">        ((ImageView) findViewById(R.id.SRC_OUT)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SRC_OUT);</span><br><span class="line">        ((ImageView) findViewById(R.id.SRC_OVER)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SRC_OVER);</span><br><span class="line"></span><br><span class="line">        ((ImageView) findViewById(R.id.DARKEN)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DARKEN);</span><br><span class="line">        ((ImageView) findViewById(R.id.XOR)).getDrawable().mutate().setTintMode(PorterDuff.Mode.XOR);</span><br><span class="line">        ((ImageView) findViewById(R.id.LIGHTEN)).getDrawable().mutate().setTintMode(PorterDuff.Mode.LIGHTEN);</span><br><span class="line">        ((ImageView) findViewById(R.id.MULTIPLY)).getDrawable().mutate().setTintMode(PorterDuff.Mode.MULTIPLY);</span><br><span class="line">        ((ImageView) findViewById(R.id.SCREEN)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SCREEN);</span><br><span class="line"></span><br><span class="line">        ((ImageView) findViewById(R.id.ADD)).getDrawable().mutate().setTintMode(PorterDuff.Mode.ADD);</span><br><span class="line">        ((ImageView) findViewById(R.id.OVERLAY)).getDrawable().mutate().setTintMode(PorterDuff.Mode.OVERLAY);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>色彩混合涉及到两个对象，<strong>目标对象</strong>和<strong>源对象</strong>，这里的目标对象是poker_a.xml这个矢量图，源对象是tint设置的颜色值，为啥这样说呢，记着这个原则，先绘制的是目标对象，我们就是要对目标对象进行调色。对目标对象调色后的对象叫做<strong>复合对象</strong>。</p>
<p>有了这两个对象，怎么进行调色呢？这里有很多计算公式，公式中又有很多元素，先来看下这些元素：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* Sa：Source alpha，源对象的Alpha通道；</span><br><span class="line">* Sc：Source <span class="attribute">color</span>，源对象的颜色；</span><br><span class="line">* Da：Destination alpha，目标对象的Alpha通道；</span><br><span class="line">* Dc：Destination <span class="attribute">color</span>，目标对象的颜色；</span><br><span class="line">* <span class="selector-attr">[a，c]</span>：对象的ARGB值，<span class="selector-tag">a</span>表示alpha，c表示<span class="attribute">color</span>。</span><br></pre></td></tr></table></figure>

<p>下面对这18个tintMode进行剖析，该文受到<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d11892bbe055">这篇文章</a>的启发。<br><strong>CLEAR</strong><br>复合对象的ARGB值是[0，0]，完全透明，相当于清除画布上的图像了。</p>
<p><strong>DST</strong><br>[Da, Dc]，只保留目标对象的alpha和color值，因此绘制出来的只有目标对象，相当于根本就没有进行调色。<br><strong>DST_ATOP</strong><br>[Sa, Sa * Dc + Sc * (1 - Da)]，两者相交处绘制目标对象，不相交的地方绘制源对象，并且相交处的效果会受到源对象和目标对象alpha的影响。<br><strong>DST_IN</strong><br>[Sa * Da, Sa * Dc]，两者相交的地方绘制目标对象，不相交的地方不进行绘制，并且相交处的效果会受到源对象对应地方透明度的影响。<br><strong>DST_OUT</strong><br>[Da * (1 - Sa), Dc * (1 - Sa)]，两者不相交的地方绘制目标对象，相交处根据源对象alpha进行过滤，完全不透明处则完全过滤，完全透明则不过滤。(亲测正确)<br><strong>DST_OVER</strong><br>[Sa + (1 - Sa)*Da, Rc &#x3D; Dc + (1 - Da)*Sc]，目标对象绘制在源对象的上方。</p>
<p><strong>SRC</strong><br>[Sa, Sc]，只保留源对象的alpha和color，因此绘制出来只有源对象。<br><strong>SRC_ATOP</strong><br>[Da, Sc * Da + (1 - Sa) * Dc]，两者相交处绘制源对象，不相交的地方绘制目标对象，并且相交处的效果会受到源对象和目标对象alpha的影响。<br><strong>SRC_IN</strong><br>[Sa * Da, Sc * Da]，两者相交处绘制源对象，不相交的地方不进行绘制，并且相交处的效果会受到源对象对应地方透明度的影响。<br><strong>SRC_OUT</strong><br>[Sa * (1 - Da), Sc * (1 - Da)]，两者不相交的地方绘制源对象，相交处根据目标对象alpha进行过滤，完全不透明处则完全过滤，完全透明则不过滤。(亲测正确)<br><strong>SRC_OVER</strong><br>[Sa + (1 - Sa)*Da, Rc &#x3D; Sc + (1 - Sa)*Dc]，源对象绘制在目标对象的上方。</p>
<p><strong>DARKEN</strong><br>[Sa + Da - Sa<em>Da, Sc</em>(1 - Da) + Dc*(1 - Sa) + min(Sc, Dc)]，顾名思义，效果会变暗。进行对应像素比较，取较暗值(即较小值)，如果色值相同则进行混合；如果两个对象都完全不透明，取较暗值，否则使用上面算法进行计算，受到源对象和目标对象对应色值和alpha值影响。结果复合对象的alpha值会变大。<strong>XOR</strong>[Sa + Da - 2 * Sa * Da, Sc * (1 - Da) + (1 - Sa) * Dc]，不相交的地方按原样绘制源对象和目标对象，相交的地方受到对应alpha和颜色值影响，按公式进行计算，如果都完全不透明则相交处完全不绘制。<strong>LIGHTEN</strong>[Sa + Da - Sa<em>Da, Sc</em>(1 - Da) + Dc*(1 - Sa) + max(Sc, Dc)]，顾名思义，效果会变亮。进行对应像素比较，取较亮值(即较大值)，如果色值相同则进行混合；如果两个对象都完全不透明，取较亮值，否则使用上面算法进行计算，受到源对象和目标对象对应色值和alpha值影响。<br><strong>MULTIPLY</strong><br>[Sa * Da, Sc * Dc]，正片叠底，即查看每个通道中的颜色信息，目标色与源色复合。结果色总是较暗的颜色。任何颜色与黑色复合产生黑色，任何颜色与白色复合保持不变。(这个理论貌似和现实生活的颜色混合的结果不一致，现实生活中黄色和白色混合会是黄白色而不是白色)。<br><strong>SCREEN</strong><br>[Sa + Da - Sa * Da, Sc + Dc - Sc * Dc]，滤色模式，这个模式与我们所用的显示屏原理相同，因此也被翻译成屏幕模式；保留两个图层中较白的部分，较暗的部分被遮盖，图层中纯黑的部分变成完全透明，纯白部分完全不透明，其他的颜色根据颜色级别产生半透明的效果。</p>
<p><strong>ADD</strong><br>Saturate(S + D)，饱和度叠加<br><strong>OVERLAY</strong><br>算法同时进行进行 Multiply（正片叠底）混合还是 Screen（屏幕）混合，是进行 Multiply混合还是 Screen混合，取决于目标对象的颜色值，目标对象颜色的高光与阴影部分的亮度等细节会被保留。</p>
<p>这18个模式终于介绍完了，再次感谢<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d11892bbe055">这篇文章</a>的作者。</p>
<h3 id="path属性"><a href="#path属性" class="headerlink" title="path属性"></a>path属性</h3><ol>
<li><p>android:strokeLineCap：顾名思义，设置线条的帽子，round圆角、square正方形、butt臀，默认是butt；</p>
</li>
<li><p>android:strokeLineJoin：线条拐弯处的样式，round圆角、bevel斜角、miter斜切尖角，默认是miter；</p>
</li>
<li><p>android:strokeMiterLimit：android:strokeLineJoin为miter的时候这个属性才发挥作用。设置miter斜切尖角长度(用miter_length表示)与线条宽度(用line_width表示)比例值的上限，默认是4，strokeMiterLimit &#x3D; miter_length &#x2F; line_width，这个属性设定了这个比例的最大值，超过这个值的尖角不再显示尖角而是bevel斜角。</p>
<p><img src="/images/drawable/1323444-d79bdd8c46b1997f.webp" alt="img"></p>
<p>图5</p>
<p><img src="/images/drawable/1323444-680a02e956cc390d.webp" alt="img"></p>
<p>图6</p>
<p>如果你希望尖角多一些，就把这个属性设置大一些。在特别尖的拐弯处的点，点的这个比例可能大与strokeMiterLimit，那么就不显示尖角效果而是类似bevel斜角的效果，这样看起来不是很突兀，比较美观。</p>
<p>图5和图6来自</p>
<p>文章</p>
<p>；</p>
</li>
<li><p>android:trimPathStart：从路径起始位置截断路径的比率，取值范围0-1，默认0；</p>
</li>
<li><p>android:trimPathEnd：从路径结束位置截断路径的比率，取值范围0-1，默认1；</p>
</li>
<li><p>android:trimPathOffset：设置路径截取的偏移比例，取值范围0-1，默认0；<br>利用android:trimPathStart和android:trimPathEnd可以做一些入场和出场动画，<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/89efdbe01ac9">链接</a></p>
</li>
<li><p>android:fillType：API 24才引入的这个属性，取值nonZero和evenOdd，默认nonZero。</p>
</li>
</ol>
<p>关于<code>android:fillType</code>这个属性，需要花点篇幅讨论下。讨论这个属性之前，先看下代码及其对应的效果：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">vector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:height</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportHeight</span>=<span class="string">&quot;600&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportWidth</span>=<span class="string">&quot;600&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;noneZero&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeWidth</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;#B32D20&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;#3C8FC1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;M20 120 a100 100 0 1 1 200 0 a100 100 0 1 1 -200 0</span></span></span><br><span class="line"><span class="string"><span class="tag">            M40 120 a80 80 0 1 1 160 0 a80 80 0 1 1 -160 0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;evenOdd&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeWidth</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;#B32D20&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;#3C8FC1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillType</span>=<span class="string">&quot;evenOdd&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;M260 120 a100 100 0 1 1 200 0 a100 100 0 1 1 -200 0</span></span></span><br><span class="line"><span class="string"><span class="tag">            M280 120 a80 80 0 1 1 160 0 a80 80 0 1 1 -160 0&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="/images/drawable/1323444-1bc237196100deb1.webp" alt="img"></p>
<p>图7</p>
<p>代码中有两条path，前者的fillType是默认的noneZero，后者的fillType是evenOdd，除了这两个属性外，其余属性一模一样(name属性和M指令的起始位置为了显示的区别，忽略好吧😄)。两者的效果图如图7所示。fillType的原理是什么呢？为啥会导致这样的效果呢？</p>
<p>这里需要提一点，代码中每一条path都绘制了两个圆，四个圆的每一个圆都是通过两条a指令绘制完成的，如果你不清楚a指令的参数，请仔细看完<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0972a0d290e9">Android矢量图I–VectorDrawable基础</a>这篇文章并搞明白a指令后再回来看本文。这8条a指令的第5个参数都是1表示顺时针，请记住都是顺时针，因为fillType属性值noneZero跟path的方向有很大关系。</p>
<p>首先来看下默认的noneZero值。多看<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://en.wikipedia.org/wiki/Nonzero-rule">维基百科</a>，那里的解释最权威。<strong>有一个多边形C，我们判断是否要对C的子多边形C1形成的一块区域进行填充，那么先定义一个变量value&#x3D;0，根据value的值来决定是否对C1进行填充；在这个C1区域内任意选择一个点P，从这个点P向任意方向发射一条无限长的直线L，但是这个方向需要直线L与C1至少有一个交点，然后找出直线L与C所有的交点，每个交点处的方向是顺时针value++，顺时针value–，如果最后的value不是0，那么就对C1填充，否则不填充。</strong><br>如果你不明白上面粗体文字的含义，那就根据上面代码名字为noneZero这个path来分析下。这条path包含4个a指令，其实也就是4个形状为弧线的子path：弧线AB、弧线BA、弧线CD、弧线DC，相应地我们就要判断四块区域(outer_a、outer_b、inner_a、inner_b)是否要进行fill(填充，这里的填充默认是填充内部)。对于区域outer_a，我们在其内部选择任意一点P，从P发射一条无限长直线，直线需要与子多边形弧线AB相交至少一个点，该点是P1，直线与多边形C的交点是P1，是顺时针，value&#x3D;P1&#x3D;1，不为0，该区域填充；对于区域inner_a，我们在其内部选择任意一点R，从R发射一条无限长直线，直线需要与子多边形弧线CD相交至少一个点，该点是R1，直线与多边形C的交点是R1和R2，value&#x3D;R1+R1&#x3D;1+1&#x3D;2，不为0，该区域填充。如图8所示，</p>
<p><img src="/images/drawable/1323444-ed2a36d243eb82c1.webp" alt="img"></p>
<p>图8</p>
<p>为了加深下印象，再来举个例子。看下面的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">vector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:height</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportHeight</span>=<span class="string">&quot;600&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportWidth</span>=<span class="string">&quot;600&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeWidth</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;#B32D20&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;#3C8FC1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;M20 320 a100 100 0 1 0 200 0</span></span></span><br><span class="line"><span class="string"><span class="tag">            M40 320 a80 80 0 1 1 160 0 a80 80 0 1 1 -160 0&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="/images/drawable/1323444-1e54785f1036c7fb.webp" alt="img"></p>
<p>图9</p>
<p>你运行上面的代码，不出问题的矢量图应该如图9所示。代码首先从A到B逆时针绘制椭圆弧，然后从C到D顺时针绘制椭圆弧，最后从D到C顺时针绘制椭圆弧。最终的多边形C包含三个子区域outer_a、inner_a、inner_b。对于outer_a，其value&#x3D;P&#x3D;-1，非0那就填充；对于inner_a，其value&#x3D;Q1&#x3D;1，非0那就填充；对于inner_b，其value&#x3D;R1+R2&#x3D;1+(-1)&#x3D;0，0那就不填充。</p>
<p>如果你已经明白了noneZero，那么evenOdd就非常非常简单了，先看<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://en.wikipedia.org/wiki/Even%E2%80%93odd_rule">维基百科</a>，它与指针方向没有关系了，一句话你就能明白：<strong>如果虚拟直线与多边形C的交点数目为奇数就填充内部，偶数就不填充内部</strong>。如果还不明白，就举个例子，看代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">vector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:height</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportHeight</span>=<span class="string">&quot;600&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportWidth</span>=<span class="string">&quot;600&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeWidth</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;#B32D20&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;#3C8FC1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillType</span>=<span class="string">&quot;evenOdd&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;M20 320 a100 100 0 1 0 200 0</span></span></span><br><span class="line"><span class="string"><span class="tag">            M40 320 a80 80 0 1 1 160 0 a80 80 0 1 1 -160 0&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面代码的结果也是如图9所示，那么拿图9来解释：对于outer_a，其只有一个交点P，奇数那就填充；对于inner_a，其只有一个交点Q，奇数那就填充；对于inner_b，有两个交点R1和R2，偶数那就不填充。</p>
<p>怀着紧张的心情，fillType属性终于介绍了完了，真害怕写错而误导读者，如果有错误的地方或者有更好的分析方法，请大神批评指正。这里有两篇文章，帮助理解fillType：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ce808a9e7e38">文章1</a>、<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://blog.csdn.net/freshforiphone/article/details/8273023">文章2</a>。再说一点，<strong>如果你是用tint属性对矢量图进行调色，注意fillType属性值会对结果造成同样的影响</strong>。<br>最后，你如果查看Paint类的内部类FillType的源码，会发现还有另外两种fillType：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Enum for the ways a path may be filled.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">FillType</span> &#123;</span><br><span class="line">        <span class="comment">// these must match the values in SkPath.h</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Specifies that &quot;inside&quot; is computed by a non-zero sum of signed</span></span><br><span class="line"><span class="comment">         * edge crossings.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">WINDING</span>         (<span class="number">0</span>),</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Specifies that &quot;inside&quot; is computed by an odd number of edge</span></span><br><span class="line"><span class="comment">         * crossings.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">EVEN_ODD</span>        (<span class="number">1</span>),</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Same as &#123;@link #WINDING&#125;, but draws outside of the path, rather than inside.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">INVERSE_WINDING</span> (<span class="number">2</span>),</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Same as &#123;@link #EVEN_ODD&#125;, but draws outside of the path, rather than inside.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">INVERSE_EVEN_ODD</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">FillType</span>(<span class="type">int</span> ni) &#123;</span><br><span class="line">            nativeInt = ni;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> nativeInt;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>对这另外两种fillType，Google程序员的注释已经解释的很清楚了，我就不解释了，否则可能越解释越乱，越乱越糊涂。</p>
<h2 id="mipmap"><a href="#mipmap" class="headerlink" title="mipmap"></a>mipmap</h2><blockquote>
<p>我们创建新项目时，它会帮助我们自动生成六个文件夹(密度不同)：</p>
<ul>
<li>drawable-ldpi （low:120dip）</li>
<li>drawable</li>
<li>drawable-mdpi （medium:160dip）</li>
<li>drawable-hdpi （high :240dip）</li>
<li>drawable-xhdpi （xhigh :320dip）</li>
<li>drawable-xxhdpi （xxhigh:480dip）</li>
</ul>
</blockquote>
<p>一般的做法是，将图片等资源放在drawable-hdip中，将一些和XML文件相关的内容（图片选择器、文字颜色选择器、自定义形状等）放在drawable中。</p>
<p>Google推荐：<strong>像素使用dip，文字使用sp</strong>。并且没有推荐图片放在mipmap中。</p>
<p>在mdip文件夹，1dip&#x3D;1px。</p>
<p>关于dp,dip,sp,pt,px的区别，可参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/carter_yu/article/details/50421787#1">附录一</a>。</p>
<p>关于图片在不同目录下的显示举例，可参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/carter_yu/article/details/50421787#2">附录二</a>。</p>
<p>官方解释：<br>mipmap——用于存放原生图片（图ic_launcher.png），缩放上有性能优化;<br>drawable——存放图片、xml，和Eclipse没有区别；</p>
<p><strong>附录一</strong></p>
<blockquote>
<p><strong>dip</strong> : device independent pixels(设备独立像素). 不同设备有不同的显示效果,这个和设备硬件有关，一般我们为了支持WVGA、HVGA和QVGA 推荐使用这个，不依赖像素。</p>
<p><strong>dp</strong> : 和dip相同。</p>
<p><strong>px</strong> : pixels(像素)，一个像素通常被视为图像的最小的完整采样，不同设备显示效果相同，一般我们HVGA代表320x480像素，这个用的比较多。</p>
<p><strong>pt</strong> : point，是一个标准的长度单位，1pt＝1&#x2F;72英寸，用于印刷业，非常简单易用。</p>
<p><strong>sp</strong> : scaled pixels(放大像素). 主要用于字体显示best for textsize。</p>
<p><strong>in</strong> ：（英寸）：长度单位。</p>
<p><strong>分辨率</strong> ：分为<strong>显示分辨率（屏幕分辨率）</strong>和<strong>图像分辨率</strong>。</p>
<p>显示分辨率：屏幕图像的精密度，是指显示器所能显示的像素有多少。显示器可 显示的像素越多，画面就越精细。显示分辨率一定的情况下，显示屏越小图像越清晰，反之，显示屏大小固定时，显示分辨率越高图像越清晰。</p>
<p>图象分辨率 ：单位英寸中所包含的像素点数。</p>
</blockquote>
<p><strong>换算公式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">float</span> <span class="title function_">applyDimension</span><span class="params">(<span class="type">int</span> unit, <span class="type">float</span> value,</span></span><br><span class="line"><span class="params">   DisplayMetrics metrics)</span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (unit) &#123;</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_PX:</span><br><span class="line">         <span class="keyword">return</span> value;</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_DIP:</span><br><span class="line">         <span class="keyword">return</span> value * metrics.density;</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_SP:</span><br><span class="line">         <span class="keyword">return</span> value * metrics.scaledDensity;</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_PT:</span><br><span class="line">         <span class="keyword">return</span> value * metrics.xdpi * (<span class="number">1.0f</span>/<span class="number">72</span>);</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_IN:</span><br><span class="line">         <span class="keyword">return</span> value * metrics.xdpi;</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_MM:</span><br><span class="line">         <span class="keyword">return</span> value * metrics.xdpi * (<span class="number">1.0f</span>/<span class="number">25.4f</span>);</span><br><span class="line">     &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>附录二</p>
<blockquote>
<p>mdpi与hdpi是2：3的关系<br>mdpi与xhdpi是1：2的关系<br>ldpi 与mdpi是3：4的关系</p>
<p>dp与px换算公式：</p>
<p>pixs &#x3D;dips * (densityDpi&#x2F;160).</p>
<p>dips&#x3D;(pixs*160)&#x2F;densityDpi</p>
</blockquote>
<p>现在假设，在一个项目中，你将一张60px<em>60px的图片放到mdpi中，它的大小是60</em>60；</p>
<p>若把它拿到hdpi中，那么它的大小应该是40*40，图片缩小。</p>
<p><strong>结论：</strong><br><strong>mipmap仅仅用于应用启动图标，可以根据不同分辨率进行优化。其他的图标资源，还是要放到drawable文件夹中。</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rhb</p>
  <div class="site-description" itemprop="description">纵浪大化中，不喜亦不惧</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">127</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/RShawshank" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;RShawshank" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rhb</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://lib.baomitu.com/canvas-nest.js/1.0.1/canvas-nest.js"></script>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
