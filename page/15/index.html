<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rshawshank.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="纵浪大化中，不喜亦不惧">
<meta property="og:type" content="website">
<meta property="og:title" content="rhb_blog">
<meta property="og:url" content="http://rshawshank.github.io/page/15/index.html">
<meta property="og:site_name" content="rhb_blog">
<meta property="og:description" content="纵浪大化中，不喜亦不惧">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="rhb">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rshawshank.github.io/page/15/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>rhb_blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">rhb_blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">rao的博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">73</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">33</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">180</span></a>

  </li>
        <li class="menu-item menu-item-photos">

    <a href="/photos/" rel="section"><i class="fa fa-camera fa-fw"></i>相册</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-download fa-fw"></i>资源</a>

  </li>
        <li class="menu-item menu-item-readnote">

    <a href="/readnote" rel="section"><i class="fa fa-book fa-fw"></i>阅读笔记</a>

  </li>
        <li class="menu-item menu-item-somethink">

    <a href="/somethink/" rel="section"><i class="fa fa-sticky-note fa-fw"></i>随笔闲谈</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/RShawshank" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/02/07/java-%E5%B9%B6%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/07/java-%E5%B9%B6%E5%8F%91/" class="post-title-link" itemprop="url">java 并发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-07 11:37:01" itemprop="dateCreated datePublished" datetime="2020-02-07T11:37:01Z">2020-02-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-30 00:37:08" itemprop="dateModified" datetime="2021-11-30T00:37:08Z">2021-11-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>东西比较多，做个笔记。方便日后查阅学习。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/02/07/java-%E5%B9%B6%E5%8F%91/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/02/07/java-%E9%94%81%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/07/java-%E9%94%81%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">java 锁机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-07 11:36:50" itemprop="dateCreated datePublished" datetime="2020-02-07T11:36:50Z">2020-02-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-13 09:13:26" itemprop="dateModified" datetime="2022-11-13T09:13:26Z">2022-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java中常用的锁机制"><a href="#Java中常用的锁机制" class="headerlink" title="Java中常用的锁机制"></a>Java中常用的锁机制</h1><h2 id="java多线程—锁机制"><a href="#java多线程—锁机制" class="headerlink" title="java多线程—锁机制"></a>java多线程—锁机制</h2><p>在开发Java多线程应用程序中，各个线程之间由于要共享资源，必须用到锁机制。Java提供了多种多线程锁机制的实现方式，常见的有synchronized、ReentrantLock、Semaphore、AtomicInteger等。每种机制都有优缺点与各自的适用场景，必须熟练掌握他们的特点才能在Java多线程应用开发时得心应手。</p>
<p>线程同步有关的类图关系可用以下的图总结：</p>
<img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/1042141-20180119085622974-1501528059.jpg" style="zoom:150%;" />



<h3 id="锁的介绍"><a href="#锁的介绍" class="headerlink" title="锁的介绍"></a>锁的介绍</h3><h4 id="什么是锁"><a href="#什么是锁" class="headerlink" title="什么是锁"></a>什么是锁</h4><p>在计算机科学中，锁(lock)或互斥(mutex)是一种同步机制，用于在有许多执行线程的环境中强制对资源的访问限制。锁旨在强制实施互斥排他、并发控制策略。</p>
<p>  锁通常需要硬件支持才能有效实施。这种支持通常采取一个或多个原子指令的形式，如”test-and-set”, “fetch-and-add” or “compare-and-swap””。这些指令允许单个进程测试锁是否空闲，如果空闲，则通过单个原子操作获取锁。</p>
<p>通俗的理解是，锁是为了解决多个线程公用一种临界资源而产生冲突的。跟上厕所一样，假如有<a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=ABC&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao">ABC</a>三个人都来上厕所而厕所只有一个一次只能进一人，A先来了，那么在A出来之前，这个厕所就处在了“锁”定状态，B和C憋死也要在外面等着，直到A出门（原因很多，如睡着了，方便完了，忘带厕纸了跑出来找人要….）“锁”定解除B和C才能进入，当然牛逼的进（A和B有一腿只让B进或者优先级高或者…），其他的在外面继续等。</p>
<h4 id="锁的属性—粒度"><a href="#锁的属性—粒度" class="headerlink" title="锁的属性—粒度"></a>锁的属性—粒度</h4><p>在引入锁粒度之前，需要了解关于锁的三个概念：</p>
<p>1、锁开销 lock overhead 锁占用内存空间、 cpu初始化和销毁锁、获取和释放锁的时间。程序使用的锁越多，相应的锁开销越大</p>
<p>2、锁竞争 lock contention 一个进程或线程试图获取另一个进程或线程持有的锁，就会发生锁竞争。锁粒度越小，发生锁竞争的可能性就越小</p>
<p>3、死锁 deadlock 至少两个任务中的每一个都等待另一个任务持有的锁的情况锁粒度是衡量锁保护的数据量大小，通常选择粗粒度的锁(锁的数量少，每个锁保护大量的数据)，在当单进程访问受保护的数据时锁开销小，但是当多个进程同时访问时性能很差。因为增大了锁的竞争。相反，使用细粒度的锁(锁数量多，每个锁保护少量的数据)增加了锁的开销但是减少了锁竞争。例如数据库中，锁的粒度有表锁、页锁、行锁、字段锁、字段的一部分锁</p>
<p>相关术语  Critical Section(临界区)、 Mutex&#x2F;mutual exclusion(互斥体)、 Semaphore&#x2F;binary semaphore(信号量)</p>
<p>注：</p>
<p>锁的粒度通常就是锁的级别。详细见：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_25408423/article/details/84340432">https://blog.csdn.net/qq_25408423/article/details/84340432</a></p>
<h3 id="Java锁的种类"><a href="#Java锁的种类" class="headerlink" title="Java锁的种类"></a>Java锁的种类</h3><ul>
<li><p>公平锁&#x2F;非公平锁</p>
</li>
<li><p>可重入锁</p>
</li>
<li><p>独享锁&#x2F;共享锁</p>
</li>
<li><p>互斥锁&#x2F;读写锁</p>
</li>
<li><p>乐观锁&#x2F;悲观锁</p>
</li>
<li><p>分段锁</p>
</li>
<li><p>偏向锁&#x2F;轻量级锁&#x2F;重量级锁</p>
</li>
<li><p>自旋锁</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20190616200439354_-1581078576151.png"></p>
</li>
</ul>
<p>上面是很多锁的名词，这些分类并不是全是指锁的状态，有的指锁的特性，有的指锁的设计，下面总结的内容是对每个锁的名词进行一定的解释。</p>
<h4 id="1-公平锁-x2F-非公平锁"><a href="#1-公平锁-x2F-非公平锁" class="headerlink" title="1.公平锁&#x2F;非公平锁"></a>1.公平锁&#x2F;非公平锁</h4><p>公平锁是指多个线程按照申请锁的顺序来获取锁，线程直接进入队列中排队，队列中的第一个线程才能获得锁。公平锁的优点是等待锁的线程不会饿死。缺点是整体吞吐效率相对非公平锁要低，等待队列中除第一个线程以外的所有线程都会阻塞，CPU唤醒阻塞线程的开销比非公平锁大。</p>
<p>非公平锁是多个线程加锁时直接尝试获取锁，获取不到才会到等待队列的队尾等待。但如果此时锁刚好可用，那么这个线程可以无需阻塞直接获取到锁，所以非公平锁有可能出现后申请锁的线程先获取锁的场景。非公平锁的优点是可以减少唤起线程的开销，整体的吞吐效率高，因为线程有几率不阻塞直接获得锁，CPU不必唤醒所有线程。缺点是处于等待队列中的线程可能会饿死，或者等很久才会获得锁。对于Java ReentrantLock而言，通过构造函数指定该锁是否是公平锁，默认是非公平锁。</p>
<p>非公平锁的优点在于吞吐量比公平锁大。 </p>
<p>例子：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104146557.png"></p>
<p>如上图所示，假设有一口水井，有管理员看守，管理员有一把锁，只有拿到锁的人才能够打水，打完水要把锁还给管理员。每个过来打水的人都要管理员的允许并拿到锁之后才能去打水，如果前面有人正在打水，那么这个想要打水的人就必须排队。管理员会查看下一个要去打水的人是不是队伍里排最前面的人，如果是的话，才会给你锁让你去打水；如果你不是排第一的人，就必须去队尾排队，这就是公平锁。</p>
<p>但是对于非公平锁，管理员对打水的人没有要求。即使等待队伍里有排队等待的人，但如果在上一个人刚打完水把锁还给管理员而且管理员还没有允许等待队伍里下一个人去打水时，刚好来了一个插队的人，这个插队的人是可以直接从管理员那里拿到锁去打水，不需要排队，原本排队等待的人只能继续等待。如下图所示：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/2018112210420869.png"></p>
<p>对于synchronized而言，也是一种非公平锁。由于其并不像ReentrantLock是通过AQS的来实现线程调度，所以并没有任何办法使其变成公平锁。</p>
<p>接下来我们通过ReentrantLock的源码来讲解公平锁和非公平锁。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104221314.png" alt="img"></p>
<p>根据代码可知，ReentrantLock里面有一个内部类Sync，Sync继承AQS（AbstractQueuedSynchronizer），添加锁和释放锁的大部分操作实际上都是在Sync中实现的。它有公平锁FairSync和非公平锁NonfairSync两个子类。ReentrantLock默认使用非公平锁，也可以通过构造器来显示的指定使用公平锁。</p>
<p>下面我们来看一下公平锁与非公平锁的加锁方法的源码:</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104235664.png" alt="img"></p>
<p> 通过上图中的源代码对比，我们可以明显的看出公平锁与非公平锁的lock()方法唯一的区别就在于公平锁在获取同步状态时多了一个限制条件：hasQueuedPredecessors()。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104316520.png" alt="img"></p>
<p>再进入hasQueuedPredecessors()，可以看到该方法主要做一件事情：主要是判断当前线程是否位于同步队列中的第一个。如果是则返回true，否则返回false。</p>
<p>综上，<strong>公平锁就是通过同步队列来实现多个线程按照申请锁的顺序来获取锁，从而实现公平的特性。非公平锁加锁时不考虑排队等待问题，直接尝试获取锁，所以存在后申请却先获得锁的情况。</strong></p>
<h4 id="2-独享锁-x2F-共享锁"><a href="#2-独享锁-x2F-共享锁" class="headerlink" title="2.独享锁&#x2F;共享锁"></a>2.独享锁&#x2F;共享锁</h4><p>独享锁和共享锁同样是一种概念。我们先介绍一下具体的概念，然后通过ReentrantLock和ReentrantReadWriteLock的源码来介绍独享锁和共享锁。</p>
<p>独享锁也叫排他锁，是<strong>指该锁一次只能被一个线程所持有</strong>。如果线程T对数据A加上排它锁后，则其他线程不能再对A加任何类型的锁。获得排它锁的线程即能读数据又能修改数据。JDK中的synchronized和JUC中Lock的实现类就是互斥锁。</p>
<p><strong>共享锁是指该锁可被多个线程所持有。如果线程T对数据A加上共享锁后，则其他线程只能对A再加共享锁，不能加排它锁。获得共享锁的线程只能读数据，不能修改数据。</strong></p>
<p>独享锁与共享锁也是通过AQS来实现的，通过实现不同的方法，来实现独享或者共享。</p>
<p>下图为ReentrantReadWriteLock的部分源码：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104424361.png" alt="img"></p>
<p>我们看到ReentrantReadWriteLock有两把锁：ReadLock和WriteLock，由词知意，一个读锁一个写锁，合称“读写锁”。再进一步观察可以发现ReadLock和WriteLock是靠内部类Sync实现的锁。Sync是AQS的一个子类，这种结构在CountDownLatch、ReentrantLock、Semaphore里面也都存在。</p>
<p>在ReentrantReadWriteLock里面，读锁和写锁的锁主体都是Sync，但读锁和写锁的加锁方式不一样。读锁是共享锁，写锁是独享锁。读锁的共享锁可保证并发读非常高效，而读写、写读、写写的过程互斥，因为读锁和写锁是分离的。所以ReentrantReadWriteLock的并发性相比一般的互斥锁有了很大提升。</p>
<p>那读锁和写锁的具体加锁方式有什么区别呢？在了解源码之前我们需要回顾一下其他知识。</p>
<p>在最开始提及AQS的时候我们也提到了state字段（int类型，32位），该字段用来描述有多少线程获持有锁。</p>
<p>在独享锁中这个值通常是0或者1（如果是重入锁的话state值就是重入的次数），在共享锁中state就是持有锁的数量。但是在ReentrantReadWriteLock中有读、写两把锁，所以需要在一个整型变量state上分别描述读锁和写锁的数量（或者也可以叫状态）。于是将state变量“按位切割”切分成了两个部分，高16位表示读锁状态（读锁个数），低16位表示写锁状态（写锁个数）。如下图所示：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104440388.png" alt="img"></p>
<p>了解了概念之后我们再来看代码，先看写锁的加锁源码：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104448924.png" alt="img"></p>
<ul>
<li>这段代码首先取到当前锁的个数c，然后再通过c来获取写锁的个数w。因为写锁是低16位，所以取低16位的最大值与当前的c做与运算（ int w &#x3D; exclusiveCount(c); ），高16位和0与运算后是0，剩下的就是低位运算的值，同时也是持有写锁的线程数目。</li>
<li>在取到写锁线程的数目后，首先判断是否已经有线程持有了锁。如果已经有线程持有了锁（c!&#x3D;0），则查看当前写锁线程的数目，如果写线程数为0（即此时存在读锁）或者持有锁的线程不是当前线程就返回失败（涉及到公平锁和非公平锁的实现）。</li>
<li>如果写入锁的数量大于最大数（65535，2的16次方-1）就抛出一个Error。</li>
<li>如果当且写线程数为0（那么读线程也应该为0，因为上面已经处理c!&#x3D;0的情况），并且当前线程需要阻塞那么就返回失败；如果通过CAS增加写线程数失败也返回失败。</li>
<li>如果c&#x3D;0，w&#x3D;0或者c&gt;0，w&gt;0（重入），则设置当前线程或锁的拥有者，返回成功！</li>
</ul>
<p>tryAcquire()除了重入条件（当前线程为获取了写锁的线程）之外，增加了一个读锁是否存在的判断。如果存在读锁，则写锁不能被获取，原因在于：必须确保写锁的操作对读锁可见，如果允许读锁在已被获取的情况下对写锁的获取，那么正在运行的其他读线程就无法感知到当前写线程的操作。</p>
<p>因此，只有等待其他读线程都释放了读锁，写锁才能被当前线程获取，而写锁一旦被获取，则其他读写线程的后续访问均被阻塞。写锁的释放与ReentrantLock的释放过程基本类似，每次释放均减少写状态，当写状态为0时表示写锁已被释放，然后等待的读写线程才能够继续访问读写锁，同时前次写线程的修改对后续的读写线程可见。</p>
<p>接着是读锁的代码：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104555799.png" alt="img"></p>
<p>可以看到在tryAcquireShared(int unused)方法中，如果其他线程已经获取了写锁，则当前线程获取读锁失败，进入等待状态。如果当前线程获取了写锁或者写锁未被获取，则当前线程（线程安全，依靠CAS保证）增加读状态，成功获取读锁。读锁的每次释放（线程安全的，可能有多个读线程同时释放读锁）均减少读状态，减少的值是“1&lt;&lt;16”。所以读写锁才能实现读读的过程共享，而读写、写读、写写的过程互斥。</p>
<p>此时，我们再回头看一下互斥锁ReentrantLock中公平锁和非公平锁的加锁源码：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104555509.png" alt="img"></p>
<p>我们发现在ReentrantLock虽然有公平锁和非公平锁两种，但是它们添加的都是独享锁。根据源码所示，当某一个线程调用lock方法获取锁时，如果同步资源没有被其他线程锁住，那么当前线程在使用CAS更新state成功后就会成功抢占该资源。而如果公共资源被占用且不是被当前线程占用，那么就会加锁失败。所以可以确定ReentrantLock无论读操作还是写操作，添加的锁都是都是独享锁。</p>
<p>对于Java ReentrantLock而言，其是独享锁。<strong>但是对于Lock的另一个实现类ReadWriteLock，其读锁是共享锁，其写锁是独享锁</strong>。读锁的共享锁可保证并发读是非常高效的，读写、写读 、写写的过程是互斥的。独享锁与共享锁也是通过AQS来实现的，通过实现不同的方法，来实现独享或者共享。对于synchronized而言，当然是独享锁。</p>
<h4 id="3-互斥锁-x2F-读写锁"><a href="#3-互斥锁-x2F-读写锁" class="headerlink" title="3.互斥锁&#x2F;读写锁"></a>3.互斥锁&#x2F;读写锁</h4><p>上面说到的独享锁&#x2F;共享锁就是一种广义的说法，互斥锁&#x2F;读写锁就是具体的实现。互斥锁在Java中的具体实现就是ReentrantLock（可重入锁）；读写锁在Java中的具体实现就是ReadWriteLock。独享锁与共享锁也是通过AQS来实现的。</p>
<p>在多线程的环境下，对同一份数据进行读写，会涉及到线程安全的问题。比如在一个线程读取数据的时候，另外一个线程在写数据，而导致前后数据的不一致性；一个线程在写数据的时候，另一个线程也在写，同样也会导致线程前后看到的数据的不一致性。   这时候可以在读写方法中加入互斥锁，任何时候只能允许一个线程的一个读或写操作，而不允许其他线程的读或写操作，这样是可以解决这样以上的问题，但是效率却大打折扣了。因为在真实的业务场景中，一份数据，读取数据的操作次数通常高于写入数据的操作，而线程与线程间的读读操作是不涉及到线程安全的问题，没有必要加入互斥锁，只要在读-写，写-写期间上锁就行了。对于这种情况，读写锁则最好的解决方案！</p>
<p>读写锁的机制： </p>
<ol>
<li><p>“读-读”不互斥 </p>
</li>
<li><p>“读-写”互斥 </p>
</li>
<li><p>“写-写”互斥</p>
</li>
</ol>
<p>即在任何时候必须保证： </p>
<ol>
<li>只有一个线程在写入； </li>
<li>线程正在读取的时候，写入操作等待； </li>
<li>线程正在写入的时候，其他线程的写入操作和读取操作都要等待；</li>
</ol>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachedData</span> &#123;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 缓存都应该是单例的，在这里用单例模式设计：  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">CachedData</span> <span class="variable">cachedData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CachedData</span>();  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReadWriteLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();<span class="comment">//读写锁  </span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; cache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();<span class="comment">//缓存  </span></span><br><span class="line">      </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">CachedData</span><span class="params">()</span>&#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CachedData <span class="title function_">getInstance</span><span class="params">()</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> cachedData;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 读取缓存：  </span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">read</span><span class="params">(String key)</span> &#123;  </span><br><span class="line">        lock.readLock().lock();  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            obj = cache.get(key);  </span><br><span class="line">            <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;  </span><br><span class="line">                lock.readLock().unlock();  </span><br><span class="line">                <span class="comment">// 在这里的时候，其他的线程有可能获取到锁  </span></span><br><span class="line">                lock.writeLock().lock();  </span><br><span class="line">                <span class="keyword">try</span> &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;  </span><br><span class="line">                        obj = <span class="string">&quot;查找数据库&quot;</span>; <span class="comment">// 实际动作是查找数据库  </span></span><br><span class="line">                        <span class="comment">// 把数据更新到缓存中：  </span></span><br><span class="line">                        cache.put(key, obj);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">                    <span class="comment">// 当前线程在获取到写锁的过程中，可以获取到读锁，这叫锁的重入，然后导致了写锁的降级，称为降级锁。  </span></span><br><span class="line">                    <span class="comment">// 利用重入可以将写锁降级，但只能在当前线程保持的所有写入锁都已经释放后，才允许重入 reader使用  </span></span><br><span class="line">                    <span class="comment">// 它们。所以在重入的过程中，其他的线程不会有获取到锁的机会（这样做的好处）。试想，先释放写锁，在  </span></span><br><span class="line">                    <span class="comment">// 上读锁，这样做有什么弊端？--如果这样做，那么在释放写锁后，在得到读锁前，有可能被其他线程打断。  </span></span><br><span class="line">                    <span class="comment">// 重入————&gt;降级锁的步骤：先获取写入锁，然后获取读取锁，最后释放写入锁（重点）  </span></span><br><span class="line">                    lock.readLock().lock();   </span><br><span class="line">                    lock.writeLock().unlock();  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            lock.readLock().unlock();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> obj;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>



<h4 id="4-乐观锁-x2F-悲观锁"><a href="#4-乐观锁-x2F-悲观锁" class="headerlink" title="4.乐观锁&#x2F;悲观锁"></a>4.乐观锁&#x2F;悲观锁</h4><p>乐观锁与悲观锁不是指具体的什么类型的锁，而是指看待并发同步的角度。</p>
<p><strong>悲观锁：总是假设最坏的情况，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会阻塞直到它拿到锁</strong>。比如Java里面的同步原语synchronized关键字的实现就是悲观锁。</p>
<p>乐观锁：顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量，在Java中java.util.concurrent.atomic包下面的原子变量类就是使用了乐观锁的一种实现方式CAS(Compare and Swap 比较并交换)实现的。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122101819836.png" alt="img"></p>
<p>根据从上面的概念描述我们可以发现：</p>
<ul>
<li><p>悲观锁适合写操作多的场景，先加锁可以保证写操作时数据正确。</p>
</li>
<li><p>乐观锁适合读操作多的场景，不加锁的特点能够使其读操作的性能大幅提升。</p>
<p>乐观锁和悲观锁的调用方式示例：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122101946394.png" alt="img"></p>
</li>
</ul>
<p>通过调用方式示例，我们可以发现<strong>悲观锁基本都是在显式的锁定之后再操作同步资源，而乐观锁则直接去操作同步资源。</strong>那么，为何乐观锁能够做到不锁定同步资源也可以正确的实现线程同步呢？我们通过介绍乐观锁的主要实现方式 “CAS” 的技术原理来为大家解惑。</p>
<h5 id="乐观锁的一种实现：CAS"><a href="#乐观锁的一种实现：CAS" class="headerlink" title="乐观锁的一种实现：CAS"></a>乐观锁的一种实现：CAS</h5><p>CAS全称 Compare And Swap（比较与交换），是一种无锁算法。在不使用锁（没有线程被阻塞）的情况下实现多线程之间的变量同步。java.util.concurrent包中的原子类就是通过CAS来实现了乐观锁。</p>
<p>CAS算法涉及到三个操作数：</p>
<ul>
<li>需要读写的内存值 V。</li>
<li>进行比较的值 A。</li>
<li>要写入的新值 B。</li>
</ul>
<p>当且仅当 V 的值等于 A 时，CAS通过原子方式用新值B来更新V的值（“比较+更新”整体是一个原子操作），否则不会执行任何操作。一般情况下，“更新”是一个不断重试的操作。</p>
<p>注：</p>
<p>【原子性：即一个操作或者多个操作 要么全部执行并且执行的过程不会被任何因素打断，要么就都不执行。</p>
<ol>
<li><p>“原子操作(atomic operation)是不需要synchronized”，所谓原子操作是指不会被线程调度机制打断的操作；这种操作一旦开始，就一直运行到结束，中间不会有任何 context switch；</p>
</li>
<li><p>java中一般事务管理里面用到原子操作。</p>
</li>
<li><ol>
<li><p>原子操作可以是一个步骤，也可以是多个操作步骤，但是其顺序不可以被打乱，也不可以被切割而只执行其中的一部分，将整个操作视作一个整体是原子性的核心特征；</p>
</li>
<li><p>使用原子操作的好处：</p>
<p>⑴. 性能角度：它执行多次的所消耗的时间远远小于由于线程所挂起到恢复所消耗的时间，因此无锁的CAS操作在性能上要比同步锁高很多；</p>
<p>⑵. 业务需求：业务本身的需求上，无锁机制本身就可以满足我们绝大多数的需求，并且在性能上也可以大大的进行提升。】</p>
</li>
</ol>
</li>
</ol>
<p>之前提到java.util.concurrent包中的原子类，就是通过CAS来实现了乐观锁，那么我们进入原子类AtomicInteger的源码，看一下AtomicInteger的定义：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122102030461.png" alt="img"></p>
<p>根据定义我们可以看出各属性的作用：</p>
<ul>
<li>unsafe： 获取并操作内存的数据。</li>
<li>valueOffset： 存储value在AtomicInteger中的偏移量。</li>
<li>value： 存储AtomicInteger的int值，该属性需要借助volatile关键字保证其在线程间是可见的。</li>
</ul>
<p>接下来，我们查看AtomicInteger的自增函数incrementAndGet()的源码时，发现自增函数底层调用的是unsafe.getAndAddInt()。但是由于JDK本身只有Unsafe.class，只通过class文件中的参数名，并不能很好的了解方法的作用，所以我们通过OpenJDK 8 来查看Unsafe的源码：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122102047431.png" alt="img"></p>
<p>根据OpenJDK 8的源码我们可以看出，getAndAddInt()循环获取给定对象o中的偏移量处的值v，然后判断内存值是否等于v。如果相等则将内存值设置为 v + delta，否则返回false，继续循环进行重试，直到设置成功才能退出循环，并且将旧值返回。整个“比较+更新”操作封装在compareAndSwapInt()中，在JNI里是借助于一个CPU指令完成的，属于原子操作，可以保证多个线程都能够看到同一个变量的修改值。</p>
<p>后续JDK通过CPU的cmpxchg指令，去比较寄存器中的 A 和 内存中的值 V。如果相等，就把要写入的新值 B 存入内存中。如果不相等，就将内存值 V 赋值给寄存器中的值 A。然后通过Java代码中的while循环再次调用cmpxchg指令进行重试，直到设置成功为止。</p>
<p>CAS虽然很高效，但是它也存在三大问题，这里也简单说一下：</p>
<p>\1. <strong>ABA问题</strong>。CAS需要在操作值的时候检查内存值是否发生变化，没有发生变化才会更新内存值。但是如果内存值原来是A，后来变成了B，然后又变成了A，那么CAS进行检查时会发现值没有发生变化，但是实际上是有变化的。ABA问题的解决思路就是在变量前面添加版本号，每次变量更新的时候都把版本号加一，这样变化过程就从“A－B－A”变成了“1A－2B－3A”。</p>
<p>JDK从1.5开始提供了AtomicStampedReference类来解决ABA问题，具体操作封装在compareAndSet()中。compareAndSet()首先检查当前引用和当前标志与预期引用和预期标志是否相等，如果都相等，则以原子方式将引用值和标志的值设置为给定的更新值。</p>
<p>\2. <strong>循环时间长开销大</strong>。CAS操作如果长时间不成功，会导致其一直自旋，给CPU带来非常大的开销。</p>
<p>\3. <strong>只能保证一个共享变量的原子操作</strong>。对一个共享变量执行操作时，CAS能够保证原子操作，但是对多个共享变量操作时，CAS是无法保证操作的原子性的。</p>
<p>Java从1.5开始JDK提供了AtomicReference类来保证引用对象之间的原子性，可以把多个变量放在一个对象里来进行CAS操作。</p>
<h4 id="5-分段锁"><a href="#5-分段锁" class="headerlink" title="5.分段锁"></a>5.分段锁</h4><p>分段锁其实是一种锁的设计，并不是具体的一种锁，对于ConcurrentHashMap而言，其并发的实现就是通过分段锁的形式来实现高效的并发操作，ConcurrentHashMap中的分段锁称为Segment，它即类似于HashMap（JDK7与JDK8中HashMap的实现）的结构，即内部拥有一个Entry数组，数组中的每个元素又是一个链表；同时又是一个ReentrantLock（Segment继承了ReentrantLock)。当需要put元素的时候，并不是对整个HashMap进行加锁，而是先通过hashcode来知道他要放在那一个分段中，然后对这个分段进行加锁，所以当多线程put的时候，只要不是放在一个分段中，就实现了真正的并行的插入。但是，在统计size的时候，可就是获取HashMap全局信息的时候，就需要获取所有的分段锁才能统计。</p>
<p>分段锁的设计目的是细化锁的粒度，当操作不需要更新整个数组的时候，就仅仅针对数组中的一项进行加锁操作。</p>
<h4 id="6-无锁-x2F-偏向锁-x2F-轻量级锁-x2F-重量级锁（待看）"><a href="#6-无锁-x2F-偏向锁-x2F-轻量级锁-x2F-重量级锁（待看）" class="headerlink" title="6.无锁&#x2F;偏向锁&#x2F;轻量级锁&#x2F;重量级锁（待看）"></a>6.无锁&#x2F;偏向锁&#x2F;轻量级锁&#x2F;重量级锁（待看）</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010648018/article/details/79750608">参考文章</a></p>
<p>这四种锁是指锁的状态，并且是针对synchronized。在Java 5通过引入锁升级的机制来实现高效synchronized。这三种锁（偏向锁&#x2F;轻量级锁&#x2F;重量级锁）的状态是通过对象监视器在对象头中的字段来表明的。</p>
<h5 id="Synchronized用法"><a href="#Synchronized用法" class="headerlink" title="Synchronized用法"></a>Synchronized用法</h5><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/blueSkyline/p/8598099.html">原文链接</a></p>
<p>synchronized是实现线程同步的基本手段，然而底层实现还是通过锁机制来保证，对于被synchronized修饰的区域每次只有一个线程可以访问，从而满足线程安全的目的。</p>
<p>synchronized通过锁机制的实现，满足了原子性，可见性和有序性，是并发编程正确执行的有效保障，而volatile只保证了可见性和有序性（禁止指令重排）。</p>
<p>synchronized可以修饰范围的包括：方法级别，代码块级别；而实际加锁的目标包括：对象锁（普通变量，静态变量），类锁。</p>
<p>下面是synchronized的几种常用方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynMethod</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">staticLockObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对象锁,代码级别,同一对象争用该锁,this为SynMethod实例,synchronized的锁绑定在this对象上</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; synchronized loop &quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对象锁，方法级别,同一对象争用该锁,普通（非静态）方法,synchronized的锁绑定在调用该方法的对象上,与上一个写法含义一致</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; synchronized loop &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对象锁，代码级别,同一类争用该锁,绑定在staticLockObj上,不同SynMethod实例,拥有同一个staticLockObj对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (staticLockObj) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; synchronized loop &quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 类锁,代码级别，同一类争用该锁</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (SynMethod.class) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; synchronized loop &quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 类锁,方法级别，同一类争用该锁,synchronized的锁绑定在SynMethod.class上</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">staticMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; synchronized loop &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试情况1</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method1();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method1();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程运行了同一个对象t1的同一个public方法method1。</p>
<p><strong>测试情况2</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method1();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method2();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程运行同一个对象t1的不同的方法method1和method2方法，但是这两个方法是使用同一个对象t1上进行同步的，所以实现同步的效果，侧面印证了这两种写法的一致性。</p>
<p><strong>测试情况3：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method3();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t2.method3();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程运行了不同的类对象t1和t2的同一个方法method3，这个方法是在一个静态对象上同步，这个<strong>静态变量</strong>是在这个类的所有实例上共享的，所以也是达到了同步的效果</p>
<p><strong>测试情况4：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method2();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method3();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程运行了同一个对象t1的method2和method3方法，这个方法分别在t1对象和SynMethod类的静态对象上同步，所以达到同步效果。因为method3方法是针对同一类的，</p>
<p><strong>测试情况5：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method4();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t2.method4();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程运行了不同对象t1和t2的同一个方法method4，该方法是在SynMethod类上同步，实现了同步效果</p>
<p><strong>测试情况6：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method4();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                SynMethod.staticMethod();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>两个线程分别运行了对象t1的method4和静态方法staticMethod，这个两个方法都在SynMethod类上同步，实现了同步的效果。</p>
<p><strong>测试情况7：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method4();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t2.method3();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>这次两个线程运行了两个对象的method3和method4发放，这个两个方法分别在SynMethod类和SynMethod类的静态对象上同步，所以没有达到同步效果</p>
<p><strong>测试情况8：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SynMethod</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynMethod</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">ta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t1.method4();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                t2.method2();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        ta.start();</span><br><span class="line">        tb.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">0</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">1</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">2</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">3</span></span><br><span class="line">A <span class="keyword">synchronized </span>loop <span class="number">4</span></span><br><span class="line"><span class="keyword">B </span><span class="keyword">synchronized </span>loop <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>这次两个线程运行了两个对象的method4和method2方法，这两个方法分别在SynMethod类和对象t2上同步，所以没有达到同步效果。</p>
<p>　　<strong>使用总结：虽然上面说的情况比较多，但是从同步对象的角度，同步的场景只用三个，一个是SynMethod实例（可以多个），SynMethod的静态对象（共享）和SynMethod类（一个），只要是在同一个对象上同步，这个对象可以是实例对象，可以是静态对象，可以是类对象，那么就可以实现同步效果，否则无法达到同步，这也与synchronized设计的初衷一致。</strong></p>
<h5 id="为什么Synchronized能实现线程同步？"><a href="#为什么Synchronized能实现线程同步？" class="headerlink" title="为什么Synchronized能实现线程同步？"></a>为什么Synchronized能实现线程同步？</h5><p>在回答这个问题之前我们需要了解两个重要的概念：“Java对象头”、“Monitor”。</p>
<p>1、Java对象头</p>
<p>synchronized是悲观锁，在操作同步资源之前需要给同步资源先加锁，<strong>这把锁就是存在Java对象头里的</strong>，而Java对象头又是什么呢？</p>
<p>我们以Hotspot虚拟机为例，Hotspot的对象头主要包括两部分数据：Mark Word（标记字段）、Klass Pointer（类型指针）。</p>
<p><strong>Mark Word</strong>：默认存储对象的HashCode，分代年龄和锁标志位信息。这些信息都是与对象自身定义无关的数据，所以Mark Word被设计成一个非固定的数据结构以便在极小的空间内存存储尽量多的数据。它会根据对象的状态复用自己的存储空间，也就是说在运行期间Mark Word里存储的数据会随着锁标志位的变化而变化。</p>
<p><strong>Klass Point</strong>：对象指向它的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例。</p>
<p>运行时JVM内存布局</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/2018032923230698"></p>
<p>Mark Word在不同锁状态下的标志位存储</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20180329232421333"></p>
<p>2、Monitor</p>
<p>Monitor可以理解为一个同步工具或一种同步机制，通常被描述为一个对象。每一个Java对象就有一把看不见的锁，称为内部锁或者Monitor锁。</p>
<p>Monitor是线程私有的数据结构，每一个线程都有一个可用monitor record列表，同时还有一个全局的可用列表。每一个被锁住的对象都会和一个monitor关联，同时monitor中有一个Owner字段存放拥有该锁的线程的唯一标识，表示该锁被这个线程占用。</p>
<p>现在话题回到synchronized，synchronized通过Monitor来实现线程同步，Monitor是依赖于底层的操作系统的Mutex Lock（互斥锁）来实现的线程同步。</p>
<p>如同我们在自旋锁中提到的“阻塞或唤醒一个Java线程需要操作系统切换CPU状态来完成，这种状态转换需要耗费处理器时间。如果同步代码块中的内容过于简单，状态转换消耗的时间有可能比用户代码执行的时间还要长”。这种方式就是synchronized最初实现同步的方式，这就是JDK 6之前synchronized效率低的原因。这种依赖于操作系统Mutex Lock所实现的锁我们称之为“重量级锁”，JDK 6中为了减少获得锁和释放锁带来的性能消耗，引入了“偏向锁”和“轻量级锁”。</p>
<p>所以目前锁一共有4种状态，级别从低到高依次是：无锁、偏向锁、轻量级锁和重量级锁。锁状态只能升级不能降级。</p>
<p>通过上面的介绍，我们对synchronized的加锁机制以及相关知识有了一个了解，那么下面我们给出四种锁状态对应的的Mark Word内容，然后再分别讲解四种锁状态的思路以及特点：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/2018112210411172.png" alt="img"></p>
<p><strong>无锁</strong></p>
<p>无锁没有对资源进行锁定，所有的线程都能访问并修改同一个资源，但同时只有一个线程能修改成功。</p>
<p>无锁的特点就是修改操作在循环内进行，线程会不断的尝试修改共享资源。如果没有冲突就修改成功并退出，否则就会继续循环尝试。如果有多个线程修改同一个值，必定会有一个线程能修改成功，而其他修改失败的线程会不断重试直到修改成功。上面我们介绍的CAS原理及应用即是无锁的实现。无锁无法全面代替有锁，但无锁在某些场合下的性能是非常高的。</p>
<p><strong>偏向锁</strong></p>
<p><strong>偏向锁是指一段同步代码一直被一个线程所访问，那么该线程会自动获取锁，降低获取锁的代价。</strong></p>
<p>在大多数情况下，锁总是由同一线程多次获得，不存在多线程竞争，所以出现了偏向锁。其目标就是在只有一个线程执行同步代码块时能够提高性能。</p>
<p>当一个线程访问同步代码块并获取锁时，会在Mark Word里存储锁偏向的线程ID。在线程进入和退出同步块时不再通过CAS操作来加锁和解锁，而是检测Mark Word里是否存储着指向当前线程的偏向锁。引入偏向锁是为了在无多线程竞争的情况下尽量减少不必要的轻量级锁执行路径，因为轻量级锁的获取及释放依赖多次CAS原子指令，而偏向锁只需要在置换ThreadID的时候依赖一次CAS原子指令即可。</p>
<p>偏向锁只有遇到其他线程尝试竞争偏向锁时，持有偏向锁的线程才会释放锁，线程不会主动释放偏向锁。偏向锁的撤销，需要等待全局安全点（在这个时间点上没有字节码正在执行），它会首先暂停拥有偏向锁的线程，判断锁对象是否处于被锁定状态。撤销偏向锁后恢复到无锁（标志位为“01”）或轻量级锁（标志位为“00”）的状态。</p>
<p>偏向锁在JDK 6及以后的JVM里是默认启用的。可以通过JVM参数关闭偏向锁：-XX:-UseBiasedLocking&#x3D;false，关闭之后程序默认会进入轻量级锁状态。</p>
<p><strong>轻量级锁</strong></p>
<p>是指当锁是偏向锁的时候，被另外的线程所访问，偏向锁就会升级为轻量级锁，其他线程会通过自旋的形式尝试获取锁，不会阻塞，从而提高性能。</p>
<p>在代码进入同步块的时候，如果同步对象锁状态为无锁状态（锁标志位为“01”状态，是否为偏向锁为“0”），虚拟机首先将在当前线程的栈帧中建立一个名为锁记录（Lock Record）的空间，用于存储锁对象目前的Mark Word的拷贝，然后拷贝对象头中的Mark Word复制到锁记录中。</p>
<p>拷贝成功后，虚拟机将使用CAS操作尝试将对象的Mark Word更新为指向Lock Record的指针，并将Lock Record里的owner指针指向对象的Mark Word。</p>
<p>如果这个更新动作成功了，那么这个线程就拥有了该对象的锁，并且对象Mark Word的锁标志位设置为“00”，表示此对象处于轻量级锁定状态。</p>
<p>如果轻量级锁的更新操作失败了，虚拟机首先会检查对象的Mark Word是否指向当前线程的栈帧，如果是就说明当前线程已经拥有了这个对象的锁，那就可以直接进入同步块继续执行，否则说明多个线程竞争锁。</p>
<p>若当前只有一个等待线程，则该线程通过自旋进行等待。但是当自旋超过一定的次数，或者一个线程在持有锁，一个在自旋，又有第三个来访时，轻量级锁升级为重量级锁。</p>
<p><strong>重量级锁</strong></p>
<p>升级为重量级锁时，锁标志的状态值变为“10”，此时Mark Word中存储的是指向重量级锁的指针，此时等待锁的线程都会进入阻塞状态。</p>
<p>整体的锁状态升级流程如下：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104130517.png" alt="img"></p>
<p>综上，偏向锁通过对比Mark Word解决加锁问题，避免执行CAS操作。而轻量级锁是通过用CAS操作和自旋来解决加锁问题，避免线程阻塞和唤醒而影响性能。重量级锁是将除了拥有锁的线程以外的线程都阻塞。</p>
<p>重量级锁是指当锁为轻量级锁的时候，另一个线程虽然是自旋，但自旋不会一直持续下去，当自旋一定次数的时候，还没有获取到锁，就会进入阻塞，该锁膨胀为重量级锁。重量级锁会让其他申请的线程进入阻塞，性能降低。<strong>随着竞争情况锁状态逐渐升级、锁可以升级但不能降级。</strong></p>
<p>偏向锁的获取和撤销：</p>
<p>HotSpot作者经过研究发现，大多数情况下，锁不仅不存在多线程竞争，而且总是由同一线程多次获得，为了让线程获得锁的代价更低而引入偏向锁。</p>
<p>线程1检查对象头中的Mark Word中是否存储了线程1，如果没有则CAS操作将Mark Word中的线程ID替换为线程1。此时，锁偏向线程1，后面该线程进入同步块时不需要进行CAS操作，只需要简单的测试一下Mark Word中是否存储指向当前线程的偏向锁，如果成功表明该线程已经获得锁。如果失败，则再需要测试一下Mark Word中偏向锁标识是否设置为1(是否是偏向锁)，如果没有设置，则使用CAS竞争锁，如果设置了，则尝试使用CAS将偏向锁指向当前线程</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20180329232604894"></p>
<p>偏向锁的竞争结果:</p>
<p>根据持有偏向锁的线程是否存活</p>
<p>1.如果不活动，偏向锁撤销到无锁状态，再偏向到其他线程<br>2.如果线程仍然活着，则升级到轻量级锁</p>
<p>偏向锁在Java6和Java7中默认是开启的，但是在应用程序启动几秒后才激活，如果有必要可以关闭延迟：<br>-XX:BiasedLockingStartupDelay&#x3D;0</p>
<p>如果确定应用程序中所有的锁通常情况下处于竞争状态，可以通过JVM参数关闭偏向锁：<br>-XX:-UseBiasedLocking&#x3D;false，那么程序默认会进入轻量级锁。</p>
<p>-XX:BiasedLockingStartupDelay&#x3D;0 -XX:+TraceBiasedLocking</p>
<p>轻量级锁膨胀：</p>
<p>1.线程在执行同步块之前，JVM会在当前栈桢中创建用于存储锁记录的空间(Lock record)，并将对象头中的Mark Word复制到锁记录中(Displaced Mark Word)。<br>2.然后线程尝试使用CAS将对象头中的Mark Word替换为指向锁记录的指针<br>3.如果成功，当前线程获得锁，如果失败，表示其他线程竞争锁，当前线程尝试使用自旋来获取锁</p>
<p><strong>偏向锁、轻量级锁、重量级锁的优缺点</strong></p>
<p>1.偏向锁是为了避免某个线程反复获得&#x2F;释放同一把锁时的性能消耗，如果仍然是同个线程去获得这个锁，尝试偏向锁时会直接进入同步块，不需要再次获得锁。</p>
<p>2.而轻量级锁和自旋锁都是为了避免直接调用操作系统层面的互斥操作，因为挂起线程是一个很耗资源的操作。</p>
<p>为了尽量避免使用重量级锁（操作系统层面的互斥），首先会尝试轻量级锁，轻量级锁会尝试使用CAS操作来获得锁，如果轻量级锁获得失败，说明存在竞争。但是也许很快就能获得锁，就会尝试自旋锁，将线程做几个空循环，每次循环时都不断尝试获得锁。如果自旋锁也失败，那么只能升级成重量级锁。</p>
<p>3.可见偏向锁，轻量级锁，自旋锁都是乐观锁。</p>
<p>逃逸分析：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20180329233254519"></p>
<p>逃逸分析：通俗一点讲，当一个对象的指针被多个方法或线程引用时，我们称这个指针发生了逃逸，必须在JIT里完成</p>
<p>锁粗化：</p>
<p>如果虚拟机探测到有这样一串零碎的操作都对同一个对象加锁，将会把加锁同步的范围扩展到整个操作序列的外部，这样就只需要加锁一次就够了</p>
<p>锁消除：</p>
<p>如果你定义的类的方法上有同步锁，但在运行时，却只有一个线程在访问，此时逃逸分析后的机器码，会去掉同步锁运行。</p>
<p>栈上分配：</p>
<p>分析找到未逃逸的变量，将变量类的实例化内存直接在栈里分配(无需进入堆)，分配完成后，继续在调用栈内执行，最后线程结束，栈空间被回收，局部变量对象也被回收。</p>
<p>从jdk1.6开始默认开启：<br>开启：  -XX:+DoEscapeAnalysis</p>
<p>关闭：  -XX:-DoEscapeAnalysis</p>
<h4 id="7-自旋锁"><a href="#7-自旋锁" class="headerlink" title="7.自旋锁"></a>7.自旋锁</h4><p>在Java中，自旋锁是指尝试获取锁的线程不会立即阻塞，而是采用循环的方式去尝试获取锁，这样的好处是减少线程上下文切换的消耗，缺点是循环会消耗CPU。</p>
<p>在介绍自旋锁前，我们需要介绍一些前提知识来帮助大家明白自旋锁的概念。</p>
<p>阻塞或唤醒一个Java线程需要操作系统切换CPU状态来完成，这种状态转换需要耗费处理器时间。如果同步代码块中的内容过于简单，状态转换消耗的时间有可能比用户代码执行的时间还要长。</p>
<p>在许多场景中，同步资源的锁定时间很短，为了这一小段时间去切换线程，线程挂起和恢复现场的花费可能会让系统得不偿失。如果物理机器有多个处理器，能够让两个或以上的线程同时并行执行，我们就可以让后面那个请求锁的线程不放弃CPU的执行时间，看看持有锁的线程是否很快就会释放锁。</p>
<p>而为了让当前线程“稍等一下”，我们需让当前线程进行自旋，如果在自旋完成后前面锁定同步资源的线程已经释放了锁，那么当前线程就可以不必阻塞而是直接获取同步资源，从而避免切换线程的开销。这就是自旋锁。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/2018112210212894.png" alt="img"></p>
<p>自旋锁本身是有缺点的，它不能代替阻塞。自旋等待虽然避免了线程切换的开销，但它要占用处理器时间。如果锁被占用的时间很短，自旋等待的效果就会非常好。反之，如果锁被占用的时间很长，那么自旋的线程只会白浪费处理器资源。所以，自旋等待的时间必须要有一定的限度，如果自旋超过了限定次数（默认是10次，可以使用-XX:PreBlockSpin来更改）没有成功获得锁，就应当挂起线程。</p>
<p>自旋锁的实现原理同样也是CAS，AtomicInteger中调用unsafe进行自增操作的源码中的do-while循环就是一个自旋操作，如果修改数值失败则通过循环来执行自旋，直至修改成功。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104052869.png" alt="img"></p>
<p>自旋锁在JDK1.4.2中引入，使用-XX:+UseSpinning来开启。JDK 6中变为默认开启，并且引入了自适应的自旋锁（适应性自旋锁）。</p>
<p>自适应意味着自旋的时间（次数）不再固定，而是由前一次在同一个锁上的自旋时间及锁的拥有者的状态来决定。如果在同一个锁对象上，自旋等待刚刚成功获得过锁，并且持有锁的线程正在运行中，那么虚拟机就会认为这次自旋也是很有可能再次成功，进而它将允许自旋等待持续相对更长的时间。如果对于某个锁，自旋很少成功获得过，那在以后尝试获取这个锁时将可能省略掉自旋过程，直接阻塞线程，避免浪费处理器资源。</p>
<p>在自旋锁中 另有三种常见的锁形式:TicketLock、CLHlock和MCSlock。</p>
<h4 id="8-可重入锁-x2F-非可重入锁"><a href="#8-可重入锁-x2F-非可重入锁" class="headerlink" title="8.可重入锁&#x2F;非可重入锁"></a>8.可重入锁&#x2F;非可重入锁</h4><p>可重入锁又名递归锁，是指在同一个线程在外层方法获取锁的时候，再进入该线程的内层方法会自动获取锁（前提锁对象得是同一个对象或者class），不会因为之前已经获取过还没释放而阻塞。Java中ReentrantLock和synchronized都是可重入锁，可重入锁的一个优点是可一定程度避免死锁。下面用示例代码来进行分析：</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104329631.png" alt="img"></p>
<p>在上面的代码中，类中的两个方法都是被内置锁synchronized修饰的，doSomething()方法中调用doOthers()方法。因为内置锁是可重入的，所以同一个线程在调用doOthers()时可以直接获得当前对象的锁，进入doOthers()进行操作。</p>
<p>如果是一个不可重入锁，那么当前线程在调用doOthers()之前需要将执行doSomething()时获取当前对象的锁释放掉，实际上该对象锁已被当前线程所持有，且无法释放。所以此时会出现死锁。</p>
<p>而为什么可重入锁就可以在嵌套调用时可以自动获得锁呢？我们通过图示和源码来分别解析一下。</p>
<p>还是打水的例子，有多个人在排队打水，此时管理员允许锁和同一个人的多个水桶绑定。这个人用多个水桶打水时，第一个水桶和锁绑定并打完水之后，第二个水桶也可以直接和锁绑定并开始打水，所有的水桶都打完水之后打水人才会将锁还给管理员。这个人的所有打水流程都能够成功执行，后续等待的人也能够打到水。这就是可重入锁。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/2018112210434386.png" alt="img"></p>
<p>但如果是非可重入锁的话，此时管理员只允许锁和同一个人的一个水桶绑定。第一个水桶和锁绑定打完水之后并不会释放锁，导致第二个水桶不能和锁绑定也无法打水。当前线程出现死锁，整个等待队列中的所有线程都无法被唤醒。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104355888.png" alt="img"></p>
<p>之前我们说过ReentrantLock和synchronized都是重入锁，那么我们通过重入锁ReentrantLock以及非可重入锁NonReentrantLock的源码来对比分析一下为什么非可重入锁在重复调用同步资源时会出现死锁。</p>
<p>首先ReentrantLock和NonReentrantLock都继承父类AQS，其父类AQS中维护了一个同步状态status来计数重入次数，status初始值为0。</p>
<p>当线程尝试获取锁时，可重入锁先尝试获取并更新status值，如果status &#x3D;&#x3D; 0表示没有其他线程在执行同步代码，则把status置为1，当前线程开始执行。如果status !&#x3D; 0，则判断当前线程是否是获取到这个锁的线程，如果是的话执行status+1，且当前线程可以再次获取锁。而非可重入锁是直接去获取并尝试更新当前status的值，如果status !&#x3D; 0的话会导致其获取锁失败，当前线程阻塞。</p>
<p>释放锁时，可重入锁同样先获取当前status的值，在当前线程是持有锁的线程的前提下。如果status-1 &#x3D;&#x3D; 0，则表示当前线程所有重复获取锁的操作都已经执行完毕，然后该线程才会真正释放锁。而非可重入锁则是在确定当前线程是持有锁的线程之后，直接将status置为0，将锁释放。</p>
<p><img src="/images/java-%E9%94%81%E6%9C%BA%E5%88%B6/20181122104410235.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">setA</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    setB();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">setB</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码就是一个可重入锁的一个特点，如果不是可重入锁的话，setB可能不会被当前线程执行，可能造成死锁。</p>
<p>需要注意的是，可重入锁加锁和解锁的次数要相等。</p>
<p><img src="/../../../../notes_learn/java/Java%25E4%25B8%25AD%25E5%25B8%25B8%25E7%2594%25A8%25E7%259A%2584%25E9%2594%2581%25E6%259C%25BA%25E5%2588%25B6.assets/20180329230449266" alt="img"></p>
<p>C&#x3D;&#x3D;0表明未获得锁，Else表示已经获得锁，这时对state加1，相应的，每次释放锁都会对state减1</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/01/19/android_drawable/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/19/android_drawable/" class="post-title-link" itemprop="url">drawable</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-19 08:41:20" itemprop="dateCreated datePublished" datetime="2020-01-19T08:41:20Z">2020-01-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-13 09:13:26" itemprop="dateModified" datetime="2022-11-13T09:13:26Z">2022-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="drawable"><a href="#drawable" class="headerlink" title="drawable"></a>drawable</h1><p><strong>drawable常用作View的背景</strong>（还可以作为ImageView中的图像来显示）。是通过xml来定义的。</p>
<p>Drawable是个抽象类，是所有Dreawble对象的基类，每个具体的Drawable是它的子类。这就反映了Drawable是可以通过代码来创建的。</p>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><h3 id="1-BitmapDrawable"><a href="#1-BitmapDrawable" class="headerlink" title="1.BitmapDrawable"></a>1.BitmapDrawable</h3><p> 表示一张图片，可以直接接引原始的图片，或者通过XML的方式描述。</p>
<h3 id="2-ShapeDrawble"><a href="#2-ShapeDrawble" class="headerlink" title="2.ShapeDrawble"></a>2.ShapeDrawble</h3><p>通过颜色构造的图形</p>
<h3 id="3-LayerDrawable"><a href="#3-LayerDrawable" class="headerlink" title="3.LayerDrawable"></a>3.LayerDrawable</h3><p>将不同的Drawable放置在不同的层上面达到一种叠加效果。XML标签是<layer-list>，一个layer-list包含很多个item，一个item表示一个Drawable。item中的属性可以移动对应的Drawable。item中的andorid：drawable属性可以引用一个Drawable（故该drawable是已经存在的。）或者自己在item中定义一个。</p>
<h3 id="4-StateListDrawable"><a href="#4-StateListDrawable" class="headerlink" title="4.StateListDrawable"></a>4.StateListDrawable</h3><p>对应着<selector>标签，表示的是drawable的集合，每个drawable对应view的一种状态，<strong>系统会根据view的状态来选择drawable</strong></p>
<p>它包含许多个item（表示一个具体的Drawable）里面包含了view的状态。故系统自上而下根据view的状态选择item。（找到一个就返回，没找到就选择默认的item）默认的item是不附带状态的。</p>
<h3 id="5-LevelListDrawable"><a href="#5-LevelListDrawable" class="headerlink" title="5.LevelListDrawable"></a>5.LevelListDrawable</h3><p>对应<level-list>标签，表示的是drawable集合，但是集合中的drawable是有等级的。根据不同的等级切换到不同的drawable。等级在item。view是通过设置等级来选择对应的drawable作为其背景的。（设置等级是通过Drawable类的setLevel方法来设置的）。</p>
<p>感觉上可以自由选择自己想要的背景。</p>
<h3 id="6-TransitionDrawable"><a href="#6-TransitionDrawable" class="headerlink" title="6.TransitionDrawable"></a>6.TransitionDrawable</h3><p>对应<transition>标签。实现<strong>两个</strong>drawable之间的淡入淡出。</p>
<p>在其中确定自己的item（即item对应的drawable之前淡入淡出）</p>
<p>可以直接在view中设置为其背景</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ImageView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/imgView&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">android:src=<span class="string">&quot;@drawable/transition&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>或者在代码中控制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">ImageView</span> <span class="variable">image</span> <span class="operator">=</span> (ImageView) findViewById(R.id.mIv);</span><br><span class="line"><span class="comment">//得到一个Drawable，属于 TransitionDrawable 类型的</span></span><br><span class="line">        <span class="type">TransitionDrawable</span> <span class="variable">transition</span> <span class="operator">=</span> (TransitionDrawable)getResources().</span><br><span class="line">                getDrawable(R.drawable.transition_simple);</span><br><span class="line"></span><br><span class="line">        image.setImageDrawable(transition);</span><br><span class="line">        transition.startTransition(<span class="number">2000</span>); <span class="comment">// 设定渐变的变化时长</span></span><br></pre></td></tr></table></figure>

<p>问题：如何实现多个drawable的淡入淡出？</p>
<p>开启一个线程（死循环）每隔一段时间发送消息到UI主线程中替换主线程中的transitionDrawable对象中的图片就可以了，需要用到handler。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/z_zt_t/article/details/52761432">https://blog.csdn.net/z_zt_t/article/details/52761432</a></p>
<h3 id="7-InsetDrawable"><a href="#7-InsetDrawable" class="headerlink" title="7.InsetDrawable"></a>7.InsetDrawable</h3><p>对应<inset>标签。可以将其他的drawable内嵌到自己的当中。故view可以让背景比自己的实际区域小。</p>
<p>很像drawable的padding属性，区别在于 padding表示drawable的内容与drawable本身的边距，insetDrawable表示两个drawable和容器之间的边距。</p>
<h3 id="8-ScaleDrawable"><a href="#8-ScaleDrawable" class="headerlink" title="8.ScaleDrawable"></a>8.ScaleDrawable</h3><p>对应与<scale>标签。根据自己的等级将其指定的drawable进行放缩。等级越小，放缩越好。等级为0，则不可见。</p>
<h3 id="9-ClipDrawable"><a href="#9-ClipDrawable" class="headerlink" title="9.ClipDrawable"></a>9.ClipDrawable</h3><p>对应与<clip>标签。根据自己的等级设置一个Drawable的当前显示比例来裁剪出另一张Drawable。（该drawable是其引用的drawable的一部分）</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/briblue/article/details/53528837">https://blog.csdn.net/briblue/article/details/53528837</a></p>
<h3 id="10-自定义Drawable"><a href="#10-自定义Drawable" class="headerlink" title="10.自定义Drawable"></a>10.自定义Drawable</h3><p>核心是draw方法（？）。系统调用draw方法来绘制view的背景。由此可得，可以通过重写drawable的draw方法来自定义drawable。</p>
<h3 id="11-VectorDrawable"><a href="#11-VectorDrawable" class="headerlink" title="11.VectorDrawable"></a>11.VectorDrawable</h3><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0972a0d290e9">Android矢量图I–VectorDrawable基础</a></p>
<p>Android API 21（5.0）引入了一个Drawable的子类<code>VectorDrawable</code>目的就是用来渲染矢量图，<code>AnimatedVectorDrawable</code>用来播放矢量动画。</p>
<p><strong>准备</strong></p>
<p>使用矢量图要根据<code>minSdkVersion</code>来分3中不同的情况：</p>
<ol>
<li><code>minSdkVersion&gt;=21</code>：用xml文件或者代码定义VectorDrawable，和普通的Drawable用法一样，不再需要额外任何东西；如何编写矢量图，下文有介绍；</li>
<li><code>minSdkVersion&lt;21</code>：如果想要渲染矢量图的话必须在app模块的build.gralde文件里添加一行代码：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">    vectorDrawables.useSupportLibrary = true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	3. <code>minSdkVersion&lt;21以及更多</code>：上面的第二种情况是使用兼容包，但是兼容包仅支持<code>AppCompatImageView</code>和<code>AppCompatImageButton</code>及其子类矢量图，而且矢量图的引用必须放在<code>app:srcCompat</code>属性中才会被识别并生效，代码必须这样写才行：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.AppCompatImageView</span></span></span><br><span class="line"><span class="tag">      <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:layout_width</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:layout_height</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">app:srcCompat</span>=<span class="string">&quot;@drawable/ic_oval&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ic_oval.xml是我们使用xml编写的矢量图，如果想要TextView的drawableTop或者其他额外方式使用矢量图渲染，那么必须在Activity中加入代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    AppCompatDelegate.setCompatVectorFromResourcesEnabled(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时这个Activity必须继承AppCompatActivity这个compat兼容包属性才会生效。</p>
<p><code>minSdkVersion&lt;21</code>情况下在非app:srcCompat属性的地方使用矢量图时，需要将矢量图用drawable容器(如StateListDrawable, InsetDrawable, LayerDrawable, LevelListDrawable, 和RotateDrawable)包裹起来使用。否则会在低版本的情况下报错<code>org.xmlpull.v1.XmlPullParserException: Binary XML file line #0: invalid drawable tag vector</code>。minSdkVersion&gt;&#x3D;21则没有任何限制。</p>
<p><strong>矢量图使用</strong></p>
<p>准备工作做好之后，我们就需要自己动手编辑矢量图了。VectorDrawable类在xml中对应的是标签是<code>vector</code>。我目前所知道的是只有xml文件才能决定矢量图的样子(也就是编辑pathData、fillColor等属性)，貌似无法使用代码来决定矢量图的绘制逻辑，而只能使用代码加载编辑好的xml文件，这个xml文件有两种方法来创建：</p>
<ol>
<li>右击drawable–&gt;Drawable resource file–&gt;设置<code>root element</code>为<code>vector</code>，这样的矢量图绘制逻辑完全掌握在开发者手里；</li>
<li>右击drawable–&gt;Vector Asset，选择SVG或者PSD文件直接生成根标签为vector的xml文件，可以百度或者Google怎样把png转换成SVG。</li>
</ol>
<p>写了这么多字，一直在瞎扯淡而没谈重点，下面我们看下根标签为vector的xml文件的真面目，代码：</p>
<p><img src="/images/drawable/1323444-54b94ead11c967ba.webp" alt="img"></p>
<p>上图中标签vector使用了四个属性：<code>android:width=&quot;24dp&quot;</code>、<code>android:height=&quot;24dp&quot;</code>、<code>android:viewportHeight=&quot;300.0&quot;</code>、<code>android:viewportWidth=&quot;300.0&quot;</code>。</p>
<ol>
<li>width和height：当使用这个矢量图的View的宽高是wrap_content 的时候这两个属性才生效；</li>
<li>viewportWidth和viewportHeight：决定画布的宽高，是定义的一个虚拟空间，方便编辑pathData属性，如果pathData中的点超出了这个虚拟空间，超出的部分将不会展现给用户；虚拟空间的原点仍然还是在左上角(R点就是原点)。</li>
</ol>
<p>path标签是vector标签的子标签，它使用了以下属性：</p>
<ol>
<li><code>android:name</code>：类似View的id属性，方便path被引用，如上图的edge是虚拟空间四个边界的path，oval是一个椭圆的path；</li>
<li><code>android:fillColor</code>：填充path的颜色，如果没有定义则不填充path</li>
<li><code>android:strokeColor</code>：path边框颜色，如果没有定义则不显示边框</li>
<li><code>android:strokeWidth</code>：path边框的粗细尺寸</li>
<li><code>android:pathData</code>：path指令，决定path的移动和绘制逻辑，这个是最主要的属性，下面详细讨论。</li>
</ol>
<p>更多path属性请参考<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://developer.android.com/reference/android/graphics/drawable/VectorDrawable.html">链接</a>。</p>
<p>pathData的指令和Path类的API方法基本差不多，比如M指令对应moveTo方法，m指令对应rMoveTo方法，下面是一些基本的指令：</p>
<ul>
<li><ol>
<li>Mx,y：移动到点(x,y)</li>
</ol>
</li>
<li><ol>
<li>Lx,y：直线连到点x,y，简化命令H(x)水平连接和V(y)垂直连接；</li>
</ol>
</li>
<li><ol>
<li>Qx1,y1 x2,y2：二阶贝塞尔曲线，控制点（x1,y1），终点x2,y2；</li>
</ol>
</li>
<li><ol>
<li>Cx1,y1 x2,y2 x3,y3：三阶贝塞尔曲线，控制点（x1,y1）（ x2,y2），终点x3,y3；</li>
</ol>
</li>
<li><ol>
<li>Tx y：平滑的二阶贝塞尔曲线，参数只有一个点(x,y)，这个点是结束点，控制点是前一个二阶贝塞尔曲线的控制点相对于前一个贝塞尔曲线的结束点的镜像点。</li>
</ol>
</li>
<li><ol>
<li>Sx2,y2 x,y：平滑的三阶贝塞尔曲线，参数为(x2,y2 x,y) ，x2,y2 为第二个控制点，x,y为绘制终点，那么第一个控制点则是前一个三阶曲线的第二个控制点相对于前一个三阶曲线终点的镜像点。</li>
</ol>
</li>
<li><ol>
<li>Arx,ry x-axis-rotation large-arc-flag,sweep-flag x,y：ellipse arc圆弧曲线</li>
</ol>
</li>
<li><ol>
<li>z：close闭合<br>……</li>
</ol>
</li>
</ul>
<p>每个指令都有大小写形式，大写表示后面的参数是绝对坐标，小写表示相对于上一个点的相对坐标位置，参数可以用逗号或者空格分离。<br>只要掌握上面5个基本指令就能编辑pathData并且绘制一些酷炫的SVG。更详细全面的path指令请参阅<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://www.w3.org/TR/SVG/paths.html%23PathDataEllipticalArcCommands">链接</a>。</p>
<p>估计你已经发现了，圆弧曲线指令A竟然那么多参数，这直接吓跑了很多的程序员，其实也并不难，且慢慢道来。</p>
<p>先根据图1里的代码来分析pathData指令。如图一所示，edge这个path使用了四个相对指令，首先指令h300 0相对向右水平移动300到点S，然后指令v0 300相对向下垂直移动300到T，再次指令h-300 0相对向左水平移动300到U，最后指令v0 -300相对向上垂直移动300到起点R，这样就根据属性strokeColor和strokeWidth绘制了四条直线，最后一个指令可以使用z代替。这很简单吧？！</p>
<p>再来看oval这个path。它使用了三条指令。第一条指令移动到点M处，第二条指令<code>a75,75 0 1,1 150,0</code>绘制M-N-O的弧线，第三条指令<code>a75,75 0 1,1 -150,0</code>绘制O-P-M的弧线。a指令共有7个参数：rx和ry表示椭圆的两个半径，x-axis-rotation表示x轴的旋转角度，x和y表示绘制椭圆弧线的终点，这5个参数很简单很好理解，large-arc-flag和sweep-flag这两个参数有点唬人。<br>解释large-arc-flag和sweep-flag这两个参数之前先考虑下这个题目：已知椭圆的半径rx和ry，请绘制若干条从起始点A到终点B的椭圆弧线。题目中是若干条，那到底几条啊？一般情况下会有四条椭圆弧线(特殊情况是rx&#x3D;线段AB的一半或者ry&#x3D;线段AB的一半，这时候的椭圆弧线只有两条)，而large-arc-flag和sweep-flag这两个参数就从这四个椭圆弧线中选取了最终的一条进行绘制。large-arc-flag决定是大弧线还是小弧线，1大0小，sweep-flag决定是顺时针弧线还是逆时针弧线，1顺0逆。</p>
<p><img src="/images/drawable/1323444-c37681ec1a63726a.webp" alt="img"></p>
<p>图2</p>
<p>看图2希望你能明白这两个参数的意义。</p>
<p>有人可能会问，图1的oval path是个圆，竟然使用了两个a指令，使用一个a指令就能绘制圆的，只要终点回到起始点就能绘制圆的path了，刚开始我也是这样认为的，比如下面的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">vector</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:width</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:height</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportHeight</span>=<span class="string">&quot;300.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportWidth</span>=<span class="string">&quot;300.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;circle&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/holo_green_light&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        M150,150</span></span></span><br><span class="line"><span class="string"><span class="tag">        a75,75 0 1,1 0,0&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;#00000000&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>  上面的代码的path从起始点又回到了起始点，不会绘制任何东西，终点x y需要和起始点错开几个像素比如<code>android:pathData=&quot;M150,150 a75,75 0 1,1 0,1&quot;</code>就大约是一个圆path，为什么说是大约一个圆？因为起始点和终点不在一起，这只是一个圆的大弧线部分。推荐使用两条a指令绘制圆path，因为一条a指令绘制的不是真正的圆path。</p>
<p><strong>group标签</strong></p>
<p>path没有<strong>scale</strong>、<strong>rotate</strong>和<strong>translate</strong>这三种属性，因此也不能执行这三种属性动画，要达到这样的目的需要借助group这个标签。group标签也是vector的一个子标签，它可以作为path或者其他group的父标签使用，将path和group组合成一个组来附加一些变换操作，这些变换操作包括<strong>scale</strong>、<strong>rotate</strong>和<strong>translate</strong>共三种。这张图3是来自<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://developer.android.com/guide/topics/graphics/vector-drawable-resources.html">android官网</a>的vector标签树型图：</p>
<p><img src="/images/drawable/1323444-f01c851c19b3679d.webp" alt="img"></p>
<p>图3</p>
<p>。<group>定义变换的细节，<clip-path>定义裁剪区域。根据这三个变换操作，group标签有以下属性：</p>
<ul>
<li>android:name：group的名字；</li>
<li>android:rotation：group的旋转角度，默认0。</li>
<li>android:pivotX：scale和rotation变换中心点的X坐标，默认0；</li>
<li>android:pivotY：scale和rotation变换中心点的Y坐标，默认0；</li>
<li>android:scaleX：X轴方向的缩放，默认1；</li>
<li>android:scaleY：Y轴方向的缩放，默认1；</li>
<li>android:translateX：X轴方向的移动距离，默认0；</li>
<li>android:translateY：Y轴方向的移动距离，默认0。</li>
</ul>
<p>这是group的全部属性了，属性都很简单，不需要解释。</p>
<p><strong>clip-path标签</strong></p>
<p><clip-path>定义当前绘制的剪切路径，就是图像的一部分剪切下来。注意，clip-path只对当前的vector和group以及当前vector和group的孩子有效。这个标签仅有两个属性：</p>
<ul>
<li>android:name：clip-path的名字；</li>
<li>android:pathData：clip-path的路径。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">vector</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:width</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:height</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportHeight</span>=<span class="string">&quot;300.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportWidth</span>=<span class="string">&quot;300.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clip-path</span> <span class="attr">android:name</span>=<span class="string">&quot;clip_one&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">    M0 20a20 20 0 0 1 20 -20</span></span></span><br><span class="line"><span class="string"><span class="tag">    l260 0a20 20 0 0 1 20 20</span></span></span><br><span class="line"><span class="string"><span class="tag">    l0 260a20 20 0 0 1 -20 20</span></span></span><br><span class="line"><span class="string"><span class="tag">    l-260 0a20 20 0 0 1 -20 -20</span></span></span><br><span class="line"><span class="string"><span class="tag">    l0 -260&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;edge&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;h300v300h-300v-300</span></span></span><br><span class="line"><span class="string"><span class="tag">        M150 0 v300</span></span></span><br><span class="line"><span class="string"><span class="tag">        M0 150 h300&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/holo_green_light&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;@android:color/holo_red_dark&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeWidth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">clip-path</span> <span class="attr">android:name</span>=<span class="string">&quot;clip_two&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;M0 150h300v150h-300v-150&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;oval&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeLineCap</span>=<span class="string">&quot;round&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeLineJoin</span>=<span class="string">&quot;round&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:pathData</span>=<span class="string">&quot;M20 20 l260,260M280 20 l-260,260h100&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeColor</span>=<span class="string">&quot;#000000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeWidth</span>=<span class="string">&quot;15&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面代码定义了两个clip-path，其效果如图4所示。</p>
<p><img src="/images/drawable/1323444-1337064674f55b83.webp" alt="img"></p>
<p>图4.gif</p>
<p><strong>build.gradle中vectorDrawables.useSupportLibrary属性</strong></p>
<p>build.gradle中的vectorDrawables.useSupportLibrary默认是false，不设置为true的话会有什么问题吗？讨论这个问题也需要根据minSdkVersion具体分析：</p>
<ol>
<li><code>minSdkVersion&gt;=21</code>：这么高的API根本就不需要兼容包，仍然可以渲染矢量图；</li>
<li><code>minSdkVersion&lt;21</code>：不再使用矢量图兼容包，不能渲染矢量图，但是有趣的是vector标签仍然可以使用，低版本的API完全把VectorDrawable当作Drawable使用了，VectorDrawable的特性完全失效。原理是vector xml文件会生成对应的png文件，使用png方式渲染图片，和矢量图没有任何关系。值得注意的是生成的png图片size很小而且会忽略vector标签的android:tint属性(貌似只忽略这个属性，我试过vector标签的android:alpha属性在生成的png图片中仍然有效，生成的png文件目录是app&#x2F;build&#x2F;generated&#x2F;res&#x2F;pngs&#x2F;debug，minSdkVersion&gt;&#x3D;21或者vectorDrawables.useSupportLibrary&#x3D;true的话不会生成这些png图片)。而且path标签的color相关的属性不能引用colors.xml的值，<code>android:strokeColor=&quot;@android:color/holo_red_dark&quot;</code>这样写的话会编译失败，提示错误：<code>Can&#39;t process attribute android:strokeColor=&quot;@android:color/holo_red_dark&quot;: references to other resources are not supported by build-time PNG generation</code>，而只能写原生的16进制color值比如<code>android:strokeColor=&quot;#234aac&quot;</code>。</li>
</ol>
<p>想看具体信息请查看这篇<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://blog.stylingandroid.com/vectordrawable-png/">文章</a>。</p>
<p><strong>SVG实战</strong></p>
<p>我做的项目中一张扑克png资源大小2k左右，我试着用矢量图画这些扑克牌。代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">vector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:width</span>=<span class="string">&quot;400dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:height</span>=<span class="string">&quot;550dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportHeight</span>=<span class="string">&quot;550&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportWidth</span>=<span class="string">&quot;400.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">android:name</span>=<span class="string">&quot;poker_diamond_a&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;border&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeWidth</span>=<span class="string">&quot;7&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeColor</span>=<span class="string">&quot;#96999c&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/white&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:pathData</span>=<span class="string">&quot;M5 25a20 20 0 0 1 20 -20</span></span></span><br><span class="line"><span class="string"><span class="tag">            h350a20 20 0 0 1 20 20v500a20 20 0 0 1 -20 20h-350a20 20 0 0 1 -20 -20v-500&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeWidth</span>=<span class="string">&quot;8&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeColor</span>=<span class="string">&quot;#cc0000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeLineJoin</span>=<span class="string">&quot;bevel&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:pathData</span>=<span class="string">&quot;M40 120</span></span></span><br><span class="line"><span class="string"><span class="tag">            l40 -90</span></span></span><br><span class="line"><span class="string"><span class="tag">            l40 90</span></span></span><br><span class="line"><span class="string"><span class="tag">            l-16-35</span></span></span><br><span class="line"><span class="string"><span class="tag">            h-48&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;small_diamond&quot;</span> <span class="attr">android:fillColor</span>=<span class="string">&quot;#cc0000&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;M80 130l41 41l-41 41l-41 -41z&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;big_diamond&quot;</span> <span class="attr">android:fillColor</span>=<span class="string">&quot;#cc0000&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;M260 310l100 100l-100 100l-100 -100z&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="/images/drawable/1323444-2f3dc23aa919c927.webp" alt="img"></p>
<p>图5</p>
<p>代码很简单，只有4条path。border路径顺序是1-2-3-4-5-6-7-8-1， a的路径是a-b-c-d-e，small_diamond的路径是e-f-g-h，big_diamond的路径是i-j-k-l。这个xml文件只有1k。</p>
<p><strong>vector属性</strong></p>
<ol>
<li><code>android:alpha</code>：矢量图的透明度，范围0-1，默认1；</li>
<li><code>android:tint</code>：矢量图的颜色，这个颜色值会覆盖所有与color相关的属性比如path的fillColor和strokeColor等；这个属性会被API setColorFilter(ColorFilter)覆盖。</li>
<li><code>android:tintMode</code>：色彩混合模式，可选值有很多，下面详细讨论，默认src_in。</li>
<li><code>android:autoMirrored</code>：当布局方向变成right-to-left的时候，矢量图是否自动镜像，默认false，这个属性在API&gt;&#x3D;19才生效。</li>
</ol>
<p>关于tintMode，先看下PorterDuff这类的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PorterDuff</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PorterDuff</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Stub!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">Mode</span> &#123;</span><br><span class="line">        CLEAR, <span class="comment">/** [Sa, Sc] */</span></span><br><span class="line"></span><br><span class="line">        DST, <span class="comment">/** [Da, Dc] */</span></span><br><span class="line">        DST_ATOP, <span class="comment">/** [Sa, Sa * Dc + Sc * (1 - Da)] */</span></span><br><span class="line">        DST_IN, <span class="comment">/** [Sa * Da, Sa * Dc] */</span></span><br><span class="line">        DST_OUT, <span class="comment">/** [Da * (1 - Sa), Dc * (1 - Sa)] */</span></span><br><span class="line">        DST_OVER, <span class="comment">/** [Sa + (1 - Sa)*Da, Rc = Dc + (1 - Da)*Sc] */</span></span><br><span class="line"></span><br><span class="line">        SRC, <span class="comment">/** [Sa, Sc] */</span></span><br><span class="line">        SRC_ATOP, <span class="comment">/** [Da, Sc * Da + (1 - Sa) * Dc] */</span></span><br><span class="line">        SRC_IN, <span class="comment">/** [Sa * Da, Sc * Da] */</span></span><br><span class="line">        SRC_OUT, <span class="comment">/** [Sa * (1 - Da), Sc * (1 - Da)] */</span></span><br><span class="line">        SRC_OVER, <span class="comment">/** [Sa + (1 - Sa)*Da, Rc = Sc + (1 - Sa)*Dc] */</span></span><br><span class="line"></span><br><span class="line">        DARKEN, <span class="comment">/** [Sa + Da - Sa*Da, Sc*(1 - Da) + Dc*(1 - Sa) + min(Sc, Dc)] */</span></span><br><span class="line">        XOR, <span class="comment">/** [Sa + Da - 2 * Sa * Da, Sc * (1 - Da) + (1 - Sa) * Dc] */</span></span><br><span class="line">        LIGHTEN, <span class="comment">/** [Sa + Da - Sa*Da, Sc*(1 - Da) + Dc*(1 - Sa) + max(Sc, Dc)] */</span></span><br><span class="line">        MULTIPLY, <span class="comment">/** [Sa * Da, Sc * Dc] */</span></span><br><span class="line">        SCREEN, <span class="comment">/** [Sa + Da - Sa * Da, Sc + Dc - Sc * Dc] */</span></span><br><span class="line">        <span class="comment">/** Saturate(S + D) */</span></span><br><span class="line">        ADD,</span><br><span class="line">        OVERLAY;</span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">Mode</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先类名PorterDuff是什么意思呢？PorterDuff是两个人名的组合: Thomas Porter和Tom Duff，他们1984年在ACM SIGGRAPH计算机图形学发表论文《Compositing digital images》，最早提出图形混合概念，极大地推动了图形图像学的发展，有兴趣的同学可以自行查阅资料。</p>
<p><img src="/images/drawable/1323444-b5395a586d961d45.webp" alt="img"></p>
<p>图1</p>
<p>PorterDuff共有18个模式可选，但是<code>android:tintMode</code>可选值只有六个：MULTIPLY、SCREEN、ADD、SRC_ATOP、SRC_IN、SRC_OVER，(xml文件只提供这6个的原因我不知道，请大神留言告知)。当然想使用其余12个tintMode模式也是可以的，需要用代码调用API Drawable.setTintMode(PorterDuff.Mode)即可，可以达到相应tintMode的效果。</p>
<p>tint属性是Android 5.0引入的，Android 6.0又引入了drawableTint的属性。<br>Button和TextView等一些组件会多出下面6个属性：</p>
<p><img src="/images/drawable/1323444-3c875323de7fee46.webp" alt="img"></p>
<p>图2</p>
<p>ImageView会多出下面6个属性：</p>
<p><img src="/images/drawable/1323444-f33ae9d93bc59295.webp" alt="img"></p>
<p>图3</p>
<p><img src="/images/drawable/1323444-1a0a013e976eef37.webp" alt="img"></p>
<p>图4</p>
<p>我们对矢量图进行调色，先看效果如图4所示，图4中红色文字表示xml允许使用的6个tintMode。下面贴出代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line">// poker_a.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">vector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:width</span>=<span class="string">&quot;400dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:height</span>=<span class="string">&quot;550dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:tint</span>=<span class="string">&quot;@android:color/holo_purple&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportHeight</span>=<span class="string">&quot;550&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:viewportWidth</span>=<span class="string">&quot;400.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">android:name</span>=<span class="string">&quot;poker_diamond_a&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;border&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeWidth</span>=<span class="string">&quot;7&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeColor</span>=<span class="string">&quot;#96999c&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/white&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:pathData</span>=<span class="string">&quot;M5 25a20 20 0 0 1 20 -20</span></span></span><br><span class="line"><span class="string"><span class="tag">            h350a20 20 0 0 1 20 20v500a20 20 0 0 1 -20 20h-350a20 20 0 0 1 -20 -20v-500&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeWidth</span>=<span class="string">&quot;8&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeColor</span>=<span class="string">&quot;@android:color/holo_red_dark&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:strokeLineJoin</span>=<span class="string">&quot;bevel&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:pathData</span>=<span class="string">&quot;M40 120</span></span></span><br><span class="line"><span class="string"><span class="tag">            l40 -90</span></span></span><br><span class="line"><span class="string"><span class="tag">            l40 90</span></span></span><br><span class="line"><span class="string"><span class="tag">            l-16-35</span></span></span><br><span class="line"><span class="string"><span class="tag">            h-48&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;small_diamond&quot;</span> <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/holo_blue_dark&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;M80 130l41 41l-41 41l-41 -41z&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">android:name</span>=<span class="string">&quot;big_diamond&quot;</span> <span class="attr">android:fillColor</span>=<span class="string">&quot;@android:color/holo_green_dark&quot;</span> <span class="attr">android:pathData</span>=<span class="string">&quot;M260 310l100 100l-100 100l-100 -100z&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">&quot;width&quot;</span>&gt;</span>64dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">&quot;height&quot;</span>&gt;</span>88dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">// activity_main.xml</span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">&quot;5dp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:tint</span>=<span class="string">&quot;@android:color/transparent&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;@android:color/holo_purple&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/CLEAR&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;10dp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;5dp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DST&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DST_ATOP&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DST_IN&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DST_OUT&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DST_OVER&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;5dp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SRC&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SRC_ATOP&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SRC_IN&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SRC_OUT&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SRC_OVER&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;5dp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/DARKEN&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/XOR&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/LIGHTEN&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/MULTIPLY&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/SCREEN&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;5dp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/ADD&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/OVERLAY&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/width&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/height&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/poker_a&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;5dp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MainActivity.java代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MainActivity.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        AppCompatDelegate.setCompatVectorFromResourcesEnabled(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        ((ImageView) findViewById(R.id.CLEAR)).getDrawable().mutate().setTintMode(PorterDuff.Mode.CLEAR);</span><br><span class="line"></span><br><span class="line">        ((ImageView) findViewById(R.id.DST)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DST);</span><br><span class="line">        ((ImageView) findViewById(R.id.DST_ATOP)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DST_ATOP);</span><br><span class="line">        ((ImageView) findViewById(R.id.DST_IN)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DST_IN);</span><br><span class="line">        ((ImageView) findViewById(R.id.DST_OUT)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DST_OUT);</span><br><span class="line">        ((ImageView) findViewById(R.id.DST_OVER)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DST_OVER);</span><br><span class="line"></span><br><span class="line">        ((ImageView) findViewById(R.id.SRC)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SRC);</span><br><span class="line">        ((ImageView) findViewById(R.id.SRC_ATOP)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SRC_ATOP);</span><br><span class="line">        ((ImageView) findViewById(R.id.SRC_IN)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SRC_IN);</span><br><span class="line">        ((ImageView) findViewById(R.id.SRC_OUT)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SRC_OUT);</span><br><span class="line">        ((ImageView) findViewById(R.id.SRC_OVER)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SRC_OVER);</span><br><span class="line"></span><br><span class="line">        ((ImageView) findViewById(R.id.DARKEN)).getDrawable().mutate().setTintMode(PorterDuff.Mode.DARKEN);</span><br><span class="line">        ((ImageView) findViewById(R.id.XOR)).getDrawable().mutate().setTintMode(PorterDuff.Mode.XOR);</span><br><span class="line">        ((ImageView) findViewById(R.id.LIGHTEN)).getDrawable().mutate().setTintMode(PorterDuff.Mode.LIGHTEN);</span><br><span class="line">        ((ImageView) findViewById(R.id.MULTIPLY)).getDrawable().mutate().setTintMode(PorterDuff.Mode.MULTIPLY);</span><br><span class="line">        ((ImageView) findViewById(R.id.SCREEN)).getDrawable().mutate().setTintMode(PorterDuff.Mode.SCREEN);</span><br><span class="line"></span><br><span class="line">        ((ImageView) findViewById(R.id.ADD)).getDrawable().mutate().setTintMode(PorterDuff.Mode.ADD);</span><br><span class="line">        ((ImageView) findViewById(R.id.OVERLAY)).getDrawable().mutate().setTintMode(PorterDuff.Mode.OVERLAY);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>色彩混合涉及到两个对象，<strong>目标对象</strong>和<strong>源对象</strong>，这里的目标对象是poker_a.xml这个矢量图，源对象是tint设置的颜色值，为啥这样说呢，记着这个原则，先绘制的是目标对象，我们就是要对目标对象进行调色。对目标对象调色后的对象叫做<strong>复合对象</strong>。</p>
<p>有了这两个对象，怎么进行调色呢？这里有很多计算公式，公式中又有很多元素，先来看下这些元素：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* Sa：Source alpha，源对象的Alpha通道；</span><br><span class="line">* Sc：Source <span class="attribute">color</span>，源对象的颜色；</span><br><span class="line">* Da：Destination alpha，目标对象的Alpha通道；</span><br><span class="line">* Dc：Destination <span class="attribute">color</span>，目标对象的颜色；</span><br><span class="line">* <span class="selector-attr">[a，c]</span>：对象的ARGB值，<span class="selector-tag">a</span>表示alpha，c表示<span class="attribute">color</span>。</span><br></pre></td></tr></table></figure>

<p>下面对这18个tintMode进行剖析，该文受到<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d11892bbe055">这篇文章</a>的启发。<br><strong>CLEAR</strong><br>复合对象的ARGB值是[0，0]，完全透明，相当于清除画布上的图像了。</p>
<p><strong>DST</strong><br>[Da, Dc]，只保留目标对象的alpha和color值，因此绘制出来的只有目标对象，相当于根本就没有进行调色。<br><strong>DST_ATOP</strong><br>[Sa, Sa * Dc + Sc * (1 - Da)]，两者相交处绘制目标对象，不相交的地方绘制源对象，并且相交处的效果会受到源对象和目标对象alpha的影响。<br><strong>DST_IN</strong><br>[Sa * Da, Sa * Dc]，两者相交的地方绘制目标对象，不相交的地方不进行绘制，并且相交处的效果会受到源对象对应地方透明度的影响。<br><strong>DST_OUT</strong><br>[Da * (1 - Sa), Dc * (1 - Sa)]，两者不相交的地方绘制目标对象，相交处根据源对象alpha进行过滤，完全不透明处则完全过滤，完全透明则不过滤。(亲测正确)<br><strong>DST_OVER</strong><br>[Sa + (1 - Sa)*Da, Rc &#x3D; Dc + (1 - Da)*Sc]，目标对象绘制在源对象的上方。</p>
<p><strong>SRC</strong><br>[Sa, Sc]，只保留源对象的alpha和color，因此绘制出来只有源对象。<br><strong>SRC_ATOP</strong><br>[Da, Sc * Da + (1 - Sa) * Dc]，两者相交处绘制源对象，不相交的地方绘制目标对象，并且相交处的效果会受到源对象和目标对象alpha的影响。<br><strong>SRC_IN</strong><br>[Sa * Da, Sc * Da]，两者相交处绘制源对象，不相交的地方不进行绘制，并且相交处的效果会受到源对象对应地方透明度的影响。<br><strong>SRC_OUT</strong><br>[Sa * (1 - Da), Sc * (1 - Da)]，两者不相交的地方绘制源对象，相交处根据目标对象alpha进行过滤，完全不透明处则完全过滤，完全透明则不过滤。(亲测正确)<br><strong>SRC_OVER</strong><br>[Sa + (1 - Sa)*Da, Rc &#x3D; Sc + (1 - Sa)*Dc]，源对象绘制在目标对象的上方。</p>
<p><strong>DARKEN</strong><br>[Sa + Da - Sa<em>Da, Sc</em>(1 - Da) + Dc*(1 - Sa) + min(Sc, Dc)]，顾名思义，效果会变暗。进行对应像素比较，取较暗值(即较小值)，如果色值相同则进行混合；如果两个对象都完全不透明，取较暗值，否则使用上面算法进行计算，受到源对象和目标对象对应色值和alpha值影响。结果复合对象的alpha值会变大。<strong>XOR</strong>[Sa + Da - 2 * Sa * Da, Sc * (1 - Da) + (1 - Sa) * Dc]，不相交的地方按原样绘制源对象和目标对象，相交的地方受到对应alpha和颜色值影响，按公式进行计算，如果都完全不透明则相交处完全不绘制。<strong>LIGHTEN</strong>[Sa + Da - Sa<em>Da, Sc</em>(1 - Da) + Dc*(1 - Sa) + max(Sc, Dc)]，顾名思义，效果会变亮。进行对应像素比较，取较亮值(即较大值)，如果色值相同则进行混合；如果两个对象都完全不透明，取较亮值，否则使用上面算法进行计算，受到源对象和目标对象对应色值和alpha值影响。<br><strong>MULTIPLY</strong><br>[Sa * Da, Sc * Dc]，正片叠底，即查看每个通道中的颜色信息，目标色与源色复合。结果色总是较暗的颜色。任何颜色与黑色复合产生黑色，任何颜色与白色复合保持不变。(这个理论貌似和现实生活的颜色混合的结果不一致，现实生活中黄色和白色混合会是黄白色而不是白色)。<br><strong>SCREEN</strong><br>[Sa + Da - Sa * Da, Sc + Dc - Sc * Dc]，滤色模式，这个模式与我们所用的显示屏原理相同，因此也被翻译成屏幕模式；保留两个图层中较白的部分，较暗的部分被遮盖，图层中纯黑的部分变成完全透明，纯白部分完全不透明，其他的颜色根据颜色级别产生半透明的效果。</p>
<p><strong>ADD</strong><br>Saturate(S + D)，饱和度叠加<br><strong>OVERLAY</strong><br>算法同时进行进行 Multiply（正片叠底）混合还是 Screen（屏幕）混合，是进行 Multiply混合还是 Screen混合，取决于目标对象的颜色值，目标对象颜色的高光与阴影部分的亮度等细节会被保留。</p>
<p>这18个模式终于介绍完了，再次感谢<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d11892bbe055">这篇文章</a>的作者。</p>
<h3 id="path属性"><a href="#path属性" class="headerlink" title="path属性"></a>path属性</h3><ol>
<li><p>android:strokeLineCap：顾名思义，设置线条的帽子，round圆角、square正方形、butt臀，默认是butt；</p>
</li>
<li><p>android:strokeLineJoin：线条拐弯处的样式，round圆角、bevel斜角、miter斜切尖角，默认是miter；</p>
</li>
<li><p>android:strokeMiterLimit：android:strokeLineJoin为miter的时候这个属性才发挥作用。设置miter斜切尖角长度(用miter_length表示)与线条宽度(用line_width表示)比例值的上限，默认是4，strokeMiterLimit &#x3D; miter_length &#x2F; line_width，这个属性设定了这个比例的最大值，超过这个值的尖角不再显示尖角而是bevel斜角。</p>
<p><img src="/images/drawable/1323444-d79bdd8c46b1997f.webp" alt="img"></p>
<p>图5</p>
<p><img src="/images/drawable/1323444-680a02e956cc390d.webp" alt="img"></p>
<p>图6</p>
<p>如果你希望尖角多一些，就把这个属性设置大一些。在特别尖的拐弯处的点，点的这个比例可能大与strokeMiterLimit，那么就不显示尖角效果而是类似bevel斜角的效果，这样看起来不是很突兀，比较美观。</p>
<p>图5和图6来自</p>
<p>文章</p>
<p>；</p>
</li>
<li><p>android:trimPathStart：从路径起始位置截断路径的比率，取值范围0-1，默认0；</p>
</li>
<li><p>android:trimPathEnd：从路径结束位置截断路径的比率，取值范围0-1，默认1；</p>
</li>
<li><p>android:trimPathOffset：设置路径截取的偏移比例，取值范围0-1，默认0；<br>利用android:trimPathStart和android:trimPathEnd可以做一些入场和出场动画，<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/89efdbe01ac9">链接</a></p>
</li>
<li><p>android:fillType：API 24才引入的这个属性，取值nonZero和evenOdd，默认nonZero。</p>
</li>
</ol>
<p>关于<code>android:fillType</code>这个属性，需要花点篇幅讨论下。讨论这个属性之前，先看下代码及其对应的效果：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">vector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:height</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportHeight</span>=<span class="string">&quot;600&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportWidth</span>=<span class="string">&quot;600&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;noneZero&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeWidth</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;#B32D20&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;#3C8FC1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;M20 120 a100 100 0 1 1 200 0 a100 100 0 1 1 -200 0</span></span></span><br><span class="line"><span class="string"><span class="tag">            M40 120 a80 80 0 1 1 160 0 a80 80 0 1 1 -160 0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;evenOdd&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeWidth</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;#B32D20&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;#3C8FC1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillType</span>=<span class="string">&quot;evenOdd&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;M260 120 a100 100 0 1 1 200 0 a100 100 0 1 1 -200 0</span></span></span><br><span class="line"><span class="string"><span class="tag">            M280 120 a80 80 0 1 1 160 0 a80 80 0 1 1 -160 0&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="/images/drawable/1323444-1bc237196100deb1.webp" alt="img"></p>
<p>图7</p>
<p>代码中有两条path，前者的fillType是默认的noneZero，后者的fillType是evenOdd，除了这两个属性外，其余属性一模一样(name属性和M指令的起始位置为了显示的区别，忽略好吧😄)。两者的效果图如图7所示。fillType的原理是什么呢？为啥会导致这样的效果呢？</p>
<p>这里需要提一点，代码中每一条path都绘制了两个圆，四个圆的每一个圆都是通过两条a指令绘制完成的，如果你不清楚a指令的参数，请仔细看完<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0972a0d290e9">Android矢量图I–VectorDrawable基础</a>这篇文章并搞明白a指令后再回来看本文。这8条a指令的第5个参数都是1表示顺时针，请记住都是顺时针，因为fillType属性值noneZero跟path的方向有很大关系。</p>
<p>首先来看下默认的noneZero值。多看<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://en.wikipedia.org/wiki/Nonzero-rule">维基百科</a>，那里的解释最权威。<strong>有一个多边形C，我们判断是否要对C的子多边形C1形成的一块区域进行填充，那么先定义一个变量value&#x3D;0，根据value的值来决定是否对C1进行填充；在这个C1区域内任意选择一个点P，从这个点P向任意方向发射一条无限长的直线L，但是这个方向需要直线L与C1至少有一个交点，然后找出直线L与C所有的交点，每个交点处的方向是顺时针value++，顺时针value–，如果最后的value不是0，那么就对C1填充，否则不填充。</strong><br>如果你不明白上面粗体文字的含义，那就根据上面代码名字为noneZero这个path来分析下。这条path包含4个a指令，其实也就是4个形状为弧线的子path：弧线AB、弧线BA、弧线CD、弧线DC，相应地我们就要判断四块区域(outer_a、outer_b、inner_a、inner_b)是否要进行fill(填充，这里的填充默认是填充内部)。对于区域outer_a，我们在其内部选择任意一点P，从P发射一条无限长直线，直线需要与子多边形弧线AB相交至少一个点，该点是P1，直线与多边形C的交点是P1，是顺时针，value&#x3D;P1&#x3D;1，不为0，该区域填充；对于区域inner_a，我们在其内部选择任意一点R，从R发射一条无限长直线，直线需要与子多边形弧线CD相交至少一个点，该点是R1，直线与多边形C的交点是R1和R2，value&#x3D;R1+R1&#x3D;1+1&#x3D;2，不为0，该区域填充。如图8所示，</p>
<p><img src="/images/drawable/1323444-ed2a36d243eb82c1.webp" alt="img"></p>
<p>图8</p>
<p>为了加深下印象，再来举个例子。看下面的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">vector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:height</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportHeight</span>=<span class="string">&quot;600&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportWidth</span>=<span class="string">&quot;600&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeWidth</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;#B32D20&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;#3C8FC1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;M20 320 a100 100 0 1 0 200 0</span></span></span><br><span class="line"><span class="string"><span class="tag">            M40 320 a80 80 0 1 1 160 0 a80 80 0 1 1 -160 0&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="/images/drawable/1323444-1e54785f1036c7fb.webp" alt="img"></p>
<p>图9</p>
<p>你运行上面的代码，不出问题的矢量图应该如图9所示。代码首先从A到B逆时针绘制椭圆弧，然后从C到D顺时针绘制椭圆弧，最后从D到C顺时针绘制椭圆弧。最终的多边形C包含三个子区域outer_a、inner_a、inner_b。对于outer_a，其value&#x3D;P&#x3D;-1，非0那就填充；对于inner_a，其value&#x3D;Q1&#x3D;1，非0那就填充；对于inner_b，其value&#x3D;R1+R2&#x3D;1+(-1)&#x3D;0，0那就不填充。</p>
<p>如果你已经明白了noneZero，那么evenOdd就非常非常简单了，先看<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://en.wikipedia.org/wiki/Even%E2%80%93odd_rule">维基百科</a>，它与指针方向没有关系了，一句话你就能明白：<strong>如果虚拟直线与多边形C的交点数目为奇数就填充内部，偶数就不填充内部</strong>。如果还不明白，就举个例子，看代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">vector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:height</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportHeight</span>=<span class="string">&quot;600&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:viewportWidth</span>=<span class="string">&quot;600&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeWidth</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:strokeColor</span>=<span class="string">&quot;#B32D20&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillColor</span>=<span class="string">&quot;#3C8FC1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fillType</span>=<span class="string">&quot;evenOdd&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pathData</span>=<span class="string">&quot;M20 320 a100 100 0 1 0 200 0</span></span></span><br><span class="line"><span class="string"><span class="tag">            M40 320 a80 80 0 1 1 160 0 a80 80 0 1 1 -160 0&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面代码的结果也是如图9所示，那么拿图9来解释：对于outer_a，其只有一个交点P，奇数那就填充；对于inner_a，其只有一个交点Q，奇数那就填充；对于inner_b，有两个交点R1和R2，偶数那就不填充。</p>
<p>怀着紧张的心情，fillType属性终于介绍了完了，真害怕写错而误导读者，如果有错误的地方或者有更好的分析方法，请大神批评指正。这里有两篇文章，帮助理解fillType：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ce808a9e7e38">文章1</a>、<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://blog.csdn.net/freshforiphone/article/details/8273023">文章2</a>。再说一点，<strong>如果你是用tint属性对矢量图进行调色，注意fillType属性值会对结果造成同样的影响</strong>。<br>最后，你如果查看Paint类的内部类FillType的源码，会发现还有另外两种fillType：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Enum for the ways a path may be filled.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">FillType</span> &#123;</span><br><span class="line">        <span class="comment">// these must match the values in SkPath.h</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Specifies that &quot;inside&quot; is computed by a non-zero sum of signed</span></span><br><span class="line"><span class="comment">         * edge crossings.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">WINDING</span>         (<span class="number">0</span>),</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Specifies that &quot;inside&quot; is computed by an odd number of edge</span></span><br><span class="line"><span class="comment">         * crossings.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">EVEN_ODD</span>        (<span class="number">1</span>),</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Same as &#123;@link #WINDING&#125;, but draws outside of the path, rather than inside.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">INVERSE_WINDING</span> (<span class="number">2</span>),</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Same as &#123;@link #EVEN_ODD&#125;, but draws outside of the path, rather than inside.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">INVERSE_EVEN_ODD</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">FillType</span>(<span class="type">int</span> ni) &#123;</span><br><span class="line">            nativeInt = ni;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> nativeInt;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>对这另外两种fillType，Google程序员的注释已经解释的很清楚了，我就不解释了，否则可能越解释越乱，越乱越糊涂。</p>
<h2 id="mipmap"><a href="#mipmap" class="headerlink" title="mipmap"></a>mipmap</h2><blockquote>
<p>我们创建新项目时，它会帮助我们自动生成六个文件夹(密度不同)：</p>
<ul>
<li>drawable-ldpi （low:120dip）</li>
<li>drawable</li>
<li>drawable-mdpi （medium:160dip）</li>
<li>drawable-hdpi （high :240dip）</li>
<li>drawable-xhdpi （xhigh :320dip）</li>
<li>drawable-xxhdpi （xxhigh:480dip）</li>
</ul>
</blockquote>
<p>一般的做法是，将图片等资源放在drawable-hdip中，将一些和XML文件相关的内容（图片选择器、文字颜色选择器、自定义形状等）放在drawable中。</p>
<p>Google推荐：<strong>像素使用dip，文字使用sp</strong>。并且没有推荐图片放在mipmap中。</p>
<p>在mdip文件夹，1dip&#x3D;1px。</p>
<p>关于dp,dip,sp,pt,px的区别，可参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/carter_yu/article/details/50421787#1">附录一</a>。</p>
<p>关于图片在不同目录下的显示举例，可参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/carter_yu/article/details/50421787#2">附录二</a>。</p>
<p>官方解释：<br>mipmap——用于存放原生图片（图ic_launcher.png），缩放上有性能优化;<br>drawable——存放图片、xml，和Eclipse没有区别；</p>
<p><strong>附录一</strong></p>
<blockquote>
<p><strong>dip</strong> : device independent pixels(设备独立像素). 不同设备有不同的显示效果,这个和设备硬件有关，一般我们为了支持WVGA、HVGA和QVGA 推荐使用这个，不依赖像素。</p>
<p><strong>dp</strong> : 和dip相同。</p>
<p><strong>px</strong> : pixels(像素)，一个像素通常被视为图像的最小的完整采样，不同设备显示效果相同，一般我们HVGA代表320x480像素，这个用的比较多。</p>
<p><strong>pt</strong> : point，是一个标准的长度单位，1pt＝1&#x2F;72英寸，用于印刷业，非常简单易用。</p>
<p><strong>sp</strong> : scaled pixels(放大像素). 主要用于字体显示best for textsize。</p>
<p><strong>in</strong> ：（英寸）：长度单位。</p>
<p><strong>分辨率</strong> ：分为<strong>显示分辨率（屏幕分辨率）</strong>和<strong>图像分辨率</strong>。</p>
<p>显示分辨率：屏幕图像的精密度，是指显示器所能显示的像素有多少。显示器可 显示的像素越多，画面就越精细。显示分辨率一定的情况下，显示屏越小图像越清晰，反之，显示屏大小固定时，显示分辨率越高图像越清晰。</p>
<p>图象分辨率 ：单位英寸中所包含的像素点数。</p>
</blockquote>
<p><strong>换算公式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">float</span> <span class="title function_">applyDimension</span><span class="params">(<span class="type">int</span> unit, <span class="type">float</span> value,</span></span><br><span class="line"><span class="params">   DisplayMetrics metrics)</span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (unit) &#123;</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_PX:</span><br><span class="line">         <span class="keyword">return</span> value;</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_DIP:</span><br><span class="line">         <span class="keyword">return</span> value * metrics.density;</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_SP:</span><br><span class="line">         <span class="keyword">return</span> value * metrics.scaledDensity;</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_PT:</span><br><span class="line">         <span class="keyword">return</span> value * metrics.xdpi * (<span class="number">1.0f</span>/<span class="number">72</span>);</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_IN:</span><br><span class="line">         <span class="keyword">return</span> value * metrics.xdpi;</span><br><span class="line">     <span class="keyword">case</span> COMPLEX_UNIT_MM:</span><br><span class="line">         <span class="keyword">return</span> value * metrics.xdpi * (<span class="number">1.0f</span>/<span class="number">25.4f</span>);</span><br><span class="line">     &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>附录二</p>
<blockquote>
<p>mdpi与hdpi是2：3的关系<br>mdpi与xhdpi是1：2的关系<br>ldpi 与mdpi是3：4的关系</p>
<p>dp与px换算公式：</p>
<p>pixs &#x3D;dips * (densityDpi&#x2F;160).</p>
<p>dips&#x3D;(pixs*160)&#x2F;densityDpi</p>
</blockquote>
<p>现在假设，在一个项目中，你将一张60px<em>60px的图片放到mdpi中，它的大小是60</em>60；</p>
<p>若把它拿到hdpi中，那么它的大小应该是40*40，图片缩小。</p>
<p><strong>结论：</strong><br><strong>mipmap仅仅用于应用启动图标，可以根据不同分辨率进行优化。其他的图标资源，还是要放到drawable文件夹中。</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/01/19/android_layout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/19/android_layout/" class="post-title-link" itemprop="url">layout</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-19 08:41:06" itemprop="dateCreated datePublished" datetime="2020-01-19T08:41:06Z">2020-01-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-13 09:13:26" itemprop="dateModified" datetime="2022-11-13T09:13:26Z">2022-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>android-布局介绍</p>
<h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><h3 id="一．基本理论"><a href="#一．基本理论" class="headerlink" title="一．基本理论"></a>一．基本理论</h3><p>Android六大基本布局分别是<br>线性布局LinearLayout、表格布局TableLayout、相对布局RelativeLayout、<br>层布局FrameLayout、绝对布局AbsoluteLayout、网格布局GridLayout。<br>其中，表格布局是线性布局的子类。<br>在手机程序设计中，绝对布局基本上不用，用得相对较多的是线性布局和相对布局。</p>
<p>学习基本布局要理解两个比较基础概念的图：<br>（一）Android布局管理器的类图<br><img src="/images/layout/1152574-20170608110040887-334790846.png"></p>
<p>上面这个类图只是说了六大基本布局的关系，其实ViewGroup还有其他一些布局管理器。<br>这里要理解一点就是布局也是布局管理器，因为布局里面还可以添加布局。</p>
<p>（二）Android布局的XML关系图<br><img src="/images/layout/1152574-20170608110104247-1881733141.png"></p>
<p>布局管理器里面既可以添加多个布局管理器又可以添加多个控件，而控件里面不能在添加布局或控件了。</p>
<h3 id="二-各个布局的使用"><a href="#二-各个布局的使用" class="headerlink" title="二.各个布局的使用"></a>二.各个布局的使用</h3><h4 id="（一）线性布局"><a href="#（一）线性布局" class="headerlink" title="（一）线性布局"></a>（一）线性布局</h4><p>线性布局在开发中使用最多，具有垂直方向与水平方向的布局方式，通过设置属性“android:orientation”控制方向，属性值垂直（vertical）和水平(horizontal)，默认水平方向。</p>
<ol>
<li>android:gravity：内部控件对齐方式，常用属性值有center、center_vertical、center_horizontal、top、bottom、left、right等。<br>这个属性在布局组件RelativeLayout、TableLayout中也有使用，FrameLayout、AbsoluteLayout则没有这个属性。</li>
<li>center：居中显示，这里并不是表示显示在LinearLayout的中心，当LinearLayout线性方向为垂直方向时，center表示水平居中，但是并不能垂直居中，此时等同于center_horizontal的作用；同样当线性方向为水平方向时，center表示垂直居中，等同于center_vertical。</li>
<li>top、bottom、left、right顾名思义为内部控件居顶、低、左、右布局。<br>这里要与android:layout_gravity区分开，layout_gravity是用来设置自身相对于父元素的布局。</li>
<li>android:layout_weight：权重，用来分配当前控件在剩余空间的大小。<br>使用权重一般要把分配该权重方向的长度设置为零，比如在水平方向分配权重，就把width设置为零。</li>
</ol>
<h4 id="（二）RelativeLayout"><a href="#（二）RelativeLayout" class="headerlink" title="（二）RelativeLayout"></a>（二）RelativeLayout</h4><p>相对布局可以让子控件相对于兄弟控件或父控件进行布局，可以设置子控件相对于兄弟控件或父控件进行上下左右对齐。<br>RelativeLayout能替换一些嵌套视图，当我们用LinearLayout来实现一个简单的布局但又使用了过多的嵌套时，就可以考虑使用RelativeLayout重新布局。<br>相对布局就是一定要加Id才能管理。</p>
<p>RelativeLayout中子控件常用属性：</p>
<ol>
<li>相对于父控件，例如：android:layout_alignParentTop&#x3D;“true”<br>android:layout_alignParentTop      控件的顶部与父控件的顶部对齐;<br>android:layout_alignParentBottom  控件的底部与父控件的底部对齐;<br>android:layout_alignParentLeft      控件的左部与父控件的左部对齐;<br>android:layout_alignParentRight     控件的右部与父控件的右部对齐;</li>
<li>相对给定Id控件，例如：android:layout_above&#x3D;“@id&#x2F;**”<br>android:layout_above 控件的底部置于给定ID的控件之上;<br>android:layout_below     控件的底部置于给定ID的控件之下;<br>android:layout_toLeftOf    控件的右边缘与给定ID的控件左边缘对齐;<br>android:layout_toRightOf  控件的左边缘与给定ID的控件右边缘对齐;<br>android:layout_alignBaseline  控件的baseline与给定ID的baseline对齐;<br>android:layout_alignTop     控件的顶部边缘与给定ID的顶部边缘对齐;<br>android:layout_alignBottom   控件的底部边缘与给定ID的底部边缘对齐;<br>android:layout_alignLeft       控件的左边缘与给定ID的左边缘对齐;<br>android:layout_alignRight      控件的右边缘与给定ID的右边缘对齐;</li>
<li>居中，例如：android:layout_centerInParent&#x3D;“true”<br>android:layout_centerHorizontal 水平居中;<br>android:layout_centerVertical    垂直居中;<br>android:layout_centerInParent  父控件的中央;</li>
</ol>
<h4 id="（三）FrameLayout"><a href="#（三）FrameLayout" class="headerlink" title="（三）FrameLayout"></a>（三）FrameLayout</h4><p>帧布局或叫层布局，从屏幕左上角按照层次堆叠方式布局，后面的控件覆盖前面的控件。<br>该布局在开发中设计地图经常用到，因为是按层次方式布局，我们需要实现层面显示的样式时就可以<br>采用这种布局方式，比如我们要实现一个类似百度地图的布局，我们移动的标志是在一个图层的上面。<br>在普通功能的软件设计中用得也不多。层布局主要应用就是地图方面。</p>
<h4 id="（四）AbsoluteLayout"><a href="#（四）AbsoluteLayout" class="headerlink" title="（四）AbsoluteLayout"></a>（四）AbsoluteLayout</h4><p> 绝对布局中将所有的子元素通过设置android:layout_x 和 android:layout_y属性，将子元素的坐标位置固定下来，即坐标(android:layout_x, android:layout_y) ，layout_x用来表示横坐标，layout_y用来表示纵坐标。屏幕左上角为坐标(0,0)，横向往右为正方，纵向往下为正方。实际应用中，这种布局用的比较少，因为Android终端一般机型比较多，各自的屏幕大小。分辨率等可能都不一样，如果用绝对布局，可能导致在有的终端上显示不全等。</p>
<h4 id="（五）TableLayout"><a href="#（五）TableLayout" class="headerlink" title="（五）TableLayout"></a>（五）TableLayout</h4><p>表格布局，适用于多行多列的布局格式，每个TableLayout是由多个TableRow组成，一个TableRow就表示TableLayout中的每一行，这一行可以由多个子元素组成。实际上TableLayout和TableRow都是LineLayout线性布局的子类。但是TableRow的参数android:orientation属性值固定为horizontal，且android:layout_width&#x3D;MATCH_PARENT，android:layout_height&#x3D;WRAP_CONTENT。所以TableRow实际是一个横向的线性布局，且所以子元素宽度和高度一致。</p>
<ul>
<li>++注意：在TableLayout中，单元格可以为空，但是不能跨列，意思是只能不能有相邻的单元格为空。++</li>
</ul>
<p>TableLayout常用属性：</p>
<ol>
<li>android:shrinkColumns：设置可收缩的列，内容过多就收缩显示到第二行</li>
<li>android:stretchColumns：设置可伸展的列，将空白区域填充满整个列</li>
<li>android:collapseColumns：设置要隐藏的列<br>列的索引从0开始，shrinkColumns和stretchColumns可以同时设置。</li>
</ol>
<p>子控件常用属性：</p>
<ol>
<li>android:layout_column：第几列</li>
<li>android:layout_span：占据列数<br>屏幕中心是一个类似Material布局，底部是一个页面切换的导航栏。底部布局通过设置android:stretchColumns&#x3D;”0,1,2,3″来让四个按钮同样大小显示并填充到整个宽度，中心区域主要使用android:stretchColumns&#x3D;”0,1,2″填充显示以及android:layout_span&#x3D;”2″控制大内容跨列显示。</li>
</ol>
<h4 id="（六）GridLayout-网格布局"><a href="#（六）GridLayout-网格布局" class="headerlink" title="（六）GridLayout(网格布局)"></a>（六）GridLayout(网格布局)</h4><p>作为android 4.0 后新增的一个布局,与前面介绍过的TableLayout(表格布局)其实有点大同小异;<br>不过新增了一些东东</p>
<ol>
<li>跟LinearLayout(线性布局)一样,他可以设置容器中组件的对齐方式</li>
<li>容器中的组件可以跨多行也可以跨多列(相比TableLayout直接放组件,占一行相比较)</li>
</ol>
<p>常用属性:<br>排列对齐:</p>
<ol>
<li>设置组件的排列方式:   android:orientation&#x3D;””     vertical(竖直,默认)或者horizontal(水平)</li>
<li>设置组件的对齐方式:   android:layout_gravity&#x3D;””   center,left,right,buttom</li>
</ol>
<p>设置布局为几行几列:</p>
<ol>
<li>设置有多少行: android:rowCount&#x3D;”4”        &#x2F;&#x2F;设置网格布局有4行</li>
<li>设置有多少列: android:columnCount&#x3D;”4”    &#x2F;&#x2F;设置网格布局有4列</li>
</ol>
<p>设置某个组件位于几行几列<br>注:都是从0开始算的哦！</p>
<ol>
<li>组件在第几行: android:layout_row &#x3D; “1”   &#x2F;&#x2F;设置组件位于第二行 </li>
<li>组件在第几列: android:layout_column &#x3D; “2”   &#x2F;&#x2F;设置该组件位于第三列</li>
</ol>
<p>设置某个组件横跨几行几列:</p>
<ol>
<li>横跨几行: android:layout_rowSpan &#x3D; “2”     &#x2F;&#x2F;纵向横跨2行</li>
<li>横跨几列: android:layout_columnSpan &#x3D; “3”     &#x2F;&#x2F;横向横跨2列</li>
</ol>
<p>这里要说明一点: </p>
<p>通过android:layout_rowSpan和android:layout_columnSpan设置表明组件横越的行数与列数<br>再通过:android:layout_gravity &#x3D; “fill”  设置表明组件填满所横越的整行或者整列</p>
<p>用法总结:</p>
<ol>
<li>GridLayout使用虚细线将布局划分为行,列和单元格,同时也支持在行,列上进行交错排列</li>
<li>使用流程:</li>
</ol>
<p>step 1. 先定义组件的对其方式 android:orientation  水平或者竖直 </p>
<p>step 2. 设置组件所在的行或者列,记得是从0开始算的</p>
<p>step 3. 设置组件横跨几行或者几列;设置完毕后,需要在设置一个填充:android:layout_gravity &#x3D; “fill”</p>
<p>可能遇到的问题:<br>当读者将布局设置为GridLayout时,会出现 莫名其妙的报错,<br>如果代码语法逻辑没有错的话,就可能是配置文件 AndroidManifest.xml 的问题了<br>因为GridLayout是android 4.0 后才推出的,API Level 为 14<br>只需要将配置文件中的 MinSDK改成14或者以上版本 即可,保存,问题就解决了！</p>
<p>除上面讲过之外常用的几个布局的属性：</p>
<ol>
<li>layout_margin<br>用于设置控件边缘相对于父控件的边距<br>android:layout_marginLeft<br>android:layout_marginRight<br>android:layout_marginTop<br>android:layout_marginBottom</li>
<li>layout_padding<br>用于设置控件内容相对于控件边缘的边距<br>android:layout_paddingLeft<br>android:layout_paddingRight<br>android:layout_paddingTop<br>android:layout_paddingBottom</li>
<li>layout_width&#x2F;height<br>用于设置控件的高度和宽度<br>wrap_content 内容包裹，表示这个控件的里面文字大小填充<br>fill_parent 跟随父窗口<br>match_parent</li>
<li>gravity<br>用于设置View组件里面内容的对齐方式<br>top bottom left   right  center等</li>
<li>android:layout_gravity<br>用于设置Container组件的对齐方式<br>android:layout_alignTop 本元素的上边缘和某元素的的上边缘对齐<br>android:layout_alignLeft 本元素的左边缘和某元素的的左边缘对齐<br>android:layout_alignBottom 本元素的下边缘和某元素的的下边缘对齐<br>android:layout_alignRight 本元素的右边缘和某元素的的右边缘对齐</li>
</ol>
<h2 id="1、约束布局ConstraintLayout"><a href="#1、约束布局ConstraintLayout" class="headerlink" title="1、约束布局ConstraintLayout"></a>1、约束布局ConstraintLayout</h2><h3 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h3><p><strong>约束布局ConstraintLayout</strong> 是一个ViewGroup，可以在Api9以上的Android系统使用它，它的出现主要是为了解决布局嵌套过多的问题，以灵活的方式定位和调整小部件。从 <strong>Android Studio 2.3</strong> 起，官方的模板默认使用 <strong>ConstraintLayout</strong>。</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/support/constraint/ConstraintLayout">官方文档</a></p>
<h3 id="2、为什么要用ConstraintLayout"><a href="#2、为什么要用ConstraintLayout" class="headerlink" title="2、为什么要用ConstraintLayout"></a>2、为什么要用ConstraintLayout</h3><p>在开发过程中经常能遇到一些复杂的UI，可能会出现布局嵌套过多的问题，嵌套得越多，设备绘制视图所需的时间和计算功耗也就越多。简单举个例子：</p>
<p><img src="/images/layout/2787721-b5e910f1c786ac4b.webp" alt="img"></p>
<p>假设现在要写一个这样的布局，可能有人会这么写：<br>首先是一个垂直的LinearLayout，里面放两个水平的LinearLayout，然后在水平的LinearLayout里面放TextView。这样的写法就嵌套了两层LinearLayout。</p>
<p><img src="/images/layout/2787721-09649fba48add621.webp" alt="img"></p>
<p>有些人考虑到了嵌套布局带来的风险，所以用一个RelativeLayout来装下所有的控件。那么问题来了，既然用RelativeLayout可以解决问题，为什么还要使用ConstraintLayout呢？因为ConstraintLayout使用起来比RelativeLayout更灵活，性能更出色！还有一点就是ConstraintLayout可以按照比例约束控件位置和尺寸，能够更好地适配屏幕大小不同的机型。</p>
<h3 id="3-如何使用ConstraintLayout"><a href="#3-如何使用ConstraintLayout" class="headerlink" title="3.如何使用ConstraintLayout"></a>3.如何使用ConstraintLayout</h3><h4 id="3-1-添加依赖"><a href="#3-1-添加依赖" class="headerlink" title="3.1 添加依赖"></a>3.1 添加依赖</h4><p>首先我们需要在app&#x2F;build.gradle文件中添加ConstraintLayout的依赖，如下所示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;com.android.support.constraint:constraint-layout:1.1.3&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-相对定位"><a href="#3-2-相对定位" class="headerlink" title="3.2 相对定位"></a>3.2 相对定位</h4><p>相对定位是部件对于另一个位置的约束，这么说可能有点抽象，举个例子：</p>
<p><img src="/images/layout/2787721-ff2d4c4b39b9e98b.webp" alt="img"></p>
<p>如图所示，TextView2在TextView1的右边，TextView3在TextView1的下面，这个时候在布局文件里面应该这样写：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;TextView1&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView2&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/TextView1&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView3&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@+id/TextView1&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面代码中在TextView2里用到了app:layout_constraintLeft_toRightOf&#x3D;”@+id&#x2F;TextView1”这个属性，他的意思是把TextView2的左边约束到TextView1的右边，如下图所示：</p>
<p><img src="/images/layout/2787721-8087344ad8a0d40c.webp" alt="img"></p>
<p>同理TextView3在TextView1的下面，就需要用到app:layout_constraintTop_toBottomOf&#x3D;”@+id&#x2F;TextView1”，即把TextView3的上面约束到TextView1的下面。</p>
<p>下面来看看相对定位的常用属性：</p>
<ul>
<li>layout_constraintLeft_toLeftOf</li>
<li>layout_constraintLeft_toRightOf</li>
<li>layout_constraintRight_toLeftOf</li>
<li>layout_constraintRight_toRightOf</li>
<li>layout_constraintTop_toTopOf</li>
<li>layout_constraintTop_toBottomOf</li>
<li>layout_constraintBottom_toTopOf</li>
<li>layout_constraintBottom_toBottomOf</li>
<li>layout_constraintBaseline_toBaselineOf</li>
<li>layout_constraintStart_toEndOf</li>
<li>layout_constraintStart_toStartOf</li>
<li>layout_constraintEnd_toStartOf</li>
<li>layout_constraintEnd_toEndOf</li>
</ul>
<p>上面属性中有一个比较有趣的layout_constraintBaseline_toBaselineOf<br><strong>Baseline</strong>指的是文本基线，举个例子：</p>
<p><img src="/images/layout/2787721-815cc21cdfaa018c.webp" alt="img"></p>
<p>如图所示，两个TextView的高度不一致，但是又希望他们文本对齐，这个时候就可以使用layout_constraintBaseline_toBaselineOf，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView2&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/TextView1&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintBaseline_toBaselineOf</span>=<span class="string">&quot;@+id/TextView1&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/images/layout/2787721-aebcad66710f4d48.webp" alt="img"></p>
<p>ConstraintLayout相对定位的用法跟RelativeLayout还是比较相似的，下面用一个图来总结相对定位：</p>
<p><img src="/images/layout/2787721-76a3c17fa604a7bf.webp" alt="img"></p>
<h4 id="3-3-角度定位"><a href="#3-3-角度定位" class="headerlink" title="3.3 角度定位"></a>3.3 角度定位</h4><p>角度定位指的是可以用一个角度和一个距离来约束两个空间的中心。举个例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView2&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintCircle</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintCircleAngle</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintCircleRadius</span>=<span class="string">&quot;150dp&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面例子中的TextView2用到了3个属性：<br>app:layout_constraintCircle&#x3D;”@+id&#x2F;TextView1”<br>app:layout_constraintCircleAngle&#x3D;”120”（角度）<br>app:layout_constraintCircleRadius&#x3D;”150dp”（距离）<br>指的是TextView2的中心在TextView1的中心的120度，距离为150dp，效果如下：</p>
<p><img src="/images/layout/2787721-8e87f3b229af0add.webp" alt="img"></p>
<h4 id="3-4-边距"><a href="#3-4-边距" class="headerlink" title="3.4 边距"></a>3.4 边距</h4><ul>
<li>3.4.1 常用margin</li>
</ul>
<p>ConstraintLayout的边距常用属性如下：<br>android:layout_marginStart<br>android:layout_marginEnd<br>android:layout_marginLeft<br>android:layout_marginTop<br>android:layout_marginRight<br>android:layout_marginBottom</p>
<p>看起来跟别的布局没有什么差别，但实际上控件在ConstraintLayout里面要实现margin，必须先约束该控件在ConstraintLayout里的位置，举个例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果在别的布局里，TextView1的位置应该是距离边框的左边和上面有一个10dp的边距，但是在ConstraintLayout里，是不生效的，因为没有约束TextView1在布局里的位置。正确的写法如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>把TextView1的左边和上边约束到parent的左边和上边，这样margin就会生效，效果如下：</p>
<p><img src="/images/layout/2787721-39397d6075ee9ea6.webp" alt="img"></p>
<p>在使用margin的时候要注意两点：<br>控件必须在布局里约束一个相对位置<br>margin只能大于等于0</p>
<ul>
<li>3.4.2 goneMargin</li>
</ul>
<p>goneMargin主要用于约束的控件可见性被设置为gone的时候使用的margin值，属性如下：<br>layout_goneMarginStart<br>layout_goneMarginEnd<br>layout_goneMarginLeft<br>layout_goneMarginTop<br>layout_goneMarginRight<br>layout_goneMarginBottom</p>
<p>举个例子：<br>假设TextView2的左边约束在TextView1的右边，并给TextView2设一个app:layout_goneMarginLeft&#x3D;”10dp”，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_goneMarginLeft</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如下，TextView2在TextView1的右边，且没有边距。</p>
<p><img src="/images/layout/2787721-70c5cdeb5790fe23.webp" alt="img"></p>
<p>这个时候把TextView1的可见性设为gone，效果如下：</p>
<p><img src="/images/layout/2787721-e6276e3d70792670.webp" alt="img"></p>
<p>TextView1消失后，TextView2有一个距离左边10dp的边距。</p>
<h4 id="3-5-居中和偏移"><a href="#3-5-居中和偏移" class="headerlink" title="3.5 居中和偏移"></a>3.5 居中和偏移</h4><p>在RelativeLayout中，把控件放在布局中间的方法是把layout_centerInParent设为true，而在ConstraintLayout中的写法是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app:layout_constraintBottom_toBottomOf=<span class="string">&quot;parent&quot;</span></span><br><span class="line">app:layout_constraintLeft_toLeftOf=<span class="string">&quot;parent&quot;</span></span><br><span class="line">app:layout_constraintRight_toRightOf=<span class="string">&quot;parent&quot;</span></span><br><span class="line">app:layout_constraintTop_toTopOf=<span class="string">&quot;parent&quot;</span></span><br></pre></td></tr></table></figure>

<p>意思是把控件的上下左右约束在布局的上下左右，这样就能把控件放在布局的中间了。同理RelativeLayout中的水平居中layout_centerHorizontal相当于在ConstraintLayout约束控件的左右为parent的左右；RelativeLayout中的垂直居中layout_centerVertical相当于在ConstraintLayout约束控件的上下为parent的上下。<br>由于ConstraintLayout中的居中已经为控件约束了一个相对位置，所以可以使用margin，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/images/layout/2787721-873d51f267e9a522.webp" alt="img"></p>
<p>上面TextView1在水平居中后使用layout_marginLeft&#x3D;”100dp”向右偏移了100dp。除了这种偏移外，ConstraintLayout还提供了另外一种偏移的属性：<br>layout_constraintHorizontal_bias 水平偏移<br>layout_constraintVertical_bias 垂直偏移</p>
<p>举个例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/images/layout/2787721-7bf04a9426419338.webp" alt="img"></p>
<p>假如现在要实现水平偏移，给TextView1的layout_constraintHorizontal_bias赋一个范围为 0-1 的值，假如赋值为0，则TextView1在布局的最左侧，假如赋值为1，则TextView1在布局的最右侧，假如假如赋值为0.5，则水平居中，假如假如赋值为0.3，则更倾向于左侧。<br>垂直偏移同理。</p>
<h4 id="3-6-尺寸约束"><a href="#3-6-尺寸约束" class="headerlink" title="3.6 尺寸约束"></a>3.6 尺寸约束</h4><p>控件的尺寸可以通过四种不同方式指定：</p>
<ul>
<li>使用指定的尺寸</li>
<li>使用wrap_content，让控件自己计算大小<br>当控件的高度或宽度为wrap_content时，可以使用下列属性来控制最大、最小的高度或宽度：<br>android:minWidth 最小的宽度<br>android:minHeight 最小的高度<br>android:maxWidth 最大的宽度<br>android:maxHeight 最大的高度<br>注意！当ConstraintLayout为1.1版本以下时，使用这些属性需要加上强制约束，如下所示：<br>app:constrainedWidth&#x3D;”true”<br>app:constrainedHeight&#x3D;”true”</li>
<li>使用 0dp (MATCH_CONSTRAINT)<br>官方不推荐在ConstraintLayout中使用match_parent，可以设置 0dp (MATCH_CONSTRAINT) 配合约束代替match_parent，举个例子：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;50dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:visibility</span>=<span class="string">&quot;visible&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>宽度设为0dp，左右两边约束parent的左右两边，并设置左边边距为50dp，效果如下：</p>
<p><img src="/images/layout/2787721-12b8f6492831ba1c.webp" alt="img"></p>
<ul>
<li>宽高比<br>当宽或高至少有一个尺寸被设置为0dp时，可以通过属性layout_constraintDimensionRatio设置宽高比，举个例子：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintDimensionRatio</span>=<span class="string">&quot;1:1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>宽设置为0dp，宽高比设置为1:1，这个时候TextView1是一个正方形，效果如下：</p>
<p><img src="/images/layout/2787721-a0f8950a52341b11.webp" alt="img"></p>
<p>除此之外，在设置宽高比的值的时候，还可以在前面加W或H，分别指定宽度或高度限制。 例如：<br>app:layout_constraintDimensionRatio&#x3D;”H,2:3”指的是 高:宽&#x3D;2:3<br>app:layout_constraintDimensionRatio&#x3D;”W,2:3”指的是 宽:高&#x3D;2:3</p>
<h4 id="3-7-链"><a href="#3-7-链" class="headerlink" title="3.7 链"></a>3.7 链</h4><p>如果两个或以上控件通过下图的方式约束在一起，就可以认为是他们是一条链（图为横向的链，纵向同理）。</p>
<p><img src="/images/layout/2787721-b3b5a73715891a53.webp" alt="img"></p>
<p>用代码表示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintRight_toLeftOf</span>=<span class="string">&quot;@+id/TextView2&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView2&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintRight_toLeftOf</span>=<span class="string">&quot;@+id/TextView3&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView3&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/TextView2&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>3个TextView相互约束，两端两个TextView分别与parent约束，成为一条链，效果如下：</p>
<p><img src="/images/layout/2787721-c601cf02c45dfb3a.webp" alt="img"></p>
<p>一条链的第一个控件是这条链的链头，我们可以在链头中设置 layout_constraintHorizontal_chainStyle来改变整条链的样式。chains提供了3种样式，分别是：<br>CHAIN_SPREAD —— 展开元素 (默认)；<br>CHAIN_SPREAD_INSIDE —— 展开元素，但链的两端贴近parent；<br>CHAIN_PACKED —— 链的元素将被打包在一起。<br>如图所示：</p>
<p><img src="/images/layout/2787721-6d3fd9ce0f0cfd75.webp" alt="img"></p>
<p>上面的例子创建了一个样式链，除了样式链外，还可以创建一个权重链。<br>可以留意到上面所用到的3个TextView宽度都为wrap_content，如果我们把宽度都设为0dp，这个时候可以在每个TextView中设置横向权重layout_constraintHorizontal_weight(constraintVertical为纵向)来创建一个权重链，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintRight_toLeftOf</span>=<span class="string">&quot;@+id/TextView2&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintHorizontal_weight</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView2&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintRight_toLeftOf</span>=<span class="string">&quot;@+id/TextView3&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintHorizontal_weight</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView3&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/TextView2&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintHorizontal_weight</span>=<span class="string">&quot;4&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/images/layout/2787721-58cfdd300086a125.webp" alt="img"></p>
<h3 id="4-辅助工具"><a href="#4-辅助工具" class="headerlink" title="4.辅助工具"></a>4.辅助工具</h3><h4 id="4-1-Optimizer"><a href="#4-1-Optimizer" class="headerlink" title="4.1 Optimizer"></a>4.1 Optimizer</h4><p>当我们使用 MATCH_CONSTRAINT 时，ConstraintLayout 将对控件进行 2 次测量，ConstraintLayout在1.1中可以通过设置 <strong>layout_optimizationLevel</strong> 进行优化，可设置的值有：<br>none：无优化<br>standard：仅优化直接约束和屏障约束（默认）<br>direct：优化直接约束<br>barrier：优化屏障约束<br>chain：优化链约束<br>dimensions：优化尺寸测量</p>
<h4 id="4-2-Barrier"><a href="#4-2-Barrier" class="headerlink" title="4.2 Barrier"></a>4.2 Barrier</h4><p><img src="/images/layout/2787721-d8ef7a9da9ced277.webp" alt="img"></p>
<p>假设有3个控件ABC，C在AB的右边，但是AB的宽是不固定的，这个时候C无论约束在A的右边或者B的右边都不对。当出现这种情况可以用Barrier来解决。Barrier可以在多个控件的一侧建立一个屏障，如下所示：</p>
<p><img src="/images/layout/2787721-5792b4a2839fa7e9.webp" alt="img"></p>
<p>这个时候C只要约束在Barrier的右边就可以了，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@+id/TextView1&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.constraint.Barrier</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/barrier&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:barrierDirection</span>=<span class="string">&quot;right&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:constraint_referenced_ids</span>=<span class="string">&quot;TextView1,TextView2&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/barrier&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>app:barrierDirection为屏障所在的位置，可设置的值有：bottom、end、left、right、start、top<br>app:constraint_referenced_ids为屏障引用的控件，可设置多个(用“,”隔开)</p>
<h4 id="4-3-Group"><a href="#4-3-Group" class="headerlink" title="4.3 Group"></a>4.3 Group</h4><p>Group可以把多个控件归为一组，方便隐藏或显示一组控件，举个例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView2&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/TextView1&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TextView3&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@id/TextView2&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="/images/layout/2787721-50070bd874fbfbf4.webp" alt="img"></p>
<p>现在有3个并排的TextView，用Group把TextView1和TextView3归为一组，再设置这组控件的可见性，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.Group</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:id</span>=<span class="string">&quot;@+id/group&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:visibility</span>=<span class="string">&quot;invisible&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:constraint_referenced_ids</span>=<span class="string">&quot;TextView1,TextView3&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>





<p>效果如下：</p>
<p><img src="/images/layout/2787721-99d23bdc50679804.webp" alt="img"></p>
<h4 id="4-4-Placeholder"><a href="#4-4-Placeholder" class="headerlink" title="4.4 Placeholder"></a>4.4 Placeholder</h4><p>Placeholder指的是占位符。在Placeholder中可使用setContent()设置另一个控件的id，使这个控件移动到占位符的位置。举个例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.Placeholder</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/placeholder&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:content</span>=<span class="string">&quot;@+id/textview&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/textview&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;#cccccc&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;TextView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">&quot;#000000&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>





<p>新建一个Placeholder约束在屏幕的左上角，新建一个TextView约束在屏幕的右上角，在Placeholder中设置 app:content&#x3D;”@+id&#x2F;textview”，这时TextView会跑到屏幕的左上角。效果如下：</p>
<p><img src="/images/layout/2787721-6406fe760390e2f8.webp" alt="img"></p>
<h4 id="4-5-Guideline"><a href="#4-5-Guideline" class="headerlink" title="4.5 Guideline"></a>4.5 Guideline</h4><p>Guildline像辅助线一样，在预览的时候帮助你完成布局（不会显示在界面上）。<br>Guildline的主要属性：<br>android:orientation 垂直vertical，水平horizontal<br>layout_constraintGuide_begin 开始位置<br>layout_constraintGuide_end 结束位置<br>layout_constraintGuide_percent 距离顶部的百分比(orientation &#x3D; horizontal时则为距离左边)<br>举个例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.Guideline</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/guideline1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintGuide_begin</span>=<span class="string">&quot;50dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.Guideline</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/guideline2&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintGuide_percent</span>=<span class="string">&quot;0.5&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>guideline1为水平辅助线，开始位置是距离顶部50dp，guideline2位垂直辅助线，开始位置为屏幕宽的0.5(中点位置)，效果如下：</p>
<p><img src="/images/layout/2787721-870080d070c12e91.webp" alt="img"></p>
<p>其他文章：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/958887ed4f5f">https://www.jianshu.com/p/958887ed4f5f</a></p>
<h2 id="2、AppbarLayout控件"><a href="#2、AppbarLayout控件" class="headerlink" title="2、AppbarLayout控件"></a>2、AppbarLayout控件</h2><p>AppbarLayout是Material Design的一个控件,目的是为了实现一些酷炫到爆的效果,比如之前的折叠导航栏可以费劲心血的写出来,现在利用Appbarlayout非常容易的就可以实现出来,当然需要配合其他几个来控件实现。</p>
<h3 id="用法："><a href="#用法：" class="headerlink" title="用法："></a>用法：</h3><p>实现toolbar的收缩和扩展需要用到：</p>
<p><strong>CoordinatorLayout</strong>和<strong>AppbarLayout</strong>的配合, 以及实现了<strong>NestedScrollView</strong>的布局或控件.AppbarLayout是一种支持响应滚动手势的app bar布局, <strong>CollapsingToolbarLayout则是专门用来实现子布局内不同元素响应滚动细节的布局.</strong></p>
<p>与AppbarLayout组合的滚动布局(RecyclerView, NestedScrollView等),需要设置 app:layout_behavior &#x3D; “@string&#x2F;appbar_scrolling_view_behavior” .没有设置的话, AppbarLayout将不会响应滚动布局的滚动事件.</p>
<p>例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;com.truly.mytoolbar.MainActivity&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/toolbar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;?attr/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:theme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">&quot;scroll&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:popupTheme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Light&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:title</span>=<span class="string">&quot;Title&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">&quot;@string/appbar_scrolling_view_behavior&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/tv_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_margin</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:lineSpacingMultiplier</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@string/textContent&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>先看下效果再来解释为什么.</p>
<p><img src="/images/layout/9833282-6152ff329ca415cc.webp" alt="img"></p>
<p>可以看到：</p>
<ul>
<li>随着文本往上滚动, 顶部的toolbar也往上滚动, 直到消失.</li>
<li>随着文本往下滚动, 一直滚到文本的第一行露出来, toolbar也逐渐露出来</li>
</ul>
<p><strong>解释:</strong><br>从上面的布局中可以看到, 其实在整个父布局CoordinatorLayout下面, 是有2个子布局</p>
<ul>
<li>AppbarLayout</li>
<li>NestedScrollView<br>NestedScrollView先放一放, 我们来看AppbarLayout.</li>
</ul>
<blockquote>
<p>AppBarLayout 继承自LinearLayout，布局方向为垂直方向。所以你可以把它当成垂直布局的LinearLayout来使用。AppBarLayout是在LinearLayou上加了一些材料设计的概念，它可以让你定制当某个可滚动View的滚动手势发生变化时，其内部的子View实现何种动作。</p>
</blockquote>
<p>【CoordinatorLayout允许behavior协调子view】</p>
<p><strong>注意:</strong></p>
<p>上面提到的”某个可滚动View”, 可以理解为某个ScrollView. 就是说，当某个ScrollView发生滚动时，你可以定制你的“顶部栏”应该执行哪些动作（如跟着一起滚动、保持不动等等）。</p>
<p>这里某个<code>ScrollView</code>就是<code>NestedScrollView</code>或者实现了NestedScrollView机制的其它控件, 如<code>RecyclerView</code>. 它有一个布局行为<code>Layout_Behavior:</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:layout_behavior=<span class="string">&quot;@string/appbar_scrolling_view_behavior&quot;</span></span><br></pre></td></tr></table></figure>

<p>这是一个系统behavior, 从字面意思就可以看到, 是为<code>appbar</code>设置滚动动作的一个<code>behavior</code>. 没有这个属性的话, Appbar就是死的, 有了它就有了灵魂.</p>
<p>我们可以通过给Appbar下的子View添加<strong>app:layout_scrollFlags</strong>来设置各子View执行的动作. scrollFlags可以设置的动作如下:</p>
<blockquote>
<p>(1) scroll: 值设为scroll的View会跟随滚动事件一起发生移动。就是当指定的ScrollView发生滚动时，该View也跟随一起滚动，就好像这个View也是属于这个ScrollView一样。</p>
</blockquote>
<p>上面这个效果就是设置了scroll之后的.</p>
<blockquote>
<p>(2) enterAlways: 值设为enterAlways的View,当任何时候ScrollView往下滚动时，该View会直接往下滚动。而不用考虑ScrollView是否在滚动到最顶部还是哪里.</p>
</blockquote>
<p>我们把layout_scrollFlags改动如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:layout_scrollFlags=<span class="string">&quot;scroll|enterAlways&quot;</span></span><br></pre></td></tr></table></figure>

<p>效果如下:</p>
<p><img src="/images/layout/9833282-5b52c0c52428e4b9.webp" alt="img"></p>
<blockquote>
<p>(3) exitUntilCollapsed：值设为exitUntilCollapsed的View，当这个View要往上逐渐“消逝”时，会一直往上滑动，直到剩下的的高度达到它的最小高度后，再响应ScrollView的内部滑动事件。</p>
</blockquote>
<p>怎么理解呢？简单解释：在ScrollView往上滑动时，首先是View把滑动事件“夺走”，由View去执行滑动，直到滑动最小高度后，把这个滑动事件“还”回去，让ScrollView内部去上滑。</p>
<p>把属性改下再看效果</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:minHeight</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_scrollFlags</span>=<span class="string">&quot;scroll|exitUntilCollapsed&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/layout/9833282-05a487d1047a720d.webp" alt="img"></p>
<blockquote>
<p>(4) enterAlwaysCollapsed：是enterAlways的附加选项，一般跟enterAlways一起使用，它是指，View在往下“出现”的时候，首先是enterAlways效果，当View的高度达到最小高度时，View就暂时不去往下滚动，直到ScrollView滑动到顶部不再滑动时，View再继续往下滑动，直到滑到View的顶部结束</p>
</blockquote>
<p>这个得把高度加大点才好实验. 来看:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;android.support.v7.widget.Toolbar</span><br><span class="line">    ...</span><br><span class="line">    android:layout_height=<span class="string">&quot;200dp&quot;</span></span><br><span class="line">    android:minHeight=<span class="string">&quot;?attr/actionBarSize&quot;</span></span><br><span class="line">    app:layout_scrollFlags=<span class="string">&quot;scroll|enterAlways|enterAlwaysCollapsed&quot;</span></span><br><span class="line">&lt;/android.support.design.widget.AppBarLayout&gt;</span><br></pre></td></tr></table></figure>



<p><img src="/images/layout/9833282-75f004f3fca8823e.webp" alt="img"></p>
<p><strong>Attention:</strong></p>
<p>其实toolbar的默认最小高度minHeight就是<code>&quot;?attr/actionBarSize&quot;</code> , 很多时候可以不用设置. 而且从图上可以看出, 其实这里有个缺陷, 就是title的位置和toolbar上的图标行脱离了, 即使在布局里添加了 <code>android:gravity=&quot;bottom|start&quot;</code>, 在toolbar滚动的时候, title还在, 图标滚动到隐藏了.</p>
<p><img src="/images/layout/9833282-b3f03f55932a8c8c.webp" alt="img"></p>
<p>后面讲解的<code>CollapsingToolbarLayout</code>可以解决这个问题, 这里先丢出来.</p>
<blockquote>
<p>(5) snap：简单理解，就是Child View滚动比例的一个吸附效果。也就是说，Child View不会存在局部显示的情况，滚动Child View的部分高度，当我们松开手指时，Child View要么向上全部滚出屏幕，要么向下全部滚进屏幕，有点类似ViewPager的左右滑动</p>
</blockquote>
<p><img src="/images/layout/9833282-f7f5ff4f8544353a.webp" alt="img"></p>
<h4 id="引入CollapsingToolbarLayout"><a href="#引入CollapsingToolbarLayout" class="headerlink" title="引入CollapsingToolbarLayout"></a><strong>引入CollapsingToolbarLayout</strong></h4><p>CollapsingToolbarLayout是用来对<code>Toolbar</code>进行再次包装的<code>ViewGroup</code>，主要是用于实现折叠（其实就是看起来像伸缩<del>）的App Bar效果。它需要放在<code>AppBarLayout</code>布局里面，并且作为<code>AppBarLayout</code>的直接子</del>。CollapsingToolbarLayout主要包括几个功能（参照了官方网站上内容，略加自己的理解进行解释）：</p>
<blockquote>
<p>(1) 折叠Title（Collapsing title）：当布局内容全部显示出来时，title是最大的，但是随着View逐步移出屏幕顶部，title变得越来越小。你可以通过调用setTitle方法来设置title。</p>
</blockquote>
<blockquote>
<p>(2)内容纱布（Content scrim）：根据滚动的位置是否到达一个阀值，来决定是否对View“盖上纱布”。可以通过setContentScrim(Drawable)来设置纱布的图片. 默认contentScrim是colorPrimary的色值</p>
</blockquote>
<blockquote>
<p>(3)状态栏纱布（Status bar scrim)：根据滚动位置是否到达一个阀值决定是否对状态栏“盖上纱布”，你可以通过setStatusBarScrim(Drawable)来设置纱布图片，但是只能在LOLLIPOP设备上面有作用。默认statusBarScrim是colorPrimaryDark的色值.</p>
</blockquote>
<blockquote>
<p>(4)视差滚动子View(Parallax scrolling children): 子View可以选择在当前的布局当时是否以“视差”的方式来跟随滚动。（PS:其实就是让这个View的滚动的速度比其他正常滚动的View速度稍微慢一点）。将布局参数app:layout_collapseMode设为parallax</p>
</blockquote>
<blockquote>
<p>(5)将子View位置固定(Pinned position children)：子View可以选择是否在全局空间上固定位置，这对于Toolbar来说非常有用，因为当布局在移动时，可以将Toolbar固定位置而不受移动的影响。 将app:layout_collapseMode设为pin。</p>
</blockquote>
<p>我们来更改一下布局:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">...</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;150dp&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.CollapsingToolbarLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/collapsing_toolbar_layout&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:theme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">&quot;scroll|exitUntilCollapsed&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/toolbar&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">&quot;?attr/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">&quot;parallax&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:popupTheme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Light&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:title</span>=<span class="string">&quot;Title&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">android.support.design.widget.CollapsingToolbarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">&quot;@string/appbar_scrolling_view_behavior&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/tv_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_margin</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:lineSpacingMultiplier</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@string/textContent&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到, 我们把原本属于toolbar的几个属性移到了CollapsingToolbarLayout上. 分别是:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android:theme=&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span><br><span class="line">app:layout_scrollFlags=&quot;scroll|exitUntilCollapsed&quot;</span><br></pre></td></tr></table></figure>

<p>同时给toolbar增加了一个折叠模式属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:layout_collapseMode=&quot;parallax&quot;</span><br></pre></td></tr></table></figure>

<p>我们来看下效果:</p>
<p><img src="/images/layout/9833282-8a6b4005bf634f9e.webp" alt="img"></p>
<p>嗯嗯, 折叠模式不对, toolbar的顶部图标没了. 我们改下折叠模式:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:layout_collapseMode=&quot;pin&quot;</span><br></pre></td></tr></table></figure>

<p>再看效果:</p>
<p><img src="/images/layout/9833282-9bbdb99625649263.webp" alt="img"></p>
<p>我们把scrollFlags属性改下, 看下对比:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:layout_scrollFlags=&quot;scroll|enterAlways|enterAlwaysCollapsed&quot;</span><br></pre></td></tr></table></figure>



<p><img src="/images/layout/9833282-1d3dab9afc7a84b2.webp" alt="img"></p>
<p>效果还是蛮不错的, 有了点Google Material Design的感觉了.</p>
<p>上面说CollapsingToolbarLayout是个ViewGroup, 那么肯定还可以添加控件. 那么我们在里面添加一个ImageView来看看. 更改布局如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">...</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;200dp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.CollapsingToolbarLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">...</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:theme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">&quot;scroll|enterAlways|enterAlwaysCollapsed&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:scaleType</span>=<span class="string">&quot;centerCrop&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:src</span>=<span class="string">&quot;@drawable/darkbg&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">&quot;parallax&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/toolbar&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">&quot;?attr/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">&quot;pin&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:popupTheme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Light&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:title</span>=<span class="string">&quot;Title&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">android.support.design.widget.CollapsingToolbarLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">&quot;@string/appbar_scrolling_view_behavior&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">...</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>来看下效果:</p>
<p><img src="/images/layout/9833282-41f0884a89f987e5.webp" alt="img"></p>
<p>嗯, 有了点意思, 但不美观, 上部的toolbar和图片不协调. toolbar应该有默认的背景属性, 我们去掉它看看.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:id</span>=<span class="string">&quot;@+id/toolbar&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:layout_collapseMode</span>=<span class="string">&quot;pin&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:popupTheme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Light&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:title</span>=<span class="string">&quot;Title&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>再看下效果:</p>
<p><img src="/images/layout/9833282-978faef12c54cb33.webp" alt="img"></p>
<p>这次真的不错哦, 已经和很多大公司的app相像了. 但是为什么去掉toolbar的<code>background</code>就可以得到透明背景呢? 说句实话, 没找到原因.</p>
<p>不过我们没有给CollapsingToolbarLayout设置<code>contentScrim</code>属性哦, 给它加个属性看看.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CollapsingToolbarLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:contentScrim</span>=<span class="string">&quot;?attr/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="/images/layout/9833282-5629801b3986aaba.webp" alt="img"></p>
<p>嗯嗯, 好像还不如没设置这个属性好呢.</p>
<p><strong>什么时候需要contentScrim属性呢?</strong><br>因为这个布局里面给CollapsingToolbarLayout的<code>layout_scrollFlags</code>设置的是 <code>&quot;scroll|enterAlways|enterAlwaysCollapsed&quot;</code> , toolbar会全部消失的, 所以感觉不是很美观. 如果将layout_scrollFlags属性改为 “scroll|exitUntilCollapsed” , 效果会好点, 适合toolbar还是需要展示的场合.</p>
<p><img src="/images/layout/9833282-808dbc8a8700bbfd.webp" alt="img"></p>
<p>不管怎么样, 先去掉contentScrim属性吧.</p>
<p>目前有很多APP比较喜欢采用沉浸式设计, 简单点说就是将状态栏和导航栏都设置成透明或半透明的.</p>
<p>我们来把状态栏statusBar设置成透明. 在style主题中的AppTheme里增加一条:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;AppTheme&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;Theme.AppCompat.Light.NoActionBar&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    ...</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:statusBarColor&quot;</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在布局里面, 将ImageView和所有它上面的父View都添加fitsSystemWindows属性.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.CollapsingToolbarLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">...</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">...</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">                <span class="attr">...</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">android.support.design.widget.CollapsingToolbarLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">...</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后来看下效果:</p>
<p><img src="/images/layout/9833282-05ffff7d8bdcfcd7.webp" alt="img"></p>
<p>其实还可以在CollapsingToolbarLayout里设置statusBarScrim为透明色, 不过有点问题, 最顶部的toolbar没有完全隐藏, 还留了一点尾巴.</p>
<p><img src="/images/layout/9833282-0fa9ac2a9a132302.webp" alt="img"></p>
<p>难道就这个属性就没用吗? 我们把layout_scrollFlags改成 “scroll|exitUntilCollapsed” 看看:</p>
<p><img src="/images/layout/9833282-7ccc6dd333860f34.webp" alt="img"></p>
<p>这个时候toolbar不用隐藏, 所以还是美美的.</p>
<p>AppbarLayout整个做成沉浸式之后, 状态栏的图标可能会受到封面图片颜色过浅的影响, 可以给其加一个渐变的不透明层.</p>
<p><strong>渐变遮罩</strong>设置方法:</p>
<p>在res&#x2F;drawable文件夹下新建一个名为status_gradient的xml资源文件, 代码如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gradient</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:angle</span>=<span class="string">&quot;270&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:endColor</span>=<span class="string">&quot;@android:color/transparent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startColor</span>=<span class="string">&quot;#CC000000&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- shape节点中, 可以通过android:shape来设置形状, 默认是矩形.</span></span><br><span class="line"><span class="comment">        gradient节点中angle的值270是从上到下，0是从左到右，90是从下到上。 </span></span><br><span class="line"><span class="comment">        此处的效果就是从下向上, 颜色逐渐由纯透明慢慢变成黑透色--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>布局中, 在ImageView下面增加一个View, 背景设为上面的渐变遮罩.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在顶部增加一个渐变遮罩, 防止出现status bar 状态栏看不清 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;40dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;@drawable/status_gradient&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_collapseMode</span>=<span class="string">&quot;pin&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>给遮罩设置折叠模式: app:layout_collapseMode&#x3D;”pin” , 折叠到顶部后定住. 来看下效果.</p>
<p><img src="/images/layout/9833282-4c9ce9254313d319.webp" alt="img"></p>
<p><img src="/images/layout/9833282-69db4f6edee4151e.webp" alt="img"></p>
<p>上图是展开状态的对比, 后面的是没有添加遮罩的效果, 前面是添加了遮罩的效果. 下图是添加了遮罩折叠后的效果. 有点黑暗系影片的感觉哦.</p>
<h4 id="FloatingActionButton再次表演"><a href="#FloatingActionButton再次表演" class="headerlink" title="FloatingActionButton再次表演"></a><strong>FloatingActionButton再次表演</strong></h4><p>作为Google Material Design的一个重要控件, <code>FloatingActionButton</code>怎么可能不在AppbarLayout中起点作用呢. 我们在布局中加一个悬浮按钮, 让它的锚点挂载Appbar的右下角. 这样这个悬浮按钮就和Appbar关联起来了.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    &lt;/<span class="attr">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    &lt;/<span class="attr">android.support.v4.widget.NestedScrollView</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.FloatingActionButton</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/fab&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_margin</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">&quot;@drawable/ic_share_white_24dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:elevation</span>=<span class="string">&quot;4dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:pressedTranslationZ</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:rippleColor</span>=<span class="string">&quot;@android:color/white&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_anchor</span>=<span class="string">&quot;@id/appbar&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_anchorGravity</span>=<span class="string">&quot;bottom|end&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们来看下效果.</p>
<p><img src="/images/layout/9833282-1c4e2bdcb9373c3b.webp" alt="img"></p>
<p>好吧, 美美的Toolbar完成了, 有点Google Material Design扑面而来的感觉了</p>
<p>使用FloatingActionButton其实非常简单只需要在布局文件中引入控件即可，不过它的属性有点多，我们先来介绍一下它的属性。</p>
<ul>
<li>android:src：FAB中显示的图标.</li>
<li>app:backgroundTint：正常的背景颜色 ，这里是ColorStateList类型</li>
<li>app:rippleColor：按下时的背景颜色</li>
<li>app:elevation：正常的阴影大小</li>
<li>app:pressedTranslationZ：按下时的阴影大小</li>
<li>app:layout_anchor：设置FAB的锚点，即以哪个控件为参照设置位置</li>
<li>app:layout_anchorGravity：FAB相对于锚点的位置</li>
<li>app:fabSize：FAB的大小，normal或mini（分别对应56dp和40dp）</li>
<li>app:borderWidth：边框大小，最好设置成0dp否则会有边框</li>
<li>android:clickable：一定要设置成true否则没有点击效果</li>
</ul>
<h4 id="其他方法介绍"><a href="#其他方法介绍" class="headerlink" title="其他方法介绍"></a>其他方法介绍</h4><blockquote>
<p><strong>addOnOffsetChangedListener</strong>当AppbarLayout 的偏移发生改变的时候回调，也就是子View滑动。</p>
<p><strong>getTotalScrollRange</strong>返回AppbarLayout 所有子View的滑动范围</p>
<p><strong>removeOnOffsetChangedListener</strong>移除监听器</p>
<p>**setExpanded (boolean expanded,  boolean animate)**设置AppbarLayout 是展开状态还是折叠状态，animate 参数控制切换到新的状态时是否需要动画</p>
<p>**setExpanded (boolean expanded)**设置AppbarLayout 是展开状态还是折叠状态,默认有动画</p>
</blockquote>
<p><strong>但看解释好像不明白，我们详细来看一下这几个方法</strong></p>
<p><strong>1，addOnOffsetChangedListener</strong></p>
<p>这是官方的解释，其实很明白了</p>
<blockquote>
<p><strong>Called when theAppBarLayout’s layout offset has been changed. This allows child views to implement custom behavior based on the offset (for instance pinning a view at a certain y value).</strong></p>
<p>在<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://mydroidapi.tk/reference/android/support/design/widget/AppBarLayout.html">AppBarLayout</a>的布局偏移量发生改变时被调用。这个方法允许子view根据偏移量实现自定义的行为（比如在特定Y值的时候固定住一个View）</p>
</blockquote>
<p>下面来举个例子来看一下这个方法能作甚们</p>
<p>如图我们搞一个这个样子的布局</p>
<p>布局：</p>
<p><img src="/images/layout/9101961-0fc70d37cc580a8e.webp" alt="img"></p>
<p>java代码：</p>
<p><img src="/images/layout/9101961-ddf0414d983a9deb.webp" alt="img"></p>
<p>日志：</p>
<p><img src="/images/layout/9101961-2a4a4ba3c11c3500.webp" alt="img"></p>
<p>​        可见当appbarlayout最大的时候偏移量为0，网上滑动的时候，偏移量向负数方向增大，下面是效果图，只是展示了可以做的一些事情，实际项目中可以根据偏移量随意操作，比如可以做个透明度的动画等等</p>
<p>效果图：</p>
<p><img src="/images/layout/9101961-f9dd5f0e84910cc3.webp" alt="img"></p>
<p><strong>2，getTotalScrollRange，这个方法返货的是一个滑动的范围，也可以理解为党appbarlayout滑动到最小值时候的一个值得绝对值，这个值是不变的，是以appbarlayout为基础的其所有子view的一个范围值，如下，我们在addOnOffsetChangedListener方法中加入以下代码，然后滑动得到的值全都是288。有这个方法，我们可以在addOnOffsetChangedListener方法中做什么事情之前做一个精准的判断。</strong></p>
<p><img src="/images/layout/9101961-2c3362b138b185c0.webp" alt="img"></p>
<p><img src="/images/layout/9101961-9bd9a7c4a8c6c29b.webp" alt="img"></p>
<p><strong>3，removeOnOffsetChangedListener  ，移除监听器，这个没什么好说的，移除掉偏移量监听，某些情况下，你可能需要根据偏移量做些神门事情，但是某些情况下，你有不想做神门，所以只好把他移除掉。</strong></p>
<p><strong>4，setExpanded (boolean expanded, boolean animate)设置AppbarLayout 是展开状态还是折叠状态，animate 参数控制切换到新的状态时是否需要动画</strong></p>
<p><strong>setExpanded (boolean expanded)设置AppbarLayout 是展开状态还是折叠状态,默认有动画</strong></p>
<p>这俩个方法，就像他的解释一样</p>
<p><img src="/images/layout/9101961-fffc6d34f559cc7e.webp" alt="img"></p>
<p>false为关闭状态，true为展开状态</p>
<p>打开时的状态：</p>
<p><img src="/images/layout/9101961-daa5251bb7b1b86c.webp" alt="img"></p>
<h4 id="CollapsingToolbarLayout"><a href="#CollapsingToolbarLayout" class="headerlink" title="CollapsingToolbarLayout"></a>CollapsingToolbarLayout</h4><p><strong>CollapsingToolbarLayout是对子view的包装,并且实现了折叠app bar效果，使用时，要作为 AppbarLayout 的直接子View。</strong></p>
<p><strong>1,Collapsing title(折叠标题)当布局全部可见的时候，title 是最大的，当布局开始滑出屏幕，title 将变得越来越小，你可以通过setTitle（CharSequence） 来设置要显示的标题。</strong></p>
<blockquote>
<p>注意：Toolbar 和CollapsingToolbarLayout 同时设置了title时，不会显示Toolbartitle而是显示CollapsingToolbarLayout 的title，如果要显示Toolbar 的title，你可一在代码中添加如下代码：</p>
<p>collapsingToolbarLayout.setTitle(“”)</p>
<p>注意:你得给CollapsingToolbarLayout设置一个值,你来个wrap_parent是不起作用的,或者你把toolbar设置一个值来撑大CollapsingToolbarLayout也是不可以的</p>
</blockquote>
<p>布局：</p>
<p><img src="/images/layout/9101961-1f1a292291af1bd5.webp" alt="img"></p>
<p>效果图：</p>
<p><img src="/images/layout/9101961-20d000180c25cb87.webp" alt="img"></p>
<p><strong>2,Content scrim(内容纱布)当CollapsingToolbarLayout滑动到一个确定的阀值时将显示或者隐藏内容纱布，可以通过setContentScrim(Drawable)来设置纱布的图片。</strong></p>
<p>布局：</p>
<p><img src="/images/layout/9101961-8bbc486ac75b819b.webp" alt="img"></p>
<p>效果图：</p>
<p><img src="/images/layout/9101961-ead6aefd11a5aa08.webp" alt="img"></p>
<p><strong>3,Status bar scrim（状态栏纱布）当CollapsingToolbarLayout滑动到一个确定的阀值时，状态栏显示或隐藏纱布，你可以通过setStatusBarScrim(Drawable)来设置纱布图片。</strong></p>
<p><strong>4,Pinned position children（固定子View的位置）子View可以固定在全局空间内，这对于实现了折叠并且允许通过滚动布局来固定Toolbar 这种情况非常有用。在xml 中将collapseMode设为pin</strong></p>
<p>布局：</p>
<p><img src="/images/layout/9101961-837ade3cd71a4983.webp" alt="img"></p>
<p>效果图：</p>
<p><img src="/images/layout/9101961-b69f7cc343302025.webp" alt="img"></p>
<p><strong>5,Parallax scrolling children（有视差地滚动子View）让CollapsingToolbarLayout 的子View 可以有视差的滚动，需要在xml中用 添加如下代码：</strong></p>
<p><strong>app:layout_collapseMode&#x3D;”parallax”</strong></p>
<blockquote>
<p>注意:app:layout_collapseParallaxMultiplier&#x3D;”0.7” 这个参数是设置视差范围的,0-1,越大视差越大</p>
</blockquote>
<p>布局：</p>
<p><img src="/images/layout/9101961-260529f1215da352.webp" alt="img"></p>
<p>效果图:</p>
<p><img src="/images/layout/9101961-6933445fdad7334b.webp" alt="img"></p>
<p>​        以上就是appbarlayout的全部特点,在项目中使用几次就会了,各种scrollFlag与CollapsingToolbarLayout的搭配使用,可以做出很多非常酷炫的效果,基本满足各种需求,<strong>如果设计师太鬼畜,那么打她,打她,打她!!!!!!!  打不过?请用behavior,behavior,.behavior!!!</strong></p>
<h2 id="3、DrawerLayout抽屉布局"><a href="#3、DrawerLayout抽屉布局" class="headerlink" title="3、DrawerLayout抽屉布局"></a>3、DrawerLayout抽屉布局</h2><p>参照：<a target="_blank" rel="noopener" href="https://blog.csdn.net/crazy1235/article/details/41696291">https://blog.csdn.net/crazy1235/article/details/41696291</a></p>
<h3 id="1、介绍-1"><a href="#1、介绍-1" class="headerlink" title="1、介绍"></a>1、介绍</h3><p>导航抽屉显示在屏幕的最左侧，默认情况下是隐藏的，当用户用手指从边缘向另一个滑动的时候，会出现一个隐藏的面板，当点击面板外部或者向原来的方向滑动的时候，抽屉导航就会消失了！<br>好了，这个抽屉就是DrawerLayout，该类位于V4包中。<br><code>android.support.v4.widget.DrawerLayout.</code></p>
<h3 id="2、使用"><a href="#2、使用" class="headerlink" title="2、使用"></a>2、使用</h3><blockquote>
<p>抽屉导航的实现步骤非常简单。只要配置好带有抽屉导航的布局就可以实现简单的策划菜单。布局代码如下：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/id_drawerlayout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/id_framelayout&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/id_btn1&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;1111&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/id_drawer&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;240dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">&quot;start&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;#E0EEE0&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/id_lv&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:divider</span>=<span class="string">&quot;#CD853F&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:dividerHeight</span>=<span class="string">&quot;2dp&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>说明：</strong></p>
<ol>
<li>必须把DrawerLayout作为布局的跟标签。</li>
<li>然后在跟标签中添加一个包含内容的视图，就是当抽屉完全隐藏的时候显示的内容布局。</li>
<li>添加一个抽屉布局，这个布局可以按照需求自己定义，我的demo中是一个listview。</li>
<li>抽屉布局中，需要指定<code>android:layout_gravity</code>属性，官方说明是用start代替left。不过我试了一下start和left，right和end的效果是一样的。知道是什么区别？（谁知道，请留言告知一下！谢谢！）</li>
<li>抽屉布局的宽度最好不要超过320dp，这样做为了当抽屉完全显示的时候，不至于把内容布局全部遮挡。</li>
</ol>
<p>好了，此时在你的activity中设置一下布局文件，就可以实现一个简单的侧滑菜单了，不过菜单是在上面的。</p>
<p><img src="/images/layout/1417661107_1898.gif" alt="img"></p>
<p><strong>初始化listview</strong></p>
<p>接下来，就要初始化listview了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mLv = (ListView) findViewById(R.id.id_lv);</span><br><span class="line">		str = <span class="keyword">new</span> <span class="title class_">String</span>[] &#123; <span class="string">&quot;item1&quot;</span>, <span class="string">&quot;item2&quot;</span>, <span class="string">&quot;item3&quot;</span>&#125;;</span><br><span class="line">		ArrayAdapter&lt;String&gt; adapter = <span class="keyword">new</span> <span class="title class_">ArrayAdapter</span>&lt;String&gt;(<span class="built_in">this</span>,</span><br><span class="line">				android.R.layout.simple_list_item_1, str);</span><br><span class="line">		mLv.setAdapter(adapter);</span><br><span class="line">		mLv.setOnItemClickListener(<span class="built_in">this</span>);</span><br></pre></td></tr></table></figure>

<p>下面，<strong>设置抽屉导航的监听事件。添加监听器的时候有三种方式</strong>。</p>
<p>1、设置DrawerLayout.DrawerListener作为监听器类,里面包含四个回调函数。</p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">mDrawerLayout.setDrawerListener(<span class="keyword">new</span> <span class="title class_">DrawerListener</span>() &#123;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 当抽屉滑动状态改变的时候被调用</span></span><br><span class="line"><span class="comment">		 * 状态值是STATE_IDLE（闲置--0）, STATE_DRAGGING（拖拽的--1）, STATE_SETTLING（固定--2）中之一。</span></span><br><span class="line"><span class="comment">		 * 抽屉打开的时候，点击抽屉，drawer的状态就会变成STATE_DRAGGING，然后变成STATE_IDLE</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerStateChanged</span><span class="params">(<span class="type">int</span> arg0)</span> &#123;</span><br><span class="line">			Log.i(<span class="string">&quot;drawer&quot;</span>, <span class="string">&quot;drawer的状态：&quot;</span> + arg0);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 当抽屉被滑动的时候调用此方法</span></span><br><span class="line"><span class="comment">		 * arg1 表示 滑动的幅度（0-1）</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerSlide</span><span class="params">(View arg0, <span class="type">float</span> arg1)</span> &#123;</span><br><span class="line">			Log.i(<span class="string">&quot;drawer&quot;</span>, arg1 + <span class="string">&quot;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 当一个抽屉被完全打开的时候被调用</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerOpened</span><span class="params">(View arg0)</span> &#123;</span><br><span class="line">			Log.i(<span class="string">&quot;drawer&quot;</span>, <span class="string">&quot;抽屉被完全打开了！&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 当一个抽屉完全关闭的时候调用此方法</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerClosed</span><span class="params">(View arg0)</span> &#123;</span><br><span class="line">			Log.i(<span class="string">&quot;drawer&quot;</span>, <span class="string">&quot;抽屉被完全关闭了！&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>

<p>2、设置DrawerListener的子类SimpleDrawerListener，使用这个类的时候不必实现全部的回调函数，可以根据自己的需要重写相应的方法。</p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mDrawerLayout.setDrawerListener(<span class="keyword">new</span> <span class="title class_">DrawerLayout</span>.SimpleDrawerListener() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerClosed</span><span class="params">(View drawerView)</span> &#123;</span><br><span class="line">				<span class="built_in">super</span>.onDrawerClosed(drawerView);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerOpened</span><span class="params">(View drawerView)</span> &#123;</span><br><span class="line">				<span class="built_in">super</span>.onDrawerOpened(drawerView);</span><br><span class="line">			&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>3、使用DrawerListener的子类ActionBarDrawerToggle。一般与ActionBar结合使用。</p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mDrawerToggle = <span class="keyword">new</span> <span class="title class_">ActionBarDrawerToggle</span>(<span class="built_in">this</span>, mDrawerLayout,</span><br><span class="line">				R.drawable.ic_drawer, R.string.drawer_open,</span><br><span class="line">				R.string.drawer_close) &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerClosed</span><span class="params">(View drawerView)</span> &#123;</span><br><span class="line">	getActionBar().setTitle(mTitle);</span><br><span class="line">	invalidateOptionsMenu();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerOpened</span><span class="params">(View drawerView)</span> &#123;</span><br><span class="line">	getActionBar().setTitle(mDrawerTitle);</span><br><span class="line">	invalidateOptionsMenu();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">mDrawerLayout.setDrawerListener(mDrawerToggle);</span><br></pre></td></tr></table></figure>

<h3 id="DrawerLayout和NavigationView使用（重点）"><a href="#DrawerLayout和NavigationView使用（重点）" class="headerlink" title="DrawerLayout和NavigationView使用（重点）"></a>DrawerLayout和NavigationView使用（重点）</h3><h4 id="（一）基本使用"><a href="#（一）基本使用" class="headerlink" title="（一）基本使用"></a>（一）基本使用</h4><p>DrawerLayout界面</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/drawer_layout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:openDrawer</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span></span></span><br><span class="line"><span class="tag">        <span class="attr">layout</span>=<span class="string">&quot;@layout/app_bar_drawer_layout__one&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.NavigationView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_view&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">&quot;start&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:headerLayout</span>=<span class="string">&quot;@layout/nav_header_drawer_layout__one&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:menu</span>=<span class="string">&quot;@menu/activity_drawer_layout__one_drawer&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到我们的最外层是DrawerLayout，包含了两个内容：<code>include</code>为显示内容区域，<code>NavigationView</code>为侧边抽屉栏。</p>
<p>NavigationView有两个app属性，分别为<code>app:headerLayout</code>和<code>app:menu</code>，headerLayout用于显示头部的布局（可选），menu用于建立MenuItem选项的菜单。</p>
<p>headerLayout就是正常的layout布局文件,我们查看下menu.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">android:checkableBehavior</span>=<span class="string">&quot;single&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_camera&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_menu_camera&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:title</span>=<span class="string">&quot;Import&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_gallery&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_menu_gallery&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:title</span>=<span class="string">&quot;Gallery&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_slideshow&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_menu_slideshow&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:title</span>=<span class="string">&quot;Slideshow&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_manage&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_menu_manage&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:title</span>=<span class="string">&quot;Tools&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">&quot;Communicate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_share&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_menu_share&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:title</span>=<span class="string">&quot;Share&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_send&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_menu_send&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:title</span>=<span class="string">&quot;Send&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>menu可以分组，group的android:checkableBehavior属性设置为single可以设置该组为单选</p>
<p>Activity主题必须设置先这两个属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;AppTheme.NoActionBar&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;windowActionBar&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;windowNoTitle&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>未设置Activity主题会爆出错误信息:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vCaused <span class="keyword">by</span>: java.lang.IllegalStateException: This Activity </span><br><span class="line">already has an action bar supplied <span class="keyword">by</span> the window decor. </span><br><span class="line">Do <span class="keyword">not</span> request Window.FEATURE_SUPPORT_ACTION_BAR </span><br><span class="line"><span class="keyword">and</span> <span class="keyword">set</span> windowActionBar to <span class="literal">false</span> <span class="keyword">in</span> your theme to use a Toolbar instead.</span><br></pre></td></tr></table></figure>

<p>设置主题为android:theme&#x3D;”@style&#x2F;AppTheme.NoActionBar”</p>
<p>效果图：</p>
<p><img src="/images/layout/3485428-f448bae6615efa4c.webp" alt="img"></p>
<h4 id="二-、监听和关闭NavigationView"><a href="#二-、监听和关闭NavigationView" class="headerlink" title="(二)、监听和关闭NavigationView"></a>(二)、监听和关闭NavigationView</h4><p>NavigationView监听通过navigationView.setNavigationItemSelectedListener(this)方法去监听menu的点击事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;StatementWithEmptyBody&quot;)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onNavigationItemSelected</span><span class="params">(MenuItem item)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Handle navigation view item clicks here.</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> item.getItemId();</span><br><span class="line">    <span class="type">DrawerLayout</span> <span class="variable">drawer</span> <span class="operator">=</span> (DrawerLayout) findViewById(R.id.drawer_layout);</span><br><span class="line">    drawer.closeDrawer(GravityCompat.START);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每次点击一个Menu关闭DrawerLayout，方法为drawer.closeDrawer(GravityCompat.START);</p>
<p>通过onBackPressed方法,当点击返回按钮的时候,如果DrawerLayout是打开状态则关闭</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBackPressed</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">DrawerLayout</span> <span class="variable">drawer</span> <span class="operator">=</span> (DrawerLayout) findViewById(R.id.drawer_layout);</span><br><span class="line">    <span class="keyword">if</span> (drawer.isDrawerOpen(GravityCompat.START)) &#123;</span><br><span class="line">        drawer.closeDrawer(GravityCompat.START);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onBackPressed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（三）、NavigationView在Toolbar下方"><a href="#（三）、NavigationView在Toolbar下方" class="headerlink" title="（三）、NavigationView在Toolbar下方"></a>（三）、NavigationView在Toolbar下方</h4><p>大多数的APP都是使用NavigationView都是全屏的，当我们想让NavigationView在Toolbar下方的时候应该怎么做呢<br>xml布局如下图，DrawerLayout在Toolbar的下方</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:id</span>=<span class="string">&quot;@+id/sample_main_layout&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/toolbar&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;?attr/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:theme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/drawer_layout&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/container&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:padding</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;NavigationView在Toolbar下方&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.NavigationView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_view&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">&quot;start&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:headerLayout</span>=<span class="string">&quot;@layout/nav_header_drawer_layout_one&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:menu</span>=<span class="string">&quot;@menu/activity_drawer_layout_one_drawer&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如图:</p>
<p><img src="/images/layout/3485428-fb9b326a661904ab.webp" alt="img"></p>
<p>NavigationView在Toolbar下方.gif</p>
<h4 id="（四）、Toolbar上不显示Home旋转开关按钮"><a href="#（四）、Toolbar上不显示Home旋转开关按钮" class="headerlink" title="（四）、Toolbar上不显示Home旋转开关按钮"></a>（四）、Toolbar上不显示Home旋转开关按钮</h4><p>上图可以看到我们点击Home旋转开关按钮,显示和隐藏了侧滑菜单。那么如果我们想要不通过按钮点击,只能右划拉出菜单需要怎么做呢。<br>我们先看下带Home旋转开关按钮的代码是如何写的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DrawerLayout</span> <span class="variable">drawer</span> <span class="operator">=</span> (DrawerLayout) findViewById(R.id.drawer_layout);</span><br><span class="line"><span class="comment">//这是带Home旋转开关按钮</span></span><br><span class="line"><span class="type">ActionBarDrawerToggle</span> <span class="variable">toggle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActionBarDrawerToggle</span>(<span class="built_in">this</span>, drawer, </span><br><span class="line">    toolbar, </span><br><span class="line">    R.string.navigation_drawer_open, R.string.navigation_drawer_close);</span><br><span class="line">drawer.setDrawerListener(toggle);</span><br><span class="line">toggle.syncState();</span><br></pre></td></tr></table></figure>

<p>这个Home旋转开关按钮实际上是通过ActionBarDrawerToggle代码绑定到toolbar上的，ActionBarDrawerToggle是和DrawerLayout搭配使用的，它可以改变android.R.id.home返回图标，监听drawer的显示和隐藏。ActionBarDrawerToggle的syncState()方法会和Toolbar关联，将图标放入到Toolbar上。<br>进入ActionBarDrawerToggle构造器可以看到一个不传Toolbar参数的构造器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ActionBarDrawerToggle</span><span class="params">(Activity activity, DrawerLayout drawerLayout,</span></span><br><span class="line"><span class="params">        <span class="meta">@StringRes</span> <span class="type">int</span> openDrawerContentDescRes,</span></span><br><span class="line"><span class="params">        <span class="meta">@StringRes</span> <span class="type">int</span> closeDrawerContentDescRes)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(activity, <span class="literal">null</span>, drawerLayout, <span class="literal">null</span>, openDrawerContentDescRes,</span><br><span class="line">            closeDrawerContentDescRes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么不带Home旋转开关按钮的代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这是不带Home旋转开关按钮</span></span><br><span class="line"><span class="type">ActionBarDrawerToggle</span> <span class="variable">toggle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActionBarDrawerToggle</span>(<span class="built_in">this</span>, drawer,</span><br><span class="line">  R.string.navigation_drawer_open, R.string.navigation_drawer_close);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当然我们把上面带Home旋转开关按钮的代码删除也是可以的。</p>
</blockquote>
<p>效果如图:</p>
<p><img src="/images/layout/3485428-37f3e8d70491ff22.webp" alt="img"></p>
<p>Toolbar上不显示Home旋转开关按钮.gif</p>
<h4 id="（五）、不使用NavigationView，使用DrawerLayout-其他布局"><a href="#（五）、不使用NavigationView，使用DrawerLayout-其他布局" class="headerlink" title="（五）、不使用NavigationView，使用DrawerLayout+其他布局"></a>（五）、不使用NavigationView，使用DrawerLayout+其他布局</h4><p>APP实际开发中往往不能完全按照Materialdesign的规则来,如网易云音乐的侧滑,底部还有两个按钮。这时候我们可以通过+其他布局来实现特殊的侧滑布局。</p>
<p>我们可以参考鸿杨大神的博客<br>[Android 自己实现 NavigationView <a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://blog.csdn.net/lmj623565791/article/details/46405409">Design Support Library(1)]</a></p>
<p>我们自己实现个简单的,DrawerLayout包裹了一个FrameLayout和一个RelativeLayout,FrameLayout是我们的显示内容区域,RelativeLayout是我们的侧边栏布局。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/drawer_layout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:openDrawer</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/container&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/toolbar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;?attr/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:popupTheme</span>=<span class="string">&quot;@style/AppTheme.PopupOverlay&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:padding</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@string/title_activity_drawer_layout_other&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_view&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">&quot;start&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;@android:color/white&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;这是顶部按钮&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_centerInParent</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;这是中间的按钮&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentBottom</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;这是底部按钮&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果需要监听DrawerLayout的侧滑状态监听,那么代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mDrawerLayout = (DrawerLayout) findViewById(R.id.drawer_layout);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 也可以使用DrawerListener的子类SimpleDrawerListener,</span></span><br><span class="line"><span class="comment">         * 或者是ActionBarDrawerToggle这个子类</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        mDrawerLayout.setDrawerListener(<span class="keyword">new</span> <span class="title class_">DrawerLayout</span>.SimpleDrawerListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerClosed</span><span class="params">(View drawerView)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>.onDrawerClosed(drawerView);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerOpened</span><span class="params">(View drawerView)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>.onDrawerOpened(drawerView);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>效果图如下:</p>
<p><img src="/images/layout/3485428-54ea163c547c1cc6.webp" alt="img"></p>
<h4 id="ActionBarDrawerToggle"><a href="#ActionBarDrawerToggle" class="headerlink" title="ActionBarDrawerToggle"></a>ActionBarDrawerToggle</h4><p>ActionBarDrawerToggle 是 DrawerLayout.DrawerListener实现。和 NavigationDrawer 搭配使用，推荐用这个方法，符合Android design规范。
 </p>
<p><strong>作用：</strong><br>           1.改变android.R.id.home返回图标。</p>
<p>    2.Drawer拉出、隐藏，带有android.R.id.home动画效果。</p>
<p>    3.监听Drawer拉出、隐藏；</p>
<p>ActionBarDrawerToggle 是在actionBar监视DrawerLayout的状态变化<br>所以<strong>不要设置activity为无标题</strong>：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>requestWindowFeature(Window.FEATURE_NO_TITLE);</span><br></pre></td></tr></table></figure>

<p><strong>实现：</strong></p>
<p>​					绑定DrawerLayout,<br>设置DrawLayout切换按钮R.drawable.ic_drawer</p>
<p>实现两个方法：<br>  onDrawerClosed<br>  onDrawerOpened<br>监视抽屉的打开和关闭。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 内部实现抽屉状态监听</span></span><br><span class="line"><span class="comment">     * onDrawerOpen</span></span><br><span class="line"><span class="comment">     * onDrawerClose</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    mDrawerToggle = <span class="keyword">new</span> <span class="title class_">ActionBarDrawerToggle</span>(</span><br><span class="line">            MainActivity.<span class="built_in">this</span>, </span><br><span class="line">            mDrawerLayout, </span><br><span class="line">            R.drawable.ic_drawer, </span><br><span class="line">            R.string.drawer_open,</span><br><span class="line">            R.string.drawer_close)&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerClosed</span><span class="params">(View drawerView)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.onDrawerClosed(drawerView);</span><br><span class="line">            getActionBar().setTitle(mTitle);</span><br><span class="line">            invalidateOptionsMenu(); <span class="comment">// creates call to</span></span><br><span class="line">                                        <span class="comment">// onPrepareOptionsMenu()</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerOpened</span><span class="params">(View drawerView)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.onDrawerOpened(drawerView);</span><br><span class="line">            getActionBar().setTitle(mDrawerTitle);</span><br><span class="line">            invalidateOptionsMenu(); <span class="comment">// creates call to</span></span><br><span class="line">                                        <span class="comment">// onPrepareOptionsMenu()</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//设置抽屉状态监听事件</span></span><br><span class="line">    mDrawerLayout.setDrawerListener(mDrawerToggle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>必须注意ActionBarDrawerToggle的使用必须在<br>onPostCreate() and onConfigurationChanged()之间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * When using the ActionBarDrawerToggle, you must call it during</span></span><br><span class="line"><span class="comment"> * onPostCreate() and onConfigurationChanged()...</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onPostCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onPostCreate(savedInstanceState);</span><br><span class="line">    <span class="comment">// Sync the toggle state after onRestoreInstanceState has occurred.</span></span><br><span class="line">    mDrawerToggle.syncState();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onConfigurationChanged</span><span class="params">(Configuration newConfig)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onConfigurationChanged(newConfig);</span><br><span class="line">    <span class="comment">// Pass any configuration change to the drawer toggls</span></span><br><span class="line">    mDrawerToggle.onConfigurationChanged(newConfig);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>更详细的例子</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">ActionBarDrawerToggle 是 DrawerLayout.DrawerListener 实现。和 NavigationDrawer 搭配使用，推荐用这个方法，符合Android design规范。</span><br><span class="line"></span><br><span class="line">我们先来看看 NavigationDrawer 里面的 ActionBarDrawerToggle 是如何编写的。</span><br><span class="line"></span><br><span class="line"><span class="comment">// ActionBarDrawerToggle ties together the the proper interactions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// between the navigation drawer and the action bar app icon.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 动作条抽屉切换器 将 抽屉 与 app icon动作条 绑定正确的交互。</span></span><br><span class="line"></span><br><span class="line">mDrawerToggle = <span class="keyword">new</span> <span class="title class_">ActionBarDrawerToggle</span>(</span><br><span class="line"></span><br><span class="line">​        getActivity(),                    <span class="comment">/* host Activity */</span></span><br><span class="line"></span><br><span class="line">​        mDrawerLayout,                    <span class="comment">/* DrawerLayout object */</span></span><br><span class="line"></span><br><span class="line">​        R.drawable.ic_drawer,             <span class="comment">/* nav drawer image to replace &#x27;Up&#x27; caret */</span></span><br><span class="line"></span><br><span class="line">​        R.string.navigation_drawer_open,  <span class="comment">/* &quot;open drawer&quot; description for accessibility */</span></span><br><span class="line"></span><br><span class="line">​        R.string.navigation_drawer_close  <span class="comment">/* &quot;close drawer&quot; description for accessibility */</span></span><br><span class="line"></span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">​    <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">​    <span class="comment">// 当抽屉关闭时</span></span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerClosed</span><span class="params">(View drawerView)</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">super</span>.onDrawerClosed(drawerView);</span><br><span class="line"></span><br><span class="line">​        <span class="comment">// 如果该Fragment对象没有被添加到了drawerView中</span></span><br><span class="line"></span><br><span class="line">​        <span class="keyword">if</span> (!isAdded()) &#123;</span><br><span class="line"></span><br><span class="line">​            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">​        &#125;</span><br><span class="line"></span><br><span class="line">​        <span class="comment">// 系统调用onPrepareOptionsMenu()去 update menu</span></span><br><span class="line"></span><br><span class="line">​        getActivity().invalidateOptionsMenu(); <span class="comment">// calls onPrepareOptionsMenu()</span></span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">​    <span class="comment">// 当抽屉打开时</span></span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerOpened</span><span class="params">(View drawerView)</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">super</span>.onDrawerOpened(drawerView);</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">if</span> (!isAdded()) &#123;</span><br><span class="line"></span><br><span class="line">​            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">​        &#125;</span><br><span class="line">​        <span class="comment">// 如果 变量“用户正在使用的抽屉” 没有设置</span></span><br><span class="line"></span><br><span class="line">​        <span class="keyword">if</span> (!mUserLearnedDrawer) &#123;</span><br><span class="line"></span><br><span class="line">​            <span class="comment">// The user manually opened the drawer; store this flag to prevent auto-showing34</span></span><br><span class="line">​            <span class="comment">// the navigation drawer automatically in the future.</span></span><br><span class="line"></span><br><span class="line">​            <span class="comment">// 用户手动打开抽屉;存储该标志，以防止自动显示在后面的导航抽屉。</span></span><br><span class="line">​		     mUserLearnedDrawer = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">​            <span class="comment">// 设置偏好</span></span><br><span class="line"></span><br><span class="line">​            <span class="type">SharedPreferences</span> <span class="variable">sp</span> <span class="operator">=</span> PreferenceManager</span><br><span class="line"></span><br><span class="line">​                    .getDefaultSharedPreferences(getActivity());</span><br><span class="line"></span><br><span class="line">​            sp.edit().putBoolean(PREF_USER_LEARNED_DRAWER, <span class="literal">true</span>).apply();</span><br><span class="line"></span><br><span class="line">​        &#125;</span><br><span class="line"></span><br><span class="line">​        getActivity().invalidateOptionsMenu(); <span class="comment">// calls onPrepareOptionsMenu()</span></span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line">ActionBarDrawerToggle 的作用：</span><br><span class="line"></span><br><span class="line">改变android.R.id.home返回图标。</span><br><span class="line">Drawer拉出、隐藏，带有android.R.id.home动画效果。</span><br><span class="line">监听Drawer拉出、隐藏；</span><br><span class="line">有几点解释一下：</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> getActivity().invalidateOptionsMenu(); 在运行时改变menu item的状态。你需要重写onPrepareOptionsMenu() ，它方便你对item移除，添加，使不可用等。在android <span class="number">3.0</span>以上，你必须调用invalidateOptionsMenu() 。</span><br><span class="line"></span><br><span class="line">当你要update你的menu时，因为action bar是一直出现的。然后系统将调用onPrepareOptionsMenu()更改menu。</span><br><span class="line"></span><br><span class="line">Activity与Fragment中都有关于menu的一系列的方法，并且都是自动的在框架中回调的。其中onCreateOptionsMenu()只是在创建menu时调用一次，但menu存在的时候是不会重复调用的。更新menu时，从activity中主动的调用 invalidateOptionsMenu() 方法，那么activity在显示menu之前自然会回调onPrepareOptionsMenu(Menu menu)，再在该方法内实现更新的细节即可。</span><br><span class="line"></span><br><span class="line">如果Fragment中没有invalidateOptionsMenu()方法，并且当menu存在的时候fragment也不会调用onCreateOptionsMenu()方法，那么我们可以在Fragment中直接调用setHasOptionsMenu()方法，将该方法设置为<span class="literal">true</span>，它就会调用onCreateOptionsMenu()，如此一来我们的目的就达到了。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> isAdded();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">isAdded</span><span class="params">()</span> 如果该Fragment对象被添加到了它的Activity中，那么它返回<span class="literal">true</span>，否则返回<span class="literal">false</span>。先判断 Fragment 是否 add，这样就能做到多个Fragment切换不重新实例化。</span><br><span class="line"></span><br><span class="line">最后不要忘了</span><br><span class="line"></span><br><span class="line">view sourceprint?</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="comment">// 给抽屉Layout绑定切换器监听</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">mDrawerLayout.setDrawerListener(mDrawerToggle);</span><br></pre></td></tr></table></figure>



<h3 id="demo："><a href="#demo：" class="headerlink" title="demo："></a>demo：</h3><p><strong>效果图</strong>：</p>
<p><img src="/images/layout/11483779-5856d1febb879be1.webp" alt="img"></p>
<p><strong>布局文件最外层使用DrawerLayout</strong></p>
<p><strong>只可以有两个子布局</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/drawerLayout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:openDrawer</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.v4.view.ViewPager</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/viewPager&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">android.support.v4.view.ViewPager</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.BottomNavigationView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/bottomNavigationView&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;50dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;@color/white&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:itemIconTint</span>=<span class="string">&quot;@drawable/home_nav_item_color_state&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:itemTextColor</span>=<span class="string">&quot;@drawable/home_nav_item_color_state&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:menu</span>=<span class="string">&quot;@menu/home_navigation&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">android.support.design.widget.BottomNavigationView</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.NavigationView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/navigationView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">&quot;left&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:headerLayout</span>=<span class="string">&quot;@layout/home_nav_header&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:menu</span>=<span class="string">&quot;@menu/home_nav_drawer&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;50dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_alignParentBottom</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">&quot;@color/red&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;退出&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.NavigationView</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>NavigationView</strong></p>
<p>NavigationView侧滑菜单，可以自行填充头部布局和菜单布局，还可以再添加任意布局</p>
<p><strong>在需要使用的页面添加如下代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HomeActivity</span> <span class="keyword">extends</span> <span class="title class_">BaseActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DrawerLayout drawerLayout;</span><br><span class="line">    <span class="keyword">private</span> ViewPager viewPager;</span><br><span class="line">    <span class="keyword">private</span> BottomNavigationView bottomNavigationView;</span><br><span class="line">    <span class="keyword">private</span> NavigationView navigationView;</span><br><span class="line"><span class="keyword">private</span> TabFragmentPagerAdapter tabFragmentPagerAdapter;</span><br><span class="line"><span class="keyword">private</span> List&lt;Fragment&gt; fragments;</span><br><span class="line"><span class="keyword">private</span> MenuItem menuItem;</span><br><span class="line"><span class="keyword">private</span> TextView tvHeader;</span><br><span class="line"><span class="keyword">private</span> MenuItem menuItem1;   </span><br><span class="line"><span class="keyword">private</span> MenuItem menuItem2;</span><br><span class="line"><span class="keyword">private</span> MenuItem menuItem3;</span><br><span class="line"><span class="keyword">private</span> MenuItem menuItem4;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getLayoutId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> R.layout.home_activity_home;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initData</span><span class="params">()</span> &#123;</span><br><span class="line">    initFragment();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initView</span><span class="params">()</span> &#123;</span><br><span class="line">    drawerLayout = findView(R.id.drawerLayout);</span><br><span class="line">    viewPager = findView(R.id.viewPager);</span><br><span class="line">    bottomNavigationView = findView(R.id.bottomNavigationView);</span><br><span class="line">    navigationView = findView(R.id.navigationView);</span><br><span class="line">    initViewPager();</span><br><span class="line">    initBottomNavigationView();</span><br><span class="line">    initNavigationView();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initListener</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">viewsClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initFragment</span><span class="params">()</span> &#123;</span><br><span class="line">    fragments = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    fragments.add(<span class="keyword">new</span> <span class="title class_">MainFragment</span>());</span><br><span class="line">    fragments.add(<span class="keyword">new</span> <span class="title class_">ListFragment</span>());</span><br><span class="line">    fragments.add(<span class="keyword">new</span> <span class="title class_">ThreeFragment</span>());</span><br><span class="line">    fragments.add(<span class="keyword">new</span> <span class="title class_">StudyFragment</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initViewPager</span><span class="params">()</span> &#123;</span><br><span class="line">    tabFragmentPagerAdapter = <span class="keyword">new</span> <span class="title class_">TabFragmentPagerAdapter</span>(getSupportFragmentManager(), fragments);</span><br><span class="line">    viewPager.setAdapter(tabFragmentPagerAdapter);</span><br><span class="line">    viewPager.addOnPageChangeListener(<span class="keyword">new</span> <span class="title class_">ViewPager</span>.OnPageChangeListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageScrolled</span><span class="params">(<span class="type">int</span> position, <span class="type">float</span> positionOffset, <span class="type">int</span> positionOffsetPixels)</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageSelected</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (menuItem != <span class="literal">null</span>) &#123;</span><br><span class="line">                menuItem.setChecked(<span class="literal">false</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                bottomNavigationView.getMenu().getItem(<span class="number">0</span>).setChecked(<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            menuItem = bottomNavigationView.getMenu().getItem(position);</span><br><span class="line">            menuItem.setChecked(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageScrollStateChanged</span><span class="params">(<span class="type">int</span> state)</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initBottomNavigationView</span><span class="params">()</span> &#123;</span><br><span class="line">    BottomNavigationViewHelper.disableShiftMode(bottomNavigationView);<span class="comment">//取消位移动画</span></span><br><span class="line">    bottomNavigationView.setOnNavigationItemSelectedListener(<span class="keyword">new</span> <span class="title class_">BottomNavigationView</span>.OnNavigationItemSelectedListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onNavigationItemSelected</span><span class="params">(<span class="meta">@NonNull</span> MenuItem item)</span> &#123;</span><br><span class="line">            menuItem = item;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> item.getItemId();</span><br><span class="line">            <span class="keyword">if</span> (i == R.id.navigation_home) &#123;</span><br><span class="line">                viewPager.setCurrentItem(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == R.id.navigation_list) &#123;</span><br><span class="line">                viewPager.setCurrentItem(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == R.id.navigation_Three) &#123;</span><br><span class="line">                viewPager.setCurrentItem(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == R.id.navigation_person) &#123;</span><br><span class="line">                viewPager.setCurrentItem(<span class="number">3</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initNavigationView</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//登录</span></span><br><span class="line">    tvHeader = navigationView.getHeaderView(<span class="number">0</span>).findViewById(R.id.show_nav_head_text);</span><br><span class="line">    menuItem1 = navigationView.getMenu().findItem(R.id.nav_item1);</span><br><span class="line">    menuItem2 = navigationView.getMenu().findItem(R.id.nav_item2);</span><br><span class="line">    menuItem3 = navigationView.getMenu().findItem(R.id.nav_item3);</span><br><span class="line">    menuItem4 = navigationView.getMenu().findItem(R.id.nav_item4);</span><br><span class="line">    <span class="comment">//通过actionbardrawertoggle将toolbar与drawablelayout关联起来</span></span><br><span class="line">    <span class="type">ActionBarDrawerToggle</span> <span class="variable">toggle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActionBarDrawerToggle</span>(</span><br><span class="line">            <span class="built_in">this</span>, drawerLayout, R.string.home_drawer_open, R.string.home_drawer_close) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawerSlide</span><span class="params">(View drawerView, <span class="type">float</span> slideOffset)</span> &#123;</span><br><span class="line">            <span class="comment">//可以重新侧滑方法,该方法实现侧滑动画,整个布局移动效果</span></span><br><span class="line">            <span class="comment">//获取mDrawerLayout中的第一个子布局，也就是布局中的RelativeLayout</span></span><br><span class="line">            <span class="comment">//获取抽屉的view</span></span><br><span class="line">            <span class="type">View</span> <span class="variable">mContent</span> <span class="operator">=</span> drawerLayout.getChildAt(<span class="number">0</span>);</span><br><span class="line">            <span class="type">float</span> <span class="variable">scale</span> <span class="operator">=</span> <span class="number">1</span> - slideOffset;</span><br><span class="line">            <span class="type">float</span> <span class="variable">endScale</span> <span class="operator">=</span> <span class="number">0.8f</span> + scale * <span class="number">0.2f</span>;</span><br><span class="line">            <span class="type">float</span> <span class="variable">startScale</span> <span class="operator">=</span> <span class="number">1</span> - <span class="number">0.3f</span> * scale;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//设置左边菜单滑动后的占据屏幕大小</span></span><br><span class="line">            drawerView.setScaleX(startScale);</span><br><span class="line">            drawerView.setScaleY(startScale);</span><br><span class="line">            <span class="comment">//设置菜单透明度</span></span><br><span class="line">            drawerView.setAlpha(<span class="number">0.6f</span> + <span class="number">0.4f</span> * (<span class="number">1</span> - scale));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//设置内容界面水平和垂直方向偏转量</span></span><br><span class="line">            <span class="comment">//在滑动时内容界面的宽度为 屏幕宽度减去菜单界面所占宽度</span></span><br><span class="line">            mContent.setTranslationX(drawerView.getMeasuredWidth() * (<span class="number">1</span> - scale));</span><br><span class="line">            <span class="comment">//设置内容界面操作无效（比如有button就会点击无效）</span></span><br><span class="line">            mContent.invalidate();</span><br><span class="line">            <span class="comment">//设置右边菜单滑动后的占据屏幕大小</span></span><br><span class="line">            mContent.setScaleX(endScale);</span><br><span class="line">            mContent.setScaleY(endScale);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    toggle.syncState();</span><br><span class="line">    drawerLayout.addDrawerListener(toggle);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置图片为本身的颜色</span></span><br><span class="line">    navigationView.setItemIconTintList(<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">//设置item的点击事件</span></span><br><span class="line">    navigationView.setNavigationItemSelectedListener(<span class="keyword">new</span> <span class="title class_">NavigationView</span>.OnNavigationItemSelectedListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onNavigationItemSelected</span><span class="params">(<span class="meta">@NonNull</span> MenuItem item)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (item == menuItem1) &#123;</span><br><span class="line"></span><br><span class="line">                drawerLayout.closeDrawer(GravityCompat.START);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item == menuItem2) &#123;</span><br><span class="line"></span><br><span class="line">                drawerLayout.closeDrawer(GravityCompat.START);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item == menuItem3) &#123;</span><br><span class="line"></span><br><span class="line">                drawerLayout.closeDrawer(GravityCompat.START);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item == menuItem4) &#123;</span><br><span class="line"></span><br><span class="line">                drawerLayout.closeDrawer(GravityCompat.START);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//头部设置监听</span></span><br><span class="line">    tvHeader.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">            Toast.makeText(HomeActivity.<span class="built_in">this</span>, <span class="string">&quot;登录成功&quot;</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4、CoordinatorLayout"><a href="#4、CoordinatorLayout" class="headerlink" title="4、CoordinatorLayout"></a>4、CoordinatorLayout</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/jxf_access/article/details/79564669">https://blog.csdn.net/jxf_access/article/details/79564669</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/01/13/android_Broadcast/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/13/android_Broadcast/" class="post-title-link" itemprop="url">Broadcast</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-13 11:18:18" itemprop="dateCreated datePublished" datetime="2020-01-13T11:18:18Z">2020-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-13 09:13:26" itemprop="dateModified" datetime="2022-11-13T09:13:26Z">2022-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="广播机制简介"><a href="#广播机制简介" class="headerlink" title="广播机制简介"></a>广播机制简介</h1><p>Android的广播机制非常灵活，Android的每一个应用程序都可以对自己感兴趣的广播进行注册，这样该程序就只会接收到自己所关心的广播内容，这些广播可能是来自系统的，也可能是来自于其他应用程序的。</p>
<p>Android提供了一套完整的API,允许应用程序自由地发送和接收广播。发送广播借助Intent，而接收广播的方法利用广播接收器Broadcast Receiver。</p>
<p>广播(Broadcast)机制用于进程&#x2F;线程间通信，因此在我们应用程序内发出的广播，其他的应用程序应该也是可以收到的。广播分为广播发送和广播接收两个过程，其中广播接收者BroadcastReceiver便是Android四大组件之一。</p>
<h2 id="BroadcastReceiver分为两类："><a href="#BroadcastReceiver分为两类：" class="headerlink" title="BroadcastReceiver分为两类："></a>BroadcastReceiver分为两类：</h2><ul>
<li>静态广播接收者：通过AndroidManifest.xml的标签来申明的BroadcastReceiver。</li>
<li>动态广播接收者：通过AMS.registerReceiver()方式注册的BroadcastReceiver，动态注册更为灵活，可在不需要时通过unregisterReceiver()取消注册。</li>
</ul>
<h2 id="从广播发送方式可分为三类："><a href="#从广播发送方式可分为三类：" class="headerlink" title="从广播发送方式可分为三类："></a>从广播发送方式可分为三类：</h2><ol>
<li>普通广播：通过Context.sendBroadcast()发送，可并行处理</li>
<li>有序广播：通过Context.sendOrderedBroadcast()发送，串行处理</li>
<li>Sticky广播：通过Context.sendStickyBroadcast()发送</li>
</ol>
<h1 id="广播的分类"><a href="#广播的分类" class="headerlink" title="广播的分类"></a>广播的分类</h1><h2 id="按照发送的方式分类"><a href="#按照发送的方式分类" class="headerlink" title="按照发送的方式分类"></a>按照发送的方式分类</h2><h3 id="标准广播"><a href="#标准广播" class="headerlink" title="标准广播"></a>标准广播</h3><p>一种完全异步执行的广播。在广播发出之后，所有的广播接收器几乎都会在同一时刻接收到这条广播信息，因此他们之间没有任何先后顺序可言。这种广播的效率会比较高，但同时也意味着它是无法被截断的。<br><img src="/images/Broadcast/3628688-b313939f9c2d9849.webp"><br>发送标准广播（异步，无序）</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send<span class="constructor">Broadcast(<span class="params">intent</span>)</span>;</span><br></pre></td></tr></table></figure>

<h3 id="有序广播"><a href="#有序广播" class="headerlink" title="有序广播"></a>有序广播</h3><p>一种同步执行的广播，在广播发出之后，同一时刻只会有一个广播接收器能够收到这条广播信息，当这个广播接收器中的逻辑执行完毕后，广播才会继续传递。此时的广播是有先后顺序的，优先级别高的广播接收器就可以先收到广播信息，并且前面的广播接收器还可以截断正在传递的广播，这样后面的广播接收器就无法收到广播信息了。<br><img src="/images/Broadcast/3628688-f5ea7c30c61ae662.webp"><br>发送有序广播（同步,有序)</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send<span class="constructor">OrderedBroadcast(<span class="params">intent</span>,<span class="params">null</span>)</span>;</span><br></pre></td></tr></table></figure>

<h2 id="按照注册的方式分类"><a href="#按照注册的方式分类" class="headerlink" title="按照注册的方式分类"></a>按照注册的方式分类</h2><h3 id="动态注册广播"><a href="#动态注册广播" class="headerlink" title="动态注册广播"></a>动态注册广播</h3><p>顾名思义，就是在代码中注册的。</p>
<h3 id="静态注册广播"><a href="#静态注册广播" class="headerlink" title="静态注册广播"></a>静态注册广播</h3><p>动态注册要求程序必须在运行时才能进行，有一定的局限性，如果我们需要在程序还没启动的时候就可以接收到注册的广播，就需要静态注册了。主要是在AndroidManifest中进行注册。</p>
<h2 id="按照定义的方式分类"><a href="#按照定义的方式分类" class="headerlink" title="按照定义的方式分类"></a>按照定义的方式分类</h2><h3 id="系统广播"><a href="#系统广播" class="headerlink" title="系统广播"></a>系统广播</h3><p>Android系统中内置了多个系统广播，每个系统广播都具有特定的intent-filter，其中主要包括具体的action，系统广播发出后，将被相应的BroadcastReceiver接收。系统广播在系统内部当特定事件发生时，由系统自动发出。</p>
<h3 id="自定义广播"><a href="#自定义广播" class="headerlink" title="自定义广播"></a>自定义广播</h3><p>由应用程序开发者自己定义的广播</p>
<h4 id="标准广播-1"><a href="#标准广播-1" class="headerlink" title="标准广播"></a>标准广播</h4><h4 id="有序广播-1"><a href="#有序广播-1" class="headerlink" title="有序广播"></a>有序广播</h4><h1 id="接收系统广播"><a href="#接收系统广播" class="headerlink" title="接收系统广播"></a>接收系统广播</h1><p>Android 内置了很多系统级别的广播，我们可以在应用程序中通过监听这些广播来得到各种系统的状态信息。比如手机开机完成后会发出一条广播，电池的电量发生变化会发出一条广播，时间或时区发生改变也会发出一条广播等。而想要接收到这些广播，需要使用广播接收器。</p>
<h2 id="实现一个广播接收器"><a href="#实现一个广播接收器" class="headerlink" title="实现一个广播接收器"></a>实现一个广播接收器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBroadcastReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">        Toast.makeText(context, <span class="string">&quot;received in MyBroadcastReceiver&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        abortBroadcast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要就是继承一个BroadcastReceiver，重写onReceive方法，当有广播来的时候，onReceive（）方法就会得到执行。在其中实现自己的业务逻辑就可以了。</p>
<h2 id="动态注册监听网络变化"><a href="#动态注册监听网络变化" class="headerlink" title="动态注册监听网络变化"></a>动态注册监听网络变化</h2><ul>
<li><p>动态注册：代码中注册。 </p>
<p>动态注册：调用Context的registerReceiver函数注册BroadcastReceiver； 当应用程序不再需要监听广播时，则需要调用unregisterReceiver函数进行反注册</p>
</li>
<li><p>静态注册：AndroidManifest.xml注册</p>
</li>
</ul>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;       </span><br><span class="line">    <span class="keyword">private</span> IntentFilter intentFilter;</span><br><span class="line">    <span class="keyword">private</span> NetworkChangeReceiver networkChangeReceiver;</span><br><span class="line">    <span class="keyword">private</span> LocalReceiver localReceiver;</span><br><span class="line">    <span class="keyword">private</span> LocalBroadcastManager localBroadcastManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">         <span class="comment">//创建IntentFilter实例（Intent的属性）。因为广播得靠intent来启动。</span></span><br><span class="line">        intentFilter = <span class="keyword">new</span> <span class="title class_">IntentFilter</span>();</span><br><span class="line">        <span class="comment">//添加action，想要接收器监听什么广播，就在这里添加相应的action---对应的是网络发生变化时系统发出的广播</span></span><br><span class="line">        intentFilter.addAction(<span class="string">&quot;android.net.conn.CONNECTIVITY_CHANGE&quot;</span>);</span><br><span class="line">        <span class="comment">//创建网络改变广播接收器</span></span><br><span class="line">        networkChangeReceiver = <span class="keyword">new</span> <span class="title class_">NetworkChangeReceiver</span>();</span><br><span class="line">        <span class="comment">//注册广播接收器，传入该接收器和IntentFilter；newworkChangeReceiver就是接收器</span></span><br><span class="line">        registerReceiver(networkChangeReceiver,intentFilter);</span><br><span class="line"></span><br><span class="line">        localBroadcastManager = LocalBroadcastManager.getInstance(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> (Button)findViewById(R.id.button);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;com.example.broadcasttest.MY_BROADCAST&quot;</span>);</span><br><span class="line">                <span class="comment">//发送异步广播（标准广播，无序）</span></span><br><span class="line">                sendBroadcast(intent);</span><br><span class="line">                <span class="comment">//发送同步广播（有序广播）</span></span><br><span class="line">                sendOrderedBroadcast(intent,<span class="literal">null</span>);</span><br><span class="line">                <span class="comment">//发送本地广播</span></span><br><span class="line">                <span class="type">Intent</span> <span class="variable">intent2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;com.example.broadcasttest.LOCAL_BROADCAST&quot;</span>);</span><br><span class="line">                localBroadcastManager.sendBroadcast(intent2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注册本地广播监听器</span></span><br><span class="line">        intentFilter = <span class="keyword">new</span> <span class="title class_">IntentFilter</span>();</span><br><span class="line">        intentFilter.addAction(<span class="string">&quot;com.example.broadcasttest.LOCAL_BROADCAST&quot;</span>);</span><br><span class="line">        localReceiver = <span class="keyword">new</span> <span class="title class_">LocalReceiver</span>();</span><br><span class="line">        localBroadcastManager.registerReceiver(localReceiver,intentFilter);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onDestroy();</span><br><span class="line">    <span class="comment">//动态注册的广播接收器一定要取消注册才行，调用unregisterReceiver()方法实现</span></span><br><span class="line">    unregisterReceiver(networkChangeReceiver);</span><br><span class="line">    localBroadcastManager.unregisterReceiver(localReceiver);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//内部类NetworkChangeReceiver是继承自BroadcastReceiver的，并重写了父类的onReceive（）方法。当网络发生变化时，onReceive方法就会得到执行</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NetworkChangeReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *getSystemService是有关Android系统服务的一个api。</span></span><br><span class="line"><span class="comment">        *ConnectivityManager是一个回应当前网络状况的一个类，当网络发生改变的时候，会做出通知。</span></span><br><span class="line"><span class="comment">        *通过networkinfo可以判断当前网络是否存在（api29不推荐是使用）</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="type">ConnectivityManager</span> <span class="variable">connectionManager</span> <span class="operator">=</span> (ConnectivityManager)context.getSystemService(Context.CONNECTIVITY_SERVICE);</span><br><span class="line">        <span class="type">NetworkInfo</span> <span class="variable">networkInfo</span> <span class="operator">=</span> connectionManager.getActiveNetworkInfo();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(networkInfo != <span class="literal">null</span> &amp;&amp; networkInfo.isAvailable())&#123;</span><br><span class="line">        Toast.makeText(context,<span class="string">&quot;network is available&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        Toast.makeText(context, <span class="string">&quot;network is unavailable&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建广播过滤器 new IntentFilter() ,添加一个值为android.net.conn.CONNECTIVIT_CHANGE的action，之所以添加这个值，是因为当网络状态发生变化的时候，系统发出的正是一条值为android.net.conn.CONNECTIVITY_CHANGE的广播。 </li>
<li>创建广播接收者NetworkChangeReceiver，并重写onReceive方法，每当网络状态发生变化的时候，onReceive方法就会得到执行，这里只是简单地使用Toast提示一段文本信息。  </li>
<li>调用registerReceiver方法进行注册，将广播接收者和过滤者的实例都传进去，就可以监听网络变化的状态了。</li>
<li>动态注册的广播接收器一定要取消注册才行：在onDestory（）方法中调用ungisterReceiver（）方法来实现。  </li>
<li>首先注册完成的时候会收到一条广播，然后修改下网络状态，又会受到一条广播，就 Toast提醒网络状态发生了变化。</li>
</ul>
<p><strong>注意事项</strong><br><strong>1. 发送异步广播(标准广播，无序) 使用sendBroadcast(intent)方法; 而发送同步广播(有序广播) 使用sendOrderedBroadcast(intent,null)方法;</strong><br><strong>2. 动态注册的广播接收器一定都要取消注册才行，这里我们是在 onDestroy()方法中通过调用unregisterReceiver()方法来实现的。</strong><br><strong>3. 动态注册 的广播接收器可以自由地控制注册与注销，在灵活性方面有很大的优势，但它也存在着一个缺点，即必须要在程序启动之后才能接收到广播，因为注册的逻辑是写在 onCreate()方法中的。</strong></p>
<p>只是提醒网络是否发生变化并不太人性化，还要准确地告诉用户当前是有网络还是没有网络，因此我们还需要对上面的代码进行优化，修改onReceive中的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NetworkChangeReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">            <span class="type">ConnectivityManager</span> <span class="variable">connectivityManager</span> <span class="operator">=</span> (ConnectivityManager)</span><br><span class="line">            getSystemService(Context.CONNECTIVITY_SERVICE);</span><br><span class="line">            <span class="type">NetworkInfo</span> <span class="variable">networkInfo</span> <span class="operator">=</span> connectivityManager.getActiveNetworkInfo();</span><br><span class="line">            <span class="keyword">if</span> (networkInfo!=<span class="literal">null</span>&amp;&amp;networkInfo.isAvailable())&#123;</span><br><span class="line">                Toast.makeText(context,<span class="string">&quot;network is available&quot;</span>,Toast.LENGTH_SHORT).</span><br><span class="line">                show();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                Toast.makeText(context,<span class="string">&quot;network is unavailable&quot;</span>,Toast.LENGTH_SHORT).</span><br><span class="line">                show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在onReceive方法中，首先通过getSystemService方法得到ConnectivityManager的实例，这是系统服务类，专门用于管理网络连接的。  </li>
<li>&#x3D;&#x3D;然后调用它的getActiveNetworkInfo方法可以得到NetworkInfor实例&#x3D;&#x3D;。  </li>
<li>接着调用NetworkInfo的isAvailable方法，就可以判断出当前是否有网络了。  </li>
<li>添加访问网络状态的权限(6.0就要动态注册了,后面讲):</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="静态注册实现开机启动"><a href="#静态注册实现开机启动" class="headerlink" title="静态注册实现开机启动"></a>静态注册实现开机启动</h2><p>动态注册的广播接收器虽然可以自由地控制注册和注销，但是必须在程序启动之后才能接收到广播。如果想让程序在未启动的情况下就能接收到广播，就需要静态注册了。现在我们让程序接收一条开机广播，当收到这个条广播时就可以在onReceive（）方法里执行相应的逻辑，从而实现开机启动的功能。</p>
<p>在程序包-&gt;New—&gt;Other-&gt;Broadcast Receiver新建广播接收器，可选 Exported属性表示是否允许这个广播接收器接收本程序以外的广播，Enabled属性表示是否启用这个广播接收器。<br>新建的广播接收器，会由Android Studio自动帮你在AndroidManifest中注册。</p>
<p> 代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">package</span>=<span class="string">&quot;com.example.a123.broadcasttest&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 权限声明，很多Android系统功能都是需要声明权限才能使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--接收开机启动完成发出的广播消息，需要声明RECEIVE_BOOT_COMPLETED权限--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--所有静态广播接收器都是在receiver这个标签内进行注册的</span></span><br><span class="line"><span class="comment">	name:指定具体注册哪一个广播接收器</span></span><br><span class="line"><span class="comment">	enabled：是否启用该广播接收器</span></span><br><span class="line"><span class="comment">	exported：是否允许这个广播接收器接收本程序以外的广播</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;.BootCompleteReceiver&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--添加该广播接收器能接受的事件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>         </span><br><span class="line">            <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.BOOT_COMPLETED&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;.MyBroadcastReceiver&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--通过android:priority=&quot;100&quot;设置优先级，优先级高的广播接收器可以先收到广播--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">                //接收自定义广播</span><br><span class="line">            <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.broadcasttest.MY_BROADCAST&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>静态的广播接收器一定要在AndroidManifest.xml中注册才可以使用，不过由于先前是使用AS快捷方式创建的广播接收器，因此注册这一步已经被自动完成了。会发现application标签内多了如下代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:name</span>=<span class="string">&quot;.BootCompleteReceiver&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：在标签内出现了一个新的标签，所有静态的广播接收器都是在这里进行注册的。它的用法其实和标签很相似，都是通过android：name来指定具体注册哪一个广播接收器，而 enaled和exported属性则是根据我们刚才勾选的状态自动生成的。</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;receiver</span><br><span class="line">    android:<span class="attribute">name</span>=<span class="string">&quot;.BootCompleteReceiver&quot;</span></span><br><span class="line">    android:<span class="attribute">enabled</span>=<span class="string">&quot;true&quot;</span></span><br><span class="line">    android:<span class="attribute">exported</span>=<span class="string">&quot;true&quot;</span>&gt;&lt;/receiver&gt;</span><br></pre></td></tr></table></figure>

<p>几个相关解释：</p>
<blockquote>
<p>android:exported<br>此BroadcastReceiver能否接收其他App发出的广播(其默认值是由receiver中有无intent-filter决定的，如果有intent-filter，默认值为true，否则为false);<br>android:name<br>此broadcastReceiver类名;<br>android:permission<br>如果设置，具有相应权限的广播发送方发送的广播才能被此broadcastReceiver所接收;<br>android:process<br>broadcastReceiver运行所处的进程。默认为App的进程。可以指定独立的进程(Android四大组件都可以通过此属性指定自己的独立进程);</p>
</blockquote>
<p>不过目前BootCompleteReceiver还是不能接收到开机广播的，还需要对广播进行限定，添加广播过滤器和申请权限。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.BootCompleteReceiver&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.BOOT_COMPLETED&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="attribute">name</span>=<span class="string">&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>由于Android系统启动完成后会发出一条值为android.permission.RECEIVE_BOOT_COMPLETED的广播，因此我们 标签里添加了相应的action。  </li>
<li>监听系统开机广播也是需要声明权限的，我们使用标签又加入一条android.permission.RECEIVE_BOOT_COMPLETED权限。<br>将模拟器重新启动就可以收到开机广播了。</li>
</ul>
<p><strong>需要额外注意的是，不要在onReceive()方法中添加过多的逻辑或者进行任何的耗时操作，因为在广播接收器中是不允许开启线程的，当onReceive方法运行较长时间而没有结束时，程序就会报错。所以广播接收器更多的是扮演一种打开程序其他组件的角色，比如创建一条状态栏通知，或者启动一个服务等。</strong></p>
<h1 id="发送广播"><a href="#发送广播" class="headerlink" title="发送广播"></a>发送广播</h1><p>根据广播的发送方式，可以将其分为以下几种类型：</p>
<ul>
<li>Normal Broadcast：普通广播</li>
<li>Ordered broadcast：有序广播</li>
<li>Sticky Broadcast：粘性广播 (在 android 5.0&#x2F;api 21中deprecated,不再推荐使用，相应的还有粘性有序广播，同样已经deprecated)</li>
</ul>
<h2 id="发送标准广播"><a href="#发送标准广播" class="headerlink" title="发送标准广播"></a>发送标准广播</h2><p>标准广播的主要特点为：</p>
<ul>
<li>同级别接收先后是随机的（无序的）</li>
<li>级别低的后接收到广播</li>
<li>接收器不能截断广播的继续传播，也不能处理广播</li>
<li>同级别动态注册（代码中注册）高于静态注册（AndroidManifest中注册）<br><img src="/images/Broadcast/2403563-c27b3860eb6821c6.webp" alt="image"></li>
</ul>
<blockquote>
<p>Context类提供两个方法可以用于发送普通广播：<br><strong>sendBroadcast(Intent intent);</strong><br>**sendBroadcast(Intent intent, String receiverPermission);**【第一个参数是intent，第二个参数是一个与权限有关的字符串】<br>差别是第二个设置权限。<br>发给特定的用户：<br>sendBroadcastAsUser(Intent intent, UserHandle user);<br>sendBroadcastAsUser(Intent intent, UserHandle user, String receiverPermission);</p>
</blockquote>
<h2 id="发送有序广播"><a href="#发送有序广播" class="headerlink" title="发送有序广播"></a>发送有序广播</h2><p>有序广播（Ordered broadcasts）则是一种同步执行的广播，在广播发出之后，同一时刻只会有一个广播接收器能够收到这条广播消息，当这个广播接收器中的逻辑执行完毕后，广播才会继续传递。所以此时的广播接收器是有先后顺序的，优先级高的广播接收器就可以先收到广播消息，并且前面的广播接收器还可以截断正在传递的广播，这样后面的广播接收器就无法收到广播消息了，只是其的主要发送方式变为：sendOrderedBroadcast(intent, receiverPermission, …)。  </p>
<p><img src="/images/Broadcast/2403563-db12e4cab4ca8ef7.webp" alt="image"></p>
<blockquote>
<p>1&gt;多个具当前已经注册且有效的BroadcastReceiver接收有序广播时，是按照先后顺序接收的，先后顺序判定标准遵循为：将当前系统中所有有效的动态注册和静态注册的BroadcastReceiver按照priority属性值从大到小排序，对于具有相同的priority的动态广播和静态广播，动态广播会排在前面。<br>2&gt;先接收的BroadcastReceiver可以对此有序广播进行截断，使后面的BroadcastReceiver不再接收到此广播，也可以对广播进行修改，使后面的BroadcastReceiver接收到广播后解析得到错误的参数值。当然，一般情况下，不建议对有序广播进行此类操作，尤其是针对系统中的有序广播。<br>有序广播的主要特点：</p>
</blockquote>
<p>同级别接收是随机的(结合下一条)<br>同级别动态注册（代码中注册）高于静态注册（AndroidManifest中注册）<br>排序规则为：将当前系统中所有有效的动态注册和静态注册的BroadcastReceiver按照priority属性值从大到小排序<br>先接收的BroadcastReceiver可以对此有序广播进行截断，使后面的BroadcastReceiver不再接收到此广播，也可以对广播进行修改，使后面的BroadcastReceiver接收到广播后解析得到错误的参数值。当然，一般情况下，不建议对有序广播进行此类操作，尤其是针对系统中的有序广播。实现截断的代码为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abortBroadcast();</span><br></pre></td></tr></table></figure>

<h2 id="发送本地广播"><a href="#发送本地广播" class="headerlink" title="发送本地广播"></a>发送本地广播</h2><p>前面涉及的都是系统的全局广播。容易引起安全性的问题。</p>
<p>本地广播就只能在应用程序的内部进行传递，广播接收器也只能接收来自本应用程序发出的广播。</p>
<p>发送本地广播主要使用LocalBroadcastManager来对广播进行管理，并提供了发送广播和注册广播接收器的方法</p>
<p>代码实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> IntentFilter intentFilter;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> LocalReceive localReceive;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> LocalBroadcastManager localBroadcastManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="comment">//获取到LocalBroadcastManager实例对象</span></span><br><span class="line">        localBroadcastManager = LocalBroadcastManager.getInstance(<span class="built_in">this</span>);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> (Button) findViewById(R.id.button);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> <span class="title class_">OnClickListener</span>() &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="comment">//创建Intent对象，指定广播内容</span></span><br><span class="line">                <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;com.example.broadcasttest.LOCAL_BROADCAST&quot;</span>);</span><br><span class="line">                <span class="comment">//发送本地广播</span></span><br><span class="line">                localBroadcastManager.sendBroadcast(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        intentFilter = <span class="keyword">new</span> <span class="title class_">IntentFilter</span>();</span><br><span class="line">        intentFilter.addAction(<span class="string">&quot;com.example.broadcasttest.LOCAL_BROADCAST&quot;</span>);</span><br><span class="line">        localReceive = <span class="keyword">new</span> <span class="title class_">LocalReceive</span>();</span><br><span class="line">        <span class="comment">//注册本地广播接收器</span></span><br><span class="line">        localBroadcastManager.registerReceiver(localReceive, intentFilter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onDestroy();</span><br><span class="line">        <span class="comment">//动态注册，同样需要取消注册广播</span></span><br><span class="line">        localBroadcastManager.unregisterReceiver(localReceive);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">LocalReceive</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">            Toast.makeText(context, <span class="string">&quot;received local broadcast&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>对于LocalBroadcastManager方式发送的应用内广播，只能通过LocalBroadcastManager动态注册的ContextReceiver才有可能接收到（静态注册或其他方式动态注册的ContextReceiver是接收不到的）。</strong>   </p>
<p>本地广播是无法通过静态注册的方式来接收的，因为静态注册主要就是为了让程序在未启动的情况下也能收到广播，而发送本地广播时，我们的程序肯定已经启动了。 </p>
<p>本地广播的优势:</p>
<ol>
<li>可以明确知道正在发送的广播不会离开我们的程序，不需要担心机密数据泄漏的问题。</li>
<li>其他的程序无法将广播发送到我们程序的内部，不需要担心会有安全漏洞的隐患。</li>
<li>发送本地广播比起发送系统全局广播将会更加高效。</li>
</ol>
<h2 id="广播的安全性问题"><a href="#广播的安全性问题" class="headerlink" title="广播的安全性问题"></a>广播的安全性问题</h2><p>由前文阐述可知，Android中的广播可以跨进程甚至跨App直接通信，且exported属性在有intent-filter的情况下默认值是true，由此将可能出现的安全隐患如下：</p>
<ul>
<li>其他App可能会针对性的发出与当前App intent-filter相匹配的广播，由此导致当前App不断接收到广播并处理；  </li>
<li>其他App可以注册与当前App一致的intent-filter用于接收广播，获取广播具体信息。</li>
</ul>
<p>无论哪种情形，这些安全隐患都确实是存在的。由此，业界常见的一些增加安全性的方案包括：</p>
<ul>
<li>对于同一App内部发送和接收广播，将exported属性人为设置成false，使得非本App内部发出的此广播不被接收;</li>
<li>在广播发送和接收时，都增加上相应的permission，用于权限验证；</li>
<li>发送广播时，指定特定广播接收器所在的包名，具体是通过intent.setPackage(packageName)指定，这样此广播将只会发送到此包中的App内与之相匹配的有效广播接收器中。  </li>
<li>采用LocalBroadcastManager的方式</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/01/13/android_Adapter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/13/android_Adapter/" class="post-title-link" itemprop="url">Adapter</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-13 11:15:53" itemprop="dateCreated datePublished" datetime="2020-01-13T11:15:53Z">2020-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-13 09:13:26" itemprop="dateModified" datetime="2022-11-13T09:13:26Z">2022-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Android-adapter"><a href="#Android-adapter" class="headerlink" title="Android adapter"></a>Android adapter</h1><p><strong>简单来说：适配器是用来帮助数据以合适的形式显示在view中给用户看的。</strong></p>
<p>Android中Adapter类其实就是把数据源绑定到指定的View上，然后再<strong>返回该View</strong>，（eg：而返回来的这个View就是ListView中的某一 行item。）这里返回来的View正是由我们的Adapter中的getView方法返回的。（这样就会容易理解数据是怎样一条一条显示在ListView 中的。）</p>
<p> Adapter是连接后端数据和前端显示的适配器接口，是数据和UI（View）之间一个重要的纽带。在常见的View(ListView,GridView)等地方都需要用到Adapter。如下图直观的表达了Data、Adapter、View三者的关系：</p>
<p><img src="/images/Adapter/5a031ddfef1b419fc712b2b85a30c61e.jpe" alt="img"></p>
<h2 id="Android中的adapter"><a href="#Android中的adapter" class="headerlink" title="Android中的adapter"></a>Android中的adapter</h2><p><img src="/images/Adapter/7d1d63e8855f237fec67a3f9fa0ed077.jpe" alt="img"></p>
<p>在我们使用过程中可以根据自己的需求实现接口或者继承类进行一定的扩展。比较常用的有 BaseAdapter，SimpleAdapter，ArrayAdapter，SimpleCursorAdapter等。</p>
<ul>
<li>BaseAdapter是一个抽象类，继承它需要实现较多的方法，所以也就具有较高的灵活性；</li>
<li>ArrayAdapter支持泛型操作，最为简单，只能展示一行字。</li>
<li>SimpleAdapter有最好的扩充性，可以自定义出各种效果。</li>
<li>SimpleCursorAdapter可以适用于简单的纯文字型ListView，它需要Cursor的字段和UI的id对应起来。如需要实现更复杂的UI也可以重写其他方法。可以认为是SimpleAdapter对数据库的简单结合，可以方便地把数据库的内容以列表的形式展示出来。</li>
</ul>
<h3 id="ArrayAdapter（数组适配器）"><a href="#ArrayAdapter（数组适配器）" class="headerlink" title="ArrayAdapter（数组适配器）"></a>ArrayAdapter（数组适配器）</h3><p>只能显示一行文本数据</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/huolan/p/5126794.html">https://www.cnblogs.com/huolan/p/5126794.html</a></p>
<p>布局文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/ll1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.test3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.ArrayAdapter;</span><br><span class="line"><span class="keyword">import</span> android.widget.ListView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span>&#123;</span><br><span class="line"><span class="comment">//    定义要显示的数据</span></span><br><span class="line">    <span class="keyword">private</span> String[] datas = &#123;<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;王五&quot;</span>,<span class="string">&quot;麻子&quot;</span>,<span class="string">&quot;小强&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> ArrayAdapter&lt;String&gt; adapter;</span><br><span class="line">    <span class="keyword">private</span> ListView listView;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        listView = (ListView) findViewById(R.id.ll1);</span><br><span class="line"><span class="comment">//        初始化适配器</span></span><br><span class="line">        adapter = <span class="keyword">new</span> <span class="title class_">ArrayAdapter</span>&lt;&gt;(<span class="built_in">this</span>,android.R.layout.simple_expandable_list_item_1,datas);</span><br><span class="line">        listView.setAdapter(adapter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果图：</p>
<p><img src="/images/Adapter/Sun,%2008%20Sep%202019%20191821.png" alt="img"></p>
<p>ArrayAdapter的参数说明：</p>
<p>第一个参数：context上下文对象</p>
<p>第二个参数：每一个item的样式，可以使用系统提供，也可以自定义就是一个TextView</p>
<p>第三个参数：数据源，要显示的数据</p>
<blockquote>
<p>系统提供的item的样式，可以试一试：</p>
<p>simple_list_item1:单独的一行文本框</p>
<p>simple_list_item2:有两个文本框组成</p>
<p>simple_list_item_checked每项都是由一个已选中的列表项</p>
<p>simple_list_item_multiple_choice:都带有一个复选框</p>
<p>simple_list_item_single_choice：都带有一个单选框</p>
</blockquote>
<h3 id="SimpleAdapter"><a href="#SimpleAdapter" class="headerlink" title="SimpleAdapter"></a>SimpleAdapter</h3><p>simpleAdapter的扩展性最好，可以定义各种各样的布局出来，可以放上ImageView（图片），还可以放上Button（按钮），CheckBox（复选框）等等。</p>
<p>使用的样例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/ll1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>实现的item样例:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/image1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_margin</span>=<span class="string">&quot;5dp&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:id</span>=<span class="string">&quot;@+id/ll2&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_height</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;5dp&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;10dp&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:id</span>=<span class="string">&quot;@+id/text1&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:text</span>=<span class="string">&quot;哈哈&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:textSize</span>=<span class="string">&quot;30sp&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:id</span>=<span class="string">&quot;@+id/text2&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:text</span>=<span class="string">&quot;哈哈哈哈哈&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:textSize</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>java文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.test3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.ListView;</span><br><span class="line"><span class="keyword">import</span> android.widget.SimpleAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span>&#123;</span><br><span class="line"><span class="comment">//    这三个经常是同时出现的</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Map&lt;String,Object&gt;&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> SimpleAdapter adapter;</span><br><span class="line">    <span class="keyword">private</span> ListView listView;<span class="comment">//使用listview的缓存机制【】</span></span><br><span class="line"><span class="comment">//    定义数据</span></span><br><span class="line">    <span class="keyword">private</span> String[] theme = &#123;<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;王五&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> String[] content =&#123;<span class="string">&quot;我是张三，你好&quot;</span>,<span class="string">&quot;我是李四，你好&quot;</span>,<span class="string">&quot;我是王五，你好&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] imageViews = &#123;R.mipmap.ic_launcher,R.mipmap.ic_account,R.mipmap.ic_password&#125;;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    saveInsanceState也就是保存Activity的状态的。那么，saveInsanceState中的状态数据是从何处而来的呢？下面我们介绍Activity的另一个方法saveInsanceState。</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    onsaveInsanceState方法是用来保存Activity的状态的。当一个Activity在生命周期结束前，会调用该方法保存状态。</span></span><br><span class="line"><span class="comment">    当一个Activity结束前，如果需要保存状态，就在onsaveInsanceState中，将状态数据以key-value的形式放入到saveInsanceState中。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        listView = (ListView) findViewById(R.id.ll1);</span><br><span class="line"><span class="comment">//        准备数据源</span></span><br><span class="line">        lists = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; theme.length;i++)&#123;</span><br><span class="line">            Map&lt;String,Object&gt; map =<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            map.put(<span class="string">&quot;image&quot;</span>,imageViews[i]);</span><br><span class="line">            map.put(<span class="string">&quot;theme&quot;</span>,theme[i]);</span><br><span class="line">            map.put(<span class="string">&quot;content&quot;</span>,content[i]);</span><br><span class="line">            lists.add(map);</span><br><span class="line">        &#125;</span><br><span class="line">        adapter = <span class="keyword">new</span> <span class="title class_">SimpleAdapter</span>(MainActivity.<span class="built_in">this</span>,lists,R.layout.list_item</span><br><span class="line">                ,<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;image&quot;</span>,<span class="string">&quot;theme&quot;</span>,<span class="string">&quot;content&quot;</span>&#125;</span><br><span class="line">                ,<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;R.id.image1,R.id.text1,R.id.text2&#125;);</span><br><span class="line">        listView.setAdapter(adapter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果图：</p>
<p><img src="data:image/png;base64,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" alt="img"></p>
<p>simpleAdapter中五个参数的</p>
<p>第一个参数：上下文对象</p>
<p>第二个参数：数据源是含有Map的一个集合（<strong>使用simpleAdapter的数据用一般都是HashMap构成的List，list的每一节对应ListView的每一行。</strong>）</p>
<p>第三个参数：每一个item的布局文件</p>
<p>第四个参数：new String[]{}数组，数组的里面的每一项要与第二个参数中的存入map集合的的key值一样，一一对应</p>
<p>第五个参数：new int[]{}数组，数组里面的第三个参数中的item里面的控件id。</p>
<h3 id="BaseAdapter"><a href="#BaseAdapter" class="headerlink" title="BaseAdapter"></a>BaseAdapter</h3><p>使用<strong>ViewHolder</strong>来优化。减少findViewById的使用</p>
<p>就是一个持有者的类，他里面一般没有方法，只有属性，作用就是一个临时的储存器，把你getView方法中每次返回的View存起来，可以下次再用。这样做的好处就是不必每次都到布局文件中去拿到你的View，提高了效率。</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/46d7ef09cb88">https://www.jianshu.com/p/46d7ef09cb88</a></p>
<p>baseAdapter的逗比式、普通式、文艺式链接：</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/112ccd04c5ff">https://www.jianshu.com/p/112ccd04c5ff</a></p>
<p>逗比式：没有使用到ListView的缓存机制，每需要显示一个item布局，就会创建一个新的View对象</p>
<p>普通式：利用了ListView的缓存特性，如果没有缓存（convertView）才创建新的View</p>
<p>ListView的显示和缓存机制：</p>
<p><img src="/images/Adapter/1099585-0fad07c3a51e19f4.webp" alt="img"></p>
<p>文艺式：使用到了ViewHolder。使用convertView中的setTag方法（他是给View对象的一个标签，标签可以是任何内容）屏幕中有多少view就会创建多少与之对应的viewholder类。循环的时候，就不用findviewby了，因为之前已经findviewby过了  并且存储在viewholder类中。</p>
<p>详细介绍的viewholder和缓存机制是怎么协同的：<a target="_blank" rel="noopener" href="https://blog.csdn.net/MoDuRooKie/article/details/80198431">https://blog.csdn.net/MoDuRooKie/article/details/80198431</a></p>
<p><em>Tag</em>不像<em>ID</em>是用标示<em>view</em>的。<em>Tag</em>从本质上来讲是就是<strong>相关联的<em>view</em>的额外的信息</strong>。它们经常用来存储一些<em>view</em>的数据，这样做非常方便而不用存入另外的单独结构。</p>
<p>setTag方法：<a target="_blank" rel="noopener" href="https://blog.csdn.net/grandgrandpa/article/details/82964251">https://blog.csdn.net/grandgrandpa/article/details/82964251</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/01/13/android_Activity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/13/android_Activity/" class="post-title-link" itemprop="url">Activity</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-13 11:15:15" itemprop="dateCreated datePublished" datetime="2020-01-13T11:15:15Z">2020-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-13 09:13:26" itemprop="dateModified" datetime="2022-11-13T09:13:26Z">2022-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Activity概述"><a href="#Activity概述" class="headerlink" title="Activity概述"></a>Activity概述</h1><p>活动代表了一个具有用户界面的单一屏幕，如 Java 的窗口或者帧。Android 的活动是 ContextThemeWrapper 类的子类。<br>它是一种可以包含用户界面组件，主要用于和用户进行交互。</p>
<h2 id="AndroidManifest文件"><a href="#AndroidManifest文件" class="headerlink" title="AndroidManifest文件"></a>AndroidManifest文件</h2><p>AndroidManifest.xml 是每个android程序中必须的文件。它位于整个项目的根目录，描述了package中暴露的组件（activities, services, 等等），他们各自的实现类，各种能被处理的数据和启动位置。 除了能声明程序中的Activities, ContentProviders, Services, 和Intent Receivers,还能指定permissions和instrumentation（安全控制和测试）</p>
<h2 id="活动与任务"><a href="#活动与任务" class="headerlink" title="活动与任务"></a>活动与任务</h2><p>Android将这些活动保持在同一个任务（task）中以维持用户的体验。简单地讲，任务是用户体验上的一个“应用程序”，是排成堆栈的一组相关活动。栈底的活动（根活动）是起始活动——一般来讲，它是用户在应用程序启动器（也称应用程序列表，下同）中选择的一个活动。栈顶的活动是正在运行的活动——它关注用户的行为（操作）。当一个活动启动另一个，新的活动被压入栈顶，变为正在运行的活动。前面那个活动保存在栈中。当用户点击返回按钮时，当前活动从栈顶中弹出，且前面那个活动恢复成为正在运行的活动。</p>
<p>一个任务的所有活动作为一个整体运行。整个任务（整个活动栈）可置于前台或发送到后台。例如，假设当前任务有四个活动在栈中——三个活动在当前活动下面。用户按下HOME键，切换到程序启动器，并选择一个新的应用程序（实际上是一个新的任务）。当前任务进入后台，新任务的根活动将显示。接着，过了一会，用户回到主屏幕并再次选择之前的应用程序（之前的任务）。那个任务栈中的所有四个活动都变为前台运行。当用户按下返回键时，不是离开当前任务回到之前任务的根活动。相反，栈顶的活动被移除且栈中的下一个活动将显示。</p>
<p>上面所描述的是活动和任务的默认行为，但是有方法来改变所有这些行为。活动与任务之间的联系及任务中活动的行为，是由启动活动的Intent对象的标志（flags）和清单文件中活动<activity>元素的属性共同决定的。</p>
<h2 id="菜单menu"><a href="#菜单menu" class="headerlink" title="菜单menu"></a>菜单menu</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/HDK2016/p/8038908.html">https://www.cnblogs.com/HDK2016/p/8038908.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/aiynmimi/article/details/54964945">https://blog.csdn.net/aiynmimi/article/details/54964945</a></p>
<h3 id="菜单的分类"><a href="#菜单的分类" class="headerlink" title="菜单的分类"></a>菜单的分类</h3><p>菜单是Android应用中非常重要且常见的组成部分，主要可以分为三类：选项菜单、上下文菜单&#x2F;上下文操作模式以及弹出菜单。它们的主要区别如下：</p>
<ul>
<li><p>选项菜单是一个应用的主菜单项，用于放置对应用产生全局影响的操作，如搜索&#x2F;设置。</p>
</li>
<li><p>上下文菜单是用户长按某一元素时出现的浮动菜单。它提供的操作将影响所选内容，主要应用于列表中的每一项元素（如长按列表项弹出删除对话框）。上下文操作模式将在屏幕顶部栏（菜单栏）显示影响所选内容的操作选项，并允许用户选择多项，一般用于对列表类型的数据进行批量操作。</p>
</li>
<li><p>弹出菜单以垂直列表形式显示一系列操作选项，一般由某一控件触发，弹出菜单将显示在对应控件的上方或下方。它适用于提供与特定内容相关的大量操作。</p>
</li>
</ul>
<h3 id="选项菜单"><a href="#选项菜单" class="headerlink" title="选项菜单"></a>选项菜单</h3><p>当用户单击设备上的菜单按钮（Menu），触发事件弹出的菜单就是选项菜单。</p>
<h4 id="效果图："><a href="#效果图：" class="headerlink" title="效果图："></a>效果图：</h4><p><img src="/images/Activity/1070689-20171214171311342-1238515765.png"></p>
<p><img src="/images/Activity/1070689-20171214171318951-320255124.png"></p>
<h4 id="实现过程讲解："><a href="#实现过程讲解：" class="headerlink" title="实现过程讲解："></a>实现过程讲解：</h4><p>在Activity中重写<code>onCreateOptionsMenu()</code>来创建选项菜单，在中包含了<code>getMenuInflater().inflate(R.menu.main,menu)</code>，R.menu.main是res的menu文件夹下的xml文件是放菜单的文件夹；</p>
<h4 id="实现代码："><a href="#实现代码：" class="headerlink" title="实现代码："></a>实现代码：</h4><p>设置菜单项可以通过两种方法</p>
<p><strong>1.通过在XML文件中添加控件来实现</strong></p>
<p>在R.menu.main的xml文件中，添加item控件来添加设置菜单项;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;com.jiapeng.munedemo.MainActivity&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/mune_enter&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orderInCategory</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;登录&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">&quot;never&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/mune_setting&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orderInCategory</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;设置&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">&quot;never&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/mune_out&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orderInCategory</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;退出&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">&quot;never&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中：<code>showAsAction</code>主要是针对这个菜单的显示起作用的，它有三个可选项<br>always：总是显示在界面上<br>never：不显示在界面上，只让出现在右边的三个点中<br>ifRoom：如果有位置才显示，不然就出现在右边的三个点中</p>
<p><strong>java代码和设置监听：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> &#123;</span><br><span class="line">    <span class="comment">//导入菜单布局</span></span><br><span class="line">    getMenuInflater().inflate(R.menu.main, menu);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> &#123;</span><br><span class="line">    <span class="comment">//创建菜单项的点击事件</span></span><br><span class="line">    <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">    <span class="keyword">case</span> R.id.mune_enter:</span><br><span class="line">        Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了登陆&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> R.id.mune_setting:</span><br><span class="line">        Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了设置&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> R.id.mune_out:</span><br><span class="line">        Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了退出&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.onOptionsItemSelected(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、<strong>通过动态代码实现</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">menu</span><span class="selector-class">.add</span>(groupId,itemId,<span class="attribute">order</span>,title),</span><br><span class="line"></span><br><span class="line">groupId--<span class="number">1</span>:分组的id;</span><br><span class="line">itemId--<span class="number">100</span>:菜单项的id;</span><br><span class="line"><span class="attribute">order</span>--<span class="number">1</span>:菜单项排序用的;</span><br><span class="line">title--&quot;菜单<span class="number">1</span>&quot;:菜单名称;</span><br></pre></td></tr></table></figure>

<p>menu的用法类似于ArrayList,可以调用add方法来加载如<br>&#x2F;&#x2F;API大于等于11 时 Item图标不显示<br>menu.add(1,100,1,”菜单一”);<br>menu.add(1,101,1,”菜单二”);<br>menu.add(1,102,1,”菜单三”);<br>add方法返回的是item，可以赋值给item，再调用item的setTitle与setIcon（在API&gt;&#x3D;11时，是不显示图标的）来设置item。</p>
<p><strong>代码如下</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> &#123;</span><br><span class="line">        <span class="comment">// groupId--1:分组的id;itemId--100:菜单项的id;order--1:菜单项排序用的;title--&quot;菜单1&quot;:菜单名称;</span></span><br><span class="line">        <span class="type">MenuItem</span> <span class="variable">item</span> <span class="operator">=</span> menu.add(<span class="number">1</span>, <span class="number">100</span>, <span class="number">1</span>, <span class="string">&quot;菜单项&quot;</span>);</span><br><span class="line">        item.setTitle(<span class="string">&quot;我是一个菜单&quot;</span>);</span><br><span class="line">        <span class="comment">// 在API&gt;=11时，是不显示图标的</span></span><br><span class="line">        item.setIcon(R.drawable.ic_launcher);</span><br><span class="line">        menu.add(<span class="number">1</span>, <span class="number">101</span>, <span class="number">1</span>, <span class="string">&quot;登录&quot;</span>);</span><br><span class="line">        menu.add(<span class="number">1</span>, <span class="number">102</span>, <span class="number">1</span>, <span class="string">&quot;设置&quot;</span>);</span><br><span class="line">        menu.add(<span class="number">1</span>, <span class="number">103</span>, <span class="number">1</span>, <span class="string">&quot;退出&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建菜单项的点击事件</span></span><br><span class="line">        <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">101</span>:</span><br><span class="line">            Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;你点击了登录&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">102</span>:</span><br><span class="line">            Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;你点击了设置&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">103</span>:</span><br><span class="line">            Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;你点击了退出&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="上下文菜单（context-menu）"><a href="#上下文菜单（context-menu）" class="headerlink" title="上下文菜单（context menu）"></a>上下文菜单（context menu）</h3><p>当用户长按Activity页面时，弹出的菜单我们称为上下文菜单。我们经常在Windows中用鼠标右键单击弹出的菜单就是上下文菜单。</p>
<p>ContextMenu与OptionMenu的区别：<br>1、<code>OptionMenu</code>对应的是<code>activity</code>，一个activity只能拥有一个选项菜单；<br>2、<code>ContextMenu</code>对应的是<code>view</code>，每个view都可以设置上下文菜单；<br>3、一般情况下ContextMenu常用语ListView或者GridView</p>
<h4 id="实现步骤："><a href="#实现步骤：" class="headerlink" title="实现步骤："></a>实现步骤：</h4><p>（1）首先给View注册上下文菜单<code>registerForContextMenu()</code><br><code>this.registerForContextMenu(contextView);</code><br>（2）添加上下文菜单的内容<code>onCreateContextMenu()</code></p>
<p><strong>效果图：</strong></p>
<p><img src="/images/Activity/1070689-20171214172243263-372940928.png" alt="img"></p>
<p><img src="/images/Activity/1070689-20171214172250357-1874018666.png" alt="img"></p>
<p><img src="/images/Activity/1070689-20171214172256295-322673058.png" alt="img"></p>
<p><strong>代码</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/container&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;com.jiapeng.munedemo.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:ignore</span>=<span class="string">&quot;MergeRootFrame&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/mune_list&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">      setContentView(R.layout.activity_main);</span><br><span class="line">      showListView();</span><br><span class="line">      <span class="comment">// 注册上下文菜单</span></span><br><span class="line">      <span class="built_in">this</span>.registerForContextMenu(listview);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 加载数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showListView</span><span class="params">()</span> &#123;</span><br><span class="line">      listview = (ListView) findViewById(R.id.mune_list);</span><br><span class="line">      ArrayAdapter&lt;String&gt; adapter = <span class="keyword">new</span> <span class="title class_">ArrayAdapter</span>&lt;String&gt;(<span class="built_in">this</span>,</span><br><span class="line">              android.R.layout.simple_list_item_1, getDate());</span><br><span class="line">      listview.setAdapter(adapter);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 创建数据源</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> list</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> ArrayList&lt;String&gt; <span class="title function_">getDate</span><span class="params">()</span> &#123;</span><br><span class="line">      ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">          list.add(<span class="string">&quot;菜单&quot;</span> + i);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> list;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 添加上下文菜单的菜单项</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreateContextMenu</span><span class="params">(ContextMenu menu, View v,</span></span><br><span class="line"><span class="params">          ContextMenuInfo menuInfo)</span> &#123;</span><br><span class="line">      menu.setHeaderTitle(<span class="string">&quot;上下文菜单&quot;</span>);</span><br><span class="line">      menu.setHeaderIcon(R.drawable.ic_launcher);</span><br><span class="line">      <span class="comment">//加载上下文菜单内容</span></span><br><span class="line">      menu.add(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;保存&quot;</span>);</span><br><span class="line">      menu.add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="string">&quot;更改&quot;</span>);</span><br><span class="line">      menu.add(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="string">&quot;删除&quot;</span>);</span><br><span class="line">      <span class="built_in">super</span>.onCreateContextMenu(menu, v, menuInfo);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 创建单击事件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onContextItemSelected</span><span class="params">(MenuItem item)</span> &#123;</span><br><span class="line">      <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">          Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了保存&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">          Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了更改&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">          Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了删除&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">super</span>.onContextItemSelected(item);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>注：何为上下文菜单：Windows操作系统中任何地方右击鼠标会出现俗称的“右键菜单”，其实就是指上下文菜单。因为上下文菜单根据鼠标位置来判断弹出什么的菜单（如桌面右击显示个性化菜单，文件右击则显示针对文件操作删除等的菜单）也就是根据上下文来判断如何弹出和弹出哪种菜单，所以称为上下文菜单。手机上就是长按会弹出选项</p>
<h3 id="子菜单（Sub-Menu）"><a href="#子菜单（Sub-Menu）" class="headerlink" title="子菜单（Sub Menu）"></a>子菜单（Sub Menu）</h3><p>就是将功能相同的操作分组显示，他作用在OptionsMenu上，是OptionsMenu的二级菜单</p>
<h4 id="实现步骤：-1"><a href="#实现步骤：-1" class="headerlink" title="实现步骤："></a>实现步骤：</h4><p>（1）重写<code>onCreateOptionsMenu()</code>方法<br>（2）点击事件，重写<code>onOptionsItemSelected()</code>方法</p>
<h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><p>（1）<code>SubMenu.add(groupId, itemId, order, title);</code><br>因为每个SubMenu有一个groupId，所以需要使用这个groupId区别是点击了那个子菜单<br>（2）APP的样式会影响子菜单的显示风格</p>
<p><strong>效果图</strong>：</p>
<p><img src="/images/Activity/1070689-20171214172703092-915673361.png" alt="img"></p>
<p><img src="/images/Activity/1070689-20171214172717857-532792389.png" alt="img"></p>
<p><img src="/images/Activity/1070689-20171214172726326-2106934821.png" alt="img"></p>
<p><strong>代码</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/container&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;com.jiapeng.munedemo.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:ignore</span>=<span class="string">&quot;MergeRootFrame&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;SubMenu&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">&quot;30sp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> &#123;</span><br><span class="line">        <span class="type">SubMenu</span> <span class="variable">fileMenu</span> <span class="operator">=</span> menu.addSubMenu(<span class="string">&quot;查看文件&quot;</span>);</span><br><span class="line">        <span class="type">SubMenu</span> <span class="variable">editMenu</span> <span class="operator">=</span> menu.addSubMenu(<span class="string">&quot;输入文件&quot;</span>);</span><br><span class="line">        <span class="comment">//添加菜单项</span></span><br><span class="line">        fileMenu.add(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;文件1&quot;</span>);</span><br><span class="line">        fileMenu.add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="string">&quot;文件2&quot;</span>);</span><br><span class="line">        fileMenu.add(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="string">&quot;文件3&quot;</span>);</span><br><span class="line">        editMenu.add(<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;输入1&quot;</span>);</span><br><span class="line">        editMenu.add(<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="string">&quot;输入2&quot;</span>);</span><br><span class="line">        editMenu.add(<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="string">&quot;输入3&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onCreateOptionsMenu(menu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建点击事件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.getGroupId() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了文件1&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了文件2&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了文件3&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.getGroupId() == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了输入1&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了输入2&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;点击了输入3&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="menu的属性解释"><a href="#menu的属性解释" class="headerlink" title="menu的属性解释"></a>menu的属性解释</h3><ul>
<li><p><code>android:id</code><br>定义资源ID，它是个唯一值，使用“@+id&#x2F;name”格式可以给这个菜单项创建一个新的资源ID，“+”号指示要创建一个新的ID。</p>
</li>
<li><p><code>android:title</code><br>字符串资源，它用字符串资源或原始的字符串来定义菜单的标题。</p>
</li>
<li><p><code>android:titleCondensed</code><br>字符串资源。它用字符串资源或原始的字符串来定义一个简要的标题，以便在普通的标题太长时来使用。</p>
</li>
<li><p><code>android:icon</code><br>可绘制资源，它定义了一个菜单项所要使用的图标。</p>
</li>
<li><p><code>android:onClick</code><br>方法名。在这个菜单项被点击时，会调用这个方法。在Activity中，这个方法必须用public关键字来声明，并且只接受一个MenuItem对象，这个对象指明了被点击的菜单项。这个方法会优先标准的回调方法：onOptionsItemSelected()。<br>警告：如果要使用ProGuard（或类似的工具）来混淆代码，就要确保不要重名这个属性所指定的方法，因为这样能够破坏功能。<br>这个属性在API级别11中被引入。</p>
</li>
<li><p><code>android:showAsAction</code><br>关键词。它定义这个项目作为操作栏中的操作项的显示时机和方式。只用Activity包含了一个ActionBar对象时，菜单项才能够作为操作项来显示。这个属性在API级别11中被引入，有效值如下：<br>值 说明<br><strong>ifRoom</strong> 如果有针对这个项目的空间，则只会把它放到操作栏中<br><strong>withText</strong> 操作项也要包含文本（通过android:title属性来定义的）。可以把这个值与其他的Flag设置放到一起，通过管道符“|”来分离它们。<br><strong>never</strong> 这个项目不会放到操作栏中<br><strong>always</strong><br>始终包这个项目放到操作栏中。要避免使用这个设置，除非在操作栏中始终显示这个项目是非常关键的。设置多个项目作为始终显示的操作项会导<br>致操作栏中其他的UI溢出。<br>icollapseActiionView 它定义了跟这个操作项关联的可折叠的操作View对象（用android:actionViewLayout来声明）。这个关键词在API级别14中被引入。</p>
</li>
<li><p><code>android:actionViewLayout</code><br>它引用一个布局资源，这个布局要用于操作窗口。更多的信息请参照“操作栏”开发指南。这个属性在API级别11中被引入。</p>
</li>
<li><p><code>android:actionViewClass</code><br>类名。它定义了操作窗口要使用的View对象的完整的类名。例如，“android.widget.SearchView”说明操作窗口要使用的SearchView类。<br>警告：如果要使用ProGuard（或类似的工具）来混淆代码，就要确保不要重名这个属性所指定的方法，因为这样能够破坏功能。<br>这个属性在API级别11中被引入。</p>
</li>
<li><p><code>android:actionProviderClass</code></p>
<p>类名，它是操作项目所使用的ActionProvider类的完整的类名。例如，“android.widget.ShareActionProvider”说明要使用<br>ShareActionProvider类。<br>警告：如果要使用ProGuard（或类似的工具）来混淆代码，就要确保不要重名这个属性所指定的方法，因为这样能够破坏功能。<br>这个属性在API级别14中被引入。</p>
</li>
<li><p><code>android:alphabeticShortcut</code><br>字符，定义一个字符快捷键</p>
</li>
<li><p><code>android:numericShortcut</code><br>数字值，定义一个数字快捷键</p>
</li>
<li><p><code>android:checkable</code><br>布尔值，如果菜单项是可以复选的，那么就设置为true。</p>
</li>
<li><p><code>android:checked</code><br>布尔值，如果复选菜单项默认是被选择的，那么就设置为true。</p>
</li>
<li><p><code>android:visible</code><br>布尔值，如果菜单项默认是可见的，那么就设置为true。</p>
</li>
<li><p><code>android:enabled</code><br>布尔值，如果菜单项目默认是可用的，那么就设置为true。</p>
</li>
<li><p><code>android:menuCategory</code><br>关键词。它的值对应了定义菜单项优先级的CATEGORE_*常量，有效值如下：<br>值 说明<br>Container 菜单项是容器的一部分<br>system 菜单项是由系统提供的。<br>secondary 提供给用户的辅助选择的菜单项（很少使用）<br>alternative 基于当前显示的数据来选择操作的菜单项。</p>
</li>
<li><p><code>android:orderInCategory</code><br>整数值，它定义菜单项在菜单组中的重要性的顺序。</p>
</li>
</ul>
<h4 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h4><p><code>&lt;group&gt;</code><br>它定义了一个菜单组（它是一个具有共同特征的菜单项的组合，如菜单项的可见性、可用性或可复选性）。它要包含多个<code>&lt;item&gt;</code>元素，而且必须是<code>&lt;menu&gt;</code>元素的子元素。</p>
<h4 id="属性（ATTRIBUTES）："><a href="#属性（ATTRIBUTES）：" class="headerlink" title="属性（ATTRIBUTES）："></a>属性（ATTRIBUTES）：</h4><ul>
<li><p><code>android:id</code><br>资源ID。它是资源的唯一标识。使用“@+id&#x2F;name”格式给菜单项创建一个新的资源ID。“+”号指示应该给这个元素创建一个新的资源ID。</p>
</li>
<li><p><code>android:checkableBeharior</code><br>关键词。针对菜单组的可复选行为的类型。有效值如下：<br>值 说明<br>none 没有可复选性<br>all 组内的所有的项目都被复选（使用复选框）<br>single 仅有一个项目能够被复选（使用单选按钮）</p>
</li>
<li><p><code>android:visible</code></p>
<p>布尔值，如果菜单组是可见的，就设置为true。</p>
</li>
<li><p><code>android:enabled</code><br>布尔值，如果菜单组是可用的，就设置为true。</p>
</li>
<li><p><code>android:menuCategory</code><br>关键词。它的值对应了Menu类的CATEGORY_*常量，定义了菜单组的优先级。有效值如下：<br>值 说明<br>container 菜单组是容器的一部分<br>system 菜单组是由系统提供的。<br>secondary 提供给用户的辅助选择的菜单组（很少使用）<br>alternative 基于当前显示的数据来选择操作的菜单组。</p>
</li>
<li><p><code>android:orderInCategory</code><br>整数值，它定义了分类中菜单项目的默认顺序。</p>
</li>
</ul>
<h3 id="使用XML定义menu"><a href="#使用XML定义menu" class="headerlink" title="使用XML定义menu"></a>使用XML定义menu</h3><p>理论上而言，使用XML和Java代码都可以创建Menu。但是在实际开发中，往往通过XML文件定义Menu，这样做有以下几个好处：</p>
<ol>
<li>使用XML可以获得更清晰的菜单结构</li>
<li>将菜单内容与应用的逻辑代码分离</li>
<li>可以使用应用资源框架，为不同的平台版本、屏幕尺寸创建最合适的菜单（如对drawable、string等系统资源的使用）</li>
</ol>
<p>要定义Menu，我们首先需要在res文件夹下新建menu文件夹，它将用于存储与Menu相关的所有XML文件。<br>我们可以使用<menu>、<item>、<group>三种XML元素定义Menu，下面简单介绍一下它们：</p>
<ol>
<li>“<menu>”是菜单项的容器。<menu>元素必须是该文件的根节点，并且能够包含一个或多个<item>和<group>元素。</li>
<li><item>是菜单项，用于定义MenuItem，可以嵌套<menu>元素，以便创建子菜单。</li>
<li><group>是<item>元素的不可见容器（可选）。可以使用它对菜单项进行分组，使一组菜单项共享可用性和可见性等属性。</li>
</ol>
<p>其中，<item>是我们主要需要关注的元素，它的常见属性如下：</p>
<ul>
<li>android:id：菜单项(MenuItem)的唯一标识</li>
<li>android:icon：菜单项的图标（可选）</li>
<li>android:title：菜单项的标题（必选）</li>
<li>android:showAsAction：指定菜单项的显示方式。常用的有ifRoom、never、always、withText，多个属性值之间可以使用|隔开。</li>
</ul>
<p>示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/option_normal_1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_vpn_key_white_24dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;普通菜单1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">&quot;ifRoom&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/option_normal_2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_email_white_24dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;普通菜单2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">&quot;always&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/option_normal_3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_vpn_key_white_24dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;普通菜单3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">&quot;withText|always&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/option_normal_4&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;普通菜单4&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">&quot;never&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>菜单栏中的菜单项会分为两个部分。一部分可以直接在菜单栏中看见，我们可以称之为常驻菜单；另一部分会被集中收纳到溢出菜单中（就是菜单栏右侧的小点状图标）。一般情况下，常驻菜单项以图标形式显示（需要定义icon属性），而溢出菜单项则以文字形式显示（通过title属性定义）。showAsAction的差异如下所示：</p>
<ol>
<li>always：菜单项永远不会被收纳到溢出菜单中，因此在菜单项过多的情况下可能超出菜单栏的显示范围。</li>
<li>ifRoom：在空间足够时，菜单项会显示在菜单栏中，否则收纳入溢出菜单中。</li>
<li>withText：无论菜单项是否定义了icon属性，都只会显示它的标题，而不会显示图标。使用这种方式的菜单项默认会被收纳入溢出菜单中。</li>
<li>never：菜单项永远只会出现在溢出菜单中。</li>
</ol>
<p>java加载代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> &#123;</span><br><span class="line">    MenuInflater inflater=getMenuInflater();</span><br><span class="line">    inflater.inflate(R.menu.option_menu_normal,menu);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (item.getItemId())&#123;</span><br><span class="line">        <span class="keyword">case</span> R.id.option_normal_1:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">case</span> R.id.option_normal_2:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">case</span> R.id.option_normal_3:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">case</span> R.id.option_normal_4:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看见，我们在Activity中重写了onCreateOptionsMenu方法，在这个方法中完成加载Menu资源的操作，关键代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取MenuInflater</span></span><br><span class="line">MenuInflater inflater=getMenuInflater();</span><br><span class="line"><span class="comment">//加载Menu资源</span></span><br><span class="line">inflater.inflate(R.menu.option_menu_normal,menu);</span><br></pre></td></tr></table></figure>

<p>需要注意的是，这个方法必须返回true，否则Menu将不会显示。</p>
<h4 id="获取MenuInflater"><a href="#获取MenuInflater" class="headerlink" title="获取MenuInflater"></a>获取MenuInflater</h4><p><strong>LayoutInflater是用来实例化整个布局文件，而 MenuInflater是用来实例化Menu目录下的Menu布局文件的。</strong><br>传统意义上的菜单定义需要Override Activity的onCreateOptionsMenu，然后在里面调用Menu.add把Menu的一个个item加进来，比较复杂。而通过使用MenuInflater可以把Menu的构造直接放在Menu布局文件中，真现模型（Model）与视图（View）的分离，程序也看着清爽多了。</p>
<p>几点说明：</p>
<p>与LayoutInflater相比，MenuInflater的用法简单多了。首先，MenuInflater获取方法只有一种：Activity.getMenuInflater()；其次，MenuInflater.inflater(int menuRes,Menu menu)(这里不代表inflater就是static方法，可以这样调用，只是为了描述方便)的返回值是void型，这就决定了MenuInflater.inflater后就没有后续操作了。这说明通过这种方式把Menu布局文件写好后就不能在程序中动态修改了，而不像LayoutInflater.inflater那样，返回值是View型，可以进行后续的进一步操作。另外，MenuInflater只有一个void inflater(int menuRes,Menu menu)非构造方法。</p>
<h3 id="包含多级子菜单的选项菜单"><a href="#包含多级子菜单的选项菜单" class="headerlink" title="包含多级子菜单的选项菜单"></a>包含多级子菜单的选项菜单</h3><p><item>是可以嵌套<menu>的，而<menu>又是<item>的容器。因此，我们可以在应用中实现具有层级结构的子菜单。下面给出一个实际的例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/option_sub_file&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;文件&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">&quot;ifRoom&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/file_new&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:title</span>=<span class="string">&quot;新建&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/file_save&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:title</span>=<span class="string">&quot;保存&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/file_more&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:title</span>=<span class="string">&quot;更多&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/file_more_1&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:title</span>=<span class="string">&quot;更多1&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/file_more_2&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:title</span>=<span class="string">&quot;更多2&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/file_more_more&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:title</span>=<span class="string">&quot;更多更多&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/file_more_more_1&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">android:title</span>=<span class="string">&quot;更多更多1&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/file_more_more_2&quot;</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">android:title</span>=<span class="string">&quot;更多更多2&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="intent"><a href="#intent" class="headerlink" title="intent"></a>intent</h2><p>Intent中文意思指”意图”,按照Android的设计理念,A<strong>ndroid使用Intent来封装程序的”调用意图”,不管启动Activity、Service、BroadcastReceiver,Android都使用统一的Intent对象来封装这一”启动意图”。此外,Intent也是应用程序组件之间通信的重要媒介。</strong>在Android中指定的了具体是某个组件，那么就是显性意图；如果只是提出要求没有指定具体的某个人，在Android中即没有指定某个具体的组件，那么就是隐式意图；所有Intent页面跳转的方式又分为显示跳转和隐式跳转。</p>
<h2 id="Intent和三大组件"><a href="#Intent和三大组件" class="headerlink" title="Intent和三大组件"></a>Intent和三大组件</h2><p>Android应用程序包含三种重要组件:Activity、Service、BroadcastReceiver,应用程序采用一致的方式启动它们，都是依靠Intent来进行启动的,Intent中封装了程序要启动的意图。</p>
<blockquote>
<p>下面是Intent启动不同组件的部分方法:<br>　Activity组件:<br>　startActivity(Intent intent);startActivityForResult(Intent intent,int requestCode);<br>　Service组件:<br>　startService(Intent intent);bindService(Intent intent,ServiceConnection conn,int flags);<br>　BroadcastReceiver组件:<br>　sendBroadcast(Intent intent);sendOrderedBroadcast(Intent intent,String receiverPermission);</p>
</blockquote>
<h3 id="显式-Explicit-intent-和隐式-Implicit-intent-。"><a href="#显式-Explicit-intent-和隐式-Implicit-intent-。" class="headerlink" title="显式(Explicit intent)和隐式(Implicit intent)。"></a>显式(Explicit intent)和隐式(Implicit intent)。</h3><h4 id="一、显式（设置Component（组件））"><a href="#一、显式（设置Component（组件））" class="headerlink" title="一、显式（设置Component（组件））"></a>一、显式（设置Component（组件））</h4><p>显式，即直接指定需要打开的activity对应的类。<br>以下多种方式都是一样的，实际上都是设置Component直接指定Activity类的显式Intent，由MainActivity跳转到SecondActivity：<br>1、构造方法传入Component，最常用的方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>, SecondActivity.class);  </span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>

<p>2、setComponent方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ComponentName</span> <span class="variable">componentName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="built_in">this</span>, SecondActivity.class);  </span><br><span class="line"><span class="comment">// 或者ComponentName componentName = new ComponentName(this, &quot;com.example.app016.SecondActivity&quot;);  </span></span><br><span class="line"><span class="comment">// 或者ComponentName componentName = new ComponentName(this.getPackageName(), &quot;com.example.app016.SecondActivity&quot;);  </span></span><br><span class="line">  </span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();  </span><br><span class="line">intent.setComponent(componentName);  </span><br><span class="line">startActivity(intent); </span><br></pre></td></tr></table></figure>

<p>3、setClass&#x2F;setClassName方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();  </span><br><span class="line">  </span><br><span class="line">intent.setClass(<span class="built_in">this</span>, SecondActivity.class);  </span><br><span class="line"><span class="comment">// 或者intent.setClassName(this, &quot;com.example.app016.SecondActivity&quot;);  </span></span><br><span class="line"><span class="comment">// 或者intent.setClassName(this.getPackageName(), &quot;com.example.app016.SecondActivity&quot;);  </span></span><br><span class="line">startActivity(intent);  </span><br></pre></td></tr></table></figure>

<p>显式Intent通过Component可以直接设置需要调用的Activity类，可以唯一确定一个Activity，意图特别明确，所以是显式的。设置这个类的方式可以是Class对象（如SecondActivity.class），<br>也可以是包名加类名的字符串（如”com.example.app016.SecondActivity”）。这个很好理解，在应用程序内部跳转界面常用这种方式。  </p>
<h4 id="二、隐式"><a href="#二、隐式" class="headerlink" title="二、隐式"></a>二、隐式</h4><p>隐式，即不是像显式的那样直接指定需要调用的Activity，隐式不明确指定启动哪个Activity，而是设置Action、Data、Category，让系统来筛选出合适的Activity。<br>筛选是根据所有的<intent-filter>来筛选。<br>下面以Action为例：<br>AndroidManifest.xml文件中，首先被调用的Activity要有一个带有<intent-filter>并且包含<action>的Activity，设定它能处理的Intent，并且category设为”android.intent.category.DEFAULT”。<br>action的name是一个字符串，可以自定义，例如我在这里设成”abcdefg”：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.example.app016.SecondActivity&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;abcdefg&quot;</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>然后，在MainActivity，才可以通过这个action name找到上面的Activity。<br>下面两种方式分别通过setAction和构造方法方法设置Action，两种方式效果相同。<br>1、setAction方法  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();  </span><br><span class="line">intent.setAction(<span class="string">&quot;abcdefg&quot;</span>);  </span><br><span class="line">startActivity(intent);  </span><br></pre></td></tr></table></figure>

<p>2、构造方法直接设置Action  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;abcdefg&quot;</span>);  </span><br><span class="line">startActivity(intent); </span><br></pre></td></tr></table></figure>

<p>通过设置Action字符串，表明自己的意图，即我想干嘛，需要由系统解析，找到能够处理这个Intent的Activity并启动。<br>比如我想打电话，则可以设置Action为”android.intent.action.DIAL”字符串，表示打电话的意图，系统会找到能处理这个意图的Activity，例如调出拨号面板。</p>
<p>有几点需要注意：<br>1、 这个Activity其他应用程序也可以调用，<strong>只要使用这个Action字符串。这样应用程序之间交互就很容易了</strong>，例如手机QQ可以调用QQ空间，可以调用腾讯微博等。<br>因为如此，为了防止应用程序之间互相影响，一般命名方式是包名+Action名，例如这里命名”abcdefg”就很不合理了，就应该改成”com.example.app016.MyTest”。<br>2、 当然，你可以在自己的程序中调用其他程序的Action。<br>例如可以在自己的应用程序中调用拨号面板：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_DIAL);  </span><br><span class="line"><span class="comment">// 或者Intent intent = new Intent(&quot;android.intent.action.DIAL&quot;);  </span></span><br><span class="line"><span class="comment">// Intent.ACTION_DIAL是内置常量，值为&quot;android.intent.action.DIAL&quot;  </span></span><br><span class="line">startActivity(intent);  </span><br></pre></td></tr></table></figure>

<p>3、一个Activity可以处理多种Action 只要你的应用程序够牛逼，一个Activity可以看网页，打电话，发短信，发邮件。。。当然可以。 Intent的Action只要是其中之一，就可以打开这个Activity。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">activity  </span><br><span class="line">    android:name=&quot;com.example.app016.SecondActivity&quot;&gt;  </span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- 可以处理下面三种Intent --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.app016.SEND_EMAIL&quot;</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.app016.SEND_MESSAGE&quot;</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.app016.DAIL&quot;</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>对于一个Action字符串，系统有可能会找到一个Activity能处理这个Action，也有可能找到多个Activity，也可能一个都找不到。<br>1、找到一个Activity<br>很简单，直接打开这个Activity。这个不需要解释。<br>2、找到多个Acyivity<br>系统会提示从多个activity中选择一个打开。<br>例如我们自己开发一个拨号面板应用程序，可以设置activity的<intent-filter>中Action name为”android.intent.action.DIAL”，这样别的程序调用拨号器时，<br>用户可以从Android自带的拨号器和我们自己开发的拨号器中选择。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.example.app016.SecondActivity&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.DIAL&quot;</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span>  </span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>这也就是当Android手机装上UC浏览器后，打开网页时会弹出选择Android自带浏览器还是UC浏览器，可能都会遇到过。<br>3、一个Activity都没找到<br>一个都没找到的话，程序就会出错，会抛出ActivityNotFoundException。比如随便写一个action字符串：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;asasasas&quot;</span>);  </span><br><span class="line">startActivity(intent);  </span><br></pre></td></tr></table></figure>

<p>所以应该注意try catch异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;asasasas&quot;</span>);  </span><br><span class="line"><span class="keyword">try</span>  </span><br><span class="line">&#123;  </span><br><span class="line">    startActivity(intent);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">catch</span>(ActivityNotFoundException e)  </span><br><span class="line">&#123;  </span><br><span class="line">    Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;找不到对应的Activity&quot;</span>, Toast.LENGTH_SHORT).show();  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>或者也可以使用Intent的resolveActivity方法判断这个Intent是否能找到合适的Activity，如果没有，则不再startActivity，或者可以直接禁用用户操作的控件。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_DIAL);  </span><br><span class="line"><span class="keyword">if</span>(intent.resolveActivity(getPackageManager()) == <span class="literal">null</span>)  </span><br><span class="line">&#123;  </span><br><span class="line">    <span class="comment">// 设置控件不可用  </span></span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>注意resolveActivity方法返回值就是显式Intent上面讲到的ComponentName对象，一般情况下也就是系统找到的那个Activity。<br>但是如果有多个Activity可供选择的话，则返回的Component是com.android.internal.app.ResolverActivity，也就是用户选择Activity的那个界面对应的Activity，这里不再深究。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> <span class="constructor">Intent(Intent.ACTION_DIAL)</span>;  </span><br><span class="line">ComponentName componentName = intent.resolve<span class="constructor">Activity(<span class="params">getPackageManager</span>()</span>);  </span><br><span class="line"><span class="keyword">if</span>(componentName != null)  </span><br><span class="line">&#123;  </span><br><span class="line">    String className = componentName.get<span class="constructor">ClassName()</span>;  </span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Toast</span>.</span></span>make<span class="constructor">Text(<span class="params">this</span>, <span class="params">className</span>, Toast.LENGTH_SHORT)</span>.show<span class="literal">()</span>;  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="四大属性"><a href="#四大属性" class="headerlink" title="四大属性"></a>四大属性</h3><p>Intent在Android中的核心作用就是“跳转”（Android中的跳转机制），同时可以携带必要的信息，将Intent作为一个信息桥梁。最熟悉的莫过于从一个活动跳转到另一个活动，然后返回到上一个活动。不过Intent的“跳转”作用不仅于此，Intent还可以在其他地方使用，比如在碎片中跳转，接受到一个广播后自动跳转。<br>　Intent主要有以下四个重要属性，它们分别为：</p>
<ul>
<li>Action：Action属性的值为一个字符串，它代表了系统中已经定义了一系列常用的动作。通过setAction()方法或在清单文件AndroidManifest.xml中设置。默认为：DEFAULT。</li>
<li>Data：Data通常是URI格式定义的操作数据。例如：tel:&#x2F;&#x2F; 。通过setData()方法设置。</li>
<li>Category：Category属性用于指定当前动作（Action）被执行的环境。通过addCategory()方法或在清单文件AndroidManifest.xml中设置。默认为：CATEGORY_DEFAULT。</li>
<li>Extras：Extras属性主要<strong>用于传递目标组件所需要的额外的数据</strong>。通过<code>putExtras()</code>方法设置。</li>
</ul>
<h4 id="Action：action表示该activity可以执行的动作。"><a href="#Action：action表示该activity可以执行的动作。" class="headerlink" title="Action：action表示该activity可以执行的动作。"></a>Action：action表示该activity可以执行的动作。</h4><ol>
<li>自定义action，匹配Activity的功能：<br>a.menifest中注册的Activity</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:name</span>=<span class="string">&quot;.StudyActivity&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.czh.study&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>b.启动activity</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(&quot;com.czh.study&quot;);</span><br><span class="line">startActivity(intent)</span><br></pre></td></tr></table></figure>

<p>当intent启动Activity的时候会拿着action到menifest中查找是否有activity的acitoin和我相同，如果匹配成功（即intent中的action和中的action相同）就跳转到该actvitiy.</p>
<p>（如果匹配的2个activity的话，系统会给你一个选择框让你选择启动那么activity）</p>
<ol start="2">
<li>利用系统action，调用UI</li>
</ol>
<p>Action常用的值如下：</p>
<ul>
<li>ACTION_MAIN：Android Application的入口，每个Android应用必须且只能包含一个此类型的Action声明。　　</li>
<li>ACTION_VIEW：系统根据不同的Data类型，通过已注册的对应Application显示数据。</li>
<li>ACTION_EDIT：系统根据不同的Data类型，通过已注册的对应Application编辑示数据。　</li>
<li>ACTION_DIAL：打开系统默认的拨号程序，如果Data中设置了电话号码，则自动在拨号程序中输入此号码。　</li>
<li>ACTION_CALL：直接呼叫Data中所带的号码。　</li>
<li>ACTION_ANSWER：接听来电。　</li>
<li>ACTION_SEND：由用户指定发送方式进行数据发送操作。</li>
<li>ACTION_SENDTO：系统根据不同的Data类型，通过已注册的对应Application进行数据发送操作。　</li>
<li>ACTION_BOOT_COMPLETED：Android系统在启动完毕后发出带有此Action的广播（Broadcast）。　</li>
<li>ACTION_TIME_CHANGED：Android系统的时间发生改变后发出带有此Action的广播（Broadcast）。　</li>
<li>ACTION_PACKAGE_ADDED：Android系统安装了新的Application之后发出带有此Action的广播（Broadcast）。　</li>
<li>ACTION_PACKAGE_CHANGED：Android系统中已存在的Application发生改变之后（如应用更新操作）发出带有此Action的广播</li>
</ul>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> 从google搜索内容 </span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(); </span><br><span class="line">intent.setAction(Intent.ACTION_WEB_SEARCH); </span><br><span class="line">intent.putExtra(SearchManager.QUERY,<span class="string">&quot;searchString&quot;</span>) </span><br><span class="line">startActivity(intent); </span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 浏览网页 </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;http://www.google.com&quot;</span>); </span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW,uri); </span><br><span class="line">startActivity(it); </span><br><span class="line"></span><br><span class="line"><span class="number">3</span> 显示地图 </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;geo:38.899533,-77.036476&quot;</span>); </span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.Action_VIEW,uri); </span><br><span class="line">startActivity(it); </span><br><span class="line"></span><br><span class="line"><span class="number">4</span> 路径规划 </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;http://maps.google.com/maps?f=dsaddr=startLat%20startLng&amp;daddr=endLat%20endLng&amp;hl=en&quot;</span>); </span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW,URI); </span><br><span class="line">startActivity(it); </span><br><span class="line"></span><br><span class="line"><span class="number">5</span> 拨打电话 </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;tel:xxxxxx&quot;</span>); </span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_DIAL, uri);   </span><br><span class="line">startActivity(it); </span><br><span class="line"></span><br><span class="line"><span class="number">6</span> 调用发短信的程序 </span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW);    </span><br><span class="line">it.putExtra(<span class="string">&quot;sms_body&quot;</span>, <span class="string">&quot;The SMS text&quot;</span>);    </span><br><span class="line">it.setType(<span class="string">&quot;vnd.android-dir/mms-sms&quot;</span>);    </span><br><span class="line">startActivity(it); </span><br><span class="line"></span><br><span class="line"><span class="number">7</span> 发送短信 </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;smsto:0800000123&quot;</span>);    </span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_SENDTO, uri);    </span><br><span class="line">it.putExtra(<span class="string">&quot;sms_body&quot;</span>, <span class="string">&quot;The SMS text&quot;</span>);    </span><br><span class="line">startActivity(it); </span><br><span class="line">String body=<span class="string">&quot;this is sms demo&quot;</span>; </span><br><span class="line"><span class="type">Intent</span> <span class="variable">mmsintent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_SENDTO, Uri.fromParts(<span class="string">&quot;smsto&quot;</span>, number, <span class="literal">null</span>)); </span><br><span class="line">mmsintent.putExtra(Messaging.KEY_ACTION_SENDTO_MESSAGE_BODY, body); </span><br><span class="line">mmsintent.putExtra(Messaging.KEY_ACTION_SENDTO_COMPOSE_MODE, <span class="literal">true</span>); </span><br><span class="line">mmsintent.putExtra(Messaging.KEY_ACTION_SENDTO_EXIT_ON_SENT, <span class="literal">true</span>); </span><br><span class="line">startActivity(mmsintent); </span><br><span class="line"></span><br><span class="line"><span class="number">8</span> 播放多媒体   </span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW); </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;file:///sdcard/song.mp3&quot;</span>); </span><br><span class="line">it.setDataAndType(uri, <span class="string">&quot;audio/mp3&quot;</span>); </span><br><span class="line">startActivity(it); </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.withAppendedPath(MediaStore.Audio.Media.INTERNAL_CONTENT_URI, <span class="string">&quot;1&quot;</span>);    </span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW, uri);    </span><br><span class="line">startActivity(it); </span><br><span class="line"></span><br><span class="line"><span class="number">9</span> uninstall apk </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.fromParts(<span class="string">&quot;package&quot;</span>, strPackageName, <span class="literal">null</span>);    </span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_DELETE, uri);    </span><br><span class="line">startActivity(it); </span><br><span class="line"></span><br><span class="line"><span class="number">10</span> install apk </span><br><span class="line"><span class="type">Uri</span> <span class="variable">installUri</span> <span class="operator">=</span> Uri.fromParts(<span class="string">&quot;package&quot;</span>, <span class="string">&quot;xxx&quot;</span>, <span class="literal">null</span>); </span><br><span class="line">returnIt = <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_PACKAGE_ADDED, installUri); </span><br><span class="line"></span><br><span class="line"><span class="number">11</span> 打开照相机 </span><br><span class="line">    &lt;<span class="number">1</span>&gt;<span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_CAMERA_BUTTON, <span class="literal">null</span>); </span><br><span class="line">           <span class="built_in">this</span>.sendBroadcast(i); </span><br><span class="line">     &lt;<span class="number">2</span>&gt;<span class="type">long</span> <span class="variable">dateTaken</span> <span class="operator">=</span> System.currentTimeMillis(); </span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> createName(dateTaken) + <span class="string">&quot;.jpg&quot;</span>; </span><br><span class="line">            fileName = folder + name; </span><br><span class="line">            <span class="type">ContentValues</span> <span class="variable">values</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentValues</span>(); </span><br><span class="line">            values.put(Images.Media.TITLE, fileName); </span><br><span class="line">            values.put(<span class="string">&quot;_data&quot;</span>, fileName); </span><br><span class="line">            values.put(Images.Media.PICASA_ID, fileName); </span><br><span class="line">            values.put(Images.Media.DISPLAY_NAME, fileName); </span><br><span class="line">            values.put(Images.Media.DESCRIPTION, fileName); </span><br><span class="line">            values.put(Images.ImageColumns.BUCKET_DISPLAY_NAME, fileName); </span><br><span class="line">            <span class="type">Uri</span> <span class="variable">photoUri</span> <span class="operator">=</span> getContentResolver().insert( </span><br><span class="line">                    MediaStore.Images.Media.EXTERNAL_CONTENT_URI, values); </span><br><span class="line"></span><br><span class="line">            <span class="type">Intent</span> <span class="variable">inttPhoto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(MediaStore.ACTION_IMAGE_CAPTURE); </span><br><span class="line">            inttPhoto.putExtra(MediaStore.EXTRA_OUTPUT, photoUri); </span><br><span class="line">            startActivityForResult(inttPhoto, <span class="number">10</span>); </span><br><span class="line"></span><br><span class="line"><span class="number">12</span> 从gallery选取图片 </span><br><span class="line">  <span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(); </span><br><span class="line">            i.setType(<span class="string">&quot;image/*&quot;</span>); </span><br><span class="line">            i.setAction(Intent.ACTION_GET_CONTENT); </span><br><span class="line">            startActivityForResult(i, <span class="number">11</span>); </span><br><span class="line"></span><br><span class="line"><span class="number">13</span> 打开录音机 </span><br><span class="line">   <span class="type">Intent</span> <span class="variable">mi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Media.RECORD_SOUND_ACTION); </span><br><span class="line">            startActivity(mi); </span><br><span class="line"></span><br><span class="line"><span class="number">14</span> 显示应用详细列表       </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;market://details?id=app_id&quot;</span>);         </span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW, uri);         </span><br><span class="line">startActivity(it);         </span><br><span class="line"><span class="comment">//where app_id is the application ID, find the ID          </span></span><br><span class="line"><span class="comment">//by clicking on your application on Market home          </span></span><br><span class="line"><span class="comment">//page, and notice the ID from the address bar      </span></span><br><span class="line"></span><br><span class="line">刚才找app id未果，结果发现用<span class="keyword">package</span> name也可以 </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;market://details?id=&lt;packagename&gt;&quot;</span>); </span><br><span class="line">这个简单多了 </span><br><span class="line"></span><br><span class="line"><span class="number">15</span> 寻找应用       </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;market://search?q=pname:pkg_name&quot;</span>);         </span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW, uri);         </span><br><span class="line">startActivity(it); </span><br><span class="line"><span class="comment">//where pkg_name is the full package path for an application       </span></span><br><span class="line"></span><br><span class="line"><span class="number">16</span> 打开联系人列表 </span><br><span class="line">            &lt;<span class="number">1</span>&gt;            </span><br><span class="line">           <span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(); </span><br><span class="line">           i.setAction(Intent.ACTION_GET_CONTENT); </span><br><span class="line">           i.setType(<span class="string">&quot;vnd.android.cursor.item/phone&quot;</span>); </span><br><span class="line">           startActivityForResult(i, REQUEST_TEXT); </span><br><span class="line"></span><br><span class="line">            &lt;<span class="number">2</span>&gt; </span><br><span class="line">            <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;content://contacts/people&quot;</span>); </span><br><span class="line">            <span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_PICK, uri); </span><br><span class="line">            startActivityForResult(it, REQUEST_TEXT); </span><br><span class="line"></span><br><span class="line"><span class="number">17</span> 打开另一程序 </span><br><span class="line"><span class="type">Intent</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(); </span><br><span class="line">            <span class="type">ComponentName</span> <span class="variable">cn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;com.yellowbook.android2&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;com.yellowbook.android2.AndroidSearch&quot;</span>); </span><br><span class="line">            i.setComponent(cn); </span><br><span class="line">            i.setAction(<span class="string">&quot;android.intent.action.MAIN&quot;</span>); </span><br><span class="line">            startActivityForResult(i, RESULT_OK); </span><br><span class="line"></span><br><span class="line"><span class="number">18</span> 调用系统编辑添加联系人（高版本SDK有效）：</span><br><span class="line"><span class="type">Intent</span> <span class="variable">it</span> <span class="operator">=</span> newIntent(Intent.ACTION_INSERT_OR_EDIT);</span><br><span class="line">               it.setType(<span class="string">&quot;vnd.android.cursor.item/contact&quot;</span>);</span><br><span class="line">                <span class="comment">//it.setType(Contacts.CONTENT_ITEM_TYPE);</span></span><br><span class="line">                it.putExtra(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;myName&quot;</span>);</span><br><span class="line">               it.putExtra(android.provider.Contacts.Intents.Insert.COMPANY,  <span class="string">&quot;organization&quot;</span>);</span><br><span class="line">               it.putExtra(android.provider.Contacts.Intents.Insert.EMAIL,<span class="string">&quot;email&quot;</span>);</span><br><span class="line">                it.putExtra(android.provider.Contacts.Intents.Insert.PHONE,<span class="string">&quot;homePhone&quot;</span>);</span><br><span class="line">                it.putExtra(android.provider.Contacts.Intents.Insert.SECONDARY_PHONE,</span><br><span class="line">                               <span class="string">&quot;mobilePhone&quot;</span>);</span><br><span class="line">                it.putExtra(  android.provider.Contacts.Intents.Insert.TERTIARY_PHONE,</span><br><span class="line">                               <span class="string">&quot;workPhone&quot;</span>);</span><br><span class="line">               it.putExtra(android.provider.Contacts.Intents.Insert.JOB_TITLE,<span class="string">&quot;title&quot;</span>);</span><br><span class="line">                startActivity(it);</span><br><span class="line"></span><br><span class="line"><span class="number">19</span> 调用系统编辑添加联系人（全有效）：</span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> newIntent(Intent.ACTION_INSERT_OR_EDIT);</span><br><span class="line">           intent.setType(People.CONTENT_ITEM_TYPE);</span><br><span class="line">           intent.putExtra(Contacts.Intents.Insert.NAME, <span class="string">&quot;My Name&quot;</span>);</span><br><span class="line">           intent.putExtra(Contacts.Intents.Insert.PHONE, <span class="string">&quot;+1234567890&quot;</span>);</span><br><span class="line">           intent.putExtra(Contacts.Intents.Insert.PHONE_TYPE,Contacts.PhonesColumns.TYPE_MOBILE);</span><br><span class="line">           intent.putExtra(Contacts.Intents.Insert.EMAIL, <span class="string">&quot;com@com.com&quot;</span>);</span><br><span class="line">           intent.putExtra(Contacts.Intents.Insert.EMAIL_TYPE,                    Contacts.ContactMethodsColumns.TYPE_WORK);</span><br><span class="line">           startActivity(intent);</span><br></pre></td></tr></table></figure>

<h4 id="category"><a href="#category" class="headerlink" title="category"></a>category</h4><p>Category属性用于指定当前动作（Action）被执行的环境。</p>
<ol>
<li>自定义category ，匹配Activity的功能：<br>如果2个activity有相同的action，那么我们可以用不同的category来区分。<br>a.menifest中注册的Activity</li>
</ol>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span>  <span class="attr">android:name</span>=<span class="string">&quot;.StudyActivity&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.czh.study&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;com.czh.category.study&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>b.启动activity</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(&quot;com.czh.study&quot;);</span><br><span class="line">intent.addCategory(&quot;com.czh.category.study&quot;)</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>解释：<br>1.这里的category起到了匹配的作用，系统先匹配action，如果action，再匹配cagegory，如果有相同就跳转。<br>2.有一点大家需要注意：<br><category android:name="android.intent.category.DEFAULT" /><br>隐式启动中你必须要加上这一条。<br>但是也有例外：<br><intent-filter><br><action android:name="android.intent.action.MAIN" /><br><category android:name="android.intent.category.LAUNCHER" /><br></intent-filter><br>这一个就不需要要。</p>
</blockquote>
<ol start="2">
<li>利用系统category</li>
</ol>
<p>cagegory常用的值如下：</p>
<ul>
<li>CATEGORY_DEFAULT：Android系统中默认的执行方式，按照普通Activity的执行方式执行。　</li>
<li>CATEGORY_BROWSABLE：设置该组件可以使用浏览器启动。</li>
<li>CATEGORY_TAB：指定该Activity作为TabActivity的Tab页　</li>
<li>CATEGORY_LAUNCHER：设置该组件为在当前应用程序启动器中优先级最高的Activity，通常为入口ACTION_MAIN配合使用。　</li>
<li>CATEGORY_HOME：设置该组件为Home Activity。</li>
<li>CATEGORY_PREFERENCE：设置该组件为Preference。　</li>
<li>CATEGORY_GADGET：设置该组件可以内嵌到另外的Activity中。</li>
<li>CATEGORY_TEST：该Activity是一个测试</li>
<li>CATEGORY_CAR_MODE：设置该Activity可在车载环境下使用  </li>
<li>CATEGORY_CAR_DOCK：指定手机被插入汽车底座（硬件）时运行该Activity</li>
<li>CATEGORY_DESK_DOCK：指定手机被插入桌面底座（硬件）时运行该Activity</li>
</ul>
<h4 id="extras"><a href="#extras" class="headerlink" title="extras"></a>extras</h4><p>**extras属性主要用于传递目标组件所需要的额外的数据。通过putExtras()方法设置。 **<br>常用的系统extras</p>
<ul>
<li>EXTRA_BCC：存放邮件密送人地址的字符串数组。</li>
<li>EXTRA_CC：存放邮件抄送人地址的字符串数组。</li>
<li>EXTRA_EMAIL：存放邮件地址的字符串数组。</li>
<li>EXTRA_SUBJECT：存放邮件主题字符串。</li>
<li>EXTRA_TEXT：存放邮件内容。</li>
<li>EXTRA_KEY_EVENT：以KeyEvent对象方式存放触发Intent的按键。</li>
<li>EXTRA_PHONE_NUMBER：存放调用ACTION_CALL时的电话号码。<br>例如：</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Intent intent  = <span class="keyword">new</span> <span class="constructor">Intent(<span class="string">&quot;com.czh.study&quot;</span>)</span>;</span><br><span class="line">                intent.put<span class="constructor">Extra(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span>;</span><br><span class="line">                start<span class="constructor">Activity(<span class="params">intent</span>)</span>;</span><br><span class="line"></span><br><span class="line">String value = get<span class="constructor">Intent()</span>.get<span class="constructor">StringExtra(<span class="string">&quot;key&quot;</span>)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="data"><a href="#data" class="headerlink" title="data"></a>data</h4><ol>
<li>什么是uri：</li>
</ol>
<p>我们先得弄明白uri是什么，才能向下讲。<br>通用资源标志符（Universal Resource Identifier, 简称”URI”）。<br>Uri代表要操作的数据，Android上可用的每种资源 - 图像、视频片段等都可以用Uri来表示。换句话说：android系统中任何可用的资源（图像、视频、文件）都可以用uri表示。</p>
<ol start="2">
<li>uri讲解：</li>
</ol>
<ul>
<li>uri属性有以下4部分组成：android:scheme、android:host、android:port、android:path<br>其中host和port2个统称为authority。</li>
<li>要使authority（host和port）有意义，必须指定scheme；要使path有意义，必须使scheme和authority（host和port）有意义<br>举例说明：<br>URI为： file:&#x2F;&#x2F;com.android.jony.test:520&#x2F;mnt&#x2F;sdcard，我们拆分如下：<br>scheme–&gt;file:<br>host–&gt;com.android.jony.test<br>port–&gt;520<br>path–&gt;mnt&#x2F;sdcard<br>authority–&gt;com.android.jony.test:520<br>图片uri:<br>content:&#x2F;&#x2F;media&#x2F;external&#x2F;images&#x2F;media&#x2F;62026<br>tel:&#x2F;&#x2F;：号码数据格式，后跟电话号码。<br>mailto:&#x2F;&#x2F;：邮件数据格式，后跟邮件收件人地址。<br>smsto:&#x2F;&#x2F;：短息数据格式，后跟短信接收号码。<br>content:&#x2F;&#x2F;：内容数据格式，后跟需要读取的内容。<br>file:&#x2F;&#x2F;：文件数据格式，后跟文件路径。<br>market:&#x2F;&#x2F;search?q&#x3D;pname:pkgname：市场数据格式，在Google Market里搜索包名为pkgname的应用。<br>geo:&#x2F;&#x2F;latitude,longitude:经纬数据格式，在地图上显示经纬度指定的位置。</li>
</ul>
<p><strong>在intentfilter中指定data属性的实际目的是：要求接收的Intent中的data必须符合intent-filter中指定的data属性，这样达到反向限定Intent的作用。</strong></p>
<p>在AndroidManifest.xml 中进行如下设置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.TestActivity&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line">         <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.jony.test&quot;</span>/&gt;</span>  </span><br><span class="line">         <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">&quot;file&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>启动该Activity的Intent必须进行如下设置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();  </span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(<span class="string">&quot;file://com.android.test:520/mnt/sdcard&quot;</span>);  </span><br><span class="line">intent.setData(uri)</span><br></pre></td></tr></table></figure>

<h4 id="data讲解："><a href="#data讲解：" class="headerlink" title="data讲解："></a>data讲解：</h4><p>1.data属性有以下5部分组成：android:scheme、android:host、android:port、android:path、android:mimeType<br>data的前四个属性构成了URI的组成部分，<br>mimeType设置了数据的类型<br>2.data元素组成的URI模型如下：<br>scheme:&#x2F;&#x2F;host:port&#x2F;path</p>
<h4 id="URI和intent-filter匹配："><a href="#URI和intent-filter匹配：" class="headerlink" title="URI和intent-filter匹配："></a>URI和intent-filter匹配：</h4><p>Intent中URI和intent-filter进行比较的时候只会进行部分的比较：<br>（1）当intent-filter中只设置了scheme，只会比较URI的scheme部分；<br>（2）当intent-filter中只设置了scheme和authority，那么只会匹配URI中的scheme和authority；<br>（3）当intent-filter中设置了scheme、authority和path，那么只会匹配URI中的scheme、authority、path；（path可以使用通配符进行匹配）<br>（4）当intent-filter中设置了mimeType，还会进行数据类型的匹配。</p>
<h2 id="intent和intentfilter"><a href="#intent和intentfilter" class="headerlink" title="intent和intentfilter"></a>intent和intentfilter</h2><p>如果一个 Intent 请求在一片数据上执行一个动作， Android 如何知道哪个应用程序（和组件）能用来响应这个请求呢？ </p>
<p><strong>Intent Filter就是 用来注册 Activity 、 Service 和 Broadcast Receiver 具有能在某种数据上执行一个动作的能力。</strong><br>使用 Intent Filter ，应用程序组件告诉 Android ，它们能为其它程序的组件的动作请求提供服务，包括同一个程序的组件、本地的或第三方的应用程序。</p>
<p>(1)IntentFilter的解释：</p>
<p>IntentFilter就是用于描述intent的各种属性， 比如action, category等</p>
<p>一些属性设置的例子：</p>
<action android:name="com.example.project.SHOW_CURRENT" />

<category android:name="android.intent.category.DEFAULT" />

<p>&lt;data android:mimeType&#x3D;”video&#x2F;mpeg” android:scheme&#x3D;”http” . . . &#x2F;&gt;</p>
<data android:mimeType="image/*" />

<data android:scheme="http" android:type="video/*" />

<p>(2)使用场景</p>
<p>activity的隐式启动和广播的匹配</p>
<p>(3)IntentFilter的匹配规则</p>
<p>IntentFilter的过滤信息有action,category,data.一个组件可以包含多个intent-filter,一个intent只要能完全匹配一组intent-filter即可成功的启动对应的组件。</p>
<p>1.action的匹配规则</p>
<p>intent-filter中必须包含一个action，intent信息中也必须指定一个action。intent-filter中可以有一个或者多个action，只要intent匹配其中的一个action即可。</p>
<p>2.category的匹配规则</p>
<p>intent中可以不指定category,在receiver的intent-filter中也可以不指定category,但是当要隐式启动一个activity是就必须指定android.intent.category.DEFAULT的category。否则系统也会报找不到指定的activity.当intent中指定了一个category时，就会在具有category的intent-filter中去找匹配组件。</p>
<p>3.data的匹配规则</p>
<p>data由两部分组成mimeType和URI.mimeType指媒体类型，比如image&#x2F;jpeg、audio&#x2F;*等。</p>
<p>URI的结构为</p>
<p><scheme>&#x2F;&#x2F;<host>:<port>&#x2F;[<path> | <pathPrefix>|<pathPattern>]</p>
<p>scheme :URI的模式，比如http、file、content等，如果URI中没有指定scheme,那么整个URI的其他参数无效。<br>host:URI的主机名，比如<a target="_blank" rel="noopener" href="http://www.baidu.com,如果host么有指定那么真个uri的其他参数无效./">www.baidu.com,如果host么有指定那么真个URI的其他参数无效。</a></p>
<p>port：URI的端口号。</p>
<p>path,pathPattern,pathPrefix:这三个参数指定路径信息</p>
<p>data的规则是如果inent-filter中描述了data,那么必须要在intent中描述匹配的data信息，如果intent-filter中没有描述data信息，那么intent中可以不指定data信息。data的规则中如果intent-filter只指定了mimeType,那么其默认的URI的scheme是file或者content。在intent中就必须同时设置mimeType和URI。如果intent-filter中有多组data,那么intent中只需要匹配一组即可。</p>
<h2 id="启动活动"><a href="#启动活动" class="headerlink" title="启动活动"></a>启动活动</h2><h3 id="Intent启动Activity"><a href="#Intent启动Activity" class="headerlink" title="Intent启动Activity"></a>Intent启动Activity</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;com.example.android.myapplication.ACTION_START&quot;</span>);       intent.addCategory(<span class="string">&quot;com.example.android.myapplication.MY_CATEGORY&quot;</span>;</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>

<p>如果没有在manifest文件中添加</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.android.myapplication.MY_CATEGORY&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">category</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>就会出现如下异常信息</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android<span class="selector-class">.content</span><span class="selector-class">.ActivityNotFoundException</span>: No Activity found to handle Intent &#123; act=com<span class="selector-class">.example</span><span class="selector-class">.android</span><span class="selector-class">.myapplication</span><span class="selector-class">.ACTION_START</span> cat=<span class="selector-attr">[com.example.android.myapplication.MY_CATEGORY]</span> &#125;</span><br></pre></td></tr></table></figure>

<p>如果不添加默认的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">category</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>一样会遇到上面这个Error</p>
<blockquote>
<pre><code>     *Intent.ACTION_VIEW 系统内置的动作
         * Uri.parse()将一个网址字符串解析成一个 Uri 对象
         * setData()方法将这个 Uri 对象传递进去,指定当前 Intent正在操作的数据
         * */
         Intent intent = new Intent(Intent.ACTION_VIEW);
         intent.setData(Uri.parse(&quot;http://www.baidu.com&quot;));
         startActivity(intent);
</code></pre>
</blockquote>
<h3 id="Activity使用Intent传递数据"><a href="#Activity使用Intent传递数据" class="headerlink" title="Activity使用Intent传递数据"></a>Activity使用Intent传递数据</h3><p>向SecondActivity传递数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;This data come from FirstActivity&quot;</span>;</span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(FirstActivity.<span class="built_in">this</span>,SecondActivity.class);</span><br><span class="line">intent.putExtra(<span class="string">&quot;howy&quot;</span>,data);</span><br><span class="line">startActivity(intent);</span><br><span class="line"><span class="comment">//  取出FirstActivity的数据</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> getIntent();</span><br><span class="line"><span class="type">String</span> <span class="variable">dataFromFirstActivity</span> <span class="operator">=</span> intent.getStringExtra(<span class="string">&quot;howy&quot;</span>);</span><br><span class="line">Log.d(TAG, dataFromFirstActivity);</span><br></pre></td></tr></table></figure>

<h3 id="数据往返传递"><a href="#数据往返传递" class="headerlink" title="数据往返传递"></a>数据往返传递</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> <span class="constructor">Intent(FirstActivity.<span class="params">this</span>,SecondActivity.<span class="params">class</span>)</span>;</span><br><span class="line">start<span class="constructor">ActivityForResult(<span class="params">intent</span>, 1)</span>;</span><br><span class="line"><span class="comment">//在SecondActivity设置数据回传</span></span><br><span class="line"> Intent intent = <span class="keyword">new</span> <span class="constructor">Intent()</span>;</span><br><span class="line">String data = <span class="string">&quot;This data from SecondActivity come to FirstActivity&quot;</span>;</span><br><span class="line">intent.put<span class="constructor">Extra(<span class="string">&quot;howy&quot;</span>, <span class="params">data</span>)</span>;</span><br><span class="line">set<span class="constructor">Result(RESULT_OK,<span class="params">intent</span>)</span>;</span><br><span class="line">finish<span class="literal">()</span>;</span><br><span class="line"><span class="comment">//在FirstActivity重写onActivityResult方法</span></span><br><span class="line"> protected void on<span class="constructor">ActivityResult(<span class="params">int</span> <span class="params">requestCode</span>, <span class="params">int</span> <span class="params">resultCode</span>, Intent <span class="params">data</span>)</span> &#123;</span><br><span class="line">        switch (requestCode) &#123;</span><br><span class="line">            case <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> (resultCode<span class="operator"> == </span>RESULT_OK) &#123;</span><br><span class="line">                    String dataComeFromSecondActivity = data.get<span class="constructor">StringExtra(<span class="string">&quot;howy&quot;</span>)</span>;</span><br><span class="line">                    <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(TAG, dataComeFromSecondActivity);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (resultCode<span class="operator"> == </span>RESULT_CANCELED) &#123;</span><br><span class="line">                    String content = <span class="string">&quot;Data come form SecondActivity had been CANCELED&quot;</span>;</span><br><span class="line">                    String dataComeFromSecondActivity = data.get<span class="constructor">StringExtra(<span class="string">&quot;howy&quot;</span>)</span>;</span><br><span class="line">                    <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(TAG, <span class="string">&quot; &quot;</span> + dataComeFromSecondActivity);</span><br><span class="line">                    <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(TAG, content);</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                String content = <span class="string">&quot;No data come form SecondActivity&quot;</span>;</span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(TAG, content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>把startActivityForResult方法中的requestCode设置为2<br>就会打印No data come form SecondActivity，<br>在onActivityResult方法会先判断requestCode，再判断resultCode。<br>即使把resultCode设为RESULT_CANCELED也是可以回传数据的。</p>
<p>onBackPressed()方法按返回键回传数据。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public void on<span class="constructor">BackPressed()</span> &#123;</span><br><span class="line">Intent intent = <span class="keyword">new</span> <span class="constructor">Intent()</span>;</span><br><span class="line">intent.put<span class="constructor">Extra(<span class="string">&quot;data_return&quot;</span>, <span class="string">&quot;Hello FirstActivity&quot;</span>)</span>;</span><br><span class="line">set<span class="constructor">Result(RESULT_OK, <span class="params">intent</span>)</span>;</span><br><span class="line">finish<span class="literal">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Activity生命周期"><a href="#Activity生命周期" class="headerlink" title="Activity生命周期"></a>Activity生命周期</h1><p>Android 使用任务（Task）来管理活动，一个任务就是一组存放在栈里的活动的集合，后进先出。<br><img src="/images/Activity/1930046-a086f191437566f4.webp"></p>
<h2 id="活动状态"><a href="#活动状态" class="headerlink" title="活动状态"></a>活动状态</h2><p>每个活动在其生命周期中最多可能会有四种状态。</p>
<ol>
<li>运行状态</li>
</ol>
<p>当一个活动位于返回栈的栈顶时，这时活动就处于运行状态。系统最不愿意回收的就是处于运行状态的活动，因为这会带来非常差的用户体验。</p>
<ol start="2">
<li>暂停状态</li>
</ol>
<p>当一个活动不再处于栈顶位置，但仍然可见时，这时活动就进入了暂停状态，比如对话框形式的活动只会占用屏幕中间的部分区域，处于暂停状态的活动仍然是完全存活着的，系统也不愿意去回收这种活动（因为它还是可见的，回收可见的东西都会在用户体验方面有不好的影响），只有在内存极低的情况下，系统才会去考虑回收这种活动。</p>
<ol start="3">
<li>停止状态</li>
</ol>
<p>当一个活动不再处于栈顶位置，并且完全不可见的时候，就进入了停止状态。系统仍然会为这种活动保存相应的状态和成员变量，但是这并不是完全可靠的，当其他地方需要内存时，处于停止状态的活动有可能会被系统回收。</p>
<ol start="4">
<li>销毁状态</li>
</ol>
<p>当一个活动从返回栈中移除后就变成了销毁状态。系统会最倾向于回收处于这种状态的活动，从而保证手机的内存充足。</p>
<h2 id="活动的生存期"><a href="#活动的生存期" class="headerlink" title="活动的生存期"></a>活动的生存期</h2><p>Activity 类定义了下面的回调。你可以不用实现所有的回调方法。当了解其中的每一个非常的重要，实现这些可以保证你的应用行为如用户所期望的那样。</p>
<ol>
<li>onCreate()</li>
</ol>
<p>它会在活动第一次被创建的时候调用。应该在这个方法中完成活动的初始化操作，比如说加载布局、绑定事件等。</p>
<ol start="2">
<li>onStart()</li>
</ol>
<p>这个方法在活动由不可见变为可见的时候调用。</p>
<ol start="3">
<li>onResume()</li>
</ol>
<p>这个方法在活动准备好和用户进行交互的时候调用。此时的活动一定位于返回栈的栈顶，并且处于运行状态。</p>
<ol start="4">
<li>onPause()</li>
</ol>
<p>这个方法在系统准备去启动或者恢复另一个活动的时候调用。我们通常会在这个方法中将一些消耗 CPU 的资源释放掉，以及保存一些关键数据，但这个方法的执行速度一定要快，不然会影响到新的栈顶活动的使用。</p>
<ol start="5">
<li>onStop()</li>
</ol>
<p>这个方法在活动完全不可见的时候调用。它和 onPause() 方法的主要区别在于，如果启动的新活动是一个对话框式的活动，那么 onPause() 方法会得到执行，而 onStop() 方法并不会执行。</p>
<ol start="6">
<li>onDestroy()</li>
</ol>
<p>这个方法在活动被销毁之前调用，之后活动的状态将变为销毁状态。</p>
<ol start="7">
<li>onRestart()</li>
</ol>
<p>这个方法在活动由停止状态变为运行状态之前调用，也就是活动被重新启动了。</p>
<hr>
<p>以上七个方法中除了onRestart()方法，其他都是两两相对的，从而又可以将活动分为三种生存期。</p>
<ol>
<li>完整生存期</li>
</ol>
<p>活动在 onCreate() 方法和 onDestroy() 方法之间所经历的，就是完整生存期。一般情况下，一个活动会在 onCreate() 方法中完成各种初始化操作，而在 onDestroy() 方法中完成释放内存的操作。</p>
<ol start="2">
<li>可见生存期</li>
</ol>
<p>活动在 onStart() 方法和 onStop() 方法之间所经历的，就是可见生存期。在可见生存期内，活动对于用户总是可见的，即便有可能无法和用户进行交互。我们可以通过这两个方法，合理地管理那些对用户可见的资源。比如在 onStart() 方法中对资源进行加载，而在 onStop() 方法中对资源进行释放，从而保证处于停止状态的活动不会占用过多内存。</p>
<ol start="3">
<li>前台生存期</li>
</ol>
<p>活动在 onResume() 方法和 onPause() 方法之间所经历的，就是前台生存期。在前台生存期内，活动总是处于运行状态的，此时的活动是可以和用户进行相互的，我们平时看到和接触最多的也这个状态下的活动。</p>
<h2 id="保存临时数据"><a href="#保存临时数据" class="headerlink" title="保存临时数据"></a>保存临时数据</h2><p>当一个活动进入到了停止状态，是有可能被系统回收的。Activity 中还提供了一个 onSaveInstanceState() 回调方法，这个方法会保证一定在活动被回收之前调用，因此我们可以通过这个方法来解决活动被回收时临时数据得不到保存的问题。</p>
<ol>
<li>保存临时数据</li>
</ol>
<p>onSaveInstanceState() 方法会携带一个Bundle 类型的参数，Bundle 提供了一系列的方法用于保存数据，键值对方式。如 putString()、putInt() 等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onSaveInstanceState</span><span class="params">(Bundle outState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onSaveInstanceState(outState);</span><br><span class="line">    <span class="type">String</span> <span class="variable">tempData</span> <span class="operator">=</span> <span class="string">&quot;Something you just typed&quot;</span>;</span><br><span class="line">    outState.putString(<span class="string">&quot;data_key&quot;</span>, tempData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>恢复临时数据</li>
</ol>
<p>onCreate()方法其实也有一个 Bundle 类型的参数。这个参数在一般情况下都是 null，但是当活动被系统回收之前有通过 onSaveInstanceState() 方法来保存数据的话，这个参数就会带有之前所保存的全部数据，只需要再通过相应的取值方法将数据取出即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (savedInstanceState != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">tempData</span> <span class="operator">=</span> savedInstanceState.getString(<span class="string">&quot;data_key&quot;</span>);</span><br><span class="line">        Log.d(TAG, tempData);</span><br><span class="line">    &#125;</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Intent 还可以结合 Bundle 一起用于传递数据的，首先可以把需要传递的数据都保存在 Bundle 对象中，然后再将 Bundle 对象存放在 Intent 里。到了目标活动之后先从 Intent 中取出 Bundle，再从Bundle中一一取出数据。</p>
<h1 id="活动的四种启动模式"><a href="#活动的四种启动模式" class="headerlink" title="活动的四种启动模式"></a>活动的四种启动模式</h1><p>安卓中的活动（Activity）有四种不同的启动模式，这四种模式分别是：standard，SingleTop，SingleTask，SingleInstance。这四种模式中，standard模式是默认的模式，其他三个想要使用的话，要在AndroidMainFest中进行修改。(例如：<android launchMode ="singleTop">)</p>
<h2 id="standard模式："><a href="#standard模式：" class="headerlink" title="standard模式："></a>standard模式：</h2><p>系统默认的启动模式。<br>Android是使用返回栈来管理活动的，在standard模式下，每当启动一个新的活动，它就会在返回栈中入栈，并处于栈顶的位置。<br>对于使用standard模式的活动，系统不会在乎这个活动是否已经在返回栈中存在，而是每次启动活动都会创建该活动的一个新的实例。 </p>
<h3 id="standard模式原理示意图："><a href="#standard模式原理示意图：" class="headerlink" title="standard模式原理示意图："></a>standard模式原理示意图：</h3><p><img src="https://images2015.cnblogs.com/blog/892430/201605/892430-20160525234337819-1224164299.png">  </p>
<blockquote>
<p>这是最基础的模式，在这种模式中，当你进入一个活动，这个活动就会创造一个实例，出现在返回栈的最顶层，上一个你离开的活动就会被压在下面，（注：返回栈是Android管理活动的地方，出现在界面上的活动就在最上面，再出现新的就一层层往下压。）当你无限的点击进入下一个界面，你的每一个活动都会在返回栈中往下压。如果你点击返回上一个的活动，最顶层的活动就会消失，第二层的就会上来，如果你要退出这个应用，要把返回栈中的所有活动都取消掉，才能退出。如果你用一个极端的例子，不停地从这个活动进入同一个活动，你点击了十次，就要返回十次才能退出程序，因为你在返回栈中创造了十个相同的实例，尽管活动是一样的。</p>
</blockquote>
<h2 id="SingleTop模式："><a href="#SingleTop模式：" class="headerlink" title="SingleTop模式："></a>SingleTop模式：</h2><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">android:</span>launchMode=<span class="string">&quot;singleTop&quot;</span></span><br></pre></td></tr></table></figure>

<p>在SingleTop模式中， 会检查在返回栈栈顶是不是你要启动的活动，如果是的话，他就不会启动，直接使用。<br>所以SingleTop不会出现standard中的情况需要点击多次才能退出程序，它只需要点击一次就可以了。  </p>
<h3 id="singleTop模式原理示意图："><a href="#singleTop模式原理示意图：" class="headerlink" title="singleTop模式原理示意图："></a>singleTop模式原理示意图：</h3><p><img src="/images/Activity/892430-20160525234453803-474351507.png"></p>
<h2 id="SingleTask模式："><a href="#SingleTask模式：" class="headerlink" title="SingleTask模式："></a>SingleTask模式：</h2><p>当活动的启动模式指定为singleTask，每次启动该活动时，首先会在返回栈中检查是否存在该活动的实例，如果发现已经存在就直接使用该实例，并把这个活动之上的所有活动统统出栈，如果没有发现就会创建一个新的活动实例。  </p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">android:</span>launchMode=<span class="string">&quot;singleTask&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="singleTask原理示意图："><a href="#singleTask原理示意图：" class="headerlink" title="singleTask原理示意图："></a>singleTask原理示意图：</h3><p><img src="/images/Activity/892430-20160525234548225-112784357.png"></p>
<h2 id="singleInstance"><a href="#singleInstance" class="headerlink" title="singleInstance"></a>singleInstance</h2><p>这种模式是最特殊的模式，这种模式是为了让不同的app之间可以共享同一个活动，如果你的app想让别的app调用你的某一个界面，就可以用这种模式，这种模式会为你想共享的界面单独创造出一个单独使用的返回栈，不会与别的返回栈共同使用。  </p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">android:</span>launchMode=<span class="string">&quot;singleInstance&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="singleInstance模式示意图"><a href="#singleInstance模式示意图" class="headerlink" title="singleInstance模式示意图:"></a>singleInstance模式示意图:</h3><p><img src="/images/Activity/892430-20160526091149569-982478014.png"></p>
<h1 id="数据适配器"><a href="#数据适配器" class="headerlink" title="数据适配器"></a>数据适配器</h1><h2 id="什么是数据适配器？"><a href="#什么是数据适配器？" class="headerlink" title="什么是数据适配器？"></a>什么是数据适配器？</h2><p>下图展示了数据源、适配器、ListView等数据展示控件之间的关系。我们知道，数据源是各种各样的，而ListView所展示数据的格式则是有一定的要求的。数据适配器正是建立了数据源与ListView之间的适配关系，将数据源转换为ListView能够显示的数据格式，从而将数据的来源与数据的显示进行解耦，降低程序的耦合性。这也体现了Android的适配器模式的使用。对于ListView、GridView等数据展示控件有多种数据适配器，本文讲解最通用的数据适配器——BaseAdapter。<br><img src="/images/Activity/834105-20151220133119758-1793380210.jpg">  </p>
<h2 id="ListView的显示与缓存机制"><a href="#ListView的显示与缓存机制" class="headerlink" title="ListView的显示与缓存机制"></a>ListView的显示与缓存机制</h2><p>我们知道，ListView、GridView等控件可以展示大量的数据信息。假如下图中的ListView可以展示100条信息，但是屏幕的尺寸是有限的，一屏幕只能显示下图中的7条。当向上滑动ListView的时候，item1被滑出了屏幕区域，那么系统就会将item1回收到Recycler中，即View缓冲池中，而将要显示的item8则会从缓存池中取出布局文件，并重新设置好item8需要显示的数据，并放入需要显示的位置。这就是ListView的缓冲机制，总结起来就是一句话：需要时才显示，显示完就被会收到缓存。ListView，GridView等数据显示控件通过这种缓存机制可以极大的节省系统资源。<br><img src="/images/Activity/834105-20151220141452867-684265253.png">  </p>
<h2 id="BaseAdapter"><a href="#BaseAdapter" class="headerlink" title="BaseAdapter"></a>BaseAdapter</h2><p>使用BaseAdapter比较简单，主要是通过继承此类来实现BaseAdapter的四个方法：</p>
<p>public int getCount(): 适配器中数据集的数据个数；</p>
<p>public Object getItem(int position): 获取数据集中与索引对应的数据项；</p>
<p>public long getItemId(int position): 获取指定行对应的ID；</p>
<p>public View getView(int position,View convertView,ViewGroup parent): 获取没一行Item的显示内容。  </p>
<p>下面通过一个简单示例演示如何使用BaseAdapter。</p>
<p>1.创建布局文件</p>
<p>activity_main.xml  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;com.cbt.learnbaseadapter.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/lv_main&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>item.xml （ListView中每条信息的显示布局）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/iv_image&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;60dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;60dp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/tv_title&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;30dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_toEndOf</span>=<span class="string">&quot;@id/iv_image&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Title&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">&quot;25sp&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/tv_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_toEndOf</span>=<span class="string">&quot;@id/iv_image&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_below</span>=<span class="string">&quot;@id/tv_title&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">&quot;20sp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.创建数据源</p>
<p>ItemBean.java   </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package com.cbt.learnbaseadapter;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by caobotao on 15/12/20.</span><br><span class="line"> */</span><br><span class="line">public class ItemBean &#123;</span><br><span class="line">    public int itemImageResId;//图像资源ID</span><br><span class="line">    public String itemTitle;//标题</span><br><span class="line">    public String itemContent;//内容</span><br><span class="line"></span><br><span class="line">    public ItemBean(int itemImageResId, String itemTitle, String itemContent) &#123;</span><br><span class="line">        this.itemImageResId = itemImageResId;</span><br><span class="line">        this.itemTitle = itemTitle;</span><br><span class="line">        this.itemContent = itemContent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>通过此Bean类，我们就将要显示的数据与ListView的布局内容一一对应了，每个Bean对象对应ListView的一条数据。这种方法在ListView中使用的非常广泛。</p>
<p>MainActivity.java  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cbt.learnbaseadapter;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.ListView;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    ListView mListView ;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        List&lt;ItemBean&gt; itemBeanList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; <span class="number">20</span>; i ++)&#123;</span><br><span class="line">            itemBeanList.add(<span class="keyword">new</span> <span class="title class_">ItemBean</span>(R.mipmap.ic_launcher, <span class="string">&quot;标题&quot;</span> + i, <span class="string">&quot;内容&quot;</span> + i));</span><br><span class="line">        &#125;</span><br><span class="line">        mListView = (ListView) findViewById(R.id.lv_main);</span><br><span class="line">        <span class="comment">//设置ListView的数据适配器</span></span><br><span class="line">        mListView.setAdapter(<span class="keyword">new</span> <span class="title class_">MyAdapter</span>(<span class="built_in">this</span>,itemBeanList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.创建BaseAdapter</p>
<p>通过上面的讲解，我们知道继承BaseAdapter需要重新四个方法：getCount、getItem、getItemId、getView。其中前三个都比较简单，而getView稍微比较复杂。通常重写getView有三种方式，这三种方法性能方面有很大的不同。接下来我们使用此三种方式分别实现MyAdapter。<br>第一种：逗比式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cbt.learnbaseadapter;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.view.*;</span><br><span class="line"><span class="keyword">import</span> android.widget.BaseAdapter;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by caobotao on 15/12/20.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdapter</span> <span class="keyword">extends</span> <span class="title class_">BaseAdapter</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;ItemBean&gt; mList;<span class="comment">//数据源</span></span><br><span class="line">    <span class="keyword">private</span> LayoutInflater mInflater;<span class="comment">//布局装载器对象</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过构造方法将数据源与数据适配器关联起来</span></span><br><span class="line">    <span class="comment">// context:要使用当前的Adapter的界面对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyAdapter</span><span class="params">(Context context, List&lt;ItemBean&gt; list)</span> &#123;</span><br><span class="line">        mList = list;</span><br><span class="line">        mInflater = LayoutInflater.from(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//ListView需要显示的数据数量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//指定的索引对应的数据项</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getItem</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mList.get(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//指定的索引对应的数据项ID</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getItemId</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//返回每一项的显示内容</span></span><br><span class="line">    <span class="keyword">public</span> View <span class="title function_">getView</span><span class="params">(<span class="type">int</span> position, View convertView, ViewGroup parent)</span> &#123;</span><br><span class="line">        <span class="comment">//将布局文件转化为View对象</span></span><br><span class="line">        <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> mInflater.inflate(R.layout.item,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 找到item布局文件中对应的控件 </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">ImageView</span> <span class="variable">imageView</span> <span class="operator">=</span> (ImageView) view.findViewById(R.id.iv_image);</span><br><span class="line">        <span class="type">TextView</span> <span class="variable">titleTextView</span> <span class="operator">=</span> (TextView) view.findViewById(R.id.tv_title);</span><br><span class="line">        <span class="type">TextView</span> <span class="variable">contentTextView</span> <span class="operator">=</span> (TextView) view.findViewById(R.id.tv_content);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取相应索引的ItemBean对象</span></span><br><span class="line">        <span class="type">ItemBean</span> <span class="variable">bean</span> <span class="operator">=</span> mList.get(position);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 设置控件的对应属性值 </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        imageView.setImageResource(bean.itemImageResId);</span><br><span class="line">        titleTextView.setText(bean.itemTitle);</span><br><span class="line">        contentTextView.setText(bean.itemContent);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为什么称这种getView的方式是逗比式呢？</p>
<p>通过上面讲解，我们知道ListView、GridView等数据展示控件有缓存机制，而这种方式每次调用getView时都是通过inflate创建一个新的View对象，然后在此view中通过findViewById找到对应的控件，完全没有利用到ListView的缓存机制。这种方式没有经过优化处理，对资源造成了极大的浪费，效率是很低的。<br>第二种：普通式  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> View <span class="title function_">getView</span><span class="params">(<span class="type">int</span> position, View convertView, ViewGroup parent)</span> &#123;<span class="comment">//如果view未被实例化过，缓存池中没有对应的缓存</span></span><br><span class="line">        <span class="keyword">if</span> (convertView == <span class="literal">null</span>) &#123;</span><br><span class="line">            convertView = mInflater.inflate(R.layout.item,<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 找到item布局文件中对应的控件</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">ImageView</span> <span class="variable">imageView</span> <span class="operator">=</span> (ImageView) convertView.findViewById(R.id.iv_image);</span><br><span class="line">        <span class="type">TextView</span> <span class="variable">titleTextView</span> <span class="operator">=</span> (TextView) convertView.findViewById(R.id.tv_title);</span><br><span class="line">        <span class="type">TextView</span> <span class="variable">contentTextView</span> <span class="operator">=</span> (TextView) convertView.findViewById(R.id.tv_content);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取相应索引的ItemBean对象</span></span><br><span class="line">        <span class="type">ItemBean</span> <span class="variable">bean</span> <span class="operator">=</span> mList.get(position);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 设置控件的对应属性值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        imageView.setImageResource(bean.itemImageResId);</span><br><span class="line">        titleTextView.setText(bean.itemTitle);</span><br><span class="line">        contentTextView.setText(bean.itemContent);</span><br><span class="line">        <span class="keyword">return</span> convertView;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>此方式充分使用了ListView的缓存机制，如果view没有缓存才创建新的view，效率相比于逗比式提升了很多。但是，当ListView很复杂时，每次调用findViewById都会去遍历视图树，所以findViewById是很消耗时间的，我们应该尽量避免使用findViewById来达到进一步优化的目的。<br>第三种：文艺式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> View <span class="title function_">getView</span><span class="params">(<span class="type">int</span> position, View convertView, ViewGroup parent)</span> &#123;</span><br><span class="line">    ViewHolder viewHolder;</span><br><span class="line">    <span class="comment">//如果view未被实例化过，缓存池中没有对应的缓存</span></span><br><span class="line">    <span class="keyword">if</span> (convertView == <span class="literal">null</span>) &#123;</span><br><span class="line">        viewHolder = <span class="keyword">new</span> <span class="title class_">ViewHolder</span>();</span><br><span class="line">        <span class="comment">// 由于我们只需要将XML转化为View，并不涉及到具体的布局，所以第二个参数通常设置为null</span></span><br><span class="line">        convertView = mInflater.inflate(R.layout.item, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对viewHolder的属性进行赋值</span></span><br><span class="line">        viewHolder.imageView = (ImageView) convertView.findViewById(R.id.iv_image);</span><br><span class="line">        viewHolder.title = (TextView) convertView.findViewById(R.id.tv_title);</span><br><span class="line">        viewHolder.content = (TextView) convertView.findViewById(R.id.tv_content);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过setTag将convertView与viewHolder关联</span></span><br><span class="line">        convertView.setTag(viewHolder);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;<span class="comment">//如果缓存池中有对应的view缓存，则直接通过getTag取出viewHolder</span></span><br><span class="line">        viewHolder = (ViewHolder) convertView.getTag();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 取出bean对象</span></span><br><span class="line">    <span class="type">ItemBean</span> <span class="variable">bean</span> <span class="operator">=</span> mList.get(position);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置控件的数据</span></span><br><span class="line">    viewHolder.imageView.setImageResource(bean.itemImageResId);</span><br><span class="line">    viewHolder.title.setText(bean.itemTitle);</span><br><span class="line">    viewHolder.content.setText(bean.itemContent);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> convertView;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ViewHolder用于缓存控件，三个属性分别对应item布局文件的三个控件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ViewHolder</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> ImageView imageView;</span><br><span class="line">    <span class="keyword">public</span> TextView title;</span><br><span class="line">    <span class="keyword">public</span> TextView content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此方式不仅利用了ListView的缓存机制，而且使用ViewHolder类来实现显示数据视图的缓存，避免多次调用findViewById来寻找控件，以达到优化程序的目的。所以，大家在平时的开发中应当尽量使用这种方式进行getView的实现。</p>
<p>总结一下用ViewHolder优化BaseAdapter的整体步骤：</p>
<blockquote>
<p>1 创建bean对象，用于封装数据；</p>
</blockquote>
<blockquote>
<p>2 在构造方法中初始化的数据List；</p>
</blockquote>
<blockquote>
<p>3 创建ViewHolder类，创建布局映射关系；</p>
</blockquote>
<blockquote>
<p>4 判断convertView，为空则创建，并设置tag，不为空则通过tag取出ViewHolder；</p>
</blockquote>
<blockquote>
<p>5 给ViewHolder的控件设置数据。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/01/02/Algorithm_%E6%9C%80%E5%A4%A7%E6%B5%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/02/Algorithm_%E6%9C%80%E5%A4%A7%E6%B5%81/" class="post-title-link" itemprop="url">最大流</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-02 15:49:10" itemprop="dateCreated datePublished" datetime="2020-01-02T15:49:10Z">2020-01-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-13 09:13:26" itemprop="dateModified" datetime="2022-11-13T09:13:26Z">2022-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="最大流"><a href="#最大流" class="headerlink" title="最大流"></a>最大流</h1><p>有一个源结点和一个汇点，从源结点向汇点“运输”货物。在不违反任何路径容量限制的条件下，从源结点到汇点运送货物的最大速率是多少——这一问题的抽象称为最大流问题</p>
<p>流具有三个需要注意的点！！</p>
<p>1、对于图中非s和t的普通结点，流进量等于流出量</p>
<p>2、我们非常关心总运输流量，比如这个下水道系统，究竟从s点到t点最多能运输多少立方米的水？我们把它记成|f|，这个|f|极其重要，是我们研究的目的所在。</p>
<p>3、当然，每条边是有运输上限的，就像某条公路车流是有上限的一样，若运输量无穷无尽，我们的研究也就没有意义了。我们将从u点到v点的运输上限，或者说是运载能力记为c(u,v)。对于从u点到v点的流量，记作f(u,v)。显然对所有边(u,v)我们有f(u,v)&lt;&#x3D;c(u,v)。<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_41613352/article/details/84481115">参考文章</a></p>
<h2 id="流网络"><a href="#流网络" class="headerlink" title="流网络"></a>流网络</h2><p>流网络G&#x3D;(V,E)是一个有向图，其中每条边(u,v)∈E均有一个非负能量c(u,v)≥0。如果(u,v)∉E，则假定c(u,v)&#x3D;0。流网络中有两个特点的顶点，源点s和汇点t，假定每个顶点均处于从源点到汇点的某条路径上，就是说，对每个顶点v∈V，存在一条路径s-&gt;v-&gt;t，因此图G是连通图，且|E|≥|V|-1。</p>
<blockquote>
<p>带权有向图：网络</p>
<p>结点：表示城市</p>
<p>有向边：表示运输路径和物流的方向</p>
<p>权重：表示运量限制</p>
<p>流：一条从源点到汇点的路径即路径上的流量——这种用来表示”流（flow）”的图称为“流网络”</p>
</blockquote>
<p>流网络遵循以下基本性质：</p>
<p>（1）流量守恒：除源结点和汇点外，其它结点上物料只是“流过”，即物料进入的速率等于离开的速率；</p>
<p>（2）物料的生成速率和接收速率恒定且足够快、足够多，满足需要（包括源结点的输出和所有结点的输入）；</p>
<p>（3）每条边上的容量是物料通过该边的最大速率，不能突破</p>
<p>流网络是一个有向图，边上定义有容量函数c：</p>
<p>(1) 有一个源结点s和汇点t；</p>
<p>(2) 有向边表示流向；</p>
<p>(3) 每条边上有一个非负的容量值；如果(u,v)∉E，则假定c(u,v)&#x3D;0；</p>
<p>(4) <strong>如果边集合E中包含（u，v）边，则图中不包含其反向边（u，v）</strong>；</p>
<p>(5) <strong>图中不允许有自循环</strong>；</p>
<p>(6) <strong>流网络是连通图</strong>，每个结点都在从s到t的某条路径上；</p>
<p>(7) 除源结点外，每个结点至少有一条流入的边；</p>
<p>(8) 除汇点外，每个结点至少有一条流出的边；</p>
<p>(9)  |E|&gt;&#x3D;|V|-1</p>
<p><strong>标准流网络</strong>：</p>
<p>(1)无反向边：也称为反向平行边。一个有向图中，（v，u）、（u，v）互为反向平行边</p>
<p>(2)只有单一的源结点和汇点。</p>
<p><strong>非标准流网络</strong>：</p>
<p>不满足上述要求的流网络是非标准的流网络。对于非标准的流网络可转化为标准流网络。</p>
<p>方法：</p>
<p>1）添加反向平行边</p>
<p><img src="https://i.loli.net/2021/01/17/s4Bl8YnIGwTZqb6.png"></p>
<p>2）多个源结点和多个汇点。加入一个超级源结点s。加入一个超级汇点t。</p>
<p><img src="https://i.loli.net/2021/01/17/bCp7QITLk52jDuq.png"></p>
<h2 id="Ford-Fulkerson方法"><a href="#Ford-Fulkerson方法" class="headerlink" title="Ford-Fulkerson方法"></a>Ford-Fulkerson方法</h2><p>通过不断增加可行流值的方式找到最大流：</p>
<p>（1）从流值为0的初始流开始；</p>
<p>（2）通过某种方法，对流值进行增加；</p>
<p>（3）当确认无法再增加流值时，就得到最大流；</p>
<p>首先这个算法有个重要的工具：残存网络。残存网络其实就是具有残存容量的图。算法导论上有个普遍公式来定义残存容量：<img src="https://i.loli.net/2021/01/17/JB9SVNoyeTqkrWs.png"></p>
<p>翻译一下公式，说明的就是对于两点间的残存容量定义为：<br>1.如果这两点连线原来就是原图的边，那么它的残存容量等于运载上限-运输流量。（<strong>就是目前你还能增加的流量的量</strong>）<br>2.如果这两点的反向连线是原图的边，那么它的残存容量等于那条边的运输流量。（<strong>表示目前用的运输流量，一旦该运输流量等于运载上限，运算结束</strong>）<br>3.其他情况是0，当做没连通。</p>
<p>接下来我们看看残存网络对我们的<strong>帮助</strong>：<br>1.残存网络中没有从s到t的路径时，最大流等于最小割容量。（<strong>没有路径就说明s到t的连线有一段已经达到了最大运载上限了，就是残存容量为0</strong>）<br>2.残存网络中有从s到t的路径时，最大流不等于最小割容量。</p>
<h2 id="最大流算法应用：寻找最大二分匹配"><a href="#最大流算法应用：寻找最大二分匹配" class="headerlink" title="最大流算法应用：寻找最大二分匹配"></a>最大流算法应用：寻找最大二分匹配</h2><p><a target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/242142">https://yq.aliyun.com/articles/242142</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/01/02/Algorithm_%E6%89%80%E6%9C%89%E7%BB%93%E7%82%B9%E5%AF%B9%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/02/Algorithm_%E6%89%80%E6%9C%89%E7%BB%93%E7%82%B9%E5%AF%B9%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/" class="post-title-link" itemprop="url">所有结点对的最短路径</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-02 15:49:00" itemprop="dateCreated datePublished" datetime="2020-01-02T15:49:00Z">2020-01-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-13 09:13:26" itemprop="dateModified" datetime="2022-11-13T09:13:26Z">2022-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="所有结点对的最短路径"><a href="#所有结点对的最短路径" class="headerlink" title="所有结点对的最短路径"></a>所有结点对的最短路径</h1><p><strong>问题</strong>：有一个带权有向图 G &#x3D; (V, E)，V 为图的顶点集合，E 为边的集合，权重函数为 w：E → R，该函数将边映射到实数值上。我们希望找到，对于所有结点对 u，v∈V，一条从结点 u 到结点 v 的最短路径，使得结点 u 到结点 v 的路径所有边的权重之和最小。</p>
<p>简单来说，我们考虑的问题是<strong>如何找到一个图中所有结点之间的最短路径</strong>。</p>
<p>用单源最短路径算法求解：<br>执行|V|次单源最短路径算法，每次使用一个不同的结点作为源点，从而可以求出每个结点到其他所有结点的最短路径。</p>
<ul>
<li>如果所有的边的权重为非负值，用Dijkstra算法：<ul>
<li>用线性数组实现最小优先队列：O(V^3^+VE)&#x3D;O(V^3^);</li>
<li>用二叉堆实现最小优先队列：O(VElgV)；（对稀疏图较好）</li>
<li>用斐波那契堆实现最小优先队列：O(V^2^lgV+VE)；</li>
</ul>
</li>
<li>如果有权重为负值边，用Bellman-Ford算法：<ul>
<li>一般的运行时间：O(V^2^E);</li>
<li>对稠密图，运行时间为O(V^4^)。</li>
</ul>
</li>
</ul>
<p><strong>允许存在权重为负值的边，但不能包含权重为负值的环路</strong></p>
<h3 id="邻接矩阵"><a href="#邻接矩阵" class="headerlink" title="邻接矩阵"></a>邻接矩阵</h3><p>邻接矩阵是表示一个图的常用存储表示。它用两个数组分别存储数据元素（顶点）的信息和数据元素之间的关系（边或弧）的信息。<br>$$<br>W_{ij}&#x3D;\begin{cases}0 &amp;&amp;&amp;&amp;&amp;&amp;if&amp;i&#x3D;j\有向边（i，j）的权重 &amp;&amp;&amp;&amp;&amp;&amp;if&amp;i\not&#x3D;j&amp;and(i,j)\in E\NIL &amp;&amp;&amp;&amp;&amp;&amp;if&amp;i\not&#x3D;j&amp;and(i,j)\notin E\\end{cases}<br>$$</p>
<h3 id="最短路径和矩阵乘法"><a href="#最短路径和矩阵乘法" class="headerlink" title="最短路径和矩阵乘法"></a>最短路径和矩阵乘法</h3><h4 id="步骤一：分析最优解结构"><a href="#步骤一：分析最优解结构" class="headerlink" title="步骤一：分析最优解结构"></a>步骤一：分析最优解结构</h4><p>一条最短路径的所有子路径都是最短路径</p>
<p><strong>每条路径都是最短路径</strong></p>
<h4 id="步骤二：所有结点对最短路径的递归解"><a href="#步骤二：所有结点对最短路径的递归解" class="headerlink" title="步骤二：所有结点对最短路径的递归解"></a>步骤二：所有结点对最短路径的递归解</h4><p>设<img src="/images/%E6%89%80%E6%9C%89%E7%BB%93%E7%82%B9%E5%AF%B9%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/20180611225358746" style="zoom: 33%;" />为从i到j的一条最短路径，且这条路径最多包含m条边。我们可以得到以下的递推公式：</p>
<img src="/images/%E6%89%80%E6%9C%89%E7%BB%93%E7%82%B9%E5%AF%B9%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/2018061122580795-1578384535707" style="zoom: 50%;" />

<p>如果图G不包含权重为负值的环路，则对于每一对结点i和j，如果δ(i,j)&lt;∞，则从i到j之间存在一条最短路径。并且，由于最短路径是简单路径，其中至多包含n-1条边，因此有：</p>
<img src="/images/%E6%89%80%E6%9C%89%E7%BB%93%E7%82%B9%E5%AF%B9%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/image-20200107161153382.png" style="zoom: 67%;" />

<h4 id="步骤三：自底向上计算最短路径权重"><a href="#步骤三：自底向上计算最短路径权重" class="headerlink" title="步骤三：自底向上计算最短路径权重"></a>步骤三：自底向上计算最短路径权重</h4><h4 id="步骤三改进：重复平方"><a href="#步骤三改进：重复平方" class="headerlink" title="步骤三改进：重复平方"></a>步骤三改进：重复平方</h4><h4 id="步骤四：构建最优解"><a href="#步骤四：构建最优解" class="headerlink" title="步骤四：构建最优解"></a>步骤四：构建最优解</h4><h2 id="计算最短路径权重-Floyd-Warshall-算法"><a href="#计算最短路径权重-Floyd-Warshall-算法" class="headerlink" title="计算最短路径权重 - Floyd-Warshall 算法"></a>计算最短路径权重 - Floyd-Warshall 算法</h2><p><strong>采取的是动态规划策略</strong></p>
<p><strong>算法的时间复杂度Θ(V^3^)。</strong></p>
<p><strong>算法允许图中存在负权重的边，但不能存在权重为负值的环路</strong></p>
<p>Floyd 算法考虑的是<em>一条路径上的中间结点</em>。对于任意结点对 i，j∈V，考虑从结点 i 到结点 j 的所有中间结点均取自集合 {1, 2, …, k} 的路径（该集合是 V &#x3D;{1,2,3·····,n}的一个子集），并且设 p 为最短路径。</p>
<p>含义：</p>
<ul>
<li><p>p是简单路径，且p的中间结点都不大于k。</p>
</li>
<li><p>p从i到j，仅经过集合{1,2,…,k}中的结点，但，</p>
<ul>
<li>不一定经过其中的每一个结点，且与顺序无关；</li>
<li>也可能不存在这样的路径，此时p的权重等于∞</li>
</ul>
</li>
</ul>
<blockquote>
<p>从任意节点i到任意节点j的最短路径不外乎2种可能，1是直接从i到j，2是从i经过若干个节点k到j。所以，算法假设Dis(i,j)为节点u到节点v的最短路径的距离，对于每一个节点k，算法检查Dis(i,k) + Dis(k,j) &lt; Dis(i,j)是否成立，如果成立，证明从i到k再到j的路径比i直接到j的路径短，便设置Dis(i,j) &#x3D; Dis(i,k) + Dis(k,j)，这样一来，当遍历完所有节点k，Dis(i,j)中记录的便是i到j的最短路径的距离。</p>
</blockquote>
<p>有两种情况：</p>
<ul>
<li>如果结点 k 不是路径 p 上的中间结点，则路径 p 上的所有中间结点都属于集合 {1, 2, …, k - 1}。</li>
<li>如果结点 k 是路径 p 上的中间结点，则可将路径 p 分解为两条路径，分别是结点 i 到结点 k 和结点 k 到结点 j 的路径。</li>
</ul>
<p>简单来说，就是中间结点选自集合 {1，2，…，k - 1} 的时候的所有结点对的最短路径权重已经知道了，接下来的考虑的中间结点从集合 1，2，…，k - 1，k} 选的时候最短路径权重是多少，只需要考虑路径经过结点 k 的时候权重变化就行了，k 可将 i 到 j 的路径分为两条路径，分别是结点 i 到结点 k 和结点 k 到结点 j 的路径，而这两个的最短路径权重已经知道的（i 到 k 的最短路径的中间结点只能从集合 {1，2，…，k - 1} 选），同理 k 到 j），所以最新的权重选择经过 k 与不经过 k 时的权重较小的那个就行。</p>
<h3 id="递归解"><a href="#递归解" class="headerlink" title="递归解"></a>递归解</h3><p>设$$d^{(k)}_{ij}$$表示从结点 i 到结点 j 的所有中间结点全部取自集合 {1，2，…，k} 的一条最短路径的权重。</p>
<p>k &#x3D; 0 时，表示结点 i 到结点 j 的路径没有任何中间结点，因此$$d^{(0)}<em>{ij} &#x3D; w</em>{ij} $$。</p>
<p>状态转移方程：<br>$$<br>d^{(k)}<em>{ij} &#x3D; \begin{cases} w</em>{ij} &amp;  \text {if $k &#x3D; 0$} \min(d^{(k-1)}<em>{ij}, d^{(k-1)}</em>{ik}+ d^{(k-1)}_{kj}) &amp;  \text {if $k\geq1$  }\end{cases}<br>$$</p>
<p>而因为任何路径的中间结点都属于集合{1,2,…,n}，所以k&#x3D;n时，$$d^{(n)}_{ij}$$给出所有可能的从结点i到结点j的中间结点均取自集合{1,2,…,n}的一条最短路径的权重，也就是从结点i到结点j的最短路径的权重。</p>
<p>所以对所有的$$i,j\in V$$,有：<br>$$<br>d^{(n)}_{ij}&#x3D;δ(i,j)<br>$$</p>
<h3 id="自底向上计算最短路径权重"><a href="#自底向上计算最短路径权重" class="headerlink" title="自底向上计算最短路径权重"></a>自底向上计算最短路径权重</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">floyd</span><span class="params">(Graph G, <span class="type">int</span> dist)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//vexnum表示图G的顶点数</span></span><br><span class="line">    <span class="comment">// 计算最短路径</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; G.vexnum; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; G.vexnum; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; G.vexnum; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 如果经过下标为k顶点路径比原两点间路径更短，则更新dist[i][j]</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> (dist[i][k] + dist[k][j]);</span><br><span class="line">                <span class="keyword">if</span> (dist[i][j] &gt; tmp)</span><br><span class="line">                &#123;</span><br><span class="line">                    dist[i][j] = tmp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="构建最短路径"><a href="#构建最短路径" class="headerlink" title="构建最短路径"></a>构建最短路径</h3><p>思路：给定一个前驱矩阵 $$\prod$$，再利用递归的思想即可输出结点 i 到结点 j 的最短路径。</p>
<p><strong>前驱矩阵</strong></p>
<blockquote>
<p>定义：给出的是从结点 i 到结点 j 的最短路径上结点 j 的前驱结点，i&#x3D;j 或者从 i 到 j 不存在路径时为 NIL。</p>
</blockquote>
<p>$$\pi^{(k)}_{ij}$$为从结点i到结点j的一条所有中间结点都取自集合{1,2, …, k}的最短路径上j的前驱结点。</p>
<p><strong>怎么得到前驱矩阵？</strong>一种方法是计算权重矩阵 dist 的同时计算前驱矩阵 ∏。具体来说，与 floyd 算法思路类似，分为两种情况：<br>当 k &#x3D; 0 时，从 i 到 j 的最短路径没有中间结点，所以，<br>$$<br>\pi^{(0)}<em>{ij} &#x3D; \begin{cases} NIL &amp;  \text {if $i &#x3D; j\ or\ w</em>{ij} &#x3D; NIL$ } \i &amp;  \text {if $i \ne j\ or\ w_{ij} &lt; NIL$ }\end{cases}<br>$$<br>当 k≥1时<br>$$<br>\pi^{(k)}<em>{ij} &#x3D; \begin{cases}\pi^{(k-1)}<em>{ij}  &amp;  \text {if $d^{(k-1)}</em>{ij} \leq d^{(k-1)}<em>{ik} + d^{(k-1)}</em>{kj}$ } \ \pi^{(k-1)}<em>{kj} &amp;  \text {if $d^{(k-1)}</em>{ij} &gt; d^{(k-1)}</em>{ik} + d^{(k-1)}_{kj}$ }\end{cases}<br>$$</p>
<blockquote>
<p>若不经过k：</p>
<p>此时求从结点i到结点j的所有中间结点都取自集合{1,2,…,k}的最短路径上的j的前驱等价于求从结点i到结点j的所有中间结点都取自集合{1,2,…,k-1}的最短路径上的j的前驱。</p>
<p>若经过k：</p>
<p>此时求从结点i到结点j的所有中间结点都取自集合{1,2,…,k}的最短路径上的j的前驱等价于求从结点k到结点j的所有中间结点都取自集合{1,2,…,k-1}的最短路径上的j的前驱。</p>
</blockquote>
<p><img src="/images/%E6%89%80%E6%9C%89%E7%BB%93%E7%82%B9%E5%AF%B9%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/image-20200107170608073.png"></p>
<p><img src="/images/%E6%89%80%E6%9C%89%E7%BB%93%E7%82%B9%E5%AF%B9%E7%9A%84%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/image-20200107170623559.png"></p>
<h2 id="用于稀疏图的Johnson算法"><a href="#用于稀疏图的Johnson算法" class="headerlink" title="用于稀疏图的Johnson算法"></a>用于稀疏图的Johnson算法</h2><p>在稀疏图中求每对结点之间的最短路径权重。</p>
<p>对稀疏图，Johnson算法优于Floyd-Warshall算法，时间复杂度可达O(V^2^lgV+VE)。</p>
<ol>
<li>Johnson算法使用的方式相当于给每个边都加了一个权重，使得所有边都为非负数，这样就能对每个边使用较为高效的Dijkstra算法。</li>
<li>注意的是不能简单的给每个边加相同的值然后使得所有边都变成非负数，原因为假设从a-&gt;b有两条路径，一条权重为1+1，一条为2，本应权重和相等；如果都加1，则变成了2+2和3，不一致了，就会导致更新了不该更新的边。</li>
<li>Johnson比较巧妙的引入了h函数来解决这个问题，通过这个函数进行每个边的重新赋值权重</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/36bbe0e86765">参考文章</a></p>
<h3 id="算法描述"><a href="#算法描述" class="headerlink" title="算法描述"></a>算法描述</h3><ol>
<li>给定图 G &#x3D; (V, E)，增加一个新的顶点 s，使 s 指向图 G 中的所有顶点都建立连接，设新的图为 G’；</li>
<li>对图 G’ 中顶点 s 使用 Bellman-Ford 算法计算单源最短路径，得到结果 h[] &#x3D; {h[0], h[1], .. h[V-1]}；</li>
<li>对原图 G 中的所有边进行 “re-weight”，即对于每个边 (u, v)，其新的权值为 w(u, v) + (h[u] - h[v])；</li>
<li>移除新增的顶点 s，对每个顶点运行 Dijkstra 算法求得最短路径；</li>
</ol>
<h3 id="算法证明"><a href="#算法证明" class="headerlink" title="算法证明"></a>算法证明</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://rshawshank.github.io/2020/01/02/Algorithm_%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="rhb">
      <meta itemprop="description" content="纵浪大化中，不喜亦不惧">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rhb_blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/02/Algorithm_%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/" class="post-title-link" itemprop="url">最小生成树</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-02 15:48:32" itemprop="dateCreated datePublished" datetime="2020-01-02T15:48:32Z">2020-01-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-13 09:13:26" itemprop="dateModified" datetime="2022-11-13T09:13:26Z">2022-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="最小生成树"><a href="#最小生成树" class="headerlink" title="最小生成树"></a>最小生成树</h1><p>关于图的几个概念定义：</p>
<ul>
<li><strong>连通图</strong>：在无向图中，若任意两个顶点vivi与vjvj都有路径相通，则称该无向图为连通图。</li>
<li><strong>强连通图</strong>：在有向图中，若任意两个顶点vivi与vjvj都有路径相通，则称该有向图为强连通图。</li>
<li><strong>连通网</strong>：在连通图中，若图的边具有一定的意义，每一条边都对应着一个数，称为权；权代表着连接连个顶点的代价，称这种连通图叫做连通网。</li>
<li><strong>生成树</strong>：一个连通图的生成树是指一个连通子图，它含有图中全部n个顶点，但只有足以构成一棵树的n-1条边。一颗有n个顶点的生成树有且仅有n-1条边，如果生成树中再添加一条边，则必定成环。</li>
<li><strong>最小生成树</strong>：在连通网的所有生成树中，所有边的代价和最小的生成树，称为最小生成树。</li>
</ul>
<p><strong>最小生成树并不一定唯一</strong></p>
<h2 id="最小生成树的形成"><a href="#最小生成树的形成" class="headerlink" title="最小生成树的形成"></a>最小生成树的形成</h2><h3 id="MST性质"><a href="#MST性质" class="headerlink" title="MST性质"></a>MST性质</h3><p>假设N &#x3D; （V，{ E }）是一个连通网，U 是顶点集V的一个非空子集。若（u , v ）是一条具有最小权值（代价）的边，其中u∈U， v∈V - U，则必存在一棵包含边（u，v）的最小生成树。</p>
<p><strong>证明：</strong></p>
<p>剪枝-粘贴法</p>
<p>假设网N的任何一棵最小生成树都不包含（u，v）。设T是连通网上的一棵最小生成树，当将边（u，v）加入到T中时，由生成树的定义，T中必存在一条包含（u，v)的回路。另一方面，由于T是生成树，则在T上必存在另一条边（u’，v’），其中u’∈U，v’∈V - U，且u和u’之间，v和v’之间均有路径相通。删去边（u’，v’），便可消除上述回路，同时得到另一棵生成树T’。因为（u，v）的代价不高于（u’，v’），则T’的代价亦不高于T，T’是包含（u，v）的一棵最小生成树，和假设矛盾。</p>
<h3 id="贪心策略设计（MST性质）"><a href="#贪心策略设计（MST性质）" class="headerlink" title="贪心策略设计（MST性质）"></a>贪心策略设计（MST性质）</h3><p>每个时刻，该方法生长最小生成树的一条边，并在整个策略的实施过程中，管理一个遵守下述循环不变式的边的集合A：<strong>在每遍循环之前，A是某棵最小生成树的一个子集。</strong></p>
<p>循环不变式：在每遍循环之前，A是某棵最小生成树的一个子集。</p>
<p>处理策略：每一步，我们选择一条边不违反循环不变式的边(u,v)加入集合A，即A∪{(u,v)}仍是某棵最小生成树的子集。</p>
<p>这样的边称为“安全边”，因为在集合A中加入它不会破坏A的循环不变式。</p>
<h2 id="Kruskal算法（贪心算法）"><a href="#Kruskal算法（贪心算法）" class="headerlink" title="Kruskal算法（贪心算法）"></a>Kruskal算法（贪心算法）</h2><p>初始最小生成树边数为0，每迭代一次就选择一条满足条件的最小代价边，加入到最小生成树的边集合里。 </p>
<ol>
<li>把图中的所有边按代价从小到大排序； </li>
<li>把图中的n个顶点看成独立的n棵树组成的森林； </li>
<li>按权值从小到大选择边，所选的边连接的两个顶点u<del>i</del>,v<del>i</del>（u<del>i</del>,v<del>i</del>,应属于两颗不同的树），则成为最小生成树的一条边，并将这两颗树合并作为一颗树。 </li>
<li>重复(3),直到所有顶点都在一颗树内或者有n-1条边为止。</li>
<li><strong>注意：不能生成环</strong></li>
</ol>
<p> <img src="/images/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/20160714144315409"></p>
<p>Kruskal算法的时间为：O(E lgE)。</p>
<p>如果再注意到|E|&lt;|V|2，则有lg|E|&#x3D;O(lgV)，所以Kruskal算法的时间可表示为O(E lgV)。</p>
<h2 id="Prim算法（贪心算法）"><a href="#Prim算法（贪心算法）" class="headerlink" title="Prim算法（贪心算法）"></a>Prim算法（贪心算法）</h2><p>此算法可以称为“加点法”，每次迭代选择代价最小的边（已经加到最小生成树的点可以连接的边中选择）对应的点，加入到最小生成树中。算法从某一个顶点s开始，逐渐长大覆盖整个连通网的所有顶点。</p>
<ol>
<li>图的所有顶点集合为V；初始令集合u&#x3D;{s},v&#x3D;V−u;</li>
<li>在两个集合u,v能够组成的边中，选择一条代价最小的边(u<del>0</del>,v<del>0</del>)，加入到最小生成树中，并把v<del>0</del>并入到集合u中。</li>
<li>重复上述步骤，直到最小生成树有n-1条边或者n个顶点为止。</li>
<li><strong>注意不能生成环</strong></li>
</ol>
<p>由于不断向集合u中加点，所以最小代价边必须同步更新；需要建立一个辅助数组closedge,用来维护集合v中每个顶点与集合u中最小代价边信息，</p>
<p><img src="/images/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/20160714161107576"></p>
<p>Prim算法的运行时间依赖于最小优先队列Q的具体实现。</p>
<p>可用二叉最小优先队列的方式实现。</p>
<p>每次EXTRACT-MIN的时间是O(lgV)。</p>
<p>EXTRACT-MIN的总时间是O(V lgV)。</p>
<p>其它时间：第11行的赋值操作共需O(E lgV)。</p>
<p>Prim算法的时间为：O(V lgV+E lgV)&#x3D;O(E lgV)。</p>
<p>从渐进意义上看，Kruskal和Prim算法具有相同的运行时间</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/16/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rhb</p>
  <div class="site-description" itemprop="description">纵浪大化中，不喜亦不惧</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">180</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/RShawshank" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;RShawshank" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rhb</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://lib.baomitu.com/canvas-nest.js/1.0.1/canvas-nest.js"></script>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
